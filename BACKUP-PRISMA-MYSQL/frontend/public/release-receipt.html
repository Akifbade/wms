<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Release Receipt</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    .receipt-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .header {
      text-align: center;
      border-bottom: 3px solid #4F46E5;
      padding-bottom: 20px;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #4F46E5;
      font-size: 32px;
      margin-bottom: 5px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .receipt-type {
      background: #4F46E5;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      display: inline-block;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .info-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .info-box {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #4F46E5;
    }

    .info-box h3 {
      color: #4F46E5;
      font-size: 14px;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .info-label {
      color: #666;
      font-weight: 500;
    }

    .info-value {
      color: #111;
      font-weight: 600;
    }

    .boxes-section {
      margin: 30px 0;
      padding: 20px;
      background: #fef3c7;
      border-radius: 8px;
      border: 2px solid #f59e0b;
    }

    .boxes-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .box-item {
      background: white;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: #4F46E5;
    }

    .payment-section {
      background: #d1fae5;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #10b981;
      margin: 30px 0;
    }

    .payment-section h3 {
      color: #10b981;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .payment-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .debt-section {
      background: #fed7aa;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #f97316;
      margin: 30px 0;
    }

    .debt-section h3 {
      color: #f97316;
      margin-bottom: 10px;
    }

    .signatures {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 50px;
      margin-top: 60px;
      padding-top: 30px;
      border-top: 2px dashed #ccc;
    }

    .signature-box {
      text-align: center;
    }

    .signature-line {
      border-top: 2px solid #333;
      margin-bottom: 10px;
      padding-top: 10px;
    }

    .signature-label {
      color: #666;
      font-size: 14px;
      font-weight: 600;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 2px solid #e5e7eb;
      color: #666;
      font-size: 12px;
    }

    .status-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 14px;
    }

    .status-full {
      background: #10b981;
      color: white;
    }

    .status-partial {
      background: #f59e0b;
      color: white;
    }

    .status-paid {
      background: #10b981;
      color: white;
    }

    .status-unpaid {
      background: #ef4444;
      color: white;
    }

    @media print {
      body {
        background: white;
        padding: 0;
      }

      .receipt-container {
        box-shadow: none;
        padding: 20px;
      }

      .no-print {
        display: none;
      }
    }

    .print-button {
      background: #4F46E5;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin: 20px auto;
      display: block;
    }

    .print-button:hover {
      background: #4338ca;
    }

    .qr-section {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      background: #f9fafb;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="receipt-container">
    <div class="header">
      <h1>üì¶ RELEASE RECEIPT</h1>
      <p>Goods Release Confirmation | ÿ™ÿ£ŸÉŸäÿØ ÿ•ÿµÿØÿßÿ± ÿßŸÑÿ®ÿ∂ÿßÿ¶ÿπ</p>
    </div>

    <div class="no-print" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
      <button class="print-button" onclick="window.print()" style="margin: 0;">
        üñ®Ô∏è Print Receipt
      </button>
      <button class="print-button" onclick="window.close()" style="margin: 0; background: #6b7280;">
        ‚úñÔ∏è Close
      </button>
    </div>

    <div id="receiptContent"></div>

    <div class="footer">
      <p><strong>Thank you for using our service!</strong></p>
      <p>ÿ¥ŸÉÿ±ÿßŸã ŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿÆÿØŸÖÿßÿ™ŸÜÿß</p>
      <p style="margin-top: 10px; font-size: 11px;">
        This is a computer-generated receipt. For any queries, please contact us.
      </p>
    </div>
  </div>

  <script>
    // Load receipt data from sessionStorage
    const receiptDataStr = sessionStorage.getItem('releaseReceipt');
    
    if (!receiptDataStr) {
      document.getElementById('receiptContent').innerHTML = `
        <div style="text-align: center; padding: 60px; color: #ef4444;">
          <h2>‚ùå No receipt data found</h2>
          <p>Please go back and try again.</p>
        </div>
      `;
    } else {
      const data = JSON.parse(receiptDataStr);
      renderReceipt(data);
    }

    function renderReceipt(data) {
      const { withdrawal, shipment, invoice, payment, releaseDate, releaseType, boxesReleased, boxesRemaining } = data;

      const releaseTypeBadge = releaseType === 'FULL' 
        ? '<span class="status-badge status-full">‚úÖ FULL RELEASE</span>'
        : '<span class="status-badge status-partial">‚ö†Ô∏è PARTIAL RELEASE</span>';

      const paymentStatusBadge = payment 
        ? '<span class="status-badge status-paid">üí∞ PAID</span>'
        : '<span class="status-badge status-unpaid">üìù ON DEBT</span>';

      let html = `
        <div style="text-align: center; margin-bottom: 20px;">
          ${releaseTypeBadge}
          ${paymentStatusBadge}
        </div>

        <div class="info-section">
          <div class="info-box">
            <h3>üìã Shipment Details</h3>
            <div class="info-row">
              <span class="info-label">Reference ID:</span>
              <span class="info-value">${shipment.referenceId || 'N/A'}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Client Name:</span>
              <span class="info-value">${shipment.clientName || 'N/A'}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Client Phone:</span>
              <span class="info-value">${shipment.clientPhone || 'N/A'}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Arrival Date:</span>
              <span class="info-value">${new Date(shipment.arrivalDate || shipment.receivedDate).toLocaleDateString()}</span>
            </div>
          </div>

          <div class="info-box">
            <h3>üìÖ Release Information</h3>
            <div class="info-row">
              <span class="info-label">Release Date:</span>
              <span class="info-value">${new Date(releaseDate).toLocaleDateString()}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Release Time:</span>
              <span class="info-value">${new Date(releaseDate).toLocaleTimeString()}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Collected By:</span>
              <span class="info-value">${withdrawal.withdrawnBy || 'N/A'}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Receipt Number:</span>
              <span class="info-value">${withdrawal.receiptNumber || 'N/A'}</span>
            </div>
          </div>
        </div>

        <div class="boxes-section">
          <h3 style="text-align: center; color: #f59e0b; margin-bottom: 15px; font-size: 18px;">
            üì¶ Boxes Released
          </h3>
          <div style="text-align: center; font-size: 48px; font-weight: bold; color: #f59e0b; margin: 20px 0;">
            ${boxesReleased}
          </div>
          <div style="text-align: center; color: #666;">
            ${releaseType === 'PARTIAL' ? `<p><strong>Remaining in storage: ${boxesRemaining} boxes</strong></p>` : '<p>All boxes released</p>'}
          </div>
        </div>
      `;

      // Payment section
      if (payment) {
        html += `
          <div class="payment-section">
            <h3>üí∞ Payment Details</h3>
            <div class="payment-grid">
              <div class="info-row">
                <span class="info-label">Amount Paid:</span>
                <span class="info-value">${payment.amount.toFixed(3)} KWD</span>
              </div>
              <div class="info-row">
                <span class="info-label">Payment Method:</span>
                <span class="info-value">${payment.method}</span>
              </div>
              ${payment.transactionRef ? `
                <div class="info-row">
                  <span class="info-label">Transaction Ref:</span>
                  <span class="info-value">${payment.transactionRef}</span>
                </div>
              ` : ''}
              <div class="info-row">
                <span class="info-label">Receipt Number:</span>
                <span class="info-value">${payment.receiptNumber}</span>
              </div>
            </div>
            <div class="info-row" style="margin-top: 15px; padding-top: 15px; border-top: 2px dashed #10b981;">
              <span class="info-label" style="font-size: 16px;">Invoice Total:</span>
              <span class="info-value" style="font-size: 18px; color: #10b981;">${invoice.totalAmount.toFixed(3)} KWD</span>
            </div>
            ${payment.amount < invoice.totalAmount ? `
              <div class="info-row">
                <span class="info-label" style="color: #ef4444;">Balance Due:</span>
                <span class="info-value" style="color: #ef4444; font-size: 18px;">${(invoice.totalAmount - payment.amount).toFixed(3)} KWD</span>
              </div>
            ` : ''}
          </div>
        `;
      } else {
        html += `
          <div class="debt-section">
            <h3>üìù Payment Status: ON DEBT</h3>
            <p style="font-size: 16px; margin: 10px 0;">
              <strong>Invoice Number:</strong> ${invoice.invoiceNumber}
            </p>
            <p style="font-size: 20px; font-weight: bold; color: #f97316; margin: 15px 0;">
              Amount Due: ${invoice.totalAmount.toFixed(3)} KWD
            </p>
            <p style="font-size: 14px; color: #666;">
              Customer must pay this amount before due date.
              Ÿäÿ¨ÿ® ÿπŸÑŸâ ÿßŸÑÿπŸÖŸäŸÑ ÿØŸÅÿπ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ®ŸÑÿ∫ ŸÇÿ®ŸÑ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßÿ≥ÿ™ÿ≠ŸÇÿßŸÇ
            </p>
          </div>
        `;
      }

      // Signatures
      html += `
        <div class="signatures">
          <div class="signature-box">
            <div class="signature-line"></div>
            <div class="signature-label">Authorized Staff Signature</div>
            <div class="signature-label" style="color: #999; font-size: 12px;">ÿ™ŸàŸÇŸäÿπ ÿßŸÑŸÖŸàÿ∏ŸÅ ÿßŸÑŸÖÿÆŸàŸÑ</div>
          </div>
          <div class="signature-box">
            <div class="signature-line"></div>
            <div class="signature-label">Customer Signature</div>
            <div class="signature-label" style="color: #999; font-size: 12px;">ÿ™ŸàŸÇŸäÿπ ÿßŸÑÿπŸÖŸäŸÑ</div>
          </div>
        </div>
      `;

      document.getElementById('receiptContent').innerHTML = html;

      // Auto-print on load
      setTimeout(() => {
        window.print();
      }, 500);
    }
  </script>
</body>
</html>
