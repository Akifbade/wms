import{r as l,j as e,u as Nt,c as Ws,F as Ie,d as Te,e as Me,f as Ae,g as Ye,h as Rs,i as we,k as rs,l as us,m as ls,n as Ts,L as xs,o as Ps,p as vt,q as zs,s as wt,O as Ct,t as De,v as St,w as ss,x as ns,y as Be,Q as nt,z as ge,A as ot,B as hs,C as Ds,D as Oe,E as os,G as it,H as ys,I as ds,J as Ge,K as qe,M as ps,N as Es,S as ze,T as kt,U as At,V as Rt,X as Se,W as fs,Y as js,Z as Je,_ as ms,$ as Ze,a0 as Tt,a1 as Is,a2 as Pt,a3 as dt,a4 as Ns,a5 as Dt,a6 as Et,a7 as It,a8 as Ft,a9 as Pe,aa as is,ab as vs,ac as ct,ad as Lt,ae as ws,af as Js,ag as Gs,ah as Fs,ai as Mt,aj as xt,ak as $t,al as Bt,am as Ot,an as mt,ao as Hs,ap as Ve,aq as qt,ar as Ut,as as Wt,at as zt,au as Vt,av as ks,aw as _s,ax as Ks,ay as Ls,az as Jt,aA as Gt,aB as Qs,aC as Ht,aD as Vs,aE as Xs,aF as Ms,aG as ut,aH as As,aI as _t,aJ as Kt,aK as Qt,aL as Xt,aM as Yt,aN as gs,aO as Zt,aP as Ys,aQ as ea,aR as es,aS as sa,aT as ta,aU as ie,aV as aa,aW as ra}from"./react-vendor-Bk0iDinh.js";import{R as $s,P as ht,a as pt,C as gt,T as Bs,L as Os,B as la,b as na,X as oa,Y as ia,c as da}from"./chart-vendor-vN45bKXT.js";import{b as Cs,H as ca}from"./qr-vendor-C2LrpBhg.js";import{E as xa}from"./pdf-vendor-Nz5meTMq.js";import{aI as Qe}from"./vendor-CvD_bgBn.js";(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const N of n)if(N.type==="childList")for(const r of N.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const N={};return n.integrity&&(N.integrity=n.integrity),n.referrerPolicy&&(N.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?N.credentials="include":n.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function o(n){if(n.ep)return;n.ep=!0;const N=t(n);fetch(n.href,N)}})();const ma=()=>{const[s,b]=l.useState(null),[t,o]=l.useState(!1);if(l.useEffect(()=>{fetch("/version.json?t="+Date.now()).then(r=>r.json()).then(r=>b(r)).catch(r=>console.error("Failed to load version:",r))},[]),!s)return null;const n=()=>{switch(s.environment){case"production":return"bg-green-100 text-green-800 border-green-300";case"staging":return"bg-yellow-100 text-yellow-800 border-yellow-300";default:return"bg-blue-100 text-blue-800 border-blue-300"}},N=()=>{switch(s.environment){case"production":return"🟢 Production";case"staging":return"🟡 Staging";default:return"🔵 Local Dev"}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed bottom-4 right-4 px-3 py-2 rounded-lg border text-xs font-mono shadow-md cursor-pointer hover:shadow-lg transition-shadow ${n()}`,onClick:()=>o(!0),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:s.version}),e.jsx("span",{className:"opacity-70",children:"•"}),e.jsx("span",{children:N()}),e.jsx("span",{className:"opacity-50 cursor-help text-base",title:"Click for details",children:"ℹ️"})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>o(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"📦 Version Info"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"✕"})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"font-semibold",children:"Version:"}),e.jsx("span",{className:"text-green-600 font-mono font-bold",children:s.version})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"font-semibold",children:"Environment:"}),e.jsx("span",{className:s.environment==="production"?"text-green-600":"text-yellow-600",children:s.environment.toUpperCase()})]}),e.jsxs("div",{className:"flex flex-col py-2 border-b",children:[e.jsx("span",{className:"font-semibold mb-1",children:"Latest Change:"}),e.jsxs("span",{className:"text-gray-700 italic bg-gray-50 px-2 py-1 rounded",children:['"',s.commitMessage||"No message",'"']})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"font-semibold",children:"Author:"}),e.jsx("span",{className:"text-blue-600",children:s.author})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"font-semibold",children:"Build Date:"}),e.jsx("span",{className:"text-gray-600",children:s.buildDate})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"font-semibold",children:"Build Time:"}),e.jsx("span",{className:"text-gray-600",children:s.buildTime})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>o(!1),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Close"})})]})})]})};var Zs={};const qs="v2.1.0",Ue={environment:Zs.REACT_APP_ENV||"development",buildDate:new Date().toISOString(),commitHash:Zs.REACT_APP_COMMIT_HASH||"local-dev"};console.log(`%c🚀 WMS Version: ${qs}`,"color: green; font-weight: bold; font-size: 14px");console.log(`%cEnvironment: ${Ue.environment}`,"color: blue");console.log(`%cCommit: ${Ue.commitHash}`,"color: gray");const ua=()=>{const s=()=>{switch(Ue.environment){case"production":return"bg-green-50 text-green-700 border-green-200";case"staging":return"bg-yellow-50 text-yellow-700 border-yellow-200";default:return"bg-blue-50 text-blue-700 border-blue-200"}},b=()=>{switch(Ue.environment){case"production":return"🟢";case"staging":return"🟡";default:return"🔵"}},t=()=>{switch(Ue.environment){case"production":return"Production";case"staging":return"Staging";default:return"Local Dev"}};return e.jsxs("div",{className:`hidden md:flex items-center gap-2 px-3 py-1 rounded-lg border text-xs font-mono ${s()}`,title:`Version: ${qs} | Commit: ${Ue.commitHash} | Deployed: ${Ue.buildDate}`,children:[e.jsx("span",{className:"font-bold",children:qs}),e.jsx("span",{className:"opacity-50",children:"•"}),e.jsxs("span",{children:[b()," ",t()]})]})},ha={ADMIN:[{name:"Dashboard",href:"/dashboard",icon:Rs},{name:"Shipments",href:"/shipments",icon:Ye},{name:"Racks",href:"/racks",icon:Ie},{name:"Materials",href:"/materials",icon:we},{name:"Material Reports",href:"/material-reports",icon:rs},{name:"Damage Report",href:"/damage-report",icon:us},{name:"Moving Jobs",href:"/moving-jobs",icon:Me},{name:"Invoices",href:"/invoices",icon:we},{name:"Expenses",href:"/expenses",icon:ls},{name:"Scanner",href:"/scanner",icon:Ae},{name:"Settings",href:"/settings",icon:Ts}],MANAGER:[{name:"Dashboard",href:"/dashboard",icon:Rs},{name:"Shipments",href:"/shipments",icon:Ye},{name:"Racks",href:"/racks",icon:Ie},{name:"Materials",href:"/materials",icon:we},{name:"Material Reports",href:"/material-reports",icon:rs},{name:"Damage Report",href:"/damage-report",icon:us},{name:"Moving Jobs",href:"/moving-jobs",icon:Me},{name:"Invoices",href:"/invoices",icon:we},{name:"Expenses",href:"/expenses",icon:ls},{name:"Scanner",href:"/scanner",icon:Ae}],WORKER:[{name:"My Jobs",href:"/my-jobs",icon:Me},{name:"QR Scanner",href:"/scanner",icon:Ae},{name:"My Tasks",href:"/my-tasks",icon:Ye}]},pa=()=>{var v,h,k;const[s,b]=l.useState(!1),[t,o]=l.useState(null),n=Nt(),N=Ws();l.useEffect(()=>{const j=localStorage.getItem("user");if(j)try{const y=JSON.parse(j);o(y),y.role==="WORKER"&&n.pathname==="/dashboard"&&N("/scanner",{replace:!0})}catch{console.error("Failed to parse user data")}},[n.pathname,N]);const r=j=>n.pathname.startsWith(j),T=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),N("/login")};return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>b(!1)}),e.jsxs("div",{className:`
          fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0
          ${s?"translate-x-0":"-translate-x-full"}
        `,children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center",children:e.jsx(Ie,{className:"h-5 w-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:"WMS"})]}),e.jsx("button",{onClick:()=>b(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-6 space-y-1 overflow-y-auto",children:(t==null?void 0:t.role)&&((v=ha[t.role])==null?void 0:v.map(j=>{const y=j.icon,g=r(j.href);return e.jsxs(xs,{to:j.href,className:`
                  flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors
                  ${g?"bg-primary-50 text-primary-700 border-l-4 border-primary-600":"text-gray-700 hover:bg-gray-100"}
                `,onClick:()=>b(!1),children:[e.jsx(y,{className:`mr-3 h-5 w-5 ${g?"text-primary-600":"text-gray-400"}`}),j.name]},j.name)}))}),e.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-3",children:[e.jsxs(xs,{to:"/profile",className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>b(!1),children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-primary-600 font-medium",children:((k=(h=t==null?void 0:t.name)==null?void 0:h.charAt(0))==null?void 0:k.toUpperCase())||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:(t==null?void 0:t.name)||"User"}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:(t==null?void 0:t.email)||"user@demo.com"}),e.jsx("p",{className:"text-xs text-primary-600 font-medium",children:"View Profile →"})]})]}),e.jsxs("button",{onClick:T,className:"flex items-center w-full px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:[e.jsx(Ps,{className:"mr-3 h-5 w-5"}),"Logout"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("header",{className:"bg-white shadow-sm z-30",children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-6",children:[e.jsx("button",{onClick:()=>b(!0),className:"lg:hidden text-gray-500 hover:text-gray-700",children:e.jsx(vt,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex-1 flex items-center justify-end space-x-4",children:[e.jsx(ua,{}),e.jsx("div",{className:"hidden md:block",children:e.jsx("input",{type:"text",placeholder:"Search...",className:"w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})}),e.jsxs("button",{className:"relative p-2 text-gray-400 hover:text-gray-600",children:[e.jsx(zs,{className:"h-6 w-6"}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),e.jsxs(xs,{to:"/profile",className:"flex items-center space-x-2 px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"View Profile",children:[e.jsx(wt,{className:"h-8 w-8"}),e.jsx("span",{className:"hidden md:inline text-sm font-medium",children:(t==null?void 0:t.name)||"Profile"})]}),e.jsxs("button",{onClick:T,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",title:"Logout",children:[e.jsx(Ps,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx(Ct,{})})]})]})},Us="/api",bs=()=>{const s=localStorage.getItem("authToken")||localStorage.getItem("token");return s&&!localStorage.getItem("authToken")&&localStorage.setItem("authToken",s),s},et=s=>{localStorage.setItem("authToken",s),localStorage.setItem("token",s)},ga=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("token"),localStorage.removeItem("user")},ba=()=>{const s=bs();return{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}}};async function _(s,b={}){const t=`${Us}${s}`,o={...b,headers:{...ba(),...b.headers}};try{const n=await fetch(t,o);if(!n.ok){const N=await n.json().catch(()=>({}));throw new Error(N.error||`HTTP ${n.status}: ${n.statusText}`)}return await n.json()}catch(n){throw console.error("API Error:",n),n}}const ya={login:async(s,b)=>{const t=await _("/auth/login",{method:"POST",body:JSON.stringify({email:s,password:b})});return et(t.token),localStorage.setItem("user",JSON.stringify(t.user)),t},register:async s=>{const b=await _("/auth/register",{method:"POST",body:JSON.stringify(s)});return et(b.token),localStorage.setItem("user",JSON.stringify(b.user)),b},me:async()=>_("/auth/me"),logout:()=>{ga()}},fa={getStats:async()=>_("/dashboard/stats")},$e={getAll:async s=>{const b=new URLSearchParams;s!=null&&s.status&&b.append("status",s.status),s!=null&&s.search&&b.append("search",s.search),s!=null&&s.page&&b.append("page",s.page.toString()),s!=null&&s.limit&&b.append("limit",s.limit.toString()),(s==null?void 0:s.isWarehouseShipment)!==void 0&&b.append("isWarehouseShipment",String(s.isWarehouseShipment));const t=b.toString();return _(`/shipments${t?`?${t}`:""}`)},getById:async s=>_(`/shipments/${s}`),create:async s=>_("/shipments",{method:"POST",body:JSON.stringify(s)}),update:async(s,b)=>_(`/shipments/${s}`,{method:"PUT",body:JSON.stringify(b)}),delete:async s=>_(`/shipments/${s}`,{method:"DELETE"})},Re={getAll:async s=>{const b=new URLSearchParams;s!=null&&s.status&&b.append("status",s.status),s!=null&&s.search&&b.append("search",s.search);const t=b.toString();return _(`/racks${t?`?${t}`:""}`)},getById:async s=>_(`/racks/${s}`),getCategories:async()=>_("/racks/categories/list"),create:async s=>_("/racks",{method:"POST",body:JSON.stringify(s)}),update:async(s,b)=>_(`/racks/${s}`,{method:"PUT",body:JSON.stringify(b)}),delete:async s=>_(`/racks/${s}`,{method:"DELETE"})},We={listProfiles:async()=>_("/company-profiles/"),getProfile:async s=>_(`/company-profiles/${s}`),createProfile:async s=>{const b=bs(),t=await fetch(`${Us}/company-profiles/`,{method:"POST",headers:{...b?{Authorization:`Bearer ${b}`}:{}},body:s});if(!t.ok){const o=await t.json().catch(()=>({}));throw new Error(o.error||`HTTP ${t.status}: ${t.statusText}`)}return t.json()},updateProfile:async(s,b)=>{const t=bs(),o=await fetch(`${Us}/company-profiles/${s}`,{method:"PUT",headers:{...t?{Authorization:`Bearer ${t}`}:{}},body:b});if(!o.ok){const n=await o.json().catch(()=>({}));throw new Error(n.error||`HTTP ${o.status}: ${o.statusText}`)}return o.json()},deleteProfile:async s=>_(`/company-profiles/${s}`,{method:"DELETE"})},as={getAll:async s=>{const b=new URLSearchParams;s!=null&&s.status&&b.append("status",s.status),s!=null&&s.search&&b.append("search",s.search),s!=null&&s.startDate&&b.append("startDate",s.startDate),s!=null&&s.endDate&&b.append("endDate",s.endDate);const t=b.toString();return{jobs:await _(`/moving-jobs${t?`?${t}`:""}`)}},getById:async s=>_(`/moving-jobs/${s}`),create:async s=>_("/moving-jobs",{method:"POST",body:JSON.stringify(s)}),update:async(s,b)=>_(`/moving-jobs/${s}`,{method:"PATCH",body:JSON.stringify(b)}),delete:async s=>_(`/moving-jobs/${s}`,{method:"DELETE"})},Ee={getSettings:async()=>_("/billing/settings"),updateSettings:async s=>_("/billing/settings",{method:"PUT",body:JSON.stringify(s)}),getChargeTypes:async s=>{const b=new URLSearchParams;return s!=null&&s.category&&b.append("category",s.category),(s==null?void 0:s.active)!==void 0&&b.append("active",String(s.active)),_(`/billing/charge-types${b.toString()?"?"+b.toString():""}`)},getChargeType:async s=>_(`/billing/charge-types/${s}`),createChargeType:async s=>_("/billing/charge-types",{method:"POST",body:JSON.stringify(s)}),updateChargeType:async(s,b)=>_(`/billing/charge-types/${s}`,{method:"PUT",body:JSON.stringify(b)}),deleteChargeType:async s=>_(`/billing/charge-types/${s}`,{method:"DELETE"}),getInvoices:async s=>{const b=new URLSearchParams(s).toString();return _(`/billing/invoices${b?"?"+b:""}`)},getInvoice:async s=>_(`/billing/invoices/${s}`),createInvoice:async s=>_("/billing/invoices",{method:"POST",body:JSON.stringify(s)}),recordPayment:async(s,b)=>_(`/billing/invoices/${s}/payments`,{method:"POST",body:JSON.stringify(b)})},ja={getAll:async s=>{const b=new URLSearchParams;s!=null&&s.status&&b.append("status",s.status),s!=null&&s.search&&b.append("search",s.search),s!=null&&s.startDate&&b.append("startDate",s.startDate),s!=null&&s.endDate&&b.append("endDate",s.endDate),s!=null&&s.shipmentId&&b.append("shipmentId",s.shipmentId);const t=b.toString();return _(`/withdrawals${t?`?${t}`:""}`)},getById:async s=>_(`/withdrawals/${s}`),create:async s=>_("/withdrawals",{method:"POST",body:JSON.stringify(s)}),updateStatus:async(s,b)=>_(`/withdrawals/${s}/status`,{method:"PUT",body:JSON.stringify({status:b})}),delete:async s=>_(`/withdrawals/${s}`,{method:"DELETE"})},Xe={getAll:async s=>{const b=new URLSearchParams(s).toString();return _(`/expenses?${b}`,{method:"GET"})},getById:async s=>_(`/expenses/${s}`,{method:"GET"}),create:async s=>_("/expenses",{method:"POST",body:JSON.stringify(s)}),update:async(s,b)=>_(`/expenses/${s}`,{method:"PUT",body:JSON.stringify(b)}),delete:async s=>_(`/expenses/${s}`,{method:"DELETE"}),updateStatus:async(s,b)=>_(`/expenses/${s}/status`,{method:"PATCH",body:JSON.stringify({status:b})}),getStats:async s=>{const b=new URLSearchParams(s).toString();return _(`/expenses/stats/summary?${b}`,{method:"GET"})}},st={getInfo:()=>_("/company",{method:"GET"}),updateInfo:s=>_("/company",{method:"PUT",body:JSON.stringify(s)})},Na={getAll:()=>_("/users",{method:"GET"}),getById:s=>_(`/users/${s}`,{method:"GET"}),create:s=>_("/users",{method:"POST",body:JSON.stringify(s)}),update:(s,b)=>_(`/users/${s}`,{method:"PUT",body:JSON.stringify(b)}),delete:s=>_(`/users/${s}`,{method:"DELETE"}),toggleStatus:s=>_(`/users/${s}/toggle`,{method:"PATCH"})},tt={get:()=>_("/invoice-settings",{method:"GET"}),update:s=>_("/invoice-settings",{method:"PUT",body:JSON.stringify(s)})},at={get:()=>_("/notification-preferences",{method:"GET"}),update:s=>_("/notification-preferences",{method:"PUT",body:JSON.stringify(s)}),sendTest:s=>_("/notification-preferences/test",{method:"POST",body:JSON.stringify({type:s})})},cs={getAll:s=>{const b=s?`?section=${s}`:"";return _(`/custom-fields${b}`,{method:"GET"})},getById:s=>_(`/custom-fields/${s}`,{method:"GET"}),create:s=>_("/custom-fields",{method:"POST",body:JSON.stringify(s)}),update:(s,b)=>_(`/custom-fields/${s}`,{method:"PUT",body:JSON.stringify(b)}),delete:s=>_(`/custom-fields/${s}`,{method:"DELETE"})},bt=()=>{const[s,b]=l.useState([]),[t,o]=l.useState(!1),[n,N]=l.useState(!1),[r,T]=l.useState({jobCode:"",jobTitle:"",clientName:"",clientPhone:"",clientEmail:"",jobDate:"",jobAddress:"",dropoffAddress:"",notes:""});l.useEffect(()=>{v()},[]);const v=async()=>{o(!0);try{const j=await fetch("/api/moving-jobs",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(j.ok){const y=await j.json();b(y)}}catch(j){console.error("Failed to fetch jobs:",j)}finally{o(!1)}},h=async j=>{j.preventDefault();try{(await fetch("/api/moving-jobs",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(r)})).ok&&(N(!1),T({jobCode:"",jobTitle:"",clientName:"",clientPhone:"",clientEmail:"",jobDate:"",jobAddress:"",dropoffAddress:"",notes:""}),v())}catch(y){console.error("Failed to create job:",y)}},k=j=>({PLANNED:"#17a2b8",DISPATCHED:"#ffc107",IN_PROGRESS:"#007bff",COMPLETED:"#28a745",CLOSED:"#6c757d",CANCELLED:"#dc3545"})[j]||"#6c757d";return e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{children:"Moving Jobs Management"}),e.jsx("button",{onClick:()=>N(!n),style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:n?"Cancel":"Create New Job"})]}),n&&e.jsx("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",marginBottom:"20px"},children:e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Job Code *"}),e.jsx("input",{type:"text",required:!0,value:r.jobCode,onChange:j=>T({...r,jobCode:j.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Job Title *"}),e.jsx("input",{type:"text",required:!0,value:r.jobTitle,onChange:j=>T({...r,jobTitle:j.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Client Name *"}),e.jsx("input",{type:"text",required:!0,value:r.clientName,onChange:j=>T({...r,clientName:j.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Client Phone *"}),e.jsx("input",{type:"tel",required:!0,value:r.clientPhone,onChange:j=>T({...r,clientPhone:j.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Job Date *"}),e.jsx("input",{type:"datetime-local",required:!0,value:r.jobDate,onChange:j=>T({...r,jobDate:j.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Job Address *"}),e.jsx("input",{type:"text",required:!0,value:r.jobAddress,onChange:j=>T({...r,jobAddress:j.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"}})]}),e.jsx("button",{type:"submit",style:{padding:"10px 20px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Create Job"})]})}),e.jsxs("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"8px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[t?e.jsx("p",{children:"Loading..."}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Job Code"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Job Title"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Client"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Date"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:s.map(j=>e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:j.jobCode}),e.jsx("td",{style:{padding:"12px"},children:j.jobTitle}),e.jsx("td",{style:{padding:"12px"},children:j.clientName}),e.jsx("td",{style:{padding:"12px"},children:new Date(j.jobDate).toLocaleDateString()}),e.jsx("td",{style:{padding:"12px"},children:e.jsx("span",{style:{backgroundColor:k(j.status),color:"white",padding:"4px 8px",borderRadius:"3px",fontSize:"12px",fontWeight:"bold"},children:j.status})})]},j.id))})]}),s.length===0&&!t&&e.jsx("p",{style:{textAlign:"center",color:"#6c757d"},children:"No jobs found. Create one to get started!"})]})]})},va=()=>{var u,C,A,w,p,f,D,L,q,E,P,J,F,z,K,V,S,O,M,H,de,be,he,ve,Ne,ae,He,_e,Fe,Q,G;const[s,b]=l.useState(null),[t,o]=l.useState([]),[n,N]=l.useState([]),[r,T]=l.useState([]),[v,h]=l.useState([]),[k,j]=l.useState([]),[y,g]=l.useState(!0),[i,m]=l.useState("");l.useEffect(()=>{a()},[]);const a=async()=>{try{g(!0);const $=await fa.getStats();b($.stats),o($.topClients||[]),N($.storageBySection||[]),T($.recentShipments||[]),h($.recentJobs||[]),j($.recentActivities||[])}catch($){m($.message),console.error("Dashboard error:",$)}finally{g(!1)}};if(y)return e.jsx("div",{className:"p-6 flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})});if(i)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:["Error loading dashboard: ",i]})});const x=[{name:"Total Revenue",value:`${((C=(u=s==null?void 0:s.invoiceRevenue)==null?void 0:u.total)==null?void 0:C.toFixed(2))||"0.00"} KWD`,subtitle:`${((A=s==null?void 0:s.invoiceRevenue)==null?void 0:A.count)||0} invoices`,icon:De,color:"bg-blue-500"},{name:"Paid Amount",value:`${((p=(w=s==null?void 0:s.invoiceRevenue)==null?void 0:w.paid)==null?void 0:p.toFixed(2))||"0.00"} KWD`,subtitle:`${((f=s==null?void 0:s.invoiceRevenue)==null?void 0:f.paidCount)||0} paid invoices`,icon:ls,color:"bg-green-500"},{name:"Outstanding",value:`${((L=(D=s==null?void 0:s.invoiceRevenue)==null?void 0:D.outstanding)==null?void 0:L.toFixed(2))||"0.00"} KWD`,subtitle:"Pending payments",icon:St,color:"bg-yellow-500"},{name:"This Month",value:`${((E=(q=s==null?void 0:s.thisMonthRevenue)==null?void 0:q.amount)==null?void 0:E.toFixed(2))||"0.00"} KWD`,subtitle:"Current month revenue",icon:rs,color:"bg-purple-500"}],d=[{name:"Active Shipments",value:((P=s==null?void 0:s.shipments)==null?void 0:P.active)||0,total:((J=s==null?void 0:s.shipments)==null?void 0:J.total)||0,icon:Ie,color:"text-blue-600"},{name:"Rack Utilization",value:`${((F=s==null?void 0:s.racks)==null?void 0:F.utilization)||0}%`,total:`${((z=s==null?void 0:s.racks)==null?void 0:z.active)||0} active`,icon:ss,color:"text-green-600"},{name:"Jobs In Progress",value:((K=s==null?void 0:s.jobs)==null?void 0:K.inProgress)||0,total:`${((V=s==null?void 0:s.jobs)==null?void 0:V.scheduled)||0} scheduled`,icon:Me,color:"text-yellow-600"},{name:"Withdrawals (Month)",value:((S=s==null?void 0:s.withdrawals)==null?void 0:S.thisMonth)||0,total:`${((O=s==null?void 0:s.withdrawals)==null?void 0:O.total)||0} total`,icon:ns,color:"text-purple-600"}],c=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ef4444","#06b6d4"],R=n.map(($,Y)=>({name:$.section||"Unknown",value:$.capacityUsed||0,total:$.capacityTotal||0,utilization:$.utilization||0,fill:c[Y%c.length]}));return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Welcome back! Here's what's happening today."})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:x.map($=>{const Y=$.icon;return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:$.name}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:$.value}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:$.subtitle})]}),e.jsx("div",{className:`${$.color} p-3 rounded-lg`,children:e.jsx(Y,{className:"h-6 w-6 text-white"})})]})},$.name)})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:d.map($=>{const Y=$.icon;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Y,{className:`h-8 w-8 ${$.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:$.name}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:$.value}),e.jsx("p",{className:"text-xs text-gray-500",children:$.total})]})]})},$.name)})}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Ie,{className:"h-6 w-6 mr-2 text-blue-600"}),"📊 Shipment Status Breakdown"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-gray-400",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Shipments"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:((M=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:M.total)||0})]}),e.jsx("div",{className:"text-4xl",children:"📦"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 mt-1",children:((H=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:H.pending)||0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((de=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:de.total)>0?Math.round(((be=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:be.pending)/((he=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:he.total)*100):0,"% of total"]})]}),e.jsx("div",{className:"text-4xl",children:"🟡"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"In Storage"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-1",children:((ve=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:ve.inStorage)||0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((Ne=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:Ne.total)>0?Math.round(((ae=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:ae.inStorage)/((He=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:He.total)*100):0,"% of total"]})]}),e.jsx("div",{className:"text-4xl",children:"🟢"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Released"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:((_e=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:_e.released)||0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((Fe=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:Fe.total)>0?Math.round(((Q=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:Q.released)/((G=s==null?void 0:s.shipmentStatusBreakdown)==null?void 0:G.total)*100):0,"% of total"]})]}),e.jsx("div",{className:"text-4xl",children:"🔵"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Storage Utilization by Section"}),R.length>0?e.jsx($s,{width:"100%",height:250,children:e.jsxs(ht,{children:[e.jsx(pt,{data:R,cx:"50%",cy:"50%",labelLine:!1,label:({name:$,utilization:Y})=>`${$} (${Y}%)`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:R.map(($,Y)=>e.jsx(gt,{fill:$.fill},`cell-${Y}`))}),e.jsx(Bs,{formatter:($,Y,te)=>[`${$} / ${te.payload.total} (${te.payload.utilization}%)`,"Capacity Used"]}),e.jsx(Os,{})]})}):e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-400",children:"No storage data available"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Clients"}),e.jsx("div",{className:"space-y-3",children:t.length>0?t.map(($,Y)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-semibold",children:Y+1}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:$.name}),e.jsxs("div",{className:"text-xs text-gray-500",children:[$.shipments||0," shipments"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-semibold text-gray-900",children:[($.revenue||0).toFixed(2)," KWD"]})})]},Y)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No client data available"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Activities"}),e.jsxs("button",{onClick:a,className:"text-sm text-blue-600 hover:text-blue-700 flex items-center space-x-1",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh"})]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:k.length>0?k.map(($,Y)=>{var te,xe;return e.jsxs("div",{className:"flex items-start space-x-3 p-3 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[e.jsx("span",{className:"font-medium",children:((te=$.user)==null?void 0:te.name)||"System"})," ",e.jsxs("span",{className:"text-gray-600",children:[$.activityType==="ITEM_ADDED"&&"added item to",$.activityType==="ITEM_REMOVED"&&"removed item from",$.activityType==="STATUS_CHANGE"&&"changed status of",$.activityType==="CAPACITY_UPDATE"&&"updated capacity of"," "]}),e.jsx("span",{className:"font-medium",children:(xe=$.rack)==null?void 0:xe.code})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:$.description}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date($.timestamp).toLocaleString()})]})]},Y)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent activities"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Shipments"}),e.jsx("div",{className:"space-y-3",children:r.length>0?r.map($=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:$.referenceId}),e.jsxs("div",{className:"text-sm text-gray-500",children:[$.clientName," • ",$.currentBoxCount," boxes"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${$.status==="ACTIVE"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:$.status})})]},$.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent shipments"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upcoming Jobs"}),e.jsx("div",{className:"space-y-3",children:v.length>0?v.map($=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:$.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:[$.clientName," • ",$.jobType]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:new Date($.scheduledDate).toLocaleDateString()}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${$.status==="IN_PROGRESS"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:$.status.replace("_"," ")})]})]},$.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No upcoming jobs"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Me,{className:"h-6 w-6 mr-2 text-orange-600"}),"🚚 Moving Jobs Management"]}),e.jsx(bt,{})]})]})},wa=({isOpen:s,onClose:b,releaseData:t,companyInfo:o})=>{var p,f;const{shipment:n,invoice:N,releaseDate:r,releasedBy:T,collectorID:v,collectorName:h,releaseType:k,boxesReleased:j,boxNumbers:y}=t,[g,i]=l.useState(null);l.useEffect(()=>{s&&(async()=>{try{const q=await(await fetch("/api/template-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json();q.success&&i(q.settings)}catch(L){console.error("Failed to load template settings:",L)}})()},[s]);const m=()=>{window.print()};if(!s)return null;const a=g||{},x=a.releasePrimaryColor||"#1e40af",d=a.releaseNoteHeaderBg||x,c=a.currencySymbol||"KD",R=a.dateFormat||"MMM dd, yyyy";a.timeFormat;const u=(D,L)=>{const q=D instanceof Date?D:new Date(D),E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return L==="MMM dd, yyyy"?`${E[q.getMonth()]} ${q.getDate().toString().padStart(2,"0")}, ${q.getFullYear()}`:L==="yyyyMMdd-HHmmss"?`${q.getFullYear()}${(q.getMonth()+1).toString().padStart(2,"0")}${q.getDate().toString().padStart(2,"0")}-${q.getHours().toString().padStart(2,"0")}${q.getMinutes().toString().padStart(2,"0")}${q.getSeconds().toString().padStart(2,"0")}`:q.toLocaleDateString()},C=r instanceof Date?r:new Date(r),A=n.arrivalDate instanceof Date?n.arrivalDate:new Date(n.arrivalDate),w=Math.ceil((C.getTime()-A.getTime())/(1e3*60*60*24));return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"no-print sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Release Note Generated"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(Be,{className:"h-5 w-5"}),"Print Release Note"]}),e.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Te,{className:"h-6 w-6"})})]})]}),e.jsxs("div",{className:"release-note-content p-8 relative",children:[a.showQRCode&&n&&e.jsx("div",{className:`absolute ${(()=>{const D=a.qrCodePosition||"TOP_RIGHT",L={TOP_RIGHT:"top-4 right-4",TOP_LEFT:"top-4 left-4",BOTTOM_RIGHT:"bottom-4 right-4",BOTTOM_LEFT:"bottom-4 left-4"};return L[D]||L.TOP_RIGHT})()} z-10 bg-white p-2 rounded-lg shadow-md print:block`,children:e.jsx(nt,{value:`SHIPMENT-${n.shipmentNumber||n.id}`,size:a.qrCodeSize||100,level:"M",includeMargin:!0})}),e.jsxs("div",{className:"text-center mb-6 pb-4 border-b-2",style:{borderColor:d},children:[a.releaseNoteShowLogo!==!1&&(a.companyLogo||(o==null?void 0:o.logo))&&e.jsx("img",{src:a.companyLogo||(o==null?void 0:o.logo),alt:"Logo",className:"h-16 mx-auto mb-2"}),e.jsx("h1",{className:"text-2xl font-bold",style:{color:x},children:a.companyName||(o==null?void 0:o.name)||"QGO Cargo"}),e.jsx("h2",{className:"text-xl text-gray-600 mt-2",children:a.releaseNoteTitle||"SHIPMENT RELEASE NOTE"}),a.companyAddress&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:a.companyAddress}),(a.companyPhone||a.companyEmail)&&e.jsxs("p",{className:"text-sm text-gray-600",children:[a.companyPhone&&e.jsx("span",{children:a.companyPhone}),a.companyPhone&&a.companyEmail&&e.jsx("span",{children:" | "}),a.companyEmail&&e.jsx("span",{children:a.companyEmail})]})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Release Note #:"}),e.jsxs("span",{className:"ml-2",children:["RN-",u(C,"yyyyMMdd-HHmmss")]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Date & Time:"}),e.jsxs("span",{className:"ml-2",children:[u(C,R)," - ",C.toLocaleTimeString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Released By:"}),e.jsx("span",{className:"ml-2",children:T})]})]})}),a.releaseShowShipment!==!1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"SHIPMENT DETAILS"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Shipment ID:"})," ",n.qrCode]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Reference:"})," ",n.referenceId||"N/A"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Client Name:"})," ",n.clientName]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Client Phone:"})," ",n.clientPhone]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Client Email:"})," ",n.clientEmail||"N/A"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Storage Type:"})," ",n.type]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Rack Locations:"})," ",n.rackLocations||((p=n.rack)==null?void 0:p.code)||"N/A"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx("span",{className:"text-green-600 font-semibold",children:"RELEASED"})]})]})]})]}),a.releaseShowStorage!==!1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"STORAGE INFORMATION"}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600",children:"Received Date"}),e.jsx("p",{className:"text-gray-800",children:n.receivedDate?u(n.receivedDate,"MMM dd, yyyy"):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600",children:"Arrival Date"}),e.jsx("p",{className:"text-gray-800",children:n.arrivalDate?u(n.arrivalDate,"MMM dd, yyyy"):u(A,"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600",children:"Release Date"}),e.jsx("p",{className:"text-gray-800",children:u(C,"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600",children:"Storage Duration"}),e.jsxs("p",{className:"text-gray-800 text-lg font-bold",style:{color:x},children:[w," days"]})]})]})]}),a.releaseShowItems!==!1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"ITEMS RELEASED"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600",children:"Total Boxes"}),e.jsxs("p",{className:"text-gray-800 text-lg",children:[n.originalBoxCount," boxes"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600",children:"Release Type"}),e.jsx("p",{className:"text-gray-800 text-lg",children:k==="FULL"?"FULL RELEASE":"PARTIAL RELEASE"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600",children:"Boxes Released"}),e.jsxs("p",{className:"text-gray-800 text-lg font-bold text-green-600",children:[j," boxes"]})]})]}),y&&y.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-gray-600 mb-1",children:"Box Numbers Released:"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-2 rounded font-mono",children:y.join(", ")})]})]}),a.releaseShowItems!==!1&&n.boxes&&n.boxes.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"ًں“¦ BOX DISTRIBUTION BY RACK"}),e.jsx("div",{className:"text-xs text-gray-600 mb-3",children:"Storage location details for each box before release"}),(()=>{const D={};return n.boxes.forEach(L=>{if(L.rackId&&L.rack){const q=L.rack.code;D[q]||(D[q]=[]),D[q].push(L)}else D.Unassigned||(D.Unassigned=[]),D.Unassigned.push(L)}),e.jsx("div",{className:"space-y-3",children:Object.entries(D).map(([L,q])=>{var J;const E=L==="Unassigned",P=(J=q[0])==null?void 0:J.rack;return e.jsxs("div",{className:`border-2 rounded-lg p-3 ${E?"border-yellow-300 bg-yellow-50":"border-green-300 bg-green-50"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base font-bold text-gray-800",children:E?"âڈ³ Unassigned":`ًں—„ï¸ڈ Rack ${L}`}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${E?"bg-yellow-200 text-yellow-800":"bg-green-200 text-green-800"}`,children:[q.length," box",q.length!==1?"es":""]})]}),!E&&(P==null?void 0:P.location)&&e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["ًں“چ ",P.location]})]})}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:q.map(F=>e.jsxs("div",{className:`px-2 py-1 rounded text-xs font-bold font-mono ${F.status==="IN_STORAGE"||F.status==="RELEASED"?"bg-white border-2 border-gray-400 text-gray-800":"bg-yellow-200 text-yellow-900"}`,title:`Box #${F.boxNumber} - ${F.status}`,children:["#",F.boxNumber]},F.id))})]},L)})})})(),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{className:"bg-white border border-gray-300 rounded p-2 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Total Racks Used"}),e.jsx("p",{className:"text-lg font-bold text-gray-800",children:Object.keys(n.boxes.reduce((D,L)=>(L.rackId&&(D[L.rackId]=!0),D),{})).length})]}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded p-2 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Assigned Boxes"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:n.boxes.filter(D=>D.rackId).length})]}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded p-2 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Unassigned Boxes"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:n.boxes.filter(D=>!D.rackId).length})]})]})]}),a.releaseShowCollector!==!1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"COLLECTOR INFORMATION"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600 mb-1",children:"Collector Name:"}),e.jsx("p",{className:"border-b-2 border-gray-400 pb-1 min-h-[28px]",children:h||"_________________________"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-600 mb-1",children:"ID Number:"}),e.jsx("p",{className:"text-gray-800 font-mono font-semibold",children:v})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Collector Signature:"}),e.jsx("div",{className:"border-b-2 border-gray-800 h-20"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Date:"}),e.jsx("p",{className:"border-b border-gray-400 pb-1",children:u(C,"MMM dd, yyyy")})]})]})]}),a.releaseShowCharges!==!1&&N&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"CHARGES & PAYMENT"}),e.jsx("table",{className:"w-full text-sm",children:e.jsxs("tbody",{children:[(f=N.lineItems)==null?void 0:f.map((D,L)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1.5 text-gray-700",children:D.description}),e.jsxs("td",{className:"text-right font-mono",children:[D.amount.toFixed(3)," ",c]})]},L)),e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"py-1.5 font-semibold",children:"Subtotal"}),e.jsxs("td",{className:"text-right font-semibold font-mono",children:[N.subtotal.toFixed(3)," ",c]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"py-1.5",children:["Tax (",(N.taxAmount/N.subtotal*100).toFixed(1),"%)"]}),e.jsxs("td",{className:"text-right font-mono",children:[N.taxAmount.toFixed(3)," ",c]})]}),e.jsxs("tr",{className:"border-t-2 border-gray-800",children:[e.jsx("td",{className:"py-2 text-lg font-bold",children:"TOTAL AMOUNT"}),e.jsxs("td",{className:"text-right text-lg font-bold font-mono",children:[N.totalAmount.toFixed(3)," ",c]})]})]})}),e.jsxs("div",{className:"mt-4 bg-gray-50 p-3 rounded text-sm",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Invoice Number:"})," ",e.jsx("span",{className:"font-mono",children:N.invoiceNumber})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment Status:"}),e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded text-xs font-semibold ${N.paymentStatus==="PAID"?"bg-green-100 text-green-800":N.paymentStatus==="PENDING"?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800"}`,children:N.paymentStatus})]})]})]}),a.releaseShowTerms!==!1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"TERMS & CONDITIONS"}),a.releaseTerms?e.jsx("div",{className:"text-xs text-gray-700 whitespace-pre-wrap",children:a.releaseTerms}):e.jsxs("ul",{className:"text-xs space-y-1 text-gray-700 ml-4",children:[e.jsx("li",{children:"â€¢ All items have been inspected and released in good condition"}),e.jsx("li",{children:"â€¢ The company shall not be held liable for any items after the release date and time"}),e.jsx("li",{children:"â€¢ Payment must be completed within the specified due date on the invoice"}),e.jsx("li",{children:"â€¢ This document serves as official proof of shipment release and receipt"}),e.jsx("li",{children:"â€¢ Any disputes must be raised within 24 hours of release"})]})]}),a.releaseShowSignatures!==!1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3 pb-2 border-b",style:{color:x},children:"AUTHORIZATION SIGNATURES"}),e.jsxs("div",{className:"grid grid-cols-2 gap-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold mb-6 text-gray-700",children:"Released By (Company Staff)"}),e.jsx("div",{className:"border-b-2 border-gray-800 mb-2 h-16"}),e.jsx("p",{className:"text-sm font-semibold",children:T}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Date: ",u(C,"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-semibold mb-6 text-gray-700",children:"Received By (Collector)"}),e.jsx("div",{className:"border-b-2 border-gray-800 mb-2 h-16"}),e.jsx("p",{className:"text-sm",children:h||"_________________________"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Date: _________________"})]})]})]}),e.jsxs("div",{className:"text-center mt-8 pt-6 border-t-2",style:{borderColor:d},children:[e.jsx("p",{className:"text-lg font-semibold mb-2",style:{color:x},children:a.releaseFooterText||"Thank you for your business!"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsx("p",{children:a.companyAddress||(o==null?void 0:o.address)||"Kuwait"}),e.jsxs("p",{children:[a.companyPhone&&e.jsxs(e.Fragment,{children:["Phone: ",a.companyPhone]}),a.companyPhone&&a.companyEmail&&e.jsx(e.Fragment,{children:" | "}),a.companyEmail&&e.jsxs(e.Fragment,{children:["Email: ",a.companyEmail]})]}),a.companyWebsite&&e.jsxs("p",{children:["Website: ",a.companyWebsite]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["Generated on ",new Date().toLocaleString()]})]})]}),e.jsxs("div",{className:"no-print sticky bottom-0 bg-gray-50 border-t px-6 py-4 flex gap-3 justify-center",children:[e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-semibold",children:[e.jsx(Be,{className:"h-5 w-5"}),"Print Release Note"]}),e.jsx("button",{onClick:b,className:"px-6 py-2 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-semibold",children:"Close"})]})]}),e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .release-note-content,
          .release-note-content * {
            visibility: visible;
          }
          .release-note-content {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            padding: 20px;
          }
          .no-print {
            display: none !important;
          }
          @page {
            margin: 1cm;
            size: A4;
          }
        }
      `})]})},Ca=({isOpen:s,onClose:b,shipment:t,withdrawalData:o,onSuccess:n})=>{var w;const[N,r]=l.useState("invoice"),[T,v]=l.useState(null),[h,k]=l.useState(!1),[j,y]=l.useState(""),[g,i]=l.useState(!1),[m,a]=l.useState({paymentMethod:"CASH",amount:0,transactionRef:"",receiptNumber:"",notes:""}),[x,d]=l.useState("full");l.useEffect(()=>{s&&t&&!T&&c()},[s,t]);const c=async()=>{try{i(!0),y("");const p=new Date(t.arrivalDate||t.receivedDate),D=Math.max(1,Math.ceil((new Date().getTime()-p.getTime())/(1e3*60*60*24))),L=await Ee.getSettings(),q=parseFloat(L.storageRatePerBox)||.5,E=t.originalBoxCount||t.currentBoxCount||o.withdrawnBoxCount,P=D*E,J=P*q,F=parseFloat(L.taxRate)||5,z=J*F/100,K=[{description:`Storage Charges - ${D} days × ${E} boxes @ ${q.toFixed(3)} KWD/day/box`,category:"STORAGE",quantity:P,unitPrice:q,amount:J,taxRate:F,taxAmount:z}],V=await Ee.createInvoice({shipmentId:t.id,clientName:t.clientName,clientPhone:t.clientPhone,clientAddress:t.clientAddress||"",lineItems:K,notes:`Auto-generated for release - ${o.withdrawnBoxCount} boxes withdrawn`,isWarehouseInvoice:!1});v(V),a(S=>({...S,amount:V.totalAmount,receiptNumber:`PMT-${Date.now()}`}))}catch(p){console.error("Invoice creation error:",p),y(p.message||"Failed to create invoice")}finally{i(!1)}},R=()=>{if(!T)return;const p=window.open(`/invoices/${T.id}/print`,"_blank");p&&p.focus()},u=async()=>{try{if(k(!0),y(""),x==="debt"){const p=await A();alert("✅ Withdrawal approved on DEBT. Customer must pay invoice later."),C(p)}else{if(x==="full"&&m.amount!==T.totalAmount){y("Full payment amount must match invoice total");return}if(x==="partial"&&m.amount>=T.totalAmount){y("Partial payment must be less than total amount");return}if(m.amount<=0){y("Payment amount must be greater than 0");return}if(m.paymentMethod==="KNET"&&!m.transactionRef.trim()){y("Transaction reference is required for KNET payments");return}await Ee.recordPayment(T.id,{amount:m.amount,paymentMethod:m.paymentMethod,transactionRef:m.transactionRef,receiptNumber:m.receiptNumber,notes:m.notes});const p=await A();alert(x==="full"?"✅ Payment recorded successfully! Invoice PAID. Release completed.":`✅ Partial payment of ${m.amount.toFixed(3)} KWD recorded. Balance: ${(T.totalAmount-m.amount).toFixed(3)} KWD. Release completed.`),C(p)}n(),b()}catch(p){y(p.message||"Failed to process payment and release")}finally{k(!1)}},C=p=>{var L,q;const f={withdrawal:p.withdrawal||p,shipment:t,invoice:T,payment:x!=="debt"?{amount:m.amount,method:m.paymentMethod,transactionRef:m.transactionRef,receiptNumber:m.receiptNumber}:null,releaseDate:new Date,releaseType:((L=p.withdrawal)==null?void 0:L.remainingBoxCount)===0?"FULL":"PARTIAL",boxesReleased:o.withdrawnBoxCount,boxesRemaining:((q=p.withdrawal)==null?void 0:q.remainingBoxCount)||0};sessionStorage.setItem("releaseReceipt",JSON.stringify(f));const D=window.open("/release-receipt.html","_blank","width=800,height=600");D&&D.focus()},A=async()=>await ja.create({shipmentId:t.id,...o});return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-red-50 to-orange-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"💰 Payment Required Before Release"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Invoice must be paid or marked as debt | يجب دفع الفاتورة"})]}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex items-center justify-center p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:`flex items-center gap-2 ${N==="invoice"?"text-primary-600":"text-green-600"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${N==="invoice"?"bg-primary-600 text-white":"bg-green-600 text-white"}`,children:N==="payment"?e.jsx(ge,{className:"h-5 w-5"}):"1"}),e.jsx("span",{className:"font-semibold",children:"Invoice Created"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:`flex items-center gap-2 ${N==="payment"?"text-primary-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${N==="payment"?"bg-primary-600 text-white":"bg-gray-300 text-white"}`,children:"2"}),e.jsx("span",{className:"font-semibold",children:"Payment & Release"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[j&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:j}),g?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Creating invoice..."})]}):T&&N==="invoice"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 border-2 border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900",children:["Invoice #",T.invoiceNumber]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Generated: ",new Date().toLocaleDateString()]})]}),e.jsx(we,{className:"h-12 w-12 text-blue-600"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Client"}),e.jsx("p",{className:"font-bold text-gray-900",children:t.clientName}),e.jsx("p",{className:"text-sm text-gray-600",children:t.clientPhone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Shipment"}),e.jsx("p",{className:"font-bold text-gray-900",children:t.referenceId}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Releasing: ",o.withdrawnBoxCount," boxes"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4",children:[(w=T.lineItems)==null?void 0:w.map((p,f)=>e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:p.description}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",p.quantity," × ",p.unitPrice.toFixed(3)," KWD"]})]}),e.jsxs("p",{className:"font-bold text-gray-900",children:[p.amount.toFixed(3)," KWD"]})]},f)),e.jsxs("div",{className:"border-t pt-3 mt-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"text-gray-900",children:[T.subtotal.toFixed(3)," KWD"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tax (5%)"}),e.jsxs("span",{className:"text-gray-900",children:[T.taxAmount.toFixed(3)," KWD"]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold border-t pt-2",children:[e.jsx("span",{className:"text-gray-900",children:"TOTAL"}),e.jsxs("span",{className:"text-primary-600",children:[T.totalAmount.toFixed(3)," KWD"]})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:R,className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold",children:[e.jsx(Be,{className:"h-5 w-5"}),"Print Invoice"]}),e.jsxs("button",{type:"button",onClick:()=>r("payment"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-primary-600 to-purple-600 text-white rounded-lg hover:from-primary-700 hover:to-purple-700 transition-colors font-semibold",children:["Proceed to Payment",e.jsx(De,{className:"h-5 w-5"})]})]})]})}):N==="payment"&&T?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Payment Option"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>{d("full"),a(p=>({...p,amount:T.totalAmount}))},className:`p-4 border-2 rounded-xl text-center transition-all ${x==="full"?"border-green-600 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-1",children:"✅ Full Payment"}),e.jsxs("p",{className:"text-sm",children:[T.totalAmount.toFixed(3)," KWD"]})]}),e.jsxs("button",{type:"button",onClick:()=>{d("partial"),a(p=>({...p,amount:0}))},className:`p-4 border-2 rounded-xl text-center transition-all ${x==="partial"?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-1",children:"💵 Partial Payment"}),e.jsx("p",{className:"text-sm",children:"Pay some now"})]}),e.jsxs("button",{type:"button",onClick:()=>d("debt"),className:`p-4 border-2 rounded-xl text-center transition-all ${x==="debt"?"border-orange-600 bg-orange-50 text-orange-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-1",children:"📝 On Debt"}),e.jsx("p",{className:"text-sm",children:"Pay later"})]})]})]}),x!=="debt"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Amount (KWD)"}),e.jsx("input",{type:"number",step:"0.001",value:m.amount,onChange:p=>a(f=>({...f,amount:parseFloat(p.target.value)||0})),disabled:x==="full",className:"w-full px-4 py-3 text-xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100",placeholder:"Enter amount"}),x==="partial"&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Remaining: ",(T.totalAmount-m.amount).toFixed(3)," KWD"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Method"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:["CASH","KNET","BANK_TRANSFER","CHEQUE"].map(p=>e.jsx("button",{type:"button",onClick:()=>a(f=>({...f,paymentMethod:p})),className:`px-4 py-3 border-2 rounded-lg font-semibold transition-all ${m.paymentMethod===p?"border-primary-600 bg-primary-50 text-primary-700":"border-gray-200 hover:border-gray-300"}`,children:p.replace("_"," ")},p))})]}),m.paymentMethod==="KNET"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Transaction Reference * ",e.jsx("span",{className:"text-red-500",children:"(Required)"})]}),e.jsx("input",{type:"text",value:m.transactionRef,onChange:p=>a(f=>({...f,transactionRef:p.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter KNET transaction reference"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Receipt Number"}),e.jsx("input",{type:"text",value:m.receiptNumber,onChange:p=>a(f=>({...f,receiptNumber:p.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Receipt number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Notes (Optional)"}),e.jsx("textarea",{value:m.notes,onChange:p=>a(f=>({...f,notes:p.target.value})),rows:2,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Any additional notes..."})]})]}),x==="debt"&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-orange-800 font-semibold",children:"⚠️ Releasing on DEBT"}),e.jsxs("p",{className:"text-sm text-orange-700 mt-2",children:["Customer can collect items without payment. Invoice #",T.invoiceNumber," will remain UNPAID and customer must pay later."]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>r("invoice"),className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-semibold",children:"← Back to Invoice"}),e.jsx("button",{type:"button",onClick:u,disabled:h,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg hover:from-green-700 hover:to-emerald-700 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Processing..."]}):e.jsx(e.Fragment,{children:x==="debt"?"✅ Approve Debt & Release":"💰 Record Payment & Release"})})]})]}):null]})]})}):null},Sa=({isOpen:s,onClose:b,shipment:t,onSuccess:o})=>{var g;const[n,N]=l.useState({withdrawnBoxCount:(t==null?void 0:t.currentBoxCount)||0,withdrawnBy:"",reason:"",notes:"",receiptNumber:`WD-${Date.now()}`}),[r,T]=l.useState(""),[v,h]=l.useState(!1);l.useEffect(()=>{s&&t&&(N({withdrawnBoxCount:t.currentBoxCount||0,withdrawnBy:"",reason:"",notes:"",receiptNumber:`WD-${Date.now()}`}),T(""))},[s,t]);const k=t?t.currentBoxCount-n.withdrawnBoxCount:0,j=n.withdrawnBoxCount===(t==null?void 0:t.currentBoxCount),y=async i=>{if(i.preventDefault(),!n.withdrawnBy.trim()){T("Please enter the name of person collecting items");return}if(n.withdrawnBoxCount<=0){T("Please enter a valid number of boxes");return}if(n.withdrawnBoxCount>(t==null?void 0:t.currentBoxCount)){T(`Cannot withdraw ${n.withdrawnBoxCount} boxes. Only ${t.currentBoxCount} available.`);return}const a=`🚨 CONFIRM ${j?"FULL RELEASE":"PARTIAL RELEASE"}

📦 Boxes: ${n.withdrawnBoxCount} out of ${t.currentBoxCount}
👤 Collected By: ${n.withdrawnBy}
📄 Reason: ${n.reason||"N/A"}

⚠️ This will trigger payment/invoice process.

Are you sure you want to proceed?`;confirm(a)&&h(!0)};return s?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"📦 Withdraw Items"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Release items from storage | سحب العناصر من المخزن"})]}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 bg-blue-50 border-b",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Shipment ID"}),e.jsx("p",{className:"font-bold text-gray-900",children:t==null?void 0:t.referenceId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Client"}),e.jsx("p",{className:"font-bold text-gray-900",children:t==null?void 0:t.clientName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Available Boxes"}),e.jsx("p",{className:"font-bold text-green-600 text-xl",children:t==null?void 0:t.currentBoxCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Rack Location"}),e.jsx("p",{className:"font-bold text-gray-900",children:((g=t==null?void 0:t.rack)==null?void 0:g.code)||"N/A"})]})]})}),e.jsxs("form",{onSubmit:y,className:"p-6 space-y-6",children:[r&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:r}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Release Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>{N(i=>({...i,withdrawnBoxCount:t.currentBoxCount}))},className:`p-4 border-2 rounded-xl text-center transition-all ${j?"border-primary-600 bg-primary-50 text-primary-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-1",children:"Full Release"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["All ",t==null?void 0:t.currentBoxCount," boxes"]})]}),e.jsxs("button",{type:"button",onClick:()=>{j&&N(i=>({...i,withdrawnBoxCount:Math.floor(t.currentBoxCount/2)}))},className:`p-4 border-2 rounded-xl text-center transition-all ${j?"border-gray-200 hover:border-gray-300":"border-purple-600 bg-purple-50 text-purple-700"}`,children:[e.jsx("p",{className:"font-bold text-lg mb-1",children:"Partial Release"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Some boxes only"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Number of Boxes to Withdraw ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:n.withdrawnBoxCount||"",onChange:i=>{const m=i.target.value===""?0:parseInt(i.target.value);N({...n,withdrawnBoxCount:m})},onFocus:i=>i.target.select(),min:"1",max:(t==null?void 0:t.currentBoxCount)||0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-lg font-semibold",placeholder:"Enter number of boxes",required:!0}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"boxes"})]}),e.jsxs("div",{className:"flex justify-between mt-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Remaining after withdrawal:"}),e.jsxs("span",{className:"font-bold text-gray-900",children:[k," boxes"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Collected By (Person Name) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:n.withdrawnBy,onChange:i=>N({...n,withdrawnBy:i.target.value}),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter full name",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Receipt Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:n.receiptNumber,onChange:i=>N({...n,receiptNumber:i.target.value}),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"WD-001"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Withdrawal"}),e.jsxs("select",{value:n.reason,onChange:i=>N({...n,reason:i.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select reason..."}),e.jsx("option",{value:"Customer Collection",children:"Customer Collection"}),e.jsx("option",{value:"Delivery",children:"Delivery"}),e.jsx("option",{value:"Transfer",children:"Transfer to Another Location"}),e.jsx("option",{value:"Return to Owner",children:"Return to Owner"}),e.jsx("option",{value:"Disposal",children:"Disposal"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{value:n.notes,onChange:i=>N({...n,notes:i.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Any additional details..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photos (Optional)"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary-400 transition-colors cursor-pointer",children:[e.jsx(hs,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Click to upload photos"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Photo upload feature coming soon"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border border-purple-200",children:[e.jsx("h4",{className:"font-bold text-gray-900 mb-4 text-lg",children:"Withdrawal Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total boxes in storage:"}),e.jsx("span",{className:"font-semibold",children:t==null?void 0:t.currentBoxCount})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Boxes to withdraw:"}),e.jsx("span",{className:"font-bold text-red-600 text-lg",children:n.withdrawnBoxCount})]}),e.jsxs("div",{className:"flex justify-between pt-3 border-t border-purple-200",children:[e.jsx("span",{className:"text-gray-900 font-semibold",children:"Remaining boxes:"}),e.jsx("span",{className:"font-bold text-green-600 text-xl",children:k})]}),j&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-yellow-800 text-sm font-medium",children:"⚠️ This will fully release the shipment and mark it as RELEASED"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 font-bold transition-all shadow-lg",children:"💰 Continue to Payment"})]})]})]}),e.jsx(Ca,{isOpen:v,onClose:()=>h(!1),shipment:t,withdrawalData:n,onSuccess:()=>{h(!1),o(),b()}})]}):null},yt=(s,b=!1)=>{if(s===""||s.trim()==="")return"";const t=b?parseFloat(s):parseInt(s);return isNaN(t)?"":t},ce=(s,b=0)=>{if(s===""||s===void 0||s===null)return b;const t=typeof s=="string"?parseFloat(s):s;return isNaN(t)?b:t};function ka({isOpen:s,onClose:b,onSuccess:t}){const[o,n]=l.useState(!1),[N,r]=l.useState(""),[T,v]=l.useState(""),[h,k]=l.useState({barcode:"",companyProfileId:"",clientName:"",clientPhone:"",clientEmail:"",clientAddress:"",arrivalDate:new Date().toISOString().split("T")[0],pieces:1,palletCount:1,boxesPerPallet:1,weight:0,dimensions:"",length:0,width:0,height:0,cbm:0,description:"",value:0,isWarehouseShipment:!1,shipper:"",consignee:"",shipperAddress:"",consigneeAddress:"",shipperPhone:"",consigneePhone:"",rackId:"",storageType:"STANDARD",specialInstructions:"",estimatedDays:30,notes:""}),[j,y]=l.useState([]),[g,i]=l.useState({}),[m,a]=l.useState([]),[x,d]=l.useState([]),[c,R]=l.useState({storageRate:.5,minimumCharge:5,currency:"KWD",taxRate:0}),[u,C]=l.useState(!1),[A,w]=l.useState(""),[p,f]=l.useState("pallet"),[D,L]=l.useState({}),[q,E]=l.useState({}),[P,J]=l.useState(!1),[F,z]=l.useState([1]),[K,V]=l.useState(0),[S,O]=l.useState({requireClientEmail:!1,requireClientPhone:!0,requireEstimatedValue:!1,requireRackAssignment:!1,autoGenerateQR:!0,qrCodePrefix:"SHP",defaultStorageType:"PERSONAL",formSectionOrder:null}),[M,H]=l.useState(["basic","client","warehouse","storage","custom","pricing"]),de=I=>{if(!I)return[];if(Array.isArray(I))return I;if(typeof I=="string")try{const B=JSON.parse(I);return Array.isArray(B)?B:I.split(",").map(U=>U.trim())}catch{return I.split(",").map(B=>B.trim())}return[]};l.useEffect(()=>{s&&(be(),he(),Fe())},[s]);const be=async()=>{try{await Promise.all([ve(),Ne(),ae(),He(),_e()])}catch(I){r("Failed to load data: "+I.message)}},he=()=>{const I=Date.now(),B=Math.floor(Math.random()*1e3).toString().padStart(3,"0"),U=`WHM${I.toString().slice(-6)}${B}`;k(W=>({...W,barcode:U}))},ve=async()=>{try{const I=await fetch("/api/custom-fields?section=SHIPMENT",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(I.ok){const B=await I.json(),U=B.customFields||B,W=Array.isArray(U)?U.filter(se=>se.isActive):[];y(W);const ee={};W.forEach(se=>{ee[se.id]=""}),i(ee)}}catch(I){console.error("Failed to load custom fields:",I)}},Ne=async()=>{try{const B=(await Re.getAll()).racks.filter(U=>U.status==="ACTIVE"&&U.capacityUsed<U.capacityTotal);a(B)}catch(I){console.error("Failed to load racks:",I)}},ae=async()=>{try{const I=await We.listProfiles(),U=(Array.isArray(I)?I:I&&Array.isArray(I.profiles)?I.profiles:[]).filter(W=>(W==null?void 0:W.isActive)!==!1);d(U)}catch(I){console.error("Failed to load company profiles:",I),d([])}},He=async()=>{try{const I=await fetch("/api/billing/settings",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(I.ok){const B=await I.json();R({storageRate:B.storageRatePerBox||B.storageRate||.5,minimumCharge:B.minimumCharge||5,currency:B.currency||"KWD",taxRate:B.taxRate||0})}else console.error("Failed to load pricing settings:",I.status)}catch(I){console.error("Failed to load pricing:",I)}},_e=async()=>{try{const I=await fetch("/api/shipment-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(I.ok){const B=await I.json(),U=B.settings||B;if(O(U),U.formSectionOrder)try{const W=JSON.parse(U.formSectionOrder);H(W),console.log("??? Section order loaded:",W)}catch{console.log("Using default section order")}console.log("??? Shipment settings loaded:",U)}}catch(I){console.error("Failed to load shipment settings:",I)}},Fe=()=>{k({barcode:"",companyProfileId:"",clientName:"",clientPhone:"",clientEmail:"",clientAddress:"",arrivalDate:new Date().toISOString().split("T")[0],pieces:1*1,palletCount:1,boxesPerPallet:1,length:0,width:0,height:0,cbm:0,weight:0,dimensions:"",description:"",value:0,isWarehouseShipment:!1,shipper:"",consignee:"",shipperAddress:"",consigneeAddress:"",shipperPhone:"",consigneePhone:"",rackId:"",storageType:"STANDARD",specialInstructions:"",estimatedDays:30,notes:""}),f("pallet"),L({}),E({}),J(!1),z([1]),V(0);const U={};j.forEach(W=>{U[W.id]=""}),i(U),r(""),v(""),he()},Q=I=>{const{name:B,value:U,type:W}=I.target,re=W==="checkbox"?I.target.checked:W==="number"?yt(U,!0):U;if(k(me=>{const ue={...me,[B]:re};if(B==="palletCount"||B==="boxesPerPallet"){const X=ce(ue.palletCount,0),ne=ce(ue.boxesPerPallet,0);if(!P){const oe=Array.from({length:Math.max(X,0)},()=>Math.max(ne,0));return z(oe.length?oe:[]),{...ue,pieces:X*ne}}return ue}if(B==="length"||B==="width"||B==="height"){const X=ce(ue.length,0),ne=ce(ue.width,0),oe=ce(ue.height,0),Ce=X>0&&ne>0&&oe>0?X*ne*oe/1e6:0;return{...ue,cbm:parseFloat(Ce.toFixed(4))}}return ue}),B==="palletCount"){const me=ce(re,0);L(ue=>{const X={...ue};return Object.keys(X).forEach(ne=>{Number(ne)>me&&delete X[Number(ne)]}),X}),E(ue=>{const X={...ue};return Object.keys(X).forEach(ne=>{Number(ne)>me&&delete X[Number(ne)]}),X}),P&&z(ue=>{var oe,Ce;const X=Math.max(me,0),ne=ue.slice(0,X);for(;ne.length<X;)ne.push(ce(((Ce=(oe=I.target.form)==null?void 0:oe.boxesPerPallet)==null?void 0:Ce.value)??1,1));return ne})}};l.useEffect(()=>{if(p==="pallet"&&P){const I=F.reduce((B,U)=>B+(Number.isFinite(U)?Math.max(0,Math.trunc(U)):0),0);k(B=>({...B,pieces:I+Math.max(0,Math.trunc(K))}))}else if(p==="pallet"&&!P){const I=ce(h.palletCount,0),B=ce(h.boxesPerPallet,0);h.pieces!==I*B&&k(U=>({...U,pieces:I*B}))}},[F,K,P,p,h.palletCount,h.boxesPerPallet]);const G=()=>{const I=Math.floor(Date.now()/1e3);let B="";if(p==="pallet")if(P){const U=Math.max(ce(h.palletCount,1),1),W=F.slice(0,U),ee=W.reduce((re,me)=>re+(Number.isFinite(me)?Math.max(0,Math.trunc(me)):0),0)+Math.max(0,Math.trunc(K)),se=W.reduce((re,me)=>Math.max(re,Math.max(0,Math.trunc(me||0))),0);B=`QR-SH-${I}-P${U}B${se}T${ee}`}else{const U=ce(h.palletCount,1),W=ce(h.boxesPerPallet,1),ee=U*W;B=`QR-SH-${I}-P${U}B${W}T${ee}`}else{const U=ce(h.pieces,1);B=`QR-SH-${I}-BOX-T${U}`}w(B),C(!0)},$=I=>I?I.startsWith("http")||I.startsWith("/")?I:`/${I}`:"",Y=async(I,B)=>{if(!B||B.length===0)return;const U=localStorage.getItem("authToken");if(!U){r("Authentication token missing. Please log in again.");return}E(W=>({...W,[I]:!0}));try{const W=[];for(const ee of Array.from(B)){const se=new FormData;se.append("photo",ee);const re=await fetch("/api/shipments/upload/photo",{method:"POST",headers:{Authorization:`Bearer ${U}`},body:se});if(!re.ok){const ue=await re.json().catch(()=>({}));throw new Error(ue.error||"Failed to upload pallet photo")}const me=await re.json();me!=null&&me.photoUrl&&W.push(me.photoUrl)}W.length>0&&L(ee=>{const se={...ee},re=se[I]||[];return se[I]=[...re,...W],se})}catch(W){console.error("Pallet photo upload failed:",W),r((W==null?void 0:W.message)||"Failed to upload pallet photos")}finally{E(W=>({...W,[I]:!1}))}},te=(I,B)=>{L(U=>{const ee=(U[I]||[]).filter((re,me)=>me!==B),se={...U};return ee.length>0?se[I]=ee:delete se[I],se})},xe=I=>{const B=g[I.id]||"";switch(I.fieldType){case"TEXT":return e.jsx("input",{type:"text",id:I.id,value:B,onChange:U=>i(W=>({...W,[I.id]:U.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${I.fieldName.toLowerCase()}`,required:I.isRequired});case"NUMBER":return e.jsx("input",{type:"number",id:I.id,value:B,onChange:U=>i(W=>({...W,[I.id]:U.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:`Enter ${I.fieldName.toLowerCase()}`,required:I.isRequired});case"DATE":return e.jsx("input",{type:"date",id:I.id,value:B,onChange:U=>i(W=>({...W,[I.id]:U.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",required:I.isRequired});case"DROPDOWN":return e.jsxs("select",{id:I.id,value:B,onChange:U=>i(W=>({...W,[I.id]:U.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",required:I.isRequired,children:[e.jsxs("option",{value:"",children:["Select ",I.fieldName.toLowerCase()]}),de(I.fieldOptions).map((U,W)=>e.jsx("option",{value:U,children:U},W))]});case"CHECKBOX":return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:I.id,checked:B==="true",onChange:U=>i(W=>({...W,[I.id]:U.target.checked.toString()})),className:"w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:I.id,className:"text-sm font-medium text-gray-700",children:I.fieldName})]});default:return null}},pe=()=>{const I=Math.max(h.pieces*c.storageRate*h.estimatedDays,c.minimumCharge),B=I*(c.taxRate/100);return{baseCost:I,tax:B,total:I+B}},le=async I=>{var B;I.preventDefault(),n(!0),r(""),v("");try{if(!h.clientName)throw new Error("Client name is required");if(S.requireClientPhone&&!h.clientPhone)throw new Error("Client phone is required by company settings");if(S.requireClientEmail&&!h.clientEmail)throw new Error("Client email is required by company settings");if(S.requireEstimatedValue&&!h.value)throw new Error("Estimated value is required by company settings");if(S.requireRackAssignment&&!h.rackId)throw new Error("Rack assignment is required by company settings");if(S.requireClientAddress&&!h.clientAddress)throw new Error("Client address is required by company settings");if(S.requireDescription&&!h.description)throw new Error("Description is required by company settings");if(S.requireNotes&&!h.notes)throw new Error("Notes are required by company settings");if(S.requireEstimatedDays&&!h.estimatedDays)throw new Error("Estimated storage days are required by company settings");const U=p==="pallet"?ce(h.palletCount,0):1,W=ce(p==="pallet"?h.boxesPerPallet:h.pieces,0),ee=P?F.slice(0,Math.max(U,0)).map(oe=>Math.max(0,Math.trunc(oe||0))):[],se=P?Math.max(0,Math.trunc(K||0)):0,re=P?ee.reduce((oe,Ce)=>oe+Ce,0)+se:U*W;if(U<=0)throw new Error("Pallet count must be at least 1");if(!P&&W<=0)throw new Error("Boxes per pallet must be at least 1");if(re<=0)throw new Error("Number of boxes must be greater than 0");if(h.isWarehouseShipment&&(!h.shipper||!h.consignee))throw new Error("Shipper and consignee are required for warehouse shipments");for(const oe of j)if(oe.isRequired&&!g[oe.id])throw new Error(`${oe.fieldName} is required`);const me=p==="pallet"?Array.from({length:U},(oe,Ce)=>D[Ce+1]||[]):[],ue={referenceId:h.barcode,companyProfileId:h.companyProfileId||void 0,clientName:h.clientName,clientPhone:h.clientPhone,clientEmail:h.clientEmail,clientAddress:h.clientAddress,arrivalDate:h.arrivalDate,palletCount:U,boxesPerPallet:P?Math.max(0,ee.reduce((oe,Ce)=>Math.max(oe,Ce),0)):W,description:h.description,originalBoxCount:re,currentBoxCount:re,estimatedValue:h.value,notes:h.notes,rackId:h.rackId||void 0,palletPhotos:me.map(oe=>oe.filter(Ce=>!!Ce)),...P?{boxesDistribution:ee,extraBoxes:se}:{},isWarehouseShipment:h.isWarehouseShipment,warehouseData:h.isWarehouseShipment?JSON.stringify({shipper:h.shipper,consignee:h.consignee,shipperAddress:h.shipperAddress,consigneeAddress:h.consigneeAddress,shipperPhone:h.shipperPhone,consigneePhone:h.consigneePhone,weight:h.weight,dimensions:h.dimensions,storageType:h.storageType,specialInstructions:h.specialInstructions,estimatedDays:h.estimatedDays}):null,customFieldValues:JSON.stringify(g)},X=await $e.create(ue),ne=((B=X.shipment)==null?void 0:B.id)||X.id;if(h.rackId&&h.pieces>0){const oe=Array.from({length:h.pieces},(Ce,jt)=>jt+1);await fetch(`/api/shipments/${ne}/assign-boxes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({rackId:h.rackId,boxNumbers:oe})})}alert(`SUCCESS!

Shipment ${h.barcode} has been created successfully!

Boxes: ${re}
Pallets: ${U}${P?"":`
Boxes per pallet: ${W}`}${P?`
Variable pallets: [${ee.join(", ")}]${se?` + ${se} loose`:""}`:""}
Client: ${h.clientName}${h.rackId?`
Assigned to Rack`:""}`),t(),b()}catch(U){r(U.message||"Failed to create shipment")}finally{n(!1)}};if(!s)return null;const ye=pe(),Z={basic:()=>e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-800 flex items-center",children:"Basic Shipment Info"}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border-2 border-blue-300 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Intake Mode:"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{f("pallet"),k(I=>({...I,palletCount:1,boxesPerPallet:1,pieces:1})),L({}),E({}),J(!1),z([1]),V(0)},className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${p==="pallet"?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Pallet Mode"}),e.jsx("button",{type:"button",onClick:()=>{f("box"),k(I=>({...I,palletCount:0,boxesPerPallet:0,pieces:1})),L({}),E({}),J(!1),z([]),V(0)},className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${p==="box"?"bg-green-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Box Mode"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Profile"}),e.jsxs("select",{name:"companyProfileId",value:h.companyProfileId,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select company (optional)"}),x.map(I=>e.jsx("option",{value:I.id,children:I.name},I.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Barcode ID"}),e.jsx("input",{type:"text",name:"barcode",value:h.barcode,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 font-mono text-lg",readOnly:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Arrival Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"arrivalDate",value:h.arrivalDate,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),p==="pallet"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Pallet Count ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"palletCount",value:h.palletCount,onChange:Q,className:"w-full px-4 py-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Boxes per Pallet ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"boxesPerPallet",value:h.boxesPerPallet,onChange:Q,className:"w-full px-4 py-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50",min:"1",required:!0,disabled:P})]}),e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"variablePerPallet",type:"checkbox",checked:P,onChange:I=>{const B=I.target.checked;if(J(B),B){const U=Math.max(ce(h.palletCount,0),0),W=Array.from({length:U},()=>Math.max(ce(h.boxesPerPallet,0),0)||1);z(W)}else{z([]),V(0);const U=ce(h.palletCount,0),W=ce(h.boxesPerPallet,0);k(ee=>({...ee,pieces:U*W}))}},className:"w-5 h-5"}),e.jsx("label",{htmlFor:"variablePerPallet",className:"text-sm font-medium text-blue-900",children:"Variable boxes per pallet + extra loose boxes"})]}),P&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3",children:Array.from({length:Math.max(ce(h.palletCount,0),0)},(I,B)=>B).map(I=>e.jsxs("div",{className:"bg-white border border-blue-200 rounded-md p-2",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Pallet #",I+1," boxes"]}),e.jsx("input",{type:"number",min:0,value:F[I]??0,onChange:B=>{const U=parseInt(B.target.value)||0;z(W=>{const ee=W.slice();return ee[I]=Math.max(0,U),ee})},className:"w-full px-2 py-2 border border-gray-300 rounded"})]},`bpp-${I}`))}),e.jsxs("div",{className:"max-w-xs",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Extra loose boxes (not on pallets)"}),e.jsx("input",{type:"number",min:0,value:K,onChange:I=>V(Math.max(0,parseInt(I.target.value)||0)),className:"w-full px-2 py-2 border border-gray-300 rounded"})]})]})]})})]}),p==="box"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Total Boxes ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"pieces",value:h.pieces,onChange:I=>{const B=parseInt(I.target.value)||1;k(U=>({...U,pieces:B}))},className:"w-full px-4 py-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent bg-green-50",min:"1",required:!0})]}),p==="pallet"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Boxes (auto)"}),e.jsx("input",{type:"number",name:"pieces",value:h.pieces,readOnly:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),p==="pallet"&&(()=>{const I=Math.max(ce(h.palletCount,0),0);if(I===0)return null;const B=Array.from({length:I},(U,W)=>W+1);return e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"bg-white border-2 border-blue-200 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-800 flex items-center gap-2",children:"Pallet Photos (optional)"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[B.length," pallet",B.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:B.map(U=>{const W=D[U]||[],ee=q[U];return e.jsxs("div",{className:"border border-blue-100 rounded-lg p-3 bg-blue-50/60",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-semibold text-blue-700 uppercase",children:["Pallet #",U]}),e.jsx("p",{className:"text-[11px] text-gray-500",children:"Add up to 5 photos for reference"})]}),W.length>0&&e.jsxs("span",{className:"text-xs font-medium text-blue-600",children:[W.length," photo",W.length!==1?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex flex-col items-center justify-center gap-2 border-2 border-dashed border-blue-300 rounded-md py-6 hover:border-blue-500 hover:bg-blue-100/40 transition-colors cursor-pointer text-center text-xs text-blue-700 font-medium",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:se=>{Y(U,se.target.files),se.target.value=""},disabled:ee||W.length>=5}),ee?"Uploading...":W.length>=5?"Limit reached":"Upload Photos"]}),W.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:W.map((se,re)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:$(se),alt:`Pallet ${U} photo ${re+1}`,className:"h-16 w-16 object-cover rounded-md border border-blue-200"}),e.jsx("button",{type:"button",onClick:()=>te(U,re),className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-red-600 text-white text-xs flex items-center justify-center shadow",title:"Remove photo",children:"×"})]},`${U}-photo-${re}`))})]})]},`pallet-${U}`)})})]})})})(),e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"bg-orange-50 border-2 border-orange-300 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold text-orange-900 mb-3 flex items-center",children:"Shipment Size & Volume"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Length (cm)"}),e.jsx("input",{type:"number",name:"length",value:h.length||"",onChange:Q,className:"w-full px-3 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm",placeholder:"0",min:"0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Width (cm)"}),e.jsx("input",{type:"number",name:"width",value:h.width||"",onChange:Q,className:"w-full px-3 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm",placeholder:"0",min:"0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Height (cm)"}),e.jsx("input",{type:"number",name:"height",value:h.height||"",onChange:Q,className:"w-full px-3 py-2 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm",placeholder:"0",min:"0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-2",children:"Weight (kg)"}),e.jsx("input",{type:"number",name:"weight",value:h.weight||"",onChange:Q,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"0",min:"0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-orange-900 font-bold mb-2",children:"CBM (m3)"}),e.jsx("div",{className:"w-full px-3 py-2 border-2 border-orange-400 rounded-lg bg-orange-100 text-orange-900 font-bold text-center",children:h.cbm>0?h.cbm.toFixed(4):"0"})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"CBM auto-calculates: (Length x Width x Height) / 1,000,000"})]})})]})]}),client:()=>e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 flex items-center",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Client Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"clientName",value:h.clientName,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Phone Number ",S.requireClientPhone&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"clientPhone",value:h.clientPhone,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+965 1234 5678",required:S.requireClientPhone})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email Address ",S.requireClientEmail&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"clientEmail",value:h.clientEmail,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"john@example.com"})]}),S.showClientAddress!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Address ",S.requireClientAddress&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"clientAddress",value:h.clientAddress,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Street address, city",required:S.requireClientAddress})]})]})]}),warehouse:()=>S.showWarehouseMode===!1?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"isWarehouseShipment",name:"isWarehouseShipment",checked:h.isWarehouseShipment,onChange:Q,className:"w-5 h-5 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("label",{htmlFor:"isWarehouseShipment",className:"text-sm font-semibold text-orange-800",children:"This is a warehouse shipment (import/export with shipper/consignee details)"})]})}),h.isWarehouseShipment&&e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-orange-800 flex items-center",children:"Warehouse Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Shipper Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"shipper",value:h.shipper,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"ABC Trading Company",required:h.isWarehouseShipment})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Consignee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"consignee",value:h.consignee,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"XYZ Imports LLC",required:h.isWarehouseShipment})]}),S.showWeight!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Weight (kg) ",S.requireWeight&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"weight",value:h.weight,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",step:"0.01",required:S.requireWeight})]}),S.showDimensions!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Dimensions (L??W??H) ",S.requireDimensions&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"dimensions",value:h.dimensions,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"100??50??30 cm",required:S.requireDimensions})]}),S.showDescription!==!1&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Description ",S.requireDescription&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"description",value:h.description,onChange:Q,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe the shipment contents...",required:S.requireDescription})]})]})]})]}),storage:()=>e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-green-800 flex items-center",children:"Storage Assignment"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Assign to Rack ",S.requireRackAssignment&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"rackId",value:h.rackId,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:S.requireRackAssignment,children:[e.jsx("option",{value:"",children:S.requireRackAssignment?"Select a rack (required)":"Select a rack (optional)"}),m.map(I=>e.jsxs("option",{value:I.id,children:[I.code," - ",I.location," (",I.capacityUsed,"/",I.capacityTotal,")"]},I.id))]})]}),S.showEstimatedDays!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Estimated Storage Days ",S.requireEstimatedDays&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"estimatedDays",value:h.estimatedDays,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",min:"1",required:S.requireEstimatedDays})]}),S.showSpecialInstructions!==!1&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions"}),e.jsx("textarea",{name:"specialInstructions",value:h.specialInstructions,onChange:Q,rows:2,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Any special handling or storage requirements..."})]})]})]}),custom:()=>j.length===0?null:e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-800 flex items-center",children:"Custom Fields"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(I=>e.jsxs("div",{className:I.fieldType==="TEXTAREA"?"md:col-span-2":"",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[I.fieldName," ",I.isRequired&&e.jsx("span",{className:"text-red-500",children:"*"})]}),xe(I)]},I.id))})]}),pricing:()=>e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-yellow-800 flex items-center",children:"Estimated Cost"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Storage Rate per Day:"}),e.jsxs("span",{className:"font-medium",children:[c.storageRate.toFixed(3)," ",c.currency]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated Days:"}),e.jsxs("span",{className:"font-medium",children:[h.estimatedDays," days"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Number of Pieces:"}),e.jsxs("span",{className:"font-medium",children:[h.pieces," pieces"]})]}),e.jsxs("div",{className:"border-t border-yellow-300 pt-3 flex justify-between",children:[e.jsx("span",{className:"font-semibold text-yellow-900",children:"Estimated Total:"}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-2xl font-bold text-yellow-900",children:[ye.total.toFixed(3)," ",c.currency]})})]})]})]})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 text-white",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"New Shipment Intake"}),e.jsx("p",{className:"text-blue-100",children:"WHM Warehouse Management System"})]}),e.jsx("button",{onClick:b,className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:"×"})]})}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-100px)]",children:e.jsxs("form",{onSubmit:le,className:"p-6 space-y-6",children:[N&&e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"!"}),N]})}),T&&e.jsx("div",{className:"bg-green-50 border-l-4 border-green-500 text-green-700 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"✓"}),T]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-sm w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Shipment QR Code"}),e.jsx("button",{type:"button",onClick:()=>C(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg flex flex-col items-center mb-4",children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Master QR Code"}),e.jsx("p",{className:"font-mono bg-white p-4 rounded border border-gray-300 text-sm break-all",children:A})]}),e.jsx("div",{className:"w-full border-t pt-4 mt-4",children:p==="pallet"?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Pallet Details:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Pallets"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:h.palletCount})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Boxes/Pallet"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:h.boxesPerPallet})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded col-span-2",children:[e.jsx("p",{className:"text-gray-600",children:"Total Boxes"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:h.pieces})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-2",children:"Box Details:"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"bg-green-50 p-3 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Total Boxes"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:h.pieces})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"This shipment contains individual boxes (no pallets)"})]})]})})]}),e.jsx("button",{type:"button",onClick:()=>{navigator.clipboard.writeText(A),alert("QR Code copied to clipboard!")},className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 rounded-lg transition-colors",children:"Copy QR Code"})]})}),(S.requireClientEmail||S.requireEstimatedValue||S.requireRackAssignment)&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"mr-2 text-lg",children:"i"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-1",children:"Company Settings Applied"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",children:[S.requireClientEmail&&e.jsx("li",{children:"Client email is required"}),S.requireEstimatedValue&&e.jsx("li",{children:"Estimated value is required"}),S.requireRackAssignment&&e.jsx("li",{children:"Rack assignment is required"})]})]})]})}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Form Sections Order:"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Click arrows to reorder"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:M.map((I,B)=>{const U={basic:"Basic",client:"Client",warehouse:"Warehouse",storage:"Storage",custom:"Custom",pricing:"Pricing"};return e.jsxs("div",{className:"flex items-center gap-1 bg-white px-2 py-1 rounded border border-gray-300",children:[e.jsx("span",{className:"text-xs font-medium",children:U[I]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("button",{type:"button",onClick:()=>{if(B>0){const W=[...M];[W[B],W[B-1]]=[W[B-1],W[B]],H(W)}},disabled:B===0,className:"text-xs text-gray-500 hover:text-blue-600 disabled:opacity-30 leading-none",children:"Up"}),e.jsx("button",{type:"button",onClick:()=>{if(B<M.length-1){const W=[...M];[W[B],W[B+1]]=[W[B+1],W[B]],H(W)}},disabled:B===M.length-1,className:"text-xs text-gray-500 hover:text-blue-600 disabled:opacity-30 leading-none",children:"Down"})]})]},I)})})]})}),M.map(I=>{const B=Z[I];return B?e.jsx("div",{children:B()},I):null}),S.showNotes!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Additional Notes ",S.requireNotes&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"notes",value:h.notes,onChange:Q,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Any additional notes or comments...",required:S.requireNotes})]}),e.jsxs("div",{style:{display:"none"},className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 flex items-center",children:"??????? Shipment Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Barcode ID"}),e.jsx("input",{type:"text",name:"barcode",value:h.barcode,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 font-mono text-lg",readOnly:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Number of Pieces ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"pieces",value:h.pieces,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",required:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 flex items-center",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Client Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"clientName",value:h.clientName,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Phone Number ",S.requireClientPhone&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"clientPhone",value:h.clientPhone,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+965 1234 5678",required:S.requireClientPhone})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email Address ",S.requireClientEmail&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",name:"clientEmail",value:h.clientEmail,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"john@example.com"})]}),S.showClientAddress!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Address ",S.requireClientAddress&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"clientAddress",value:h.clientAddress,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Street address, city",required:S.requireClientAddress})]})]})]}),S.showWarehouseMode!==!1&&e.jsx("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"isWarehouseShipment",name:"isWarehouseShipment",checked:h.isWarehouseShipment,onChange:Q,className:"w-5 h-5 text-orange-600 bg-gray-100 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("label",{htmlFor:"isWarehouseShipment",className:"text-sm font-semibold text-orange-800",children:"This is a warehouse shipment (import/export with shipper/consignee details)"})]})}),h.isWarehouseShipment&&S.showWarehouseMode!==!1&&e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-orange-800 flex items-center",children:"Warehouse Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Shipper Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"shipper",value:h.shipper,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"ABC Trading Company",required:h.isWarehouseShipment})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Consignee Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"consignee",value:h.consignee,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"XYZ Imports LLC",required:h.isWarehouseShipment})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Shipper Address"}),e.jsx("input",{type:"text",name:"shipperAddress",value:h.shipperAddress,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"123 Export St, Dubai, UAE"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Consignee Address"}),e.jsx("input",{type:"text",name:"consigneeAddress",value:h.consigneeAddress,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"456 Import Ave, Kuwait City"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 flex items-center",children:"Shipment Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Total Weight (kg)"}),e.jsx("input",{type:"number",name:"weight",value:h.weight,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.0",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dimensions (L x W x H)"}),e.jsx("input",{type:"text",name:"dimensions",value:h.dimensions,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"100 x 50 x 30 cm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Estimated Value (",c.currency,") ",S.requireEstimatedValue&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"value",value:h.value,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",step:"0.01",required:S.requireEstimatedValue})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Storage Type"}),e.jsxs("select",{name:"storageType",value:h.storageType,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"STANDARD",children:"Standard Storage"}),e.jsx("option",{value:"FRAGILE",children:"Fragile Items"}),e.jsx("option",{value:"HAZMAT",children:"Hazardous Materials"}),e.jsx("option",{value:"COLD",children:"Cold Storage"}),e.jsx("option",{value:"SECURE",children:"High Security"})]})]}),S.showDescription!==!1&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Description ",S.requireDescription&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"description",value:h.description,onChange:Q,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Describe the shipment contents...",required:S.requireDescription})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-green-800 flex items-center",children:"Storage Assignment"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Assign to Rack ",S.requireRackAssignment&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"rackId",value:h.rackId,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:S.requireRackAssignment,children:[e.jsx("option",{value:"",children:S.requireRackAssignment?"Select a rack (required)":"Select a rack (optional)"}),m.map(I=>e.jsxs("option",{value:I.id,children:[I.code," - ",I.location," (",I.capacityUsed,"/",I.capacityTotal,")"]},I.id))]})]}),S.showEstimatedDays!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Estimated Storage Days ",S.requireEstimatedDays&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"estimatedDays",value:h.estimatedDays,onChange:Q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",min:"1",required:S.requireEstimatedDays})]}),S.showSpecialInstructions!==!1&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Instructions"}),e.jsx("textarea",{name:"specialInstructions",value:h.specialInstructions,onChange:Q,rows:2,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Any special handling or storage requirements..."})]})]})]}),j.length>0&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-purple-800 flex items-center",children:"??? Custom Fields"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:j.map(I=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[I.fieldName,I.isRequired&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),xe(I)]},I.id))})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-blue-800 flex items-center",children:"Estimated Storage Cost"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600",children:"Base Cost"}),e.jsxs("div",{className:"text-xl font-bold text-blue-800",children:[ye.baseCost.toFixed(3)," ",c.currency]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[h.pieces," pieces x ",h.estimatedDays," days x ",c.storageRate," rate"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-gray-600",children:["Tax (",c.taxRate,"%)"]}),e.jsxs("div",{className:"text-xl font-bold text-blue-800",children:[ye.tax.toFixed(3)," ",c.currency]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600",children:"Total Estimate"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-900",children:[ye.total.toFixed(3)," ",c.currency]})]})]})]}),S.showNotes!==!1&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Additional Notes ",S.requireNotes&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"notes",value:h.notes,onChange:Q,rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Any additional notes or comments...",required:S.requireNotes})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:G,className:"px-6 py-3 border-2 border-purple-500 text-purple-600 rounded-lg hover:bg-purple-50 font-medium transition-colors flex items-center gap-2",disabled:o||p==="pallet"&&(!h.palletCount||!h.boxesPerPallet)||p==="box"&&!h.pieces,children:p==="pallet"?"View Pallet QR":"View Box QR"}),e.jsx("button",{type:"button",onClick:b,className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors",disabled:o,children:"Cancel"}),e.jsx("button",{type:"button",onClick:Fe,className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors",disabled:o,children:"Reset"}),e.jsx("button",{type:"submit",className:"px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,children:o?"Creating...":"Create Shipment"})]})]})})]})})}function Aa({isOpen:s,onClose:b,onSelectRack:t,selectedRackId:o}){var w;const[n,N]=l.useState([]),[r,T]=l.useState(!0),[v,h]=l.useState("all"),[k,j]=l.useState("all"),[y,g]=l.useState(null),[i,m]=l.useState(!1);l.useEffect(()=>{s&&a()},[s]);const a=async()=>{try{T(!0);const p=await Re.getAll();N(p.racks||[])}catch(p){console.error("Load racks error:",p)}finally{T(!1)}},x=p=>Math.round(p.capacityUsed/p.capacityTotal*100),d=p=>p>=90?"bg-red-500":p>=75?"bg-yellow-500":p>=50?"bg-blue-500":"bg-green-500",c=n.filter(p=>!(k!=="all"&&!p.code.startsWith(k)||v==="available"&&p.capacityUsed>=p.capacityTotal||v==="full"&&p.capacityUsed<p.capacityTotal)),R=Array.from(new Set(n.map(p=>p.code.charAt(0)))).sort(),u=async p=>{m(!0);try{const f=await Re.getById(p.id);g(f.rack)}catch(f){console.error("Failed to load rack details:",f),g(p)}finally{m(!1)}},C=()=>{y&&y.status==="ACTIVE"&&y.capacityUsed<y.capacityTotal&&(t(y.id,y.code),b())},A=()=>{g(null)};return s?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"??????? Warehouse Rack Map"}),e.jsx("p",{className:"text-sm text-purple-100 mt-1",children:"Select a rack with available space"})]}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 text-2xl font-bold",children:"??"})]}),e.jsxs("div",{className:"px-6 py-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Section:"}),e.jsx("button",{onClick:()=>j("all"),className:`px-3 py-1 rounded-md text-sm font-medium ${k==="all"?"bg-purple-600 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"All"}),R.map(p=>e.jsx("button",{onClick:()=>j(p),className:`px-3 py-1 rounded-md text-sm font-medium ${k===p?"bg-purple-600 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:p},p))]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Show:"}),e.jsx("button",{onClick:()=>h("all"),className:`px-3 py-1 rounded-md text-sm font-medium ${v==="all"?"bg-blue-600 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"All"}),e.jsx("button",{onClick:()=>h("available"),className:`px-3 py-1 rounded-md text-sm font-medium ${v==="available"?"bg-green-600 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Available"}),e.jsx("button",{onClick:()=>h("full"),className:`px-3 py-1 rounded-md text-sm font-medium ${v==="full"?"bg-red-600 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"Full"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-gray-600",children:"0-50% Full"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-gray-600",children:"50-75% Full"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-gray-600",children:"75-90% Full"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-gray-600",children:"90-100% Full"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:c.map(p=>{const f=x(p),D=p.status==="ACTIVE"&&p.capacityUsed<p.capacityTotal,L=p.id===o;return e.jsxs("button",{onClick:()=>u(p),className:`relative border-2 rounded-lg p-4 transition-all hover:shadow-lg ${L?"border-purple-600 bg-purple-50 ring-2 ring-purple-600":D?"border-gray-300 hover:border-purple-400":"border-red-200 bg-red-50"}`,children:[L&&e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx(ge,{className:"h-6 w-6 text-purple-600 bg-white rounded-full"})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Ds,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{className:"flex items-center gap-1 mb-2 mt-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-lg font-bold text-gray-900",children:p.code})]}),e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:`inline-block px-2 py-0.5 text-xs font-semibold rounded-full ${p.status==="ACTIVE"?f>=100?"bg-red-100 text-red-800":f>=90?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:p.status==="ACTIVE"?f>=100?"???? FULL":f>=90?"???? ALMOST FULL":"???? AVAILABLE":p.status})}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3 truncate",title:p.location,children:["???? ",p.location]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:"Capacity"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[p.capacityUsed,"/",p.capacityTotal]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:`h-2.5 rounded-full transition-all ${d(f)}`,style:{width:`${Math.min(f,100)}%`}})}),e.jsxs("div",{className:"text-xs text-center text-gray-500 font-semibold",children:[f,"%"]})]}),D?e.jsxs("div",{className:"mt-2 text-xs font-medium text-green-600 text-center",children:["??? ",p.capacityTotal-p.capacityUsed," spaces"]}):e.jsx("div",{className:"mt-2 text-xs font-medium text-red-600 text-center",children:"??? No space"}),e.jsx("div",{className:"mt-2 text-xs text-blue-600 text-center font-medium",children:"Click to view details"})]},p.id)})}),!r&&c.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No racks found"}),e.jsx("p",{className:"text-sm mt-2",children:"Try changing the filters"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-semibold",children:c.length})," of"," ",e.jsx("span",{className:"font-semibold",children:n.length})," racks"]}),e.jsx("button",{onClick:b,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 font-medium",children:"Cancel"})]})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-end z-[60]",children:e.jsxs("div",{className:"bg-white h-full w-full max-w-2xl shadow-2xl flex flex-col animate-slide-in-right",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ae,{className:"h-7 w-7"}),"Rack ",y.code]}),e.jsxs("p",{className:"text-sm text-blue-100 mt-1",children:["???? ",y.location]})]}),e.jsx("button",{onClick:A,className:"text-white hover:text-gray-200 text-3xl font-bold",children:e.jsx(Te,{className:"h-8 w-8"})})]}),i?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Status"}),e.jsx("p",{className:"text-lg font-bold mt-1",children:e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm ${y.status==="ACTIVE"?y.capacityUsed>=y.capacityTotal?"bg-red-100 text-red-800":"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:y.status==="ACTIVE"?y.capacityUsed>=y.capacityTotal?"???? FULL":"???? AVAILABLE":y.status})})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Capacity"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:[y.capacityUsed,"/",y.capacityTotal]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Available"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 mt-1",children:y.capacityTotal-y.capacityUsed})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Utilization"}),e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[x(y),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:`h-4 rounded-full transition-all ${d(x(y))}`,style:{width:`${Math.min(x(y),100)}%`}})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:["???? Stored Shipments (",((w=y.boxes)==null?void 0:w.length)||0,")"]}),y.boxes&&y.boxes.length>0?e.jsx("div",{className:"space-y-3",children:y.boxes.map(p=>{let f=[];if(p.photos)try{const D=JSON.parse(p.photos);f=Array.isArray(D)?D:[]}catch(D){console.warn("Failed to parse box photos",D),f=[]}return e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 hover:border-blue-400 hover:shadow-md transition-all",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:["#",p.shipment.referenceId]}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${p.shipment.status==="STORED"?"bg-green-100 text-green-800":p.shipment.status==="RELEASED"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:p.shipment.status})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Box: ",e.jsx("span",{className:"font-semibold text-gray-700",children:p.boxNumber})]})]})}),p.shipment.shipper&&e.jsxs("div",{className:"text-xs text-gray-600 mt-2 space-y-1",children:[e.jsxs("p",{children:["???? ",e.jsx("span",{className:"font-medium",children:"From:"})," ",p.shipment.shipper]}),p.shipment.consignee&&e.jsxs("p",{children:["???? ",e.jsx("span",{className:"font-medium",children:"To:"})," ",p.shipment.consignee]})]}),f.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-700 mb-2 flex items-center gap-1",children:["???? Photos (",f.length,")"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:f.map((D,L)=>e.jsxs("a",{href:D,target:"_blank",rel:"noopener noreferrer",className:"group relative block aspect-square rounded-lg overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-all",children:[e.jsx("img",{src:D,alt:`Box photo ${L+1}`,className:"w-full h-full object-cover group-hover:scale-110 transition-transform"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold opacity-0 group-hover:opacity-100",children:"???? View"})})]},L))})]})]},p.id)})}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-4xl mb-3",children:"????"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No shipments stored"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"This rack is empty"})]})]}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex gap-3",children:[e.jsx("button",{onClick:A,className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 font-medium",children:"Close"}),y.status==="ACTIVE"&&y.capacityUsed<y.capacityTotal&&e.jsx("button",{onClick:C,className:"flex-1 px-4 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 font-bold shadow-lg",children:"??? Select This Rack"})]})]})]})})]}):null}function Ra({isOpen:s,onClose:b,onSuccess:t,shipment:o}){const[n,N]=l.useState(!1),[r,T]=l.useState([]),[v,h]=l.useState([]),[k,j]=l.useState({}),[y,g]=l.useState({clientName:"",clientPhone:"",clientEmail:"",description:"",totalBoxCount:"",currentBoxCount:"",rackId:"",estimatedValue:"",notes:"",status:""}),[i,m]=l.useState(""),[a,x]=l.useState(""),[d,c]=l.useState(!1);l.useEffect(()=>{s&&o&&(u(),R(),g({clientName:o.clientName||"",clientPhone:o.clientPhone||"",clientEmail:o.clientEmail||"",description:o.description||"",totalBoxCount:o.totalBoxCount||"",currentBoxCount:o.currentBoxCount||"",rackId:o.rackId||"",estimatedValue:o.estimatedValue||"",notes:o.notes||"",status:o.status||"IN_STORAGE"}),m(""),x(""))},[s,o]);const R=async()=>{try{const w=await fetch("/api/custom-fields?section=SHIPMENT",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(w.ok){const p=await w.json(),f=p.customFields||p,D=Array.isArray(f)?f.filter(L=>L.isActive):[];h(D)}if(o!=null&&o.id){const p=await fetch(`/api/custom-field-values/SHIPMENT/${o.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(p.ok){const f=await p.json(),D=f.customFieldValues||f,L={};Array.isArray(D)&&D.forEach(q=>{L[q.customFieldId]=q.fieldValue}),j(L)}}}catch(w){console.error("Failed to load custom fields:",w)}},u=async()=>{try{const p=(await Re.getAll()).racks.filter(f=>f.id===(o==null?void 0:o.rackId)||f.status==="ACTIVE"&&f.capacityUsed<f.capacityTotal);T(p)}catch(w){m("Failed to load racks: "+w.message)}},C=w=>{const{name:p,value:f}=w.target;g(D=>({...D,[p]:p.includes("Count")||p==="estimatedValue"?yt(f,!0):f}))},A=async w=>{w.preventDefault(),N(!0),m(""),x("");try{const p=ce(y.totalBoxCount),f=ce(y.currentBoxCount),D=ce(y.estimatedValue);if(!y.clientName||!y.clientPhone)throw new Error("Client name and phone are required");if(p<=0)throw new Error("Total box count must be greater than 0");if(f>p)throw new Error("Current box count cannot exceed total box count");if(!y.rackId)throw new Error("Please select a rack");const L={clientName:y.clientName,clientPhone:y.clientPhone,clientEmail:y.clientEmail,description:y.description,currentBoxCount:f,rackId:y.rackId,estimatedValue:D,notes:y.notes,status:y.status};if(await $e.update(o.id,L),v.length>0){const q=Object.entries(k).filter(([E,P])=>P!=="").map(([E,P])=>({customFieldId:E,fieldValue:P}));try{await fetch(`/api/custom-field-values/SHIPMENT/${o.id}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({values:q})})}catch(E){console.error("Failed to save custom field values:",E)}}alert(`✅ SUCCESS!

Shipment ${o.referenceId} has been updated successfully!

📦 Current Boxes: ${f}
📍 Rack: ${y.rackId}`),t(),b()}catch(p){m(p.message||"Failed to update shipment")}finally{N(!1)}};return!s||!o?null:e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-blue-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"✏️ Edit Shipment"}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 text-2xl font-bold",disabled:n,children:"×"})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-6",children:[i&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:i}),a&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:a}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"clientName",value:y.clientName,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"clientPhone",value:y.clientPhone,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+965 1234 5678",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",name:"clientEmail",value:y.clientEmail,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"john@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estimated Value (KWD)"}),e.jsx("input",{type:"number",name:"estimatedValue",value:y.estimatedValue,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00",step:"0.01",min:"0"})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Shipment Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("input",{type:"text",name:"description",value:y.description,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Household items, furniture, etc."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Total Box Count ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"totalBoxCount",value:y.totalBoxCount,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"10",min:"1",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Current Box Count ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"currentBoxCount",value:y.currentBoxCount,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"10",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:y.status,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"IN_STORAGE",children:"In Storage"}),e.jsx("option",{value:"PARTIAL",children:"Partial"}),e.jsx("option",{value:"RELEASED",children:"Released"})]})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Rack Assignment"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Rack"}),e.jsxs("select",{name:"rackId",value:y.rackId,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- No Rack Assigned --"}),r.map(w=>e.jsxs("option",{value:w.id,children:[w.code," - ",w.location," (Available: ",w.capacityTotal-w.capacityUsed,"/",w.capacityTotal,")"]},w.id))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",onClick:()=>c(!0),className:"w-full px-4 py-2 bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 font-medium border-2 border-purple-300",children:"🗺️ Open Rack Map"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes"}),e.jsx("textarea",{name:"notes",value:y.notes,onChange:C,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Any special instructions or notes..."})]}),v.length>0&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"✨ Custom Fields"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map(w=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[w.fieldName,w.isRequired&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),w.fieldType==="TEXT"&&e.jsx("input",{type:"text",value:k[w.id]||"",onChange:p=>j(f=>({...f,[w.id]:p.target.value})),required:w.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),w.fieldType==="NUMBER"&&e.jsx("input",{type:"number",value:k[w.id]||"",onChange:p=>j(f=>({...f,[w.id]:p.target.value})),required:w.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),w.fieldType==="DATE"&&e.jsx("input",{type:"date",value:k[w.id]||"",onChange:p=>j(f=>({...f,[w.id]:p.target.value})),required:w.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),w.fieldType==="DROPDOWN"&&w.fieldOptions&&e.jsxs("select",{value:k[w.id]||"",onChange:p=>j(f=>({...f,[w.id]:p.target.value})),required:w.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Select --"}),(()=>{if(!w.fieldOptions)return[];try{const p=JSON.parse(w.fieldOptions);return Array.isArray(p)?p.map(f=>e.jsx("option",{value:f,children:f},f)):[]}catch{return typeof w.fieldOptions=="string"?w.fieldOptions.split(",").map(p=>e.jsx("option",{value:p.trim(),children:p.trim()},p.trim())):[]}})()]}),w.fieldType==="CHECKBOX"&&e.jsxs("div",{className:"flex items-center h-10",children:[e.jsx("input",{type:"checkbox",checked:k[w.id]==="true",onChange:p=>j(f=>({...f,[w.id]:p.target.checked?"true":"false"})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Yes"})]})]},w.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium",disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:n,children:n?"Updating...":"Update Shipment"})]})]})]}),e.jsx(Aa,{isOpen:d,onClose:()=>c(!1),selectedRackId:y.rackId,onSelectRack:w=>{g(p=>({...p,rackId:w})),c(!1)}})]})}function Ta({shipmentId:s}){const[b,t]=l.useState([]),[o,n]=l.useState(!1),[N,r]=l.useState({}),[T,v]=l.useState([]);l.useEffect(()=>{h()},[s]);const h=async()=>{n(!0);try{const m=(await(await fetch(`/api/shipments/${s}/boxes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json()).boxes||[];t(m);const a=[];for(const c of m){if(c.photos)try{const R=JSON.parse(c.photos);if(Array.isArray(R))for(const u of R)typeof u=="string"&&u&&!a.includes(u)&&a.push(u)}catch{}if(c.pieceQR)try{const R=JSON.parse(c.pieceQR);c.palletNumber=R.palletNumber||null}catch{c.palletNumber=null}}v(a);const x={},d=[];for(const c of m)if(c.rackId&&c.rack){const R=`${c.rack.code}|${c.rack.location||""}`;x[R]||(x[R]=[]),x[R].push(c)}else d.push(c);d.length>0&&(x["Unassigned|Pending Assignment"]=d),r(x)}catch(g){console.error("Failed to load boxes:",g)}finally{n(!1)}};if(o)return e.jsxs("div",{className:"border border-blue-200 bg-blue-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"📦"})," Box Distribution"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Loading box distribution..."})]});if(b.length===0)return null;const k=b.length,j=b.filter(g=>g.rackId).length,y=Object.keys(N).filter(g=>!g.startsWith("Unassigned")).length;return e.jsxs("div",{className:"border border-blue-200 bg-blue-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"📦"})," Box Distribution & Locations"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 p-3 bg-white rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:k}),e.jsx("p",{className:"text-xs text-gray-600",children:"Total Boxes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:j}),e.jsx("p",{className:"text-xs text-gray-600",children:"Assigned"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:y}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Rack",y!==1?"s":""]})]})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(N).map(([g,i])=>{const[m,a]=g.split("|"),x=g.startsWith("Unassigned");return e.jsxs("div",{className:`p-3 rounded-lg border-2 ${x?"bg-yellow-50 border-yellow-300":"bg-white border-green-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:x?"⏳":"🗄️"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800",children:m}),a&&!x&&e.jsx("p",{className:"text-xs text-gray-600",children:a})]})]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${x?"bg-yellow-200 text-yellow-800":"bg-green-200 text-green-800"}`,children:[i.length," box",i.length!==1?"es":""]})]}),e.jsx("div",{className:"grid grid-cols-8 gap-1 mt-2",children:i.map(d=>e.jsxs("div",{className:`aspect-square flex flex-col items-center justify-center text-xs font-bold rounded ${d.status==="IN_STORAGE"?"bg-green-500 text-white":d.status==="RELEASED"?"bg-gray-400 text-white":"bg-yellow-400 text-gray-800"}`,title:`Box #${d.boxNumber}${d.palletNumber?` - Pallet ${d.palletNumber}`:""} - ${d.status}`,children:[e.jsx("span",{children:d.boxNumber}),d.palletNumber&&e.jsxs("span",{className:"text-[8px] opacity-80",children:["P",d.palletNumber]})]},d.id))})]},g)})}),T.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-white rounded-lg border border-blue-200",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:["Photos (",T.length,")"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:T.map((g,i)=>e.jsxs("a",{href:g,target:"_blank",rel:"noopener noreferrer",className:"group relative block aspect-square rounded-lg overflow-hidden border-2 border-blue-200 hover:border-blue-500 transition-all",children:[e.jsx("img",{src:g,alt:`Photo ${i+1}`,className:"w-full h-full object-cover group-hover:scale-110 transition-transform"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors"})]},i))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-blue-200",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Status Legend:"}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-600",children:"In Storage"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-yellow-400 rounded"}),e.jsx("span",{className:"text-gray-600",children:"Pending"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-400 rounded"}),e.jsx("span",{className:"text-gray-600",children:"Released"})]})]})]})]})}function Pa({isOpen:s,onClose:b,shipmentId:t}){const[o,n]=l.useState(null),[N,r]=l.useState([]),[T,v]=l.useState(!1),[h,k]=l.useState("");l.useEffect(()=>{s&&t&&(j(),y())},[s,t]);const j=async()=>{v(!0),k("");try{const i=await $e.getById(t);n(i.shipment)}catch(i){k("Failed to load shipment details"),console.error(i)}finally{v(!1)}},y=async()=>{try{const i=await fetch(`/api/custom-field-values/SHIPMENT/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(i.ok){const m=await i.json();r(m.customFieldValues||m.values||[])}}catch(i){console.error("Failed to load custom field values:",i)}},g=i=>{const m={PENDING:{color:"bg-yellow-100 text-yellow-800 border-yellow-300",emoji:"🟡",text:"Pending"},IN_TRANSIT:{color:"bg-blue-100 text-blue-800 border-blue-300",emoji:"🚚",text:"In Transit"},IN_STORAGE:{color:"bg-green-100 text-green-800 border-green-300",emoji:"🟢",text:"In Storage"},RELEASED:{color:"bg-gray-100 text-gray-800 border-gray-300",emoji:"🔵",text:"Released"}},a=m[i]||m.PENDING;return e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-semibold border ${a.color}`,children:[a.emoji," ",a.text]})};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-4 flex justify-between items-center rounded-t-lg",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"📦 Shipment Details"}),e.jsxs("p",{className:"text-blue-100 text-sm mt-1",children:["Reference: ",o==null?void 0:o.referenceId]})]}),e.jsx("button",{onClick:b,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6",children:T?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading shipment details..."})]}):h?e.jsx("div",{className:"bg-red-50 border border-red-300 text-red-800 px-4 py-3 rounded",children:h}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:o.name}),e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["QR Code: ",o.qrCode]})]}),g(o.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Type"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Total Boxes"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.originalBoxCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Current Boxes"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.currentBoxCount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Arrival Date"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(o.arrivalDate).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"👤"})," Client Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Name"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.clientName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Phone"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.clientPhone})]}),o.clientEmail&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Email"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.clientEmail})]}),o.estimatedValue&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Estimated Value"}),e.jsxs("p",{className:"font-semibold text-gray-800",children:["KWD ",o.estimatedValue.toFixed(3)]})]})]})]}),o.rack&&e.jsxs("div",{className:"border border-green-200 bg-green-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"🗄️"})," Primary Storage Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Rack Code"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.rack.code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Location"}),e.jsx("p",{className:"font-semibold text-gray-800",children:o.rack.location})]})]})]}),e.jsx(Ta,{shipmentId:t}),(o.description||o.notes)&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"📝"})," Additional Information"]}),o.description&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Description"}),e.jsx("p",{className:"text-gray-800",children:o.description})]}),o.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Notes"}),e.jsx("p",{className:"text-gray-800",children:o.notes})]})]}),N.length>0&&e.jsxs("div",{className:"border border-purple-200 bg-purple-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"✨"})," Custom Fields"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:N.map(i=>e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:i.customField.fieldName}),e.jsx("p",{className:"font-semibold text-gray-800",children:i.customField.fieldType==="CHECKBOX"?i.fieldValue==="true"?"✅ Yes":"❌ No":i.fieldValue})]},i.id))})]}),o.withdrawals&&o.withdrawals.length>0&&e.jsxs("div",{className:"border border-orange-200 bg-orange-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"📤"})," Withdrawal History"]}),e.jsx("div",{className:"space-y-2",children:o.withdrawals.map(i=>e.jsxs("div",{className:"bg-white p-3 rounded border border-orange-200 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-semibold",children:[i.withdrawnBoxCount," boxes withdrawn"]}),e.jsx("span",{className:"text-gray-600",children:new Date(i.withdrawalDate).toLocaleDateString()})]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Collected by: ",i.withdrawnBy]}),i.notes&&e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:i.notes})]},i.id))})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:[e.jsxs("h4",{className:"font-bold text-gray-800 mb-3 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"🕐"})," Audit Trail"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Created"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(o.createdAt).toLocaleString()}),o.createdBy&&e.jsxs("p",{className:"text-xs text-gray-500",children:["By: User ID ",o.createdBy]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Last Updated"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(o.updatedAt).toLocaleString()}),o.updatedBy&&e.jsxs("p",{className:"text-xs text-gray-500",children:["By: User ID ",o.updatedBy]})]}),o.releasedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Released"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date(o.releasedAt).toLocaleString()})]})]})]})]}):null}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-end gap-3 border-t rounded-b-lg",children:e.jsx("button",{onClick:b,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"Close"})})]})}):null}function Da({isOpen:s,onClose:b,shipmentId:t,shipmentRef:o}){var R;const[n,N]=l.useState([]),[r,T]=l.useState(null),[v,h]=l.useState({}),[k,j]=l.useState(null),[y,g]=l.useState([]),[i,m]=l.useState(!1),[a,x]=l.useState(null);l.useEffect(()=>{s&&t&&(fetch("/api/company/branding").then(u=>u.json()).then(u=>{const C=(u==null?void 0:u.branding)||null;console.log("✅ BoxQRModal: Loaded branding:",C),console.log("   - logoUrl:",C==null?void 0:C.logoUrl),j(C)}).catch(u=>{console.error("❌ BoxQRModal: Failed to load branding:",u)}),d())},[s,t]);const d=async()=>{m(!0),x(null);try{const u=await fetch(`/api/shipments/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(u.ok){const A=await u.json();T(A.shipment||A)}const C=await fetch(`/api/shipments/${t}/boxes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(C.ok){const A=await C.json();if(!A.boxes||A.boxes.length===0){x("No boxes found for this shipment"),m(!1);return}const w=A.boxes.map(S=>({id:S.id,boxNumber:S.boxNumber,qrCode:S.qrCode,status:S.status,pieceQR:S.pieceQR,rack:S.rack}));N(w);const p=new Map,f=[];w.forEach(S=>{let O=0,M=!1;try{const H=S.pieceQR?JSON.parse(S.pieceQR):void 0;O=Number((H==null?void 0:H.palletNumber)||0),M=!!(H!=null&&H.isLoose)||O===0}catch{const H=/-PAL-(\d+)/.exec(S.qrCode);O=H?parseInt(H[1],10):0,M=O===0}M?f.push(S):p.set(O,(p.get(O)||0)+1)});const D=(r==null?void 0:r.palletCount)||p.size||0,L=(r==null?void 0:r.qrCode)||"",q=(r==null?void 0:r.clientName)||"",E=r!=null&&r.arrivalDate?new Date(r.arrivalDate):null,P=E?`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}-${String(E.getDate()).padStart(2,"0")}`:"",J=(S,O)=>{const M={t:"PAL",pn:S,pc:D||p.size,pcs:O,ref:o,c:q,ad:P};let H="";try{H=typeof window<"u"&&window.btoa?window.btoa(JSON.stringify(M)):btoa(JSON.stringify(M))}catch{H=encodeURIComponent(JSON.stringify(M))}return L?`${L}-PAL-${S}-OF-${D||p.size}|S:${H}`:`PALLET-${t}-${S}|S:${H}`},F=Array.from(p.entries()).sort((S,O)=>S[0]-O[0]).map(([S,O])=>{const M=J(S,O);return{type:"PALLET",key:`PAL-${S}`,palletNumber:S,pieces:O,qrValue:M}}),z=f.sort((S,O)=>S.boxNumber-O.boxNumber).map(S=>({type:"LOOSE_BOX",key:`BOX-${S.id}`,boxId:S.id,boxNumber:S.boxNumber,qrValue:S.qrCode})),K=[...F,...z];g(K);const V={};for(const S of K){const O=S.key,M=S.qrValue;V[O]=await Cs.toDataURL(M,{width:220})}h(V)}}catch(u){console.error("Failed to load data:",u)}finally{m(!1)}},c=async()=>{const u=[];k!=null&&k.logoUrl&&u.push(new Promise(C=>{const A=new Image;A.onload=()=>C(),A.onerror=()=>C(),A.src=k.logoUrl})),Object.values(v).forEach(C=>{u.push(new Promise(A=>{const w=new Image;w.onload=()=>A(),w.onerror=()=>A(),w.src=C}))}),await Promise.all(u),setTimeout(()=>{window.print()},100)};return s?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-4 flex justify-between items-center rounded-t-lg print:hidden",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[k!=null&&k.logoUrl?e.jsx("img",{src:k.logoUrl,alt:(k==null?void 0:k.name)||"Brand",className:"h-8 w-auto rounded bg-white/10 p-1"}):e.jsx("span",{className:"inline-flex items-center justify-center h-8 w-8 rounded bg-white/20 font-black",children:"Q"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"QGO Cargo • QR Suite"}),e.jsxs("p",{className:"text-indigo-100 text-sm mt-1",children:["Shipment: ",o,(R=r==null?void 0:r.companyProfile)!=null&&R.name?` • Profile: ${r.companyProfile.name}`:""]})]})]}),e.jsx("button",{onClick:b,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6",children:i?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading QR codes..."})]}):a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-gray-700 font-semibold text-lg",children:a}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Boxes will be created when shipment is saved"})]}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-5xl mb-4",children:"📦"}),e.jsx("p",{className:"text-gray-500",children:"No boxes found for this shipment"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center print:hidden",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800",children:["QRs to Print: ",y.length," (Pallets: ",y.filter(u=>u.type==="PALLET").length,", Loose Boxes: ",y.filter(u=>u.type==="LOOSE_BOX").length,")"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"One QR per pallet with details, plus one for each loose box"})]}),e.jsxs("button",{onClick:c,className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print All QR Codes"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:y.map(u=>{var C,A;return e.jsxs("div",{className:"border-2 border-gray-200 rounded-lg p-4 text-center hover:border-indigo-400 transition print:border print:border-black print:break-inside-avoid",children:[u.type==="PALLET"?e.jsxs("div",{className:"bg-blue-100 text-blue-800 font-bold text-lg rounded-md py-2 mb-3",children:["Pallet #",u.palletNumber]}):e.jsxs("div",{className:"bg-purple-100 text-purple-800 font-bold text-lg rounded-md py-2 mb-3",children:["Loose Box #",u.boxNumber]}),v[u.key]&&e.jsx("img",{src:v[u.key],alt:`${u.type==="PALLET"?`Pallet ${u.palletNumber}`:`Loose Box ${u.boxNumber}`} QR`,className:"mx-auto mb-3"}),e.jsx("div",{className:"flex items-center justify-center gap-2 mb-3",children:k!=null&&k.logoUrl?e.jsx("img",{src:k.logoUrl,alt:"Logo",className:"h-8 w-auto object-contain",onError:w=>{console.error("❌ Logo failed to load:",k.logoUrl),w.target.style.display="none"}}):e.jsx("span",{className:"text-sm font-black text-indigo-700",children:"QGO"})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[e.jsx("p",{className:"text-sm text-gray-600 font-mono truncate max-w-[220px]",title:u.qrValue,children:u.qrValue.replace(/\|S:.+$/,"")}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(u.qrValue),className:"text-indigo-600 hover:text-indigo-800 text-sm underline print:hidden",title:"Copy full QR value",children:"Copy"})]}),u.type==="PALLET"?e.jsxs("div",{className:"text-sm text-gray-700 space-y-1.5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Shipment:"})," ",e.jsx("span",{className:"font-bold",children:o})]}),((C=r==null?void 0:r.companyProfile)==null?void 0:C.name)&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Profile:"})," ",e.jsx("span",{className:"font-bold",children:r.companyProfile.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pieces on Pallet:"})," ",e.jsx("span",{className:"font-bold",children:u.pieces})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Client:"})," ",e.jsx("span",{className:"font-bold",children:(r==null?void 0:r.clientName)||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Arrived:"})," ",e.jsx("span",{className:"font-bold",children:new Date((r==null?void 0:r.arrivalDate)||"").toLocaleDateString()})]})]}):e.jsxs("div",{className:"text-sm text-gray-700 space-y-1.5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Shipment:"})," ",e.jsx("span",{className:"font-bold",children:o})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",e.jsx("span",{className:"font-bold",children:"Loose Box"})]}),((A=r==null?void 0:r.companyProfile)==null?void 0:A.name)&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Profile:"})," ",e.jsx("span",{className:"font-bold",children:r.companyProfile.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Client:"})," ",e.jsx("span",{className:"font-bold",children:(r==null?void 0:r.clientName)||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Arrived:"})," ",e.jsx("span",{className:"font-bold",children:new Date((r==null?void 0:r.arrivalDate)||"").toLocaleDateString()})]})]})]},u.key)})}),n.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-lg font-semibold",children:"No boxes found"})]})]})}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 px-6 py-4 flex justify-end gap-3 border-t rounded-b-lg print:hidden",children:e.jsx("button",{onClick:b,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition",children:"Close"})})]}),e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          .fixed, .fixed * {
            visibility: visible !important;
          }
          .fixed {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
          .fixed img {
            visibility: visible !important;
            max-width: 100%;
            height: auto;
          }
          .print\\:hidden {
            display: none !important;
          }
          .print\\:border {
            border: 1px solid #000 !important;
          }
          .print\\:break-inside-avoid {
            page-break-inside: avoid;
          }
        }
      `})]}):null}const Ea=()=>{const[s,b]=l.useState(""),[t,o]=l.useState("all"),[n,N]=l.useState("all"),[r,T]=l.useState([]),[v,h]=l.useState({all:0,pending:0,in_storage:0,partial:0,released:0}),[k,j]=l.useState({all:0,regular:0,warehouse:0}),[y,g]=l.useState(!0),[i,m]=l.useState(""),[a,x]=l.useState(!1),[d,c]=l.useState(null),[R,u]=l.useState(!1),[C,A]=l.useState(!1),[w,p]=l.useState(!1),[f,D]=l.useState(!1),[L,q]=l.useState(!1),[E,P]=l.useState(null);l.useEffect(()=>{J()},[t,n,s]);const J=async()=>{try{g(!0);const H=(await $e.getAll({})).shipments||[],de={all:H.length,pending:H.filter(ae=>ae.status==="PENDING").length,in_storage:H.filter(ae=>ae.status==="IN_STORAGE"||ae.status==="ACTIVE").length,partial:H.filter(ae=>ae.status==="PARTIAL").length,released:H.filter(ae=>ae.status==="RELEASED").length};h(de);const be={all:H.length,regular:H.filter(ae=>!ae.isWarehouseShipment).length,warehouse:H.filter(ae=>ae.isWarehouseShipment).length};j(be);const he={};t!=="all"&&(he.status=t==="in_storage"?"IN_STORAGE":t.toUpperCase()),n==="regular"?he.isWarehouseShipment=!1:n==="warehouse"&&(he.isWarehouseShipment=!0),s&&(he.search=s);const Ne=(await $e.getAll(he)).shipments||[];console.log("📦 Shipments loaded:",Ne.map(ae=>({id:ae.referenceId,status:ae.status,boxes:ae.currentBoxCount}))),T(Ne)}catch(M){m(M.message),console.error("Load shipments error:",M)}finally{g(!1)}},F=async M=>{const H=r.find(be=>be.id===M),de=`🚨 DELETE SHIPMENT

Reference: ${(H==null?void 0:H.referenceId)||"N/A"}
Client: ${(H==null?void 0:H.clientName)||"N/A"}
Boxes: ${(H==null?void 0:H.currentBoxCount)||0}

⚠️ This action CANNOT be undone!

Are you sure you want to delete this shipment?`;if(confirm(de))try{await $e.delete(M),alert("✅ Shipment deleted successfully!"),J()}catch(be){alert("❌ Error deleting shipment: "+be.message)}},z=M=>{c(M),x(!0)},K=M=>{const H=new Date(M.arrivalDate),de=M.releasedAt?new Date(M.releasedAt):new Date;Math.ceil((de.getTime()-H.getTime())/(1e3*60*60*24));const be={shipment:M,invoice:null,releaseDate:M.releasedAt||new Date,releasedBy:"Admin User",collectorID:"N/A",releaseType:M.currentBoxCount===0?"FULL":"PARTIAL",boxesReleased:M.originalBoxCount-M.currentBoxCount};P(be),q(!0)},V=M=>{switch(M){case"PENDING":return{color:"bg-yellow-100 text-yellow-800",icon:"⏳",label:"Pending"};case"IN_STORAGE":return{color:"bg-green-100 text-green-800",icon:"✅",label:"In Storage"};case"ACTIVE":return{color:"bg-green-100 text-green-800",icon:"✅",label:"In Storage"};case"PARTIAL":return{color:"bg-orange-100 text-orange-800",icon:"⚠",label:"Partial"};case"RELEASED":return{color:"bg-blue-100 text-blue-800",icon:"🔵",label:"Released"};default:return{color:"bg-gray-100 text-gray-800",icon:"⚪",label:M}}},S=M=>{const H=Number(M==null?void 0:M.palletCount)||0,de=Number(M==null?void 0:M.boxesPerPallet)||0;return H>1||H===1&&de>1?"PALLET":"BOX"},O=M=>{const H=(M==null?void 0:M.arrivalDate)||(M==null?void 0:M.receivedDate)||(M==null?void 0:M.createdAt);if(!H)return 0;const de=new Date(H);if(Number.isNaN(de.getTime()))return 0;const he=new Date().getTime()-de.getTime(),ve=Math.ceil(he/(1e3*60*60*24));return Math.max(0,ve)};return y?e.jsx("div",{className:"p-6 flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading shipments..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"📦 Warehouse Shipments"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Complete warehouse management with intake, tracking, and release"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all shadow-md",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2"}),"📦 New Shipment Intake"]})]}),i&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:i}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(os,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Shipment Type"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${n==="all"?"bg-primary-100 text-primary-700 border border-primary-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["All Types (",k.all,")"]}),e.jsxs("button",{onClick:()=>N("regular"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${n==="regular"?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Rs,{className:"h-4 w-4"}),"Regular Shipments (",k.regular,")"]}),e.jsxs("button",{onClick:()=>N("warehouse"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${n==="warehouse"?"bg-orange-100 text-orange-700 border border-orange-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(it,{className:"h-4 w-4"}),"Warehouse Shipments (",k.warehouse,")"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>o("all"),className:`flex-1 py-4 px-6 text-center font-medium text-sm transition-colors ${t==="all"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"All Shipments"}),v.all>0&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:v.all})]})}),e.jsx("button",{onClick:()=>o("pending"),className:`flex-1 py-4 px-6 text-center font-medium text-sm transition-colors ${t==="pending"?"border-b-2 border-yellow-500 text-yellow-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"⏳ Pending"}),v.pending>0&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:v.pending})]})}),e.jsx("button",{onClick:()=>o("in_storage"),className:`flex-1 py-4 px-6 text-center font-medium text-sm transition-colors ${t==="in_storage"?"border-b-2 border-green-500 text-green-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"✅ In Storage"}),v.in_storage>0&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:v.in_storage})]})}),e.jsx("button",{onClick:()=>o("partial"),className:`flex-1 py-4 px-6 text-center font-medium text-sm transition-colors ${t==="partial"?"border-b-2 border-orange-500 text-orange-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"� Partial"}),v.partial>0&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:v.partial})]})}),e.jsx("button",{onClick:()=>o("released"),className:`flex-1 py-4 px-6 text-center font-medium text-sm transition-colors ${t==="released"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{children:"🔵 Released"}),v.released>0&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:v.released})]})})]})}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by client name, phone, or shipment ID...",value:s,onChange:M=>b(M.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Barcode ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pieces"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rack"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Stored"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[r.map(M=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:M.referenceId})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:M.clientName}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(M.receivedDate).toLocaleDateString()})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:M.clientPhone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:["📦 ",M.currentBoxCount," / ",M.originalBoxCount," pieces"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center gap-2",children:S(M)==="PALLET"?e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-800",children:"🪵 Pallet"}):e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800",children:"📦 Box"})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-medium text-primary-600",children:M.rackLocations||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("span",{className:"font-semibold",children:[O(M)," days"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(()=>{const H=V(M.status);return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full ${H.color}`,children:[e.jsx("span",{children:H.icon}),e.jsx("span",{children:H.label})]})})()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{c(M),D(!0)},className:"text-indigo-600 hover:text-indigo-900 transition-colors",title:"View/Print QR Codes",children:e.jsx(Ae,{className:"h-5 w-5"})}),(M.status==="IN_STORAGE"||M.status==="IN_WAREHOUSE"||M.status==="PARTIAL"||M.status==="STORED"||M.status==="ACTIVE")&&M.currentBoxCount>0&&e.jsx("button",{onClick:()=>z(M),className:"text-green-600 hover:text-green-900",title:"Generate Invoice & Release",children:e.jsx(Ps,{className:"h-5 w-5"})}),M.status==="RELEASED"&&e.jsx("button",{onClick:()=>K(M),className:"text-purple-600 hover:text-purple-900",title:"Print Release Note",children:e.jsx(Be,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{c(M),p(!0)},className:"text-blue-600 hover:text-blue-900",title:"View Details",children:e.jsx(ds,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>{c(M),A(!0)},className:"text-gray-600 hover:text-gray-900",title:"Edit Shipment",children:e.jsx(Ge,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>F(M.id),className:"text-red-600 hover:text-red-900",children:e.jsx(qe,{className:"h-5 w-5"})})]})})]},M.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center text-gray-500",children:"No shipments found"})})]})]})})}),e.jsx(ka,{isOpen:R,onClose:()=>u(!1),onSuccess:J}),e.jsx(Ra,{isOpen:C,onClose:()=>A(!1),shipment:d,onSuccess:J}),e.jsx(Pa,{isOpen:w,onClose:()=>p(!1),shipmentId:(d==null?void 0:d.id)||""}),e.jsx(Sa,{isOpen:a,onClose:()=>x(!1),shipment:d,onSuccess:J}),e.jsx(Da,{isOpen:f,onClose:()=>D(!1),shipmentId:(d==null?void 0:d.id)||"",shipmentRef:(d==null?void 0:d.referenceId)||""}),L&&E&&e.jsx(wa,{isOpen:L,onClose:()=>q(!1),releaseData:E})]})};function Ia({isOpen:s,onClose:b,onSuccess:t}){const[o,n]=l.useState(!1),[N,r]=l.useState([]),[T,v]=l.useState({code:"",location:"",rackType:"STORAGE",categoryId:"",companyProfileId:"",capacityTotal:100,status:"ACTIVE",length:"",width:"",height:"",dimensionUnit:"METERS"}),[h,k]=l.useState(""),[j,y]=l.useState(""),[g,i]=l.useState(""),[m,a]=l.useState(null),x=w=>w?w.startsWith("http")||w.startsWith("/")?w:`/uploads/${w}`:"";l.useEffect(()=>{s&&d()},[s]);const d=async()=>{try{const p=(await We.listProfiles()||[]).filter(f=>f.isActive!==!1).map(f=>({id:f.id,name:f.name,description:f.description,logo:f.logo,contractStatus:f.contractStatus,contactPerson:f.contactPerson,contactPhone:f.contactPhone,color:"#5B21B6",icon:"????"}));r(p)}catch(w){console.error("Failed to load categories:",w)}};l.useEffect(()=>{s&&(v({code:"",location:"",rackType:"STORAGE",categoryId:"",companyProfileId:"",capacityTotal:100,status:"ACTIVE",length:"",width:"",height:"",dimensionUnit:"METERS"}),k(""),y(""),i(""),a(null))},[s]);const c=w=>{const{name:p,value:f}=w.target;if(v(D=>{const L={...D,[p]:p==="capacityTotal"?Number(f):f};return p==="categoryId"&&(L.companyProfileId=f),L}),p==="categoryId"){const D=N.find(L=>L.id===f);a(D||null)}},R=async w=>{try{const p=`RACK:${w}`,f=await Cs.toDataURL(p,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});k(f)}catch(p){console.error("QR generation error:",p)}},u=w=>{const p=w.target.value.toUpperCase();v(f=>({...f,code:p})),p.length>0?R(p):k("")},C=()=>{if(!h)return;const w=document.createElement("a");w.href=h,w.download=`rack-${T.code}-qr.png`,document.body.appendChild(w),w.click(),document.body.removeChild(w)},A=async w=>{w.preventDefault(),n(!0),y(""),i("");try{if(!T.code||!T.location)throw new Error("Rack code and location are required");if(T.capacityTotal<=0)throw new Error("Capacity must be greater than 0");const p=`RACK-${T.code}-${Date.now()}`,f=T.companyProfileId||T.categoryId||"",{categoryId:D,companyProfileId:L,length:q,width:E,height:P,...J}=T,F={...J,qrCode:p,capacityUsed:0,length:q?parseFloat(q):void 0,width:E?parseFloat(E):void 0,height:P?parseFloat(P):void 0,categoryId:void 0,companyProfileId:f||void 0};await Re.create(F),i("Rack created successfully! ???"),await R(T.code),setTimeout(()=>{t(),b()},2e3)}catch(p){y(p.message||"Failed to create rack")}finally{n(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-purple-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"???? Create New Rack"}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 text-2xl font-bold",disabled:o,children:"??"})]}),e.jsxs("form",{onSubmit:A,className:"p-6 space-y-6",children:[j&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:j}),g&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:g}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Rack Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"code",value:T.code,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent uppercase",placeholder:"A1, B2, C3...",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use format like A1, A2, B1, etc."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Location ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"location",value:T.location,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Zone A, Floor 1, Section North...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Rack Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"rackType",value:T.rackType,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"STORAGE",children:"Storage"}),e.jsx("option",{value:"MATERIALS",children:"Materials"}),e.jsx("option",{value:"EQUIPMENT",children:"Equipment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category / Company"}),e.jsxs("select",{name:"categoryId",value:T.categoryId,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Category / Company..."}),N.map(w=>e.jsxs("option",{value:w.id,children:["???? ",w.name]},w.id))]}),m&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m.logo&&e.jsx("img",{src:x(m.logo),alt:`${m.name} logo`,className:"h-10 w-10 rounded-md object-contain bg-white border border-blue-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:m.name}),m.contractStatus&&e.jsx("p",{className:"text-blue-600 text-xs uppercase font-semibold",children:m.contractStatus})]})]}),m.description&&e.jsx("p",{className:"text-blue-700 text-xs mt-1",children:m.description}),(m.contactPerson||m.contactPhone)&&e.jsxs("p",{className:"text-blue-700 text-xs mt-1",children:[m.contactPerson&&`Contact: ${m.contactPerson}`,m.contactPerson&&m.contactPhone&&" ?? ",m.contactPhone&&`Phone: ${m.contactPhone}`]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select which company/category this rack belongs to"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Total Capacity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"capacityTotal",value:T.capacityTotal,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"100",min:"1",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum number of items/boxes"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"status",value:T.status,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"}),e.jsx("option",{value:"RESERVED",children:"Reserved"})]})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"???? Dimensions (Size Information)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Length"}),e.jsx("input",{type:"number",name:"length",value:T.length,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.0",step:"0.01",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Width"}),e.jsx("input",{type:"number",name:"width",value:T.width,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.0",step:"0.01",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Height"}),e.jsx("input",{type:"number",name:"height",value:T.height,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.0",step:"0.01",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),e.jsxs("select",{name:"dimensionUnit",value:T.dimensionUnit,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"METERS",children:"Meters"}),e.jsx("option",{value:"FEET",children:"Feet"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"???? Optional: Enter rack physical dimensions for detailed tracking"})]}),h&&e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"QR Code Preview"}),e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx("img",{src:h,alt:"QR Code",className:"border-2 border-gray-300 rounded p-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Scan this code to identify rack: ",e.jsx("span",{className:"font-bold",children:T.code})]}),g&&e.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 font-medium text-sm",children:"???? Download QR Code"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:o,children:o?"Creating...":"Create Rack"})]})]})]})}):null}function Fa({isOpen:s,onClose:b,onSuccess:t,rack:o}){const[n,N]=l.useState(!1),[r,T]=l.useState([]),[v,h]=l.useState({code:"",location:"",rackType:"STORAGE",categoryId:"",companyProfileId:"",capacityTotal:100,status:"ACTIVE",length:"",width:"",height:"",dimensionUnit:"METERS"}),[k,j]=l.useState(""),[y,g]=l.useState(""),[i,m]=l.useState(""),[a,x]=l.useState(null),d=f=>f?f.startsWith("http")||f.startsWith("/")?f:`/uploads/${f}`:"";l.useEffect(()=>{s&&c()},[s]);const c=async()=>{try{const D=(await We.listProfiles()||[]).filter(L=>L.isActive!==!1).map(L=>({id:L.id,name:L.name,description:L.description,logo:L.logo,contractStatus:L.contractStatus,contactPerson:L.contactPerson,contactPhone:L.contactPhone,color:"#5B21B6",icon:"????"}));T(D)}catch(f){console.error("Failed to load categories:",f)}};l.useEffect(()=>{s&&o&&(h({code:o.code||"",location:o.location||"",rackType:o.rackType||"STORAGE",categoryId:o.companyProfileId||o.categoryId||"",companyProfileId:o.companyProfileId||"",capacityTotal:o.capacityTotal||100,status:o.status||"ACTIVE",length:o.length||"",width:o.width||"",height:o.height||"",dimensionUnit:o.dimensionUnit||"METERS"}),o.companyProfile?x({id:o.companyProfile.id,name:o.companyProfile.name,logo:o.companyProfile.logo,description:o.companyProfile.description,contractStatus:o.companyProfile.contractStatus,contactPerson:o.companyProfile.contactPerson,contactPhone:o.companyProfile.contactPhone,color:"#5B21B6",icon:"????"}):o.category&&x(o.category),o.code&&u(o.code),g(""),m(""))},[s,o]);const R=f=>{const{name:D,value:L}=f.target;if(h(q=>{const E={...q,[D]:D==="capacityTotal"?Number(L):L};return D==="categoryId"&&(E.companyProfileId=L),E}),D==="categoryId"){const q=r.find(E=>E.id===L);x(q||null)}},u=async f=>{try{const D=`RACK:${f}`,L=await Cs.toDataURL(D,{width:200,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});j(L)}catch(D){console.error("QR generation error:",D)}},C=f=>{const D=f.target.value.toUpperCase();h(L=>({...L,code:D})),D.length>0?u(D):j("")},A=()=>{if(!k)return;const f=document.createElement("a");f.href=k,f.download=`rack-${v.code}-qr.png`,document.body.appendChild(f),f.click(),document.body.removeChild(f)},w=async f=>{f.preventDefault(),N(!0),g(""),m("");try{if(!v.code||!v.location)throw new Error("Rack code and location are required");if(v.capacityTotal<=0)throw new Error("Capacity must be greater than 0");if(v.capacityTotal<o.capacityUsed)throw new Error(`Cannot reduce capacity below current usage (${o.capacityUsed})`);const{categoryId:D,companyProfileId:L,length:q,width:E,height:P,...J}=v,F={...J,length:q?parseFloat(q):void 0,width:E?parseFloat(E):void 0,height:P?parseFloat(P):void 0,categoryId:void 0,companyProfileId:v.companyProfileId||v.categoryId||void 0};await Re.update(o.id,F),m("Rack updated successfully! ???"),setTimeout(()=>{t(),b()},1500)}catch(D){g(D.message||"Failed to update rack")}finally{N(!1)}};if(!s||!o)return null;const p=Math.round(o.capacityUsed/o.capacityTotal*100);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-purple-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"?????? Edit Rack"}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 text-2xl font-bold",disabled:n,children:"??"})]}),e.jsxs("form",{onSubmit:w,className:"p-6 space-y-6",children:[y&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:y}),i&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:i}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Current Usage"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-blue-700",children:[o.capacityUsed," / ",o.capacityTotal," items (",p,"%)"]}),e.jsx("div",{className:"w-32 bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-blue-600",style:{width:`${p}%`}})})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Rack Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"code",value:v.code,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent uppercase",placeholder:"A1, B2, C3...",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use format like A1, A2, B1, etc."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Location ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"location",value:v.location,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Zone A, Floor 1, Section North...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Rack Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"rackType",value:v.rackType,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"STORAGE",children:"Storage"}),e.jsx("option",{value:"MATERIALS",children:"Materials"}),e.jsx("option",{value:"EQUIPMENT",children:"Equipment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category / Company"}),e.jsxs("select",{name:"categoryId",value:v.categoryId,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Category / Company..."}),r.map(f=>e.jsxs("option",{value:f.id,children:["???? ",f.name]},f.id))]}),a&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.logo&&e.jsx("img",{src:d(a.logo),alt:`${a.name} logo`,className:"h-10 w-10 rounded-md object-contain bg-white border border-blue-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:a.name}),a.contractStatus&&e.jsx("p",{className:"text-blue-600 text-xs uppercase font-semibold",children:a.contractStatus})]})]}),a.description&&e.jsx("p",{className:"text-blue-700 text-xs mt-1",children:a.description}),(a.contactPerson||a.contactPhone)&&e.jsxs("p",{className:"text-blue-700 text-xs mt-1",children:[a.contactPerson&&`Contact: ${a.contactPerson}`,a.contactPerson&&a.contactPhone&&" ?? ",a.contactPhone&&`Phone: ${a.contactPhone}`]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select which company/category this rack belongs to"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Total Capacity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",name:"capacityTotal",value:v.capacityTotal,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"100",min:o.capacityUsed,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Min: ",o.capacityUsed," (current usage)"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"status",value:v.status,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"}),e.jsx("option",{value:"RESERVED",children:"Reserved"})]})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"???? Dimensions (Size Information)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Length"}),e.jsx("input",{type:"number",name:"length",value:v.length,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.0",step:"0.01",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Width"}),e.jsx("input",{type:"number",name:"width",value:v.width,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.0",step:"0.01",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Height"}),e.jsx("input",{type:"number",name:"height",value:v.height,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0.0",step:"0.01",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Unit"}),e.jsxs("select",{name:"dimensionUnit",value:v.dimensionUnit,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[e.jsx("option",{value:"METERS",children:"Meters"}),e.jsx("option",{value:"FEET",children:"Feet"})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"???? Optional: Enter rack physical dimensions for detailed tracking"})]}),k&&e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"QR Code"}),e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx("img",{src:k,alt:"QR Code",className:"border-2 border-gray-300 rounded p-2"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Scan this code to identify rack: ",e.jsx("span",{className:"font-bold",children:v.code})]}),e.jsx("button",{type:"button",onClick:A,className:"px-4 py-2 bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 font-medium text-sm",children:"???? Download QR Code"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium",disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:n,children:n?"Updating...":"Update Rack"})]})]})]})})}const La=({shipment:s,boxCount:b,photos:t})=>{var N;const[o,n]=l.useState(!1);return e.jsxs("div",{className:"bg-gradient-to-r from-white to-blue-50 border-2 border-blue-200 rounded-lg p-4 hover:border-blue-400 hover:shadow-md transition-all",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:["#",(s==null?void 0:s.referenceId)||"N/A"]}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${(s==null?void 0:s.status)==="IN_WAREHOUSE"||(s==null?void 0:s.status)==="PARTIAL"?"bg-green-100 text-green-800":(s==null?void 0:s.status)==="RELEASED"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:(s==null?void 0:s.status)||"N/A"})]}),e.jsxs("p",{className:"text-xs text-gray-700 font-semibold",children:["📦 ",((N=s==null?void 0:s.companyProfile)==null?void 0:N.name)||(s==null?void 0:s.clientName)||"Unknown Company"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Boxes: ",e.jsx("span",{className:"font-semibold text-gray-700",children:b})]})]})}),t.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsxs("button",{onClick:()=>n(!o),className:"w-full flex items-center justify-between text-xs font-semibold text-blue-600 hover:text-blue-800 transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["📷 Photos (",t.length,")"]}),e.jsx("span",{className:"text-lg",children:o?"▲":"▼"})]}),o&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:t.map((r,T)=>e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"group relative block aspect-square rounded-lg overflow-hidden border-2 border-blue-200 hover:border-blue-500 transition-all",children:[e.jsx("img",{src:r,alt:`Photo ${T+1}`,className:"w-full h-full object-cover group-hover:scale-110 transition-transform"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xl opacity-0 group-hover:opacity-100",children:"🔍"})})]},T))})]})]})},Ma=()=>{var J;const[s,b]=l.useState("all"),[t,o]=l.useState("all"),[n,N]=l.useState([]),[r,T]=l.useState(!0),[v,h]=l.useState(!1),[k,j]=l.useState(!1),[y,g]=l.useState(null),[i,m]=l.useState(!1),[a,x]=l.useState(null),[d,c]=l.useState(null),[R,u]=l.useState(!1),[C,A]=l.useState(!1),w=l.useRef({}),p=F=>F?F.startsWith("http")||F.startsWith("/")?F:`/uploads/${F}`:"";l.useEffect(()=>{f()},[]);const f=async()=>{try{T(!0);const F=await Re.getAll();N(F.racks||[])}catch(F){console.error("Load racks error:",F)}finally{T(!1)}},D=n.filter(F=>{var de,be,he,ve,Ne,ae;const z=s==="all"||F.code.startsWith(s),K=t==null?void 0:t.toLowerCase(),V=(be=(de=F.category)==null?void 0:de.name)==null?void 0:be.toLowerCase(),S=typeof F.category=="string"?F.category.toLowerCase():void 0,O=(ve=(he=F.companyProfile)==null?void 0:he.name)==null?void 0:ve.toLowerCase(),M=(ae=(Ne=F.companyProfile)==null?void 0:Ne.id)==null?void 0:ae.toLowerCase();return z&&(t==="all"||K===V||K===S||K===O||K===M)}),L=F=>F>=90?"bg-red-500":F>=75?"bg-yellow-500":"bg-green-500",q=async F=>{var z,K,V,S,O;m(!0),u(!0);try{const M=await Re.getById(F.id);console.log("✅ Rack details loaded:",M.rack),console.log("   - companyProfile:",(z=M.rack)==null?void 0:z.companyProfile),console.log("   - companyProfile.name:",(V=(K=M.rack)==null?void 0:K.companyProfile)==null?void 0:V.name),console.log("   - companyProfile.logo:",(O=(S=M.rack)==null?void 0:S.companyProfile)==null?void 0:O.logo),x(M.rack)}catch(M){console.error("❌ Failed to load rack details:",M),console.log("⚠️ Falling back to basic rack data:",F),x(F)}finally{u(!1)}},E=async()=>{A(!0),setTimeout(async()=>{for(const F of n){const z=w.current[F.id];if(z)try{await Cs.toCanvas(z,`RACK_${F.code}`,{width:200,margin:1})}catch(K){console.error(`Failed to generate QR for ${F.code}:`,K)}}},100)},P=()=>{const F=window.open("","_blank");if(!F)return;const z=n.map(K=>{const V=w.current[K.id];if(!V)return"";const S=V.toDataURL();return`
        <div class="qr-item">
          <h3>${K.code}</h3>
          <p class="location">${K.location||"Warehouse"}</p>
          <img src="${S}" alt="QR Code" />
          <p class="code">RACK_${K.code}</p>
        </div>
      `}).join("");F.document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <title>All Rack QR Codes</title>
          <style>
            body {
              margin: 0;
              padding: 20px;
              font-family: Arial, sans-serif;
            }
            .grid {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              gap: 20px;
            }
            .qr-item {
              text-align: center;
              border: 2px solid #000;
              padding: 15px;
              page-break-inside: avoid;
            }
            h3 {
              margin: 0 0 5px 0;
              font-size: 24px;
            }
            .location {
              margin: 5px 0;
              font-size: 14px;
              color: #666;
            }
            img {
              width: 100%;
              max-width: 200px;
              margin: 10px 0;
            }
            .code {
              font-size: 16px;
              font-weight: bold;
              font-family: 'Courier New', monospace;
              margin: 5px 0 0 0;
            }
            @media print {
              body { padding: 10px; }
              .grid { gap: 15px; }
            }
          </style>
        </head>
        <body>
          <h1 style="text-align: center; margin-bottom: 20px;">Warehouse Rack QR Codes</h1>
          <div class="grid">
            ${z}
          </div>
          <script>
            window.onload = function() {
              setTimeout(function() {
                window.print();
              }, 500);
            };
          <\/script>
        </body>
      </html>
    `),F.document.close()};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Warehouse Racks"}),e.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-green-500 to-blue-500 text-white text-xs font-bold rounded-full animate-pulse",children:"✨ UPDATED"})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Monitor and manage warehouse storage racks - Now with enhanced UI!"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:E,className:"inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(hs,{className:"h-5 w-5 mr-2"}),"Bulk QR Codes"]}),e.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2"}),"Add Rack"]})]})]}),r?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Racks"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:n.length})]}),e.jsx(Ie,{className:"h-10 w-10 text-primary-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Capacity"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:n.reduce((F,z)=>F+z.capacityTotal,0)})]}),e.jsx(rs,{className:"h-10 w-10 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Occupied"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:n.reduce((F,z)=>F+z.capacityUsed,0)})]}),e.jsxs("div",{className:"text-green-600 text-sm font-medium",children:[n.length>0?Math.round(n.reduce((F,z)=>F+z.capacityUsed,0)/n.reduce((F,z)=>F+z.capacityTotal,0)*100):0,"%"]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Available"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:n.reduce((F,z)=>F+(z.capacityTotal-z.capacityUsed),0)})]}),e.jsxs("div",{className:"text-blue-600 text-sm font-medium",children:[n.length>0?Math.round(n.reduce((F,z)=>F+(z.capacityTotal-z.capacityUsed),0)/n.reduce((F,z)=>F+z.capacityTotal,0)*100):0,"%"]})]})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(ps,{className:"h-4 w-4"})," SECTION"]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${s==="all"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Sections"}),["A","B","C"].map(F=>e.jsxs("button",{onClick:()=>b(F),className:`px-4 py-2 rounded-lg font-medium transition-colors ${s===F?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Section ",F]},F))]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(Es,{className:"h-4 w-4"})," CATEGORY"]}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>o("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${t==="all"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Categories"}),e.jsx("button",{onClick:()=>o("DIOR"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${t==="DIOR"?"bg-purple-600 text-white":"bg-purple-50 text-purple-700 hover:bg-purple-100"}`,children:"Dior"}),e.jsx("button",{onClick:()=>o("COMPANY_MATERIAL"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${t==="COMPANY_MATERIAL"?"bg-blue-600 text-white":"bg-blue-50 text-blue-700 hover:bg-blue-100"}`,children:"Company Material"}),e.jsx("button",{onClick:()=>o("JAZEERA"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${t==="JAZEERA"?"bg-green-600 text-white":"bg-green-50 text-green-700 hover:bg-green-100"}`,children:"Jazeera"}),e.jsx("button",{onClick:()=>o("OTHERS"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${t==="OTHERS"?"bg-gray-600 text-white":"bg-gray-50 text-gray-700 hover:bg-gray-100"}`,children:"Others"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5"})," Warehouse Layout"]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-gray-600",children:"0-50%"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{className:"text-gray-600",children:"50-90%"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{className:"text-gray-600",children:"90-100%"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:D.map(F=>{const z=F.capacityTotal&&F.capacityTotal>0?F.capacityTotal:1,K=typeof F.utilization=="number"?F.utilization:Math.round(F.capacityUsed/z*100),V=new Set;F.boxes&&Array.isArray(F.boxes)&&F.boxes.forEach(M=>{M.shipmentId&&V.add(M.shipmentId)});const S=V.size,O=Math.max(z-F.capacityUsed,0);return e.jsxs("div",{onClick:()=>q(F),className:"group relative bg-gradient-to-br from-white to-gray-50 border rounded-xl p-3 hover:shadow-lg hover:scale-[1.02] transition-all duration-200 cursor-pointer",style:{borderColor:K>=90?"#ef4444":K>=50?"#eab308":"#10b981"},children:[e.jsx("div",{className:"absolute -top-2 -right-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold shadow ${F.status==="ACTIVE"?K>=100?"bg-red-500 text-white":K>=90?"bg-yellow-500 text-white":"bg-green-500 text-white":"bg-gray-400 text-white"}`,children:F.status==="ACTIVE"?K>=100?"FULL":K>=90?"BUSY":"OK":"OFF"})}),e.jsx("button",{onClick:M=>{M.stopPropagation(),g(F),j(!0)},className:"absolute top-2 left-2 p-1.5 bg-white rounded-lg shadow opacity-0 group-hover:opacity-100 transition-opacity hover:bg-blue-50",title:"Edit Rack",children:e.jsx(Ge,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{className:"mb-4 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(Ae,{className:"h-6 w-6 text-primary-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-2xl font-bold text-gray-900 leading-tight",children:F.code})})]}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:F.location||"N/A"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Capacity (pallets)"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[F.capacityUsed,"/",F.capacityTotal]})]}),e.jsxs("div",{className:"relative w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:[e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${L(K)}`,style:{width:`${Math.min(K,100)}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-bold text-white drop-shadow-md",children:[K,"%"]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t-2 border-gray-200",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Available"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:O})]}),e.jsx("div",{className:"h-10 w-px bg-gray-300"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Shipments"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:S})]})]})]})]},F.id)})}),D.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No racks found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try selecting a different section"})]})]}),e.jsx(Ia,{isOpen:v,onClose:()=>h(!1),onSuccess:f}),e.jsx(Fa,{isOpen:k,onClose:()=>j(!1),rack:y,onSuccess:f}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary-600 to-blue-600 text-white px-6 py-5 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(Ae,{className:"h-8 w-8"}),"Rack ",(a==null?void 0:a.code)||"..."]}),e.jsxs("p",{className:"text-sm text-blue-100 mt-1 flex items-center gap-1",children:[e.jsx(ps,{className:"h-4 w-4"})," ",(a==null?void 0:a.location)||"Loading..."]})]}),e.jsx("button",{onClick:()=>m(!1),className:"text-white hover:text-gray-200 p-2 rounded-lg hover:bg-white/10 transition",children:e.jsx(Te,{className:"h-7 w-7"})})]}),R?e.jsx("div",{className:"flex-1 flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Loading rack details..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Status"}),e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-bold ${(a==null?void 0:a.status)==="ACTIVE"?a.capacityUsed>=a.capacityTotal?"bg-red-100 text-red-800":"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:(a==null?void 0:a.status)==="ACTIVE"?a.capacityUsed>=a.capacityTotal?e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"h-4 w-4"})," FULL"]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-4 w-4"})," ACTIVE"]}):"INACTIVE"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Pallet Capacity"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[a==null?void 0:a.capacityUsed,"/",a==null?void 0:a.capacityTotal]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Available Pallets"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Math.max(((a==null?void 0:a.capacityTotal)||0)-((a==null?void 0:a.capacityUsed)||0),0)})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-500 font-medium mb-1",children:"Utilization"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[a&&a.capacityTotal>0?Math.round(a.capacityUsed/a.capacityTotal*100):0,"%"]})]})]})}),e.jsx("div",{className:"px-6 pt-4 pb-2 bg-white border-b",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[(a==null?void 0:a.companyProfile)&&a.companyProfile.name&&e.jsxs("div",{className:"flex items-center gap-3 bg-purple-50 border border-purple-200 rounded-lg p-4",children:[a.companyProfile.logo&&e.jsx("img",{src:p(a.companyProfile.logo),alt:`${a.companyProfile.name} logo`,className:"h-16 w-16 rounded-lg object-contain bg-white border border-purple-200",onError:F=>{console.warn("Logo failed to load:",a.companyProfile.logo),F.target.style.display="none"}}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs text-purple-600 font-semibold uppercase mb-1",children:"Company / Profile"}),e.jsx("p",{className:"text-lg font-bold text-purple-900 truncate cursor-pointer underline-offset-2 hover:underline",title:"Filter boxes by this company",onClick:()=>c(F=>F===a.companyProfile.name?null:a.companyProfile.name),children:a.companyProfile.name}),a.companyProfile.contractStatus&&e.jsx("p",{className:"text-xs font-semibold text-purple-700 uppercase",children:a.companyProfile.contractStatus}),(a.companyProfile.contactPerson||a.companyProfile.contactPhone)&&e.jsxs("p",{className:"text-xs text-purple-700 mt-1",children:[a.companyProfile.contactPerson&&`Contact: ${a.companyProfile.contactPerson}`,a.companyProfile.contactPerson&&a.companyProfile.contactPhone&&" ?? ",a.companyProfile.contactPhone&&`Phone: ${a.companyProfile.contactPhone}`]}),a.companyProfile.description&&e.jsx("p",{className:"text-xs text-purple-700 mt-2 line-clamp-3",children:a.companyProfile.description})]})]}),(a==null?void 0:a.category)&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500 font-medium mb-2 flex items-center gap-1",children:[e.jsx(Es,{className:"h-4 w-4"})," Category"]}),e.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold ${a.category==="DIOR"?"bg-purple-100 text-purple-800 border border-purple-300":a.category==="COMPANY_MATERIAL"?"bg-blue-100 text-blue-800 border border-blue-300":a.category==="JAZEERA"?"bg-green-100 text-green-800 border border-green-300":"bg-gray-100 text-gray-800 border border-gray-300"}`,children:[a.category==="DIOR"&&"Dior",a.category==="COMPANY_MATERIAL"&&"Company Material",a.category==="JAZEERA"&&"Jazeera",a.category==="OTHERS"&&"Others"]})]}),((a==null?void 0:a.length)||(a==null?void 0:a.width)||(a==null?void 0:a.height))&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500 font-medium mb-2 flex items-center gap-1",children:[e.jsx(At,{className:"h-4 w-4"})," Dimensions"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm font-mono bg-gray-50 px-4 py-2 rounded-lg border border-gray-200",children:[a.length&&e.jsxs("span",{className:"font-bold text-gray-900",children:["L: ",a.length]}),a.width&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"??"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["W: ",a.width]})]}),a.height&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"??"}),e.jsxs("span",{className:"font-bold text-gray-900",children:["H: ",a.height]})]}),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:a.dimensionUnit==="FEET"?"ft":"m"})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5"})," Stored Shipments (",((J=a==null?void 0:a.boxes)==null?void 0:J.length)||0,")"]}),a!=null&&a.boxes&&a.boxes.length>0?e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:(()=>{const F=new Map;return a.boxes.filter(V=>{var O,M,H;return d?(((M=(O=V.shipment)==null?void 0:O.companyProfile)==null?void 0:M.name)||((H=V.shipment)==null?void 0:H.clientName)||"")===d:!0}).forEach(V=>{let S=0;try{const O=V.pieceQR?JSON.parse(V.pieceQR):void 0;S=Number((O==null?void 0:O.palletNumber)||0)}catch{const O=/-PAL-(\d+)/.exec(V.qrCode||"");S=O?parseInt(O[1],10):0}F.has(S)||F.set(S,[]),F.get(S).push(V)}),Array.from(F.entries()).sort((V,S)=>V[0]===0?1:S[0]===0?-1:V[0]-S[0]).map(([V,S])=>e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center justify-between mb-2 ${V===0?"text-purple-800":"text-amber-800"}`,children:[e.jsxs("h4",{className:"text-sm font-bold ",children:[V===0?"Loose":`Pallet #${V}`," (",S.length," pcs)"]}),e.jsx("div",{className:`text-[10px] px-2 py-0.5 rounded-full border ${V===0?"border-dashed border-purple-400 text-purple-600":"border-amber-400 text-amber-600"}`,children:V===0?"LOOSE":"PALLET"})]}),e.jsx("div",{className:"space-y-3",children:(()=>{const O=new Map;return S.forEach(M=>{var de;const H=((de=M.shipment)==null?void 0:de.id)||"unknown";O.has(H)||O.set(H,[]),O.get(H).push(M)}),Array.from(O.values()).map((M,H)=>{const be=M[0].shipment,he=[];return M.forEach(ve=>{if(ve.photos)try{const Ne=JSON.parse(ve.photos);Array.isArray(Ne)&&he.push(...Ne)}catch(Ne){console.warn("Failed to parse box photos",Ne)}}),e.jsx(La,{shipment:be,boxCount:M.length,photos:he},`shipment-${H}`)})})()})]},`grp-${V}`))})()}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-4xl mb-3",children:"????"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No shipments stored"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"This rack is empty"})]})]})}),d&&e.jsx("div",{className:"px-6 pb-4 -mt-2",children:e.jsx("button",{onClick:()=>c(null),className:"text-xs px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-full text-gray-700",children:"Clear company filter"})}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx(Ds,{className:"h-5 w-5 inline mr-1"}),"Click on any shipment for more details"]}),e.jsx("button",{onClick:()=>m(!1),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 font-medium",children:"Close"})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-6 py-5 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(hs,{className:"h-8 w-8"}),"Bulk QR Codes - All Racks"]}),e.jsxs("p",{className:"text-sm text-purple-100 mt-1",children:[n.length," racks total"]})]}),e.jsx("button",{onClick:()=>A(!1),className:"text-white hover:text-gray-200 p-2 rounded-lg hover:bg-white/10 transition",children:e.jsx(Te,{className:"h-7 w-7"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:n.map(F=>e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-xl p-4 text-center hover:border-purple-400 hover:shadow-lg transition-all",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:F.code}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:F.location||"Warehouse"}),e.jsx("canvas",{ref:z=>{z&&(w.current[F.id]=z)},className:"mx-auto mb-3"}),e.jsxs("p",{className:"text-xs font-mono font-bold text-gray-600",children:["RACK_",F.code]})]},F.id))})}),e.jsxs("div",{className:"p-6 border-t bg-gray-50 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx(Ds,{className:"h-5 w-5 inline mr-1"}),"Print all QR codes at once"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>A(!1),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 font-medium",children:"Close"}),e.jsxs("button",{onClick:P,className:"inline-flex items-center gap-2 px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold shadow-lg",children:[e.jsx(Be,{className:"h-5 w-5"}),"Print All QR Codes"]})]})]})]})})]})};function $a({isOpen:s,onClose:b,onSuccess:t}){const[o,n]=l.useState(!1),[N,r]=l.useState({title:"",jobType:"LOCAL",clientName:"",clientPhone:"",fromAddress:"",toAddress:"",scheduledDate:"",status:"SCHEDULED"}),[T,v]=l.useState([]),[h,k]=l.useState({}),[j,y]=l.useState([]),[g,i]=l.useState([]),[m,a]=l.useState(""),[x,d]=l.useState("");l.useEffect(()=>{if(s){const A=new Date().toISOString().split("T")[0];r({title:"",jobType:"LOCAL",clientName:"",clientPhone:"",fromAddress:"",toAddress:"",scheduledDate:A,status:"SCHEDULED"}),a(""),d(""),i([]),R(),c(),k({})}},[s]);const c=async()=>{try{const A=await fetch("/api/materials",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(A.ok){const w=await A.json();y(w.filter(p=>p.totalQuantity>0))}}catch(A){console.error("Failed to load materials:",A)}},R=async()=>{try{const A=await fetch("/api/custom-fields?section=JOB",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(A.ok){const w=await A.json(),p=w.customFields||w,f=Array.isArray(p)?p.filter(L=>L.isActive):[];v(f);const D={};f.forEach(L=>{D[L.id]=""}),k(D)}}catch(A){console.error("Failed to load custom fields:",A)}},u=A=>{const{name:w,value:p}=A.target;r(f=>({...f,[w]:p}))},C=async A=>{A.preventDefault(),n(!0),a(""),d("");try{if(!N.title||!N.clientName||!N.clientPhone)throw new Error("Title, client name, and phone are required");if(!N.fromAddress)throw new Error("From address is required");if(!N.scheduledDate)throw new Error("Scheduled date is required");if(N.jobType==="INTERNATIONAL"&&!N.toAddress)throw new Error("To address is required for international moves");const w={jobCode:`JOB-${Date.now()}`,jobTitle:N.title,clientName:N.clientName,clientPhone:N.clientPhone,clientEmail:"",jobDate:new Date(N.scheduledDate).toISOString(),jobAddress:N.fromAddress,dropoffAddress:N.toAddress||null,teamLeaderId:null,driverName:null,vehicleNumber:null,notes:null,status:N.status},f=(await as.create(w)).id;if(g.length>0){const D=g.filter(L=>L.materialId&&L.quantity>0);for(const L of D)try{await fetch("/api/materials/issue",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({jobId:f,materialId:L.materialId,quantity:L.quantity})})}catch(q){console.error("Failed to issue material:",q)}}if(T.length>0){const D=Object.entries(h).filter(([L,q])=>q!=="").map(([L,q])=>({customFieldId:L,fieldValue:q}));if(D.length>0)try{await fetch(`/api/custom-field-values/JOB/${f}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({values:D})})}catch(L){console.error("Failed to save custom field values:",L)}}d("Moving job created successfully! ✅"),setTimeout(()=>{t(),b()},1500)}catch(w){a(w.message||"Failed to create moving job")}finally{n(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-green-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"🚛 Create New Moving Job"}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 text-2xl font-bold",disabled:o,children:"×"})]}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-6",children:[m&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:m}),x&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:x}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Job Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Job Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"title",value:N.title,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"e.g., Office Relocation - ABC Company",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Job Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"jobType",value:N.jobType,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"LOCAL",children:"Local Move"}),e.jsx("option",{value:"INTERNATIONAL",children:"International Move"}),e.jsx("option",{value:"PACKING_ONLY",children:"Packing Only"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:N.status,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"SCHEDULED",children:"Scheduled"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"COMPLETED",children:"Completed"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Scheduled Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"scheduledDate",value:N.scheduledDate,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"clientName",value:N.clientName,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"clientPhone",value:N.clientPhone,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"+965 1234 5678",required:!0})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Location Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["From Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"fromAddress",value:N.fromAddress,onChange:u,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Full pickup address...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["To Address ",N.jobType==="INTERNATIONAL"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"toAddress",value:N.toAddress,onChange:u,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Full delivery address...",required:N.jobType==="INTERNATIONAL"}),N.jobType==="PACKING_ONLY"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for packing-only jobs"})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"📦 Materials (Optional)"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Select materials needed for this job. Stock will be deducted automatically."}),e.jsxs("div",{className:"space-y-3",children:[g.map((A,w)=>{const p=j.find(f=>f.id===A.materialId);return e.jsxs("div",{className:"flex gap-3 items-center bg-gray-50 p-3 rounded",children:[e.jsxs("select",{value:A.materialId,onChange:f=>{const D=[...g];D[w].materialId=f.target.value,i(D)},className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"",children:"-- Select Material --"}),j.map(f=>e.jsxs("option",{value:f.id,children:[f.sku," - ",f.name," (Stock: ",f.totalQuantity," ",f.unit,")"]},f.id))]}),e.jsx("input",{type:"number",min:"1",max:(p==null?void 0:p.totalQuantity)||999,value:A.quantity,onChange:f=>{const D=[...g];D[w].quantity=parseInt(f.target.value)||0,i(D)},className:"w-24 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Qty"}),e.jsx("button",{type:"button",onClick:()=>{i(g.filter((f,D)=>D!==w))},className:"text-red-600 hover:text-red-800",children:"✕"})]},w)}),e.jsx("button",{type:"button",onClick:()=>{i([...g,{materialId:"",quantity:1}])},className:"text-green-600 hover:text-green-800 text-sm font-medium",children:"+ Add Material"})]})]}),T.length>0&&e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"✨ Custom Fields"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:T.map(A=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[A.fieldName,A.isRequired&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),A.fieldType==="TEXT"&&e.jsx("input",{type:"text",value:h[A.id]||"",onChange:w=>k(p=>({...p,[A.id]:w.target.value})),required:A.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:`Enter ${A.fieldName.toLowerCase()}`}),A.fieldType==="NUMBER"&&e.jsx("input",{type:"number",value:h[A.id]||"",onChange:w=>k(p=>({...p,[A.id]:w.target.value})),required:A.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:`Enter ${A.fieldName.toLowerCase()}`}),A.fieldType==="DATE"&&e.jsx("input",{type:"date",value:h[A.id]||"",onChange:w=>k(p=>({...p,[A.id]:w.target.value})),required:A.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"}),A.fieldType==="DROPDOWN"&&A.fieldOptions&&e.jsxs("select",{value:h[A.id]||"",onChange:w=>k(p=>({...p,[A.id]:w.target.value})),required:A.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Select --"}),(()=>{try{const w=JSON.parse(A.fieldOptions);return Array.isArray(w)?w.map(p=>e.jsx("option",{value:p,children:p},p)):[]}catch{return typeof A.fieldOptions=="string"?A.fieldOptions.split(",").map(w=>e.jsx("option",{value:w.trim(),children:w.trim()},w.trim())):[]}})()]}),A.fieldType==="CHECKBOX"&&e.jsxs("div",{className:"flex items-center h-10",children:[e.jsx("input",{type:"checkbox",checked:h[A.id]==="true",onChange:w=>k(p=>({...p,[A.id]:w.target.checked?"true":"false"})),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-2 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Yes"})]})]},A.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:o,children:o?"Creating...":"Create Job"})]})]})]})}):null}function ft({isOpen:s,onClose:b,jobId:t,onSuccess:o}){const[n,N]=l.useState([]),[r,T]=l.useState(new Map),[v,h]=l.useState(!1);l.useEffect(()=>{s&&t&&k()},[s,t]);const k=async()=>{try{const m=await fetch(`/api/materials/job-materials/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(m.ok){const x=(await m.json()).filter(c=>!c.returns||c.returns.length===0);N(x);const d=new Map;x.forEach(c=>{d.set(c.id,{issueId:c.id,quantityUsed:0,quantityGood:0,quantityDamaged:0,damageReason:"",notes:"",photos:[]})}),T(d)}}catch(m){console.error("Failed to load issued materials:",m)}},j=(m,a,x)=>{const d=new Map(r),c=d.get(m);c&&(d.set(m,{...c,[a]:x}),T(d))},y=(m,a)=>{if(a){const x=r.get(m);if(x){const d=[...x.photos,...Array.from(a)];j(m,"photos",d)}}},g=(m,a)=>{const x=r.get(m);if(x){const d=x.photos.filter((c,R)=>R!==a);j(m,"photos",d)}},i=async m=>{m.preventDefault(),h(!0);try{for(const[a,x]of r.entries()){const d=n.find(A=>A.id===a);if(!d)continue;console.log("Return Data:",{materialName:d.material.name,issued:d.quantity,quantityGood:x.quantityGood,quantityGoodType:typeof x.quantityGood,quantityDamaged:x.quantityDamaged,quantityDamagedType:typeof x.quantityDamaged});const c=Number(x.quantityGood)+Number(x.quantityDamaged);if(c>d.quantity){alert(`${d.material.name}: Total returned (${c}) cannot exceed issued quantity (${d.quantity})`),h(!1);return}const R=d.quantity-c;if(x.quantityDamaged>0&&!x.damageReason.trim()){alert(`${d.material.name}: Damage reason required for damaged items`),h(!1);return}if(x.quantityDamaged>0&&x.photos.length===0){alert(`${d.material.name}: Photo proof required for damaged items`),h(!1);return}const u=new FormData;u.append("jobId",t),u.append("issueId",a),u.append("quantityUsed",String(R)),u.append("quantityGood",String(Number(x.quantityGood))),u.append("quantityDamaged",String(Number(x.quantityDamaged))),u.append("damageReason",x.damageReason),u.append("notes",x.notes),x.photos.forEach(A=>{u.append("photos",A)});const C=await fetch("/api/materials/return",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:u});if(!C.ok){const A=await C.json();throw new Error(A.error||"Failed to record return")}}await o(),alert("✅ Material returns recorded successfully! Stock updated."),b()}catch(a){alert(`❌ Error: ${a.message}`)}finally{h(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"📦 Return Materials"}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-700",children:e.jsx(Se,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:i,className:"p-6",children:[n.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No materials to return"}):e.jsx("div",{className:"space-y-6",children:n.map(m=>{const a=r.get(m.id);return a?e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:m.material.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[m.material.sku," • Issued: ",e.jsxs("span",{className:"font-bold text-blue-600",children:[m.quantity," ",m.material.unit]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"✅ Returned (Good Condition) *"}),e.jsx("input",{type:"number",min:"0",max:m.quantity,value:a.quantityGood===0?"":a.quantityGood,onChange:x=>{const d=x.target.value===""?0:Number(x.target.value);j(m.id,"quantityGood",isNaN(d)?0:d)},className:"w-full border rounded px-3 py-2 text-lg font-semibold",placeholder:"Enter quantity"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Good items returned to stock"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"❌ Damaged (Lost)"}),e.jsx("input",{type:"number",min:"0",max:m.quantity,value:a.quantityDamaged===0?"":a.quantityDamaged,onChange:x=>{const d=x.target.value===""?0:Number(x.target.value);j(m.id,"quantityDamaged",isNaN(d)?0:d)},className:"w-full border rounded px-3 py-2 text-lg font-semibold",placeholder:"Enter quantity"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Damaged/broken items"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-4",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["🔧 Used/Consumed: ",e.jsxs("span",{className:"text-lg font-bold",children:[m.quantity-(a.quantityGood+a.quantityDamaged)," ",m.material.unit]})]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Automatically calculated: Issued (",m.quantity,") - Returned (",a.quantityGood,") - Damaged (",a.quantityDamaged,")"]})]}),a.quantityDamaged>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Damage Reason *"}),e.jsx("textarea",{value:a.damageReason,onChange:x=>j(m.id,"damageReason",x.target.value),className:"w-full border rounded px-3 py-2",rows:2,placeholder:"Explain what happened...",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:[e.jsx(fs,{className:"w-4 h-4 inline mr-1"}),"Damage Photos * (Required)"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:x=>y(m.id,x.target.files),className:"w-full border rounded px-3 py-2"}),a.photos.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a.photos.map((x,d)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(x),alt:`Damage ${d+1}`,className:"w-20 h-20 object-cover rounded"}),e.jsx("button",{type:"button",onClick:()=>g(m.id,d),className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full p-1",children:e.jsx(js,{className:"w-3 h-3"})})]},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx("textarea",{value:a.notes,onChange:x=>j(m.id,"notes",x.target.value),className:"w-full border rounded px-3 py-2",rows:2,placeholder:"Any additional notes..."})]})]},m.id):null})}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 border rounded hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v||n.length===0,className:"px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-400",children:v?"Saving...":"Record Returns"})]})]})]})}):null}function Ba({isOpen:s,onClose:b,onSuccess:t,job:o}){const[n,N]=l.useState(!1),[r,T]=l.useState({title:"",jobType:"LOCAL",clientName:"",clientPhone:"",fromAddress:"",toAddress:"",scheduledDate:"",status:"SCHEDULED"}),[v,h]=l.useState([]),[k,j]=l.useState({}),[y,g]=l.useState(!1),[i,m]=l.useState(""),[a,x]=l.useState("");l.useEffect(()=>{if(s&&o){const u=o.jobDate||o.scheduledDate?new Date(o.jobDate||o.scheduledDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0];T({title:o.jobTitle||o.title||"",jobType:o.jobType||"LOCAL",clientName:o.clientName||"",clientPhone:o.clientPhone||"",fromAddress:o.jobAddress||o.fromAddress||"",toAddress:o.dropoffAddress||o.toAddress||"",scheduledDate:u,status:o.status||"PLANNED"}),m(""),x(""),d()}},[s,o]);const d=async()=>{if(o!=null&&o.id)try{const u=await fetch("/api/custom-fields?section=JOB",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(u.ok){const C=await u.json(),A=C.customFields||C,w=Array.isArray(A)?A.filter(f=>f.isActive):[];h(w);const p=await fetch(`/api/custom-field-values/JOB/${o.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(p.ok){const f=await p.json(),D=f.customFieldValues||f,L={};Array.isArray(D)&&D.forEach(q=>{L[q.customFieldId]=q.fieldValue}),j(L)}}}catch(u){console.error("Failed to load custom fields:",u)}},c=u=>{const{name:C,value:A}=u.target;T(w=>({...w,[C]:A}))},R=async u=>{u.preventDefault(),N(!0),m(""),x("");try{if(!r.title||!r.clientName||!r.clientPhone)throw new Error("Title, client name, and phone are required");if(!r.fromAddress)throw new Error("From address is required");if(!r.scheduledDate)throw new Error("Scheduled date is required");if(r.jobType==="INTERNATIONAL"&&!r.toAddress)throw new Error("To address is required for international moves");const C={jobTitle:r.title,clientName:r.clientName,clientPhone:r.clientPhone,jobDate:new Date(r.scheduledDate).toISOString(),jobAddress:r.fromAddress,dropoffAddress:r.toAddress||null,status:r.status};if(await as.update(o.id,C),v.length>0){const A=Object.entries(k).filter(([w,p])=>p!=="").map(([w,p])=>({customFieldId:w,fieldValue:p}));if(A.length>0)try{await fetch(`/api/custom-field-values/JOB/${o.id}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({values:A})})}catch(w){console.error("Failed to save custom field values:",w)}}x("Moving job updated successfully! ✅"),setTimeout(()=>{t(),b()},1500)}catch(C){m(C.message||"Failed to update moving job")}finally{N(!1)}};return!s||!o?null:e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-green-600 text-white px-6 py-4 rounded-t-lg flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"✏️ Edit Moving Job"}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 text-2xl font-bold",disabled:n,children:"×"})]}),e.jsxs("form",{onSubmit:R,className:"p-6 space-y-6",children:[i&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:i}),a&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded",children:a}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Job Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Job Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"title",value:r.title,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"e.g., Office Relocation - ABC Company",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Job Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"jobType",value:r.jobType,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"LOCAL",children:"Local Move"}),e.jsx("option",{value:"INTERNATIONAL",children:"International Move"}),e.jsx("option",{value:"PACKING_ONLY",children:"Packing Only"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Status ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"status",value:r.status,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"PLANNED",children:"Planned"}),e.jsx("option",{value:"SCHEDULED",children:"Scheduled"}),e.jsx("option",{value:"IN_PROGRESS",children:"In Progress"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Use "Complete Job" button to finish job and return materials'})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Scheduled Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",name:"scheduledDate",value:r.scheduledDate,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Client Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"clientName",value:r.clientName,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",name:"clientPhone",value:r.clientPhone,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"+965 1234 5678",required:!0})]})]})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Location Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["From Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"fromAddress",value:r.fromAddress,onChange:c,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Full pickup address...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["To Address ",r.jobType==="INTERNATIONAL"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"toAddress",value:r.toAddress,onChange:c,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Full delivery address...",required:r.jobType==="INTERNATIONAL"}),r.jobType==="PACKING_ONLY"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty for packing-only jobs"})]})]})]}),v.length>0&&e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"✨ Custom Fields"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:v.map(u=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[u.fieldName,u.isRequired&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),u.fieldType==="TEXT"&&e.jsx("input",{type:"text",value:k[u.id]||"",onChange:C=>j(A=>({...A,[u.id]:C.target.value})),required:u.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:`Enter ${u.fieldName.toLowerCase()}`}),u.fieldType==="NUMBER"&&e.jsx("input",{type:"number",value:k[u.id]||"",onChange:C=>j(A=>({...A,[u.id]:C.target.value})),required:u.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:`Enter ${u.fieldName.toLowerCase()}`}),u.fieldType==="DATE"&&e.jsx("input",{type:"date",value:k[u.id]||"",onChange:C=>j(A=>({...A,[u.id]:C.target.value})),required:u.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent"}),u.fieldType==="DROPDOWN"&&u.fieldOptions&&e.jsxs("select",{value:k[u.id]||"",onChange:C=>j(A=>({...A,[u.id]:C.target.value})),required:u.isRequired,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Select --"}),(()=>{try{const C=JSON.parse(u.fieldOptions);return Array.isArray(C)?C.map(A=>e.jsx("option",{value:A,children:A},A)):[]}catch{return typeof u.fieldOptions=="string"?u.fieldOptions.split(",").map(C=>e.jsx("option",{value:C.trim(),children:C.trim()},C.trim())):[]}})()]}),u.fieldType==="CHECKBOX"&&e.jsxs("div",{className:"flex items-center h-10",children:[e.jsx("input",{type:"checkbox",checked:k[u.id]==="true",onChange:C=>j(A=>({...A,[u.id]:C.target.checked?"true":"false"})),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-2 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Yes"})]})]},u.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 font-medium",disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:n,children:n?"Updating...":"Update Job"})]})]})]}),e.jsx(ft,{isOpen:y,onClose:()=>{g(!1),t(),b()},jobId:(o==null?void 0:o.id)||"",onSuccess:()=>{g(!1),t(),b()}})]})}const Oa=({jobId:s,jobStatus:b,onUpdate:t})=>{const[o,n]=l.useState("issued"),[N,r]=l.useState([]),[T,v]=l.useState([]),[h,k]=l.useState([]),[j,y]=l.useState(!1),[g,i]=l.useState({materialId:"",quantity:0,rackId:"",notes:""}),[m,a]=l.useState(!1),[x,d]=l.useState(null),[c,R]=l.useState({issueId:"",quantityUsed:0,quantityGood:0,quantityDamaged:0,damageReason:"",notes:"",photos:[]}),[u,C]=l.useState(!1);l.useEffect(()=>{A()},[s]);const A=async()=>{const J={Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"};try{const z=await(await fetch("/api/materials",{headers:J})).json();r(z);const V=await(await fetch("/api/materials/available-racks",{headers:J})).json();v(V);const O=await(await fetch(`/api/materials/job-materials/${s}`,{headers:J})).json();k(O)}catch(F){console.error("Failed to load data:",F)}},w=async P=>{P.preventDefault(),C(!0);const J=localStorage.getItem("authToken");try{const F=await fetch("/api/materials/issue",{method:"POST",headers:{Authorization:`Bearer ${J}`,"Content-Type":"application/json"},body:JSON.stringify({jobId:s,materialId:g.materialId,quantity:g.quantity,rackId:g.rackId||null,notes:g.notes})});if(F.ok)alert("Material issued successfully! Stock updated."),y(!1),i({materialId:"",quantity:0,rackId:"",notes:""}),A(),t==null||t();else{const z=await F.json();alert(`Failed to issue material: ${z.error}`)}}catch(F){console.error("Failed to issue material:",F),alert("Failed to issue material")}finally{C(!1)}},p=async P=>{P.preventDefault(),C(!0);const J=localStorage.getItem("authToken"),F=new FormData;F.append("jobId",s),F.append("issueId",c.issueId),F.append("quantityUsed",c.quantityUsed.toString()),F.append("quantityGood",c.quantityGood.toString()),F.append("quantityDamaged",c.quantityDamaged.toString()),F.append("damageReason",c.damageReason),F.append("notes",c.notes),c.photos.forEach(z=>{F.append("photos",z)});try{const z=await fetch("/api/materials/return",{method:"POST",headers:{Authorization:`Bearer ${J}`},body:F});if(z.ok)alert("Material return recorded! Stock updated."),a(!1),R({issueId:"",quantityUsed:0,quantityGood:0,quantityDamaged:0,damageReason:"",notes:"",photos:[]}),d(null),A(),t==null||t();else{const K=await z.json();alert(`Failed to record return: ${K.error}`)}}catch(z){console.error("Failed to record return:",z),alert("Failed to record material return")}finally{C(!1)}},f=P=>{if(P.target.files){const J=Array.from(P.target.files);R({...c,photos:[...c.photos,...J]})}},D=P=>{const J=c.photos.filter((F,z)=>z!==P);R({...c,photos:J})},L=P=>{d(P),R({issueId:P.id,quantityUsed:0,quantityGood:0,quantityDamaged:0,damageReason:"",notes:"",photos:[]}),a(!0)},q=()=>h.reduce((P,J)=>P+J.totalCost,0),E=()=>h.filter(P=>!P.returns||P.returns.length===0).length;return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Je,{className:"w-6 h-6"}),"Job Materials"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track materials issued and returned for this job"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Cost"}),e.jsxs("p",{className:"text-xl font-bold",children:[q().toFixed(2)," KWD"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pending Returns"}),e.jsx("p",{className:"text-xl font-bold text-orange-600",children:E()})]})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 border-b",children:[e.jsxs("button",{onClick:()=>n("issued"),className:`px-4 py-2 font-medium ${o==="issued"?"border-b-2 border-blue-600 text-blue-600":"text-gray-500"}`,children:["Issued Materials (",h.length,")"]}),e.jsx("button",{onClick:()=>n("return"),className:`px-4 py-2 font-medium ${o==="return"?"border-b-2 border-blue-600 text-blue-600":"text-gray-500"}`,children:"Returns & Damages"})]}),o==="issued"&&e.jsxs("div",{children:[b!=="COMPLETED"&&b!=="CANCELLED"&&e.jsxs("button",{onClick:()=>y(!0),className:"mb-4 flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:[e.jsx(ms,{className:"w-4 h-4"}),"Issue Material"]}),j&&e.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Issue Material to Job"}),e.jsx("button",{onClick:()=>y(!1),children:e.jsx(Se,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w,className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Material *"}),e.jsxs("select",{required:!0,value:g.materialId,onChange:P=>i({...g,materialId:P.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"-- Select Material --"}),N.map(P=>e.jsxs("option",{value:P.id,children:[P.sku," - ",P.name," (Stock: ",P.totalQuantity," ",P.unit,")"]},P.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quantity *"}),e.jsx("input",{type:"number",required:!0,min:"1",value:g.quantity,onChange:P=>i({...g,quantity:P.target.value===""?0:parseInt(P.target.value)||0}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Storage Rack (Optional)"}),e.jsxs("select",{value:g.rackId,onChange:P=>i({...g,rackId:P.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"-- No Specific Rack --"}),T.map(P=>e.jsxs("option",{value:P.id,children:[P.code," - ",P.location]},P.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:g.notes,onChange:P=>i({...g,notes:P.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"Any special notes..."})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("button",{type:"submit",disabled:u,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),u?"Issuing...":"Issue Material"]})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Material"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Unit Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rack"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(P=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:P.material.name}),e.jsx("p",{className:"text-sm text-gray-500",children:P.material.sku})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[P.quantity," ",P.material.unit]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[P.unitCost.toFixed(2)," KWD"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap font-bold",children:[P.totalCost.toFixed(2)," KWD"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:P.rack?`${P.rack.code} - ${P.rack.location}`:"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:P.returns&&P.returns.length>0?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",children:"Returned"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800",children:"Pending Return"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(!P.returns||P.returns.length===0)&&b==="COMPLETED"&&e.jsxs("button",{onClick:()=>L(P),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx(Tt,{className:"w-4 h-4"}),"Record Return"]})})]},P.id))})]})})]}),m&&x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Record Material Return"}),e.jsx("button",{onClick:()=>a(!1),children:e.jsx(Se,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded mb-4",children:[e.jsx("p",{className:"font-medium",children:x.material.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Issued Quantity: ",x.quantity," ",x.material.unit]})]}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quantity Used *"}),e.jsx("input",{type:"number",required:!0,min:"0",max:x.quantity,value:c.quantityUsed,onChange:P=>{const J=parseInt(P.target.value)||0;R({...c,quantityUsed:J})},className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Good Condition *"}),e.jsx("input",{type:"number",required:!0,min:"0",value:c.quantityGood,onChange:P=>R({...c,quantityGood:parseInt(P.target.value)||0}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Damaged *"}),e.jsx("input",{type:"number",required:!0,min:"0",value:c.quantityDamaged,onChange:P=>R({...c,quantityDamaged:parseInt(P.target.value)||0}),className:"w-full border rounded px-3 py-2"})]})]}),c.quantityDamaged>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Damage Reason *"}),e.jsx("textarea",{required:!0,value:c.damageReason,onChange:P=>R({...c,damageReason:P.target.value}),className:"w-full border rounded px-3 py-2",rows:2,placeholder:"Explain what happened..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:[e.jsx(fs,{className:"w-4 h-4 inline mr-1"}),"Damage Photos (Required for damaged items)"]}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:f,className:"w-full border rounded px-3 py-2"}),c.photos.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:c.photos.map((P,J)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(P),alt:`Damage ${J+1}`,className:"w-20 h-20 object-cover rounded"}),e.jsx("button",{type:"button",onClick:()=>D(J),className:"absolute -top-2 -right-2 bg-red-600 text-white rounded-full p-1",children:e.jsx(js,{className:"w-3 h-3"})})]},J))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),e.jsx("textarea",{value:c.notes,onChange:P=>R({...c,notes:P.target.value}),className:"w-full border rounded px-3 py-2",rows:2,placeholder:"Any additional notes..."})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>a(!1),className:"px-4 py-2 border rounded hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:u,className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),u?"Saving...":"Record Return"]})]})]})]})}),o==="return"&&e.jsxs("div",{className:"space-y-4",children:[h.filter(P=>P.returns&&P.returns.length>0).map(P=>{var J;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:P.material.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Issued: ",P.quantity," ",P.material.unit]})]})}),(J=P.returns)==null?void 0:J.map(F=>e.jsx("div",{className:"bg-gray-50 p-3 rounded mt-2",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Used"}),e.jsx("p",{className:"font-medium",children:F.quantityUsed})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Returned (Good)"}),e.jsx("p",{className:"font-medium text-green-600",children:F.quantityGood})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Damaged"}),e.jsx("p",{className:"font-medium text-red-600",children:F.quantityDamaged})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Date"}),e.jsx("p",{className:"font-medium",children:new Date(F.recordedAt).toLocaleDateString()})]})]})},F.id))]},P.id)}),h.filter(P=>P.returns&&P.returns.length>0).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No returns recorded yet"})]})]})},qa=({open:s,onClose:b,jobId:t,materialIssueId:o,existingAssignment:n,onSuccess:N})=>{const[r,T]=l.useState(!1),[v,h]=l.useState([]),[k,j]=l.useState([]),[y,g]=l.useState(""),[i,m]=l.useState({jobId:t,materialIssueId:o,packerName:"",packerUserId:"",carpenterName:"",carpenterUserId:"",driverName:"",driverUserId:"",externalLaborCount:0,externalLaborNames:"",externalLaborCost:0,outsideForkliftNeeded:!1,forkliftOperatorName:"",forkliftCost:0,forkliftHours:0,notes:""});l.useEffect(()=>{if(s&&(a(),n&&(m(n),n.externalLaborNames)))try{const u=JSON.parse(n.externalLaborNames);j(Array.isArray(u)?u:[])}catch{j([])}},[s,n]);const a=async()=>{try{const u=await fetch("/api/staff-assignments/available-staff",{headers:{Authorization:"Bearer "}});if(u.ok){const C=await u.json();h(C)}}catch(u){console.error("Failed to fetch staff:",u)}},x=(u,C)=>{const A=v.find(w=>w.id===C);A&&m({...i,[`${u}Name`]:A.name,[`${u}UserId`]:A.id})},d=()=>{y.trim()&&(j([...k,y.trim()]),g(""))},c=u=>{j(k.filter((C,A)=>A!==u))},R=async u=>{u.preventDefault(),T(!0);try{const C={...i,externalLaborCount:k.length,externalLaborNames:JSON.stringify(k)},A=n!=null&&n.id?"/api/staff-assignments/":"/api/staff-assignments",w=n!=null&&n.id?"PUT":"POST";(await fetch(A,{method:w,headers:{"Content-Type":"application/json",Authorization:"Bearer "},body:JSON.stringify(C)})).ok?(N==null||N(),b()):alert("Failed to save staff assignment")}catch(C){console.error("Failed to save assignment:",C),alert("Error saving staff assignment")}finally{T(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-4 flex justify-between items-center rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-xl font-bold",children:"Staff Assignment"})]}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx(Se,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:R,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 text-gray-700 flex items-center gap-2",children:[e.jsx(Is,{className:"w-5 h-5"}),"Internal Staff"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Packer"}),e.jsxs("select",{value:i.packerUserId||"",onChange:u=>x("packer",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Packer"}),v.map(u=>e.jsxs("option",{value:u.id,children:[u.name," - ",u.position||"Staff"]},u.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Carpenter"}),e.jsxs("select",{value:i.carpenterUserId||"",onChange:u=>x("carpenter",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Carpenter"}),v.map(u=>e.jsxs("option",{value:u.id,children:[u.name," - ",u.position||"Staff"]},u.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Driver"}),e.jsxs("select",{value:i.driverUserId||"",onChange:u=>x("driver",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Driver"}),v.map(u=>e.jsxs("option",{value:u.id,children:[u.name," - ",u.position||"Staff"]},u.id))]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"External Labor"}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",value:y,onChange:u=>g(u.target.value),placeholder:"Enter labor name",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500",onKeyPress:u=>u.key==="Enter"&&(u.preventDefault(),d())}),e.jsxs("button",{type:"button",onClick:d,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Pt,{className:"w-4 h-4"}),"Add"]})]}),k.length>0&&e.jsx("div",{className:"space-y-2",children:k.map((u,C)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-md",children:[e.jsx("span",{className:"text-sm font-medium",children:u}),e.jsx("button",{type:"button",onClick:()=>c(C),className:"text-red-600 hover:text-red-700",children:e.jsx(js,{className:"w-4 h-4"})})]},C))}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"External Labor Cost (KWD)"}),e.jsx("input",{type:"number",step:"0.001",value:i.externalLaborCost||"",onChange:u=>m({...i,externalLaborCost:parseFloat(u.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Forklift (Outside)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"forklift",checked:i.outsideForkliftNeeded||!1,onChange:u=>m({...i,outsideForkliftNeeded:u.target.checked}),className:"w-4 h-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"forklift",className:"text-sm font-medium text-gray-700",children:"Outside Forklift Needed"})]}),i.outsideForkliftNeeded&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Operator Name"}),e.jsx("input",{type:"text",value:i.forkliftOperatorName||"",onChange:u=>m({...i,forkliftOperatorName:u.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hours"}),e.jsx("input",{type:"number",step:"0.5",value:i.forkliftHours||"",onChange:u=>m({...i,forkliftHours:parseFloat(u.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost (KWD)"}),e.jsx("input",{type:"number",step:"0.001",value:i.forkliftCost||"",onChange:u=>m({...i,forkliftCost:parseFloat(u.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500"})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:i.notes||"",onChange:u=>m({...i,notes:u.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500",placeholder:"Any additional notes..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",disabled:r,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50",disabled:r,children:r?"Saving...":n?"Update":"Assign Staff"})]})]})]})}):null},Ua=({isOpen:s,onClose:b,job:t,onUpdate:o})=>{const[n,N]=l.useState("details"),[r,T]=l.useState(!1);return!s||!t?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:t.title||t.jobTitle}),e.jsx("p",{className:"text-gray-600",children:t.jobCode})]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-700",children:e.jsx(Se,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"border-b px-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>N("details"),className:`py-3 px-4 font-medium border-b-2 transition-colors ${n==="details"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-800"}`,children:"Job Details"}),e.jsx("button",{onClick:()=>N("materials"),className:`py-3 px-4 font-medium border-b-2 transition-colors ${n==="materials"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-800"}`,children:"Materials"}),e.jsx("button",{onClick:()=>N("staff"),className:`py-3 px-4 font-medium border-b-2 transition-colors ${n==="staff"?"border-green-600 text-green-600":"border-transparent text-gray-600 hover:text-gray-800"}`,children:"Staff Assignment"})]})}),e.jsxs("div",{className:"p-6",children:[n==="details"&&e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Client Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Name"}),e.jsx("p",{className:"font-medium",children:t.clientName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.clientPhone})]}),t.clientEmail&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),e.jsx("p",{className:"font-medium",children:t.clientEmail})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Job Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("p",{className:"font-medium",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="COMPLETED"?"bg-green-100 text-green-800":t.status==="IN_PROGRESS"?"bg-blue-100 text-blue-800":t.status==="CANCELLED"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Job Date"}),e.jsx("p",{className:"font-medium",children:new Date(t.jobDate).toLocaleDateString()})]}),t.driverName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Driver"}),e.jsx("p",{className:"font-medium",children:t.driverName})]}),t.vehicleNumber&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vehicle"}),e.jsx("p",{className:"font-medium",children:t.vehicleNumber})]})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Addresses"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pickup Address"}),e.jsx("p",{className:"font-medium",children:t.jobAddress})]}),t.dropoffAddress&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Dropoff Address"}),e.jsx("p",{className:"font-medium",children:t.dropoffAddress})]})]})]}),t.notes&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"font-bold text-lg mb-3",children:"Notes"}),e.jsx("p",{className:"text-gray-700 bg-gray-50 p-4 rounded",children:t.notes})]})]}),n==="materials"&&e.jsx(Oa,{jobId:t.id,jobStatus:t.status,onUpdate:o}),n==="staff"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Staff Assignment"}),e.jsx("p",{className:"text-gray-600",children:"Assign packers, carpenters, drivers, and external labor to this job."})]}),e.jsx("button",{onClick:()=>T(!0),className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-medium",children:"+ Assign Staff to Job"}),e.jsx("div",{className:"mt-6 text-gray-500 text-center py-8 border-2 border-dashed rounded-lg",children:"Staff assignments will be displayed here"})]})]}),r&&e.jsx(qa,{open:r,onClose:()=>T(!1),jobId:t.id,onSuccess:()=>{T(!1),o&&o()}})]})})};function Wa({isOpen:s,onClose:b,jobId:t}){const[o,n]=l.useState(null),[N,r]=l.useState([]),[T,v]=l.useState(!0),h=l.useRef(null);l.useEffect(()=>{s&&t&&k()},[s,t]);const k=async()=>{v(!0);try{const m=localStorage.getItem("authToken"),x=await(await fetch(`/api/moving-jobs/${t}`,{headers:{Authorization:`Bearer ${m}`}})).json();n(x);const c=await(await fetch(`/api/materials/job-materials/${t}`,{headers:{Authorization:`Bearer ${m}`}})).json();r(c)}catch(m){console.error("Failed to load data:",m)}finally{v(!1)}},j=()=>{const m=N.reduce((R,u)=>R+u.quantity,0),a=N.reduce((R,u)=>{var A;const C=(A=u.returns)==null?void 0:A[0];return R+((C==null?void 0:C.quantityUsed)||0)},0),x=N.reduce((R,u)=>{var A;const C=(A=u.returns)==null?void 0:A[0];return R+((C==null?void 0:C.quantityGood)||0)},0),d=N.reduce((R,u)=>{var A;const C=(A=u.returns)==null?void 0:A[0];return R+((C==null?void 0:C.quantityDamaged)||0)},0),c=N.reduce((R,u)=>R+u.totalCost,0);return{totalIssued:m,totalUsed:a,totalReturned:x,totalDamaged:d,totalCost:c}},y=()=>{window.print()},g=()=>{const m=j();let a=`Material SKU,Material Name,Issued Qty,Used Qty,Returned Good,Damaged,Unit Cost,Total Cost,Status
`;N.forEach(R=>{var A;const u=(A=R.returns)==null?void 0:A[0],C=u?"Returned":"Pending";a+=`${R.material.sku},${R.material.name},${R.quantity},${(u==null?void 0:u.quantityUsed)||0},${(u==null?void 0:u.quantityGood)||0},${(u==null?void 0:u.quantityDamaged)||0},${R.unitCost},${R.totalCost},${C}
`}),a+=`
Totals:,,,${m.totalIssued},${m.totalUsed},${m.totalReturned},${m.totalDamaged},,${m.totalCost}
`;const x=new Blob([a],{type:"text/csv"}),d=URL.createObjectURL(x),c=document.createElement("a");c.href=d,c.download=`Job-${o==null?void 0:o.jobCode}-Material-Report.csv`,c.click()};if(!s)return null;const i=j();return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @media print {
          body * {
            visibility: hidden;
          }
          #printable-report, #printable-report * {
            visibility: visible;
          }
          #printable-report {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
          .no-print {
            display: none !important;
          }
        }
      `}),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center no-print",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"📊 Job Material Report"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4"}),"Print"]}),e.jsxs("button",{onClick:g,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"CSV"]}),e.jsx("button",{onClick:b,className:"text-gray-500 hover:text-gray-700",children:e.jsx(Se,{className:"w-6 h-6"})})]})]}),e.jsx("div",{ref:h,id:"printable-report",className:"p-6",children:T?e.jsx("p",{className:"text-center py-8",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 border-b pb-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Material Usage Report"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Job Code:"})," ",o==null?void 0:o.jobCode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Job Title:"})," ",o==null?void 0:o.jobTitle]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Client:"})," ",o==null?void 0:o.clientName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date((o==null?void 0:o.jobDate)||"").toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded text-xs ${(o==null?void 0:o.status)==="COMPLETED"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:o==null?void 0:o.status})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Issued"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:i.totalIssued})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Used"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:i.totalUsed})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Returned Good"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i.totalReturned})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Damaged"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:i.totalDamaged})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cost"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-600",children:[i.totalCost.toFixed(2)," KWD"]})]})]}),e.jsxs("table",{className:"min-w-full border-collapse border",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"border px-4 py-2 text-left",children:"SKU"}),e.jsx("th",{className:"border px-4 py-2 text-left",children:"Material Name"}),e.jsx("th",{className:"border px-4 py-2 text-center",children:"Issued"}),e.jsx("th",{className:"border px-4 py-2 text-center",children:"Used"}),e.jsx("th",{className:"border px-4 py-2 text-center",children:"Returned"}),e.jsx("th",{className:"border px-4 py-2 text-center",children:"Damaged"}),e.jsx("th",{className:"border px-4 py-2 text-right",children:"Unit Cost"}),e.jsx("th",{className:"border px-4 py-2 text-right",children:"Total Cost"}),e.jsx("th",{className:"border px-4 py-2 text-center",children:"Status"})]})}),e.jsxs("tbody",{children:[N.map(m=>{var x;const a=(x=m.returns)==null?void 0:x[0];return e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:m.material.sku}),e.jsx("td",{className:"border px-4 py-2",children:m.material.name}),e.jsxs("td",{className:"border px-4 py-2 text-center",children:[m.quantity," ",m.material.unit]}),e.jsx("td",{className:"border px-4 py-2 text-center",children:(a==null?void 0:a.quantityUsed)||"-"}),e.jsx("td",{className:"border px-4 py-2 text-center text-green-600",children:(a==null?void 0:a.quantityGood)||"-"}),e.jsx("td",{className:"border px-4 py-2 text-center text-red-600",children:(a==null?void 0:a.quantityDamaged)||"-"}),e.jsxs("td",{className:"border px-4 py-2 text-right",children:[m.unitCost.toFixed(2)," KWD"]}),e.jsxs("td",{className:"border px-4 py-2 text-right font-bold",children:[m.totalCost.toFixed(2)," KWD"]}),e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${a?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`,children:a?"Returned":"Pending"})})]},m.id)}),e.jsxs("tr",{className:"bg-gray-50 font-bold",children:[e.jsx("td",{colSpan:2,className:"border px-4 py-2",children:"TOTALS"}),e.jsx("td",{className:"border px-4 py-2 text-center",children:i.totalIssued}),e.jsx("td",{className:"border px-4 py-2 text-center",children:i.totalUsed}),e.jsx("td",{className:"border px-4 py-2 text-center text-green-600",children:i.totalReturned}),e.jsx("td",{className:"border px-4 py-2 text-center text-red-600",children:i.totalDamaged}),e.jsx("td",{className:"border px-4 py-2"}),e.jsxs("td",{className:"border px-4 py-2 text-right",children:[i.totalCost.toFixed(2)," KWD"]}),e.jsx("td",{className:"border px-4 py-2"})]})]})]}),N.some(m=>{var a,x;return((x=(a=m.returns)==null?void 0:a[0])==null?void 0:x.quantityDamaged)>0})&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"🔴 Damage Details"}),N.filter(m=>{var a,x;return((x=(a=m.returns)==null?void 0:a[0])==null?void 0:x.quantityDamaged)>0}).map(m=>{var x;const a=(x=m.damages)==null?void 0:x[0];return e.jsxs("div",{className:"border rounded p-4 mb-3",children:[e.jsx("p",{className:"font-bold",children:m.material.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Damaged Quantity: ",m.returns[0].quantityDamaged," ",m.material.unit]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("strong",{children:"Reason:"})," ",a.reason]}),a.photoUrls&&e.jsx("div",{className:"flex gap-2 mt-2",children:a.photoUrls.split(",").map((d,c)=>e.jsx("img",{src:d,alt:`Damage ${c+1}`,className:"w-20 h-20 object-cover rounded"},c))})]})]},m.id)})]}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500",children:[e.jsxs("p",{children:["Generated on ",new Date().toLocaleString()]}),e.jsx("p",{children:"Warehouse Management System"})]})]})})]})})]})}const za=({isOpen:s,onClose:b,job:t})=>{const[o,n]=l.useState([]),[N,r]=l.useState(!1),[T,v]=l.useState(!1),[h,k]=l.useState(!1);l.useEffect(()=>{s&&(t!=null&&t.id)&&j()},[s,t]);const j=async()=>{try{r(!0);const c=await fetch(`/api/job-files/${t.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(c.ok){const R=await c.json();n(R.files||[])}}catch(c){console.error("Failed to load files:",c)}finally{r(!1)}},y=c=>{c.preventDefault(),c.stopPropagation(),c.type==="dragenter"||c.type==="dragover"?k(!0):c.type==="dragleave"&&k(!1)},g=async c=>{c.preventDefault(),c.stopPropagation(),k(!1),c.dataTransfer.files&&c.dataTransfer.files[0]&&await m(c.dataTransfer.files)},i=async c=>{c.target.files&&c.target.files[0]&&await m(c.target.files)},m=async c=>{const R=new FormData;Array.from(c).forEach(u=>{R.append("files",u)}),R.append("jobId",t.id);try{v(!0),(await fetch("/api/job-files/upload",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:R})).ok?await j():alert("Failed to upload files")}catch(u){console.error("Upload error:",u),alert("Failed to upload files")}finally{v(!1)}},a=async c=>{if(confirm("Delete this file?"))try{(await fetch(`/api/job-files/${c}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).ok?await j():alert("Failed to delete file")}catch(R){console.error("Delete error:",R),alert("Failed to delete file")}},x=c=>{if(c===0)return"0 Bytes";const R=1024,u=["Bytes","KB","MB","GB"],C=Math.floor(Math.log(c)/Math.log(R));return Math.round(c/Math.pow(R,C)*100)/100+" "+u[C]},d=c=>c.includes("image")?"🖼️":c.includes("pdf")?"📄":c.includes("word")||c.includes("document")?"📝":c.includes("excel")||c.includes("spreadsheet")?"📊":"📎";return!s||!t?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"📁 Job Files & Documents"}),e.jsx("p",{className:"text-purple-100 text-sm",children:t.jobTitle||t.jobCode})]}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 text-2xl font-bold",children:e.jsx(Se,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${h?"border-purple-500 bg-purple-50":"border-gray-300"}`,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:g,children:[e.jsx(Dt,{className:`w-12 h-12 mx-auto mb-4 ${h?"text-purple-600":"text-gray-400"}`}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"Drop files here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Supports: PDF, Images, Documents, Spreadsheets (Max 10MB each)"}),e.jsxs("label",{className:"inline-block",children:[e.jsx("span",{className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 cursor-pointer",children:T?"Uploading...":"Browse Files"}),e.jsx("input",{type:"file",multiple:!0,onChange:i,className:"hidden",disabled:T,accept:".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx"})]})]})}),e.jsx("div",{className:"p-6 max-h-96 overflow-y-auto",children:N?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-purple-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading files..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Et,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No files uploaded yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Upload your first document using the area above"})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:o.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("span",{className:"text-3xl mr-4",children:d(c.mimeType)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:c.originalName}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-1",children:[e.jsx("span",{children:x(c.fileSize)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(c.uploadedAt).toLocaleDateString()}),c.uploadedBy&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["By ",c.uploadedBy]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:`/uploads/job-files/${c.jobId}/${c.folderName||""}/${c.fileName}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",title:"View",children:e.jsx(It,{className:"w-5 h-5"})}),e.jsx("a",{href:`/uploads/job-files/${c.jobId}/${c.folderName||""}/${c.fileName}`,download:c.originalName,className:"p-2 text-green-600 hover:bg-green-50 rounded-lg",title:"Download",children:e.jsx(Ns,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>a(c.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",title:"Delete",children:e.jsx(js,{className:"w-5 h-5"})})]})]},c.id))})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[o.length," file",o.length!==1?"s":""," uploaded"]}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Close"})]})]})})},Va=()=>{const[s,b]=l.useState("all"),[t,o]=l.useState([]),[n,N]=l.useState(!0),[r,T]=l.useState(!1),[v,h]=l.useState(!1),[k,j]=l.useState(!1),[y,g]=l.useState(!1),[i,m]=l.useState(!1),[a,x]=l.useState(!1),[d,c]=l.useState(null);l.useEffect(()=>{R()},[s]);const R=async()=>{try{N(!0);const C={};if(s!=="all"){const w={scheduled:"SCHEDULED,PLANNED",inprogress:"IN_PROGRESS,DISPATCHED",completed:"COMPLETED,CLOSED"};C.status=w[s]||s.toUpperCase()}const A=await as.getAll(C);o(A.jobs||[])}catch(C){console.error("Load jobs error:",C)}finally{N(!1)}},u=C=>{switch(C){case"Scheduled":return"bg-blue-100 text-blue-800";case"In Progress":return"bg-green-100 text-green-800";case"Completed":return"bg-gray-100 text-gray-800";case"Cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Moving Jobs"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Schedule and manage moving operations"})]}),e.jsxs("button",{onClick:()=>T(!0),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2"}),"New Job"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Jobs"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:t.length})]}),e.jsx(Me,{className:"h-10 w-10 text-primary-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:t.filter(C=>C.status==="IN_PROGRESS").length})]})})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Scheduled"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-2",children:t.filter(C=>C.status==="SCHEDULED"||C.status==="PLANNED").length})]})})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Completed"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 mt-2",children:t.filter(C=>C.status==="COMPLETED").length})]})})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>b("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${s==="all"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Jobs"}),e.jsx("button",{onClick:()=>b("scheduled"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${s==="scheduled"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Scheduled"}),e.jsx("button",{onClick:()=>b("inprogress"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${s==="inprogress"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"In Progress"}),e.jsx("button",{onClick:()=>b("completed"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${s==="completed"?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Completed"})]})}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading jobs..."})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:t.map(C=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-lg transition-all",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:C.jobTitle||C.title||"Untitled Job"}),e.jsx("p",{className:"text-blue-100 text-sm",children:C.jobCode||"No Code"})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full ${u(C.status)}`,children:C.status})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center text-sm mb-2",children:[e.jsx(ss,{className:"h-5 w-5 mr-2 text-blue-600"}),e.jsx("span",{className:"font-bold text-gray-700",children:"Client Details"})]}),e.jsxs("div",{className:"ml-7 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:C.clientName}),e.jsx("p",{className:"text-sm text-gray-600",children:C.clientPhone}),C.clientEmail&&e.jsx("p",{className:"text-sm text-gray-600",children:C.clientEmail})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(ps,{className:"h-5 w-5 mr-2 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"From:"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:C.jobAddress||C.fromAddress||"Not specified"})]})]}),(C.dropoffAddress||C.toAddress)&&e.jsx("div",{className:"flex items-start text-sm ml-7",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"To:"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:C.dropoffAddress||C.toAddress})]})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ft,{className:"h-5 w-5 mr-2 text-blue-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:C.jobDate?new Date(C.jobDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"No Date"})]}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium",children:C.jobType||"LOCAL"})]}),C.assignments&&C.assignments.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:"ASSIGNED TEAM"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.assignments.map(A=>e.jsxs("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium",children:["👤 ",A.user.name]},A.id))})]}),C.materialIssues&&C.materialIssues.length>0&&e.jsx("div",{className:"bg-orange-50 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs font-medium text-orange-700 mb-1",children:["📦 Materials: ",C.materialIssues.length," items issued"]})}),C.notes&&e.jsxs("div",{className:"text-xs text-gray-600 bg-yellow-50 p-2 rounded border-l-4 border-yellow-400",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",C.notes.substring(0,50),C.notes.length>50?"...":""]})]}),e.jsxs("div",{className:"px-6 pb-6 grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>{c(C),j(!0)},className:"px-4 py-2 bg-green-50 text-green-600 rounded-md hover:bg-green-100 font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"View"]}),e.jsxs("button",{onClick:()=>{c(C),h(!0)},className:"px-4 py-2 bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>{c(C),g(!0)},className:"px-4 py-2 bg-purple-50 text-purple-600 rounded-md hover:bg-purple-100 font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Report"]}),e.jsx("button",{onClick:()=>{c(C),x(!0)},className:"px-4 py-2 bg-indigo-50 text-indigo-600 rounded-md hover:bg-indigo-100 font-medium text-sm flex items-center justify-center gap-2",children:"📁 Files"}),C.status!=="COMPLETED"&&e.jsx("button",{onClick:()=>{c(C),m(!0)},className:"px-4 py-2 bg-orange-50 text-orange-600 rounded-md hover:bg-orange-100 font-medium text-sm flex items-center justify-center gap-2",children:"✅ Complete Job"}),e.jsxs("button",{onClick:async()=>{if(confirm(`Delete job "${C.title||C.jobTitle}"?`))try{await as.delete(C.id),R()}catch(A){console.error("Delete error:",A),alert("Failed to delete job")}},className:"px-4 py-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 font-medium text-sm flex items-center justify-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),"Delete"]})]})]},C.id))}),e.jsx($a,{isOpen:r,onClose:()=>T(!1),onSuccess:R}),e.jsx(Ba,{isOpen:v,onClose:()=>h(!1),job:d,onSuccess:R}),e.jsx(Ua,{isOpen:k,onClose:()=>j(!1),job:d,onUpdate:R}),e.jsx(Wa,{isOpen:y,onClose:()=>g(!1),jobId:(d==null?void 0:d.id)||""}),e.jsx(ft,{isOpen:i,onClose:()=>m(!1),jobId:(d==null?void 0:d.id)||"",onSuccess:async()=>{try{await as.update(d.id,{status:"COMPLETED"}),await R()}catch(C){throw console.error("Failed to update job status:",C),C}}}),e.jsx(za,{isOpen:a,onClose:()=>x(!1),job:d})]})},Ja=[{name:"Indigo Purple",primary:"#4F46E5",secondary:"#7C3AED",accent:"#10B981"},{name:"Blue Cyan",primary:"#0EA5E9",secondary:"#06B6D4",accent:"#8B5CF6"},{name:"Green",primary:"#10B981",secondary:"#059669",accent:"#F59E0B"},{name:"Amber Red",primary:"#F59E0B",secondary:"#EF4444",accent:"#3B82F6"}],Ga=()=>{const[s,b]=l.useState({name:"",email:"",phone:"",address:"",website:"",logo:null,primaryColor:"#4F46E5",secondaryColor:"#7C3AED",accentColor:"#10B981",showCompanyName:!0,logoSize:"medium"}),[t,o]=l.useState(!1),[n,N]=l.useState(!0),[r,T]=l.useState(null),[v,h]=l.useState(null),[k,j]=l.useState(null);l.useEffect(()=>{(async()=>{try{const d=(await st.getInfo()).company;b({name:d.name||"",email:d.email||"",phone:d.phone||"",address:d.address||"",website:d.website||"",logo:d.logo||null,primaryColor:d.primaryColor||"#4F46E5",secondaryColor:d.secondaryColor||"#7C3AED",accentColor:d.accentColor||"#10B981",showCompanyName:d.showCompanyName!==!1,logoSize:d.logoSize||"medium"}),d.logo&&j(d.logo)}catch(x){console.error("Failed to load company data:",x),T({type:"error",text:"Failed to load company information"})}finally{N(!1)}})()},[]);const y=a=>{var d;const x=(d=a.target.files)==null?void 0:d[0];if(x){if(x.size>2*1024*1024){T({type:"error",text:"Logo file size must be less than 2MB"});return}h(x);const c=new FileReader;c.onloadend=()=>{j(c.result)},c.readAsDataURL(x)}},g=async()=>{if(!v)return null;try{const a=new FormData;a.append("logo",v);const x=localStorage.getItem("authToken"),d=await fetch("/api/upload/logo",{method:"POST",headers:{Authorization:`Bearer ${x}`},body:a});if(d.ok)return(await d.json()).logoUrl}catch(a){console.error("Failed to upload logo:",a)}return null},i=async()=>{o(!0),T(null);try{let a=s.logo;if(v){const x=await g();x&&(a=x)}await st.updateInfo({name:s.name,email:s.email,phone:s.phone,website:s.website,address:s.address,logo:a,primaryColor:s.primaryColor,secondaryColor:s.secondaryColor,accentColor:s.accentColor,showCompanyName:s.showCompanyName,logoSize:s.logoSize}),T({type:"success",text:"Company settings saved successfully!"}),h(null),setTimeout(()=>{window.location.reload()},1500)}catch(a){T({type:"error",text:a.message||"Failed to save company information"})}finally{o(!1)}},m=a=>{b(x=>({...x,primaryColor:a.primary,secondaryColor:a.secondary,accentColor:a.accent}))};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading company information..."})]})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Company & Branding"}),e.jsx("p",{className:"text-gray-600",children:"Manage your company details, logo, and brand colors"})]}),e.jsx("button",{onClick:i,disabled:t,className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-5 w-5"}),e.jsx("span",{children:"Save Changes"})]})})]}),r&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center space-x-3 ${r.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[r.type==="success"?e.jsx(ge,{className:"h-6 w-6"}):e.jsx(Pe,{className:"h-6 w-6"}),e.jsx("span",{className:"font-medium",children:r.text})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(is,{className:"h-6 w-6 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Company Logo"})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[k?e.jsx("img",{src:k,alt:"Company Logo",className:"w-24 h-24 rounded-lg object-cover border-2 border-gray-200"}):e.jsx("div",{className:"w-24 h-24 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",children:e.jsx(ze,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("label",{className:"absolute -bottom-2 -right-2 bg-primary-600 text-white p-2 rounded-full cursor-pointer hover:bg-primary-700 transition-colors shadow-lg",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:y,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Upload Company Logo"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"PNG, JPG, SVG up to 2MB. Recommended: 200x200px"}),v&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["✓ New logo selected: ",v.name]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(ze,{className:"h-6 w-6 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Company Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.name,onChange:a=>b({...s,name:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Demo Warehouse Co."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:"Email Address"})]}),e.jsx("input",{type:"email",value:s.email,onChange:a=>b({...s,email:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"contact@company.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx("span",{children:"Phone Number"})]}),e.jsx("input",{type:"tel",value:s.phone,onChange:a=>b({...s,phone:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"+965 1234 5678"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx(Lt,{className:"h-4 w-4"}),e.jsx("span",{children:"Website"})]}),e.jsx("input",{type:"url",value:s.website,onChange:a=>b({...s,website:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"https://company.com"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx(ps,{className:"h-4 w-4"}),e.jsx("span",{children:"Address"})]}),e.jsx("textarea",{value:s.address,onChange:a=>b({...s,address:a.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Kuwait City, Kuwait"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx(ws,{className:"h-6 w-6 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Brand Colors"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Quick Presets"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Ja.map(a=>e.jsxs("button",{onClick:()=>m(a),className:"p-3 border-2 border-gray-200 rounded-lg hover:border-primary-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-6 h-6 rounded",style:{backgroundColor:a.primary}}),e.jsx("div",{className:"w-6 h-6 rounded",style:{backgroundColor:a.secondary}}),e.jsx("div",{className:"w-6 h-6 rounded",style:{backgroundColor:a.accent}})]}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:a.name})]},a.name))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"color",value:s.primaryColor,onChange:a=>b({...s,primaryColor:a.target.value}),className:"h-10 w-20 rounded border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:s.primaryColor,onChange:a=>b({...s,primaryColor:a.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono",placeholder:"#4F46E5"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"color",value:s.secondaryColor,onChange:a=>b({...s,secondaryColor:a.target.value}),className:"h-10 w-20 rounded border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:s.secondaryColor,onChange:a=>b({...s,secondaryColor:a.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono",placeholder:"#7C3AED"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Accent Color"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"color",value:s.accentColor,onChange:a=>b({...s,accentColor:a.target.value}),className:"h-10 w-20 rounded border border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:s.accentColor,onChange:a=>b({...s,accentColor:a.target.value}),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono",placeholder:"#10B981"})]})]})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Show Company Name on Login"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Display company name below logo on login page"})]}),e.jsx("button",{onClick:()=>b({...s,showCompanyName:!s.showCompanyName}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${s.showCompanyName?"bg-primary-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s.showCompanyName?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo Size on Login Page"}),e.jsxs("select",{value:s.logoSize,onChange:a=>b({...s,logoSize:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"small",children:"Small (48px)"}),e.jsx("option",{value:"medium",children:"Medium (80px)"}),e.jsx("option",{value:"large",children:"Large (128px)"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Login Page Preview"}),e.jsx("div",{className:"relative h-64 rounded-lg overflow-hidden flex items-center justify-center",style:{background:`linear-gradient(135deg, ${s.primaryColor}15 0%, ${s.secondaryColor}15 100%)`},children:e.jsxs("div",{className:"text-center",children:[k?e.jsx("img",{src:k,alt:"Logo",className:"h-16 w-16 mx-auto mb-4 rounded-lg object-cover"}):e.jsx("div",{className:"h-16 w-16 mx-auto mb-4 rounded-lg flex items-center justify-center",style:{background:`linear-gradient(135deg, ${s.primaryColor} 0%, ${s.secondaryColor} 100%)`},children:e.jsx(ze,{className:"h-8 w-8 text-white"})}),s.showCompanyName&&e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.name||"Company Name"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Sign in to access your account"})]})})]})]})},rt=[{value:"ACTIVE",label:"Active",color:"green"},{value:"INACTIVE",label:"Inactive",color:"gray"},{value:"EXPIRED",label:"Expired",color:"red"},{value:"PENDING",label:"Pending",color:"yellow"}],Ha=()=>{const[s,b]=l.useState([]),[t,o]=l.useState(!0),[n,N]=l.useState(!1),[r,T]=l.useState(null),[v,h]=l.useState(null),[k,j]=l.useState(null),[y,g]=l.useState(null),[i,m]=l.useState(!1),[a,x]=l.useState(null),[d,c]=l.useState({name:"",description:"",contactPerson:"",contactPhone:"",contractStatus:"ACTIVE",isActive:!0});l.useEffect(()=>{R()},[]);const R=async()=>{try{o(!0);const f=await We.listProfiles();b(f)}catch{g({type:"error",text:"Failed to load company profiles"})}finally{o(!1)}},u=f=>{var L;const D=(L=f.target.files)==null?void 0:L[0];if(D){if(D.size>2*1024*1024){g({type:"error",text:"Logo must be less than 2MB"});return}h(D);const q=new FileReader;q.onloadend=()=>{j(q.result)},q.readAsDataURL(D)}},C=f=>{c({name:f.name,description:f.description||"",contactPerson:f.contactPerson||"",contactPhone:f.contactPhone||"",contractStatus:f.contractStatus||"ACTIVE",isActive:f.isActive}),j(f.logoUrl||f.logo||null),h(null),T(f.id),N(!0)},A=()=>{N(!1),T(null),c({name:"",description:"",contactPerson:"",contactPhone:"",contractStatus:"ACTIVE",isActive:!0}),h(null),j(null)},w=async f=>{if(f.preventDefault(),!d.name.trim()){g({type:"error",text:"Company name is required"});return}m(!0);try{const D=new FormData;D.append("name",d.name),D.append("description",d.description),D.append("contactPerson",d.contactPerson),D.append("contactPhone",d.contactPhone),D.append("contractStatus",d.contractStatus),D.append("isActive",String(d.isActive)),v&&D.append("logo",v),r?(await We.updateProfile(r,D),g({type:"success",text:"Company profile updated successfully"})):(await We.createProfile(D),g({type:"success",text:"Company profile created successfully"})),setTimeout(()=>{A(),R(),g(null)},1500)}catch(D){g({type:"error",text:D.message||"Failed to save company profile"})}finally{m(!1)}},p=async f=>{m(!0);try{await We.deleteProfile(f),g({type:"success",text:"Company profile deleted successfully"}),x(null),setTimeout(()=>{R(),g(null)},1500)}catch(D){g({type:"error",text:D.message||"Failed to delete company profile"})}finally{m(!1)}};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading company profiles..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Company Profiles"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Create and manage company profiles (DIOR, JAZEERA, etc.)"})]}),e.jsxs("button",{onClick:()=>{A(),N(!0)},className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors flex items-center space-x-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),e.jsx("span",{children:"New Profile"})]})]}),y&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center space-x-3 ${y.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:[y.type==="success"?e.jsx(ge,{className:"h-6 w-6"}):e.jsx(us,{className:"h-6 w-6"}),e.jsx("span",{className:"font-medium",children:y.text})]}),n&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r?"Edit Company Profile":"Create New Company Profile"}),e.jsx("button",{onClick:A,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Profile Logo"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[k?e.jsx("img",{src:k,alt:"Profile Logo",className:"w-24 h-24 rounded-lg object-cover border-2 border-gray-200"}):e.jsx("div",{className:"w-24 h-24 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center bg-gray-50",children:e.jsx(is,{className:"h-8 w-8 text-gray-400"})}),e.jsxs("label",{className:"absolute -bottom-2 -right-2 bg-primary-600 text-white p-2 rounded-full cursor-pointer hover:bg-primary-700 transition-colors shadow-lg",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx("input",{type:"file",accept:"image/*",onChange:u,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"PNG, JPG, SVG up to 2MB"}),v&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["✓ ",v.name]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Company Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:d.name,onChange:f=>c({...d,name:f.target.value}),placeholder:"e.g., DIOR, JAZEERA, COMPANY_MATERIAL",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:f=>c({...d,description:f.target.value}),placeholder:"Brief description of the company...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx("span",{children:"Contact Person"})]}),e.jsx("input",{type:"text",value:d.contactPerson,onChange:f=>c({...d,contactPerson:f.target.value}),placeholder:"John Doe",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center space-x-2",children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx("span",{children:"Contact Phone"})]}),e.jsx("input",{type:"tel",value:d.contactPhone,onChange:f=>c({...d,contactPhone:f.target.value}),placeholder:"+965 1234 5678",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contract Status"}),e.jsx("select",{value:d.contractStatus,onChange:f=>c({...d,contractStatus:f.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:rt.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Active Status"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enable this company profile for use"})]}),e.jsx("button",{type:"button",onClick:()=>c({...d,isActive:!d.isActive}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${d.isActive?"bg-primary-600":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${d.isActive?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex space-x-3 justify-end",children:[e.jsx("button",{type:"button",onClick:A,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Saving..."})]}):e.jsx("span",{children:r?"Update Profile":"Create Profile"})})]})]})]}),s.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(ze,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No company profiles yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Create your first company profile to get started"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(f=>{const D=rt.find(E=>E.value===f.contractStatus),L=(D==null?void 0:D.color)||"gray",q=f.logoUrl||f.logo;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[q?e.jsx("img",{src:q,alt:f.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(ze,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:f.name}),f.description&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:f.description})]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium flex-shrink-0
                    ${L==="green"?"bg-green-100 text-green-800":""}
                    ${L==="red"?"bg-red-100 text-red-800":""}
                    ${L==="yellow"?"bg-yellow-100 text-yellow-800":""}
                    ${L==="gray"?"bg-gray-100 text-gray-800":""}
                  `,children:D==null?void 0:D.label})]}),e.jsxs("div",{className:"space-y-1 mb-4 text-sm",children:[f.contactPerson&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",f.contactPerson]}),f.contactPhone&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",f.contactPhone]})]}),e.jsxs("div",{className:"mb-4 flex items-center space-x-2 text-sm",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${f.isActive?"bg-green-500":"bg-gray-300"}`}),e.jsx("span",{className:f.isActive?"text-green-700":"text-gray-700",children:f.isActive?"Active":"Inactive"})]}),a===f.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Delete this profile?"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>p(f.id),disabled:i,className:"flex-1 px-2 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 disabled:opacity-50",children:"Delete"}),e.jsx("button",{onClick:()=>x(null),className:"flex-1 px-2 py-1 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>C(f),className:"flex-1 px-3 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center space-x-1",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Edit"})]}),e.jsxs("button",{onClick:()=>x(f.id),className:"flex-1 px-3 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors flex items-center justify-center space-x-1",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Delete"})]})]})]},f.id)})})]})},_a={ADMIN:"bg-red-100 text-red-800",MANAGER:"bg-blue-100 text-blue-800",DRIVER:"bg-purple-100 text-purple-800",WORKER:"bg-green-100 text-green-800",SCANNER:"bg-yellow-100 text-yellow-800",PACKER:"bg-gray-100 text-gray-800",LABOR:"bg-gray-100 text-gray-800"},Ka={ACTIVE:"bg-green-100 text-green-800",INACTIVE:"bg-gray-100 text-gray-800"},Qa=()=>{const[s,b]=l.useState([]),[t,o]=l.useState(!0),[n,N]=l.useState(""),[r,T]=l.useState("ALL"),[v,h]=l.useState("ALL"),[k,j]=l.useState(!1),[y,g]=l.useState(null);l.useEffect(()=>{i()},[]);const i=async()=>{try{const d=(await Na.getAll()).users.map(c=>({id:c.id,name:c.name,email:c.email,phone:c.phone||"",role:c.role,status:c.isActive?"ACTIVE":"INACTIVE",skills:c.skills?typeof c.skills=="string"?JSON.parse(c.skills):c.skills:[],joinedAt:c.createdAt?new Date(c.createdAt).toLocaleDateString():"",lastActive:new Date(c.updatedAt).toLocaleDateString(),avatar:c.avatar||void 0}));b(d)}catch(x){console.error("Failed to load users:",x)}finally{o(!1)}},m=s.filter(x=>{const d=x.name.toLowerCase().includes(n.toLowerCase())||x.email.toLowerCase().includes(n.toLowerCase()),c=r==="ALL"||x.role===r,R=v==="ALL"||x.status===v;return d&&c&&R}),a=x=>x.split(" ").map(d=>d[0]).join("").toUpperCase();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage team members, roles, and permissions"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors flex items-center space-x-2",children:[e.jsx(Js,{className:"h-5 w-5"}),e.jsx("span",{children:"Add User"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ss,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Gs,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(x=>x.status==="ACTIVE").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Fs,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Admins"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(x=>x.role==="ADMIN").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(us,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Inactive"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.filter(x=>x.status==="INACTIVE").length})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ys,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users by name or email...",value:n,onChange:x=>N(x.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:r,onChange:x=>T(x.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"ALL",children:"All Roles"}),e.jsx("option",{value:"ADMIN",children:"Admin"}),e.jsx("option",{value:"MANAGER",children:"Manager"}),e.jsx("option",{value:"DRIVER",children:"Driver"}),e.jsx("option",{value:"WORKER",children:"Worker"}),e.jsx("option",{value:"SCANNER",children:"Scanner"}),e.jsx("option",{value:"PACKER",children:"Packer"}),e.jsx("option",{value:"LABOR",children:"Labor"})]})]}),e.jsx("div",{children:e.jsxs("select",{value:v,onChange:x=>h(x.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"ALL",children:"All Status"}),e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"INACTIVE",children:"Inactive"})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role & Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Skills"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(x=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:x.avatar?e.jsx("img",{className:"h-10 w-10 rounded-full",src:x.avatar,alt:x.name}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-primary-600",children:a(x.name)})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.name}),e.jsx("div",{className:"text-sm text-gray-500",children:x.email}),e.jsx("div",{className:"text-sm text-gray-500",children:x.phone})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${_a[x.role]}`,children:x.role}),e.jsx("br",{}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${Ka[x.status]}`,children:x.status})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.skills.slice(0,2).map((d,c)=>e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded",children:d},c)),x.skills.length>2&&e.jsxs("span",{className:"inline-flex px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded",children:["+",x.skills.length-2," more"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x.lastActive}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>g(x),className:"text-primary-600 hover:text-primary-900",children:e.jsx(ds,{className:"h-4 w-4"})}),e.jsx("button",{className:"text-blue-600 hover:text-blue-900",children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsx("button",{className:"text-red-600 hover:text-red-900",children:e.jsx(qe,{className:"h-4 w-4"})})]})})]},x.id))})]})})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"📋 Role Permissions Guide"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border border-red-200 rounded-lg p-4 bg-red-50",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Fs,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("h4",{className:"font-medium text-red-900",children:"Admin"})]}),e.jsxs("ul",{className:"text-xs text-red-700 space-y-1",children:[e.jsx("li",{children:"✅ Full system access"}),e.jsx("li",{children:"✅ Manage users"}),e.jsx("li",{children:"✅ View all jobs"}),e.jsx("li",{children:"✅ Financial reports"}),e.jsx("li",{children:"✅ Settings"})]})]}),e.jsxs("div",{className:"border border-blue-200 rounded-lg p-4 bg-blue-50",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(ss,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("h4",{className:"font-medium text-blue-900",children:"Manager"})]}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"✅ Manage jobs"}),e.jsx("li",{children:"✅ View reports"}),e.jsx("li",{children:"✅ Manage teams"}),e.jsx("li",{children:"✅ Scan shipments"}),e.jsx("li",{children:"❌ System settings"})]})]}),e.jsxs("div",{className:"border border-purple-200 rounded-lg p-4 bg-purple-50",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("span",{className:"text-purple-600 mr-2",children:"🚗"}),e.jsx("h4",{className:"font-medium text-purple-900",children:"Driver"})]}),e.jsxs("ul",{className:"text-xs text-purple-700 space-y-1",children:[e.jsx("li",{children:"✅ View assigned jobs"}),e.jsx("li",{children:"✅ Update job status"}),e.jsx("li",{children:"✅ Mobile app access"}),e.jsx("li",{children:"❌ View all jobs"}),e.jsx("li",{children:"❌ Manage system"})]})]}),e.jsxs("div",{className:"border border-green-200 rounded-lg p-4 bg-green-50",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Gs,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("h4",{className:"font-medium text-green-900",children:"Worker"})]}),e.jsxs("ul",{className:"text-xs text-green-700 space-y-1",children:[e.jsx("li",{children:"✅ Scan shipments"}),e.jsx("li",{children:"✅ View dashboard"}),e.jsx("li",{children:"✅ Manage shipments"}),e.jsx("li",{children:"❌ Manage jobs"}),e.jsx("li",{children:"❌ View reports"})]})]}),e.jsxs("div",{className:"border border-yellow-200 rounded-lg p-4 bg-yellow-50",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("span",{className:"text-yellow-600 mr-2",children:"📱"}),e.jsx("h4",{className:"font-medium text-yellow-900",children:"Scanner"})]}),e.jsxs("ul",{className:"text-xs text-yellow-700 space-y-1",children:[e.jsx("li",{children:"✅ Scan shipments ONLY"}),e.jsx("li",{children:"✅ View pending items"}),e.jsx("li",{children:"❌ Dashboard access"}),e.jsx("li",{children:"❌ Manage anything"}),e.jsx("li",{children:"❌ Reports"})]})]}),e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("span",{className:"text-gray-600 mr-2",children:"📦"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Packer"})]}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"🔒 Dummy user only"}),e.jsx("li",{children:"✅ Job staff assignment"}),e.jsx("li",{children:"❌ Cannot login"}),e.jsx("li",{children:"❌ No system access"}),e.jsx("li",{children:"Used for tracking"})]})]}),e.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("span",{className:"text-gray-600 mr-2",children:"🔧"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Labor"})]}),e.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[e.jsx("li",{children:"🔒 Dummy user only"}),e.jsx("li",{children:"✅ Job staff assignment"}),e.jsx("li",{children:"❌ Cannot login"}),e.jsx("li",{children:"❌ No system access"}),e.jsx("li",{children:"Used for tracking"})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["💡 ",e.jsx("strong",{children:"Tip:"}),' PACKER and LABOR roles are "dummy users" - they can be assigned to Moving Job staff for tracking purposes but cannot login to the system.']})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Add New User"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:async x=>{x.preventDefault();const d=new FormData(x.currentTarget),c={name:d.get("name"),email:d.get("email"),password:d.get("password"),role:d.get("role")};try{const R=localStorage.getItem("authToken"),u=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify(c)}),C=await u.json();u.ok?(alert("User created successfully!"),j(!1),i(),x.currentTarget.reset()):alert(C.error||"Failed to create user")}catch(R){alert(R.message||"Failed to create user")}},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Enter full name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),e.jsx("input",{type:"email",name:"email",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password *"}),e.jsx("input",{type:"password",name:"password",required:!0,minLength:6,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Minimum 6 characters"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Minimum 6 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{name:"role",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select a role"}),e.jsx("option",{value:"ADMIN",children:"🛡️ Admin - Full system access"}),e.jsx("option",{value:"MANAGER",children:"👔 Manager - Manage jobs & teams"}),e.jsx("option",{value:"DRIVER",children:"🚗 Driver - View assigned jobs only"}),e.jsx("option",{value:"WORKER",children:"👷 Worker - General warehouse work"}),e.jsx("option",{value:"SCANNER",children:"📱 Scanner - QR scanning only"}),e.jsx("option",{value:"PACKER",children:"📦 Packer - Staff assignment only"}),e.jsx("option",{value:"LABOR",children:"🔧 Labor - Staff assignment only"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PACKER/LABOR are dummy users for job staff assignment only"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center space-x-2",children:[e.jsx(Js,{className:"h-5 w-5"}),e.jsx("span",{children:"Create User"})]})]})]})]})})]})},Xa=()=>{const[s,b]=l.useState({templateType:"MODERN",primaryColor:"#2563eb",secondaryColor:"#64748b",showLogo:!0,showCompanyAddress:!0,showClientDetails:!0,footerText:"Thank you for your business!",termsConditions:"",invoicePrefix:"INV",invoiceStartNumber:1001}),[t,o]=l.useState(!0),[n,N]=l.useState(!1),[r,T]=l.useState(null);l.useEffect(()=>{v()},[]);const v=async()=>{try{const y=(await tt.get()).settings;b({templateType:"MODERN",primaryColor:y.primaryColor||"#2563eb",secondaryColor:y.accentColor||"#64748b",showLogo:y.showLogo!==void 0?y.showLogo:!0,showCompanyAddress:!0,showClientDetails:!0,footerText:y.footerText||"Thank you for your business!",termsConditions:y.terms||"",invoicePrefix:y.prefix||"INV",invoiceStartNumber:y.nextNumber||1001})}catch(j){console.error("Failed to load invoice settings:",j),T({type:"error",text:"Failed to load invoice settings"})}finally{o(!1)}},h=async()=>{N(!0),T(null);try{await tt.update({prefix:s.invoicePrefix,nextNumber:s.invoiceStartNumber,primaryColor:s.primaryColor,accentColor:s.secondaryColor,showLogo:s.showLogo,footerText:s.footerText,terms:s.termsConditions}),T({type:"success",text:"Invoice settings saved successfully!"}),setTimeout(()=>T(null),3e3)}catch(j){T({type:"error",text:j.message||"Failed to save invoice settings"})}finally{N(!1)}};if(t)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading invoice settings..."})]})});const k=[{id:"MODERN",name:"Modern",preview:"📄"},{id:"CLASSIC",name:"Classic",preview:"📋"},{id:"MINIMAL",name:"Minimal",preview:"📝"}];return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(ws,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Advanced Template Configuration"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Access the full template customization system with 70+ configuration options for invoices and release notes"}),e.jsxs("ul",{className:"text-xs text-gray-600 space-y-1 mb-4",children:[e.jsx("li",{children:"• Company branding & logo upload"}),e.jsx("li",{children:"• Invoice & release note layouts"}),e.jsx("li",{children:"• Custom colors, fonts & styling"}),e.jsx("li",{children:"• Print settings & localization"})]}),e.jsxs(xs,{to:"/settings/templates",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:["Open Template Settings",e.jsx(Mt,{className:"h-4 w-4"})]})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Invoice & Templates"}),e.jsx("p",{className:"text-gray-600",children:"Customize invoice appearance and branding"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[r&&e.jsx("div",{className:`text-sm ${r.type==="success"?"text-green-600":"text-red-600"}`,children:r.text}),e.jsx("button",{onClick:h,disabled:n,className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Saving...":"Save Changes"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice Template"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:k.map(j=>e.jsxs("div",{onClick:()=>b(y=>({...y,templateType:j.id})),className:`border-2 rounded-lg p-6 cursor-pointer transition-all ${s.templateType===j.id?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-primary-300"}`,children:[e.jsx("div",{className:"text-4xl text-center mb-2",children:j.preview}),e.jsx("div",{className:"text-center font-medium",children:j.name}),s.templateType===j.id&&e.jsx("div",{className:"text-center mt-2",children:e.jsx(ge,{className:"h-5 w-5 text-primary-600 mx-auto"})})]},j.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Brand Colors"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"color",value:s.primaryColor,onChange:j=>b(y=>({...y,primaryColor:j.target.value})),className:"h-10 w-20 rounded border border-gray-300"}),e.jsx("input",{type:"text",value:s.primaryColor,onChange:j=>b(y=>({...y,primaryColor:j.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"color",value:s.secondaryColor,onChange:j=>b(y=>({...y,secondaryColor:j.target.value})),className:"h-10 w-20 rounded border border-gray-300"}),e.jsx("input",{type:"text",value:s.secondaryColor,onChange:j=>b(y=>({...y,secondaryColor:j.target.value})),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Prefix"}),e.jsx("input",{type:"text",value:s.invoicePrefix,onChange:j=>b(y=>({...y,invoicePrefix:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Number"}),e.jsx("input",{type:"number",value:s.invoiceStartNumber,onChange:j=>b(y=>({...y,invoiceStartNumber:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsx("div",{className:"mt-6 space-y-4",children:[{key:"showLogo",label:"Show Company Logo"},{key:"showCompanyAddress",label:"Show Company Address"},{key:"showClientDetails",label:"Show Client Details"}].map(j=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s[j.key],onChange:y=>b(g=>({...g,[j.key]:y.target.checked})),className:"h-4 w-4 text-primary-600 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:j.label})]},j.key))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Footer & Terms"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Footer Text"}),e.jsx("input",{type:"text",value:s.footerText,onChange:j=>b(y=>({...y,footerText:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Terms & Conditions"}),e.jsx("textarea",{value:s.termsConditions,onChange:j=>b(y=>({...y,termsConditions:j.target.value})),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Enter your terms and conditions..."})]})]})]}),e.jsx("button",{className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700",children:"Save Invoice Settings"})]})},Ya=()=>{const[s,b]=l.useState("general"),[t,o]=l.useState(null),[n,N]=l.useState([]),[r,T]=l.useState(!0),[v,h]=l.useState(!1),[k,j]=l.useState(null);l.useEffect(()=>{y(),g()},[]);const y=async()=>{try{const a=await Ee.getSettings();o(a)}catch(a){console.error("Failed to load billing settings:",a),j({type:"error",text:"Failed to load billing settings"})}finally{T(!1)}},g=async()=>{try{const a=await Ee.getChargeTypes();N(a)}catch(a){console.error("Failed to load charge types:",a)}},i=async()=>{if(t){if(!t.currency||t.currency.trim()===""){j({type:"error",text:"Currency is required"});return}if(!t.invoicePrefix||t.invoicePrefix.trim()===""){j({type:"error",text:"Invoice prefix is required"});return}if(t.taxRate!==void 0&&(t.taxRate<0||t.taxRate>100)){j({type:"error",text:"Tax rate must be between 0 and 100"});return}if(t.invoiceDueDays!==void 0&&t.invoiceDueDays<0){j({type:"error",text:"Invoice due days must be positive"});return}if(t.gracePeriodDays!==void 0&&t.gracePeriodDays<0){j({type:"error",text:"Grace period days must be positive"});return}if(t.iban&&t.iban.trim()!==""&&!/^[A-Z]{2}[0-9]{2}[A-Z0-9]{1,30}$/.test(t.iban.replace(/\s/g,""))){j({type:"error",text:"Invalid IBAN format"});return}h(!0);try{await Ee.updateSettings(t),j({type:"success",text:"Billing settings updated successfully!"}),setTimeout(()=>j(null),3e3)}catch(a){console.error("Failed to save settings:",a),j({type:"error",text:a.message||"Failed to save billing settings"})}finally{h(!1)}}},m=[{id:"general",name:"General Settings",icon:De},{id:"invoice",name:"Invoice Design",icon:ws},{id:"bank",name:"Bank Details",icon:ls},{id:"terms",name:"Terms & Conditions",icon:we},{id:"charges",name:"Charge Types",icon:De}];return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Billing Settings"}),e.jsx("p",{className:"text-gray-600",children:"Configure storage charges, invoice customization, and payment details"})]}),k&&e.jsx("div",{className:`p-4 rounded-lg ${k.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center",children:[k.type==="success"?e.jsx(ge,{className:"h-5 w-5 mr-2"}):e.jsx(Pe,{className:"h-5 w-5 mr-2"}),k.text]})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:m.map(a=>{const x=a.icon;return e.jsxs("button",{onClick:()=>b(a.id),className:`
                  py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2
                  ${s===a.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx(x,{className:"h-5 w-5"}),a.name]},a.id)})})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[s==="general"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"General Billing Settings"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Currency"}),e.jsx("input",{type:"text",value:t.currency,onChange:a=>o({...t,currency:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"KWD"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Prefix"}),e.jsx("input",{type:"text",value:t.invoicePrefix,onChange:a=>o({...t,invoicePrefix:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"INV"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Rate (%)"}),e.jsx("input",{type:"number",step:"0.01",value:t.taxRate||"",onChange:a=>o({...t,taxRate:parseFloat(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"5.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Due Days"}),e.jsx("input",{type:"number",value:t.invoiceDueDays||"",onChange:a=>o({...t,invoiceDueDays:parseInt(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Grace Period (Days)"}),e.jsx("input",{type:"number",value:t.gracePeriodDays||"",onChange:a=>o({...t,gracePeriodDays:parseInt(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"3"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Days before storage charges apply"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Storage Charge"}),e.jsx("input",{type:"number",step:"0.01",value:t.minimumStorageCharge||"",onChange:a=>o({...t,minimumStorageCharge:parseFloat(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"10.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Storage Rate Type"}),e.jsxs("select",{value:t.storageRateType,onChange:a=>o({...t,storageRateType:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"PER_BOX",children:"Per Box"}),e.jsx("option",{value:"PER_CUBIC_M",children:"Per Cubic Meter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Storage Rate Per Box"}),e.jsx("input",{type:"number",step:"0.001",value:t.storageRatePerBox||"",onChange:a=>o({...t,storageRatePerBox:parseFloat(a.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"0.500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Rate per box per day"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:i,disabled:v,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:v?"Saving...":"Save Settings"})})]}),s==="invoice"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice Design & Layout"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo URL"}),e.jsx("input",{type:"text",value:t.logoUrl||"",onChange:a=>o({...t,logoUrl:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"https://example.com/logo.png"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo Position"}),e.jsxs("select",{value:t.logoPosition,onChange:a=>o({...t,logoPosition:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"LEFT",children:"Left"}),e.jsx("option",{value:"CENTER",children:"Center"}),e.jsx("option",{value:"RIGHT",children:"Right"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:t.showCompanyStamp,onChange:a=>o({...t,showCompanyStamp:a.target.checked}),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{children:"Show Company Stamp"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:t.primaryColor||"#1E40AF",onChange:a=>o({...t,primaryColor:a.target.value}),className:"h-10 w-20 rounded border border-gray-300"}),e.jsx("input",{type:"text",value:t.primaryColor||"",onChange:a=>o({...t,primaryColor:a.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"#1E40AF"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:t.secondaryColor||"#64748B",onChange:a=>o({...t,secondaryColor:a.target.value}),className:"h-10 w-20 rounded border border-gray-300"}),e.jsx("input",{type:"text",value:t.secondaryColor||"",onChange:a=>o({...t,secondaryColor:a.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"#64748B"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Registration No."}),e.jsx("input",{type:"text",value:t.taxRegistrationNo||"",onChange:a=>o({...t,taxRegistrationNo:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"123456789"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Registration No."}),e.jsx("input",{type:"text",value:t.companyRegistrationNo||"",onChange:a=>o({...t,companyRegistrationNo:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"CR-123456"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:i,disabled:v,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:v?"Saving...":"Save Settings"})})]}),s==="bank"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Bank Account Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:"These details will be shown on invoices for customer payments"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank Name"}),e.jsx("input",{type:"text",value:t.bankName||"",onChange:a=>o({...t,bankName:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"National Bank of Kuwait"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch Name"}),e.jsx("input",{type:"text",value:t.branchName||"",onChange:a=>o({...t,branchName:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Salmiya Branch"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Name"}),e.jsx("input",{type:"text",value:t.accountName||"",onChange:a=>o({...t,accountName:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Your Company Name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:t.accountNumber||"",onChange:a=>o({...t,accountNumber:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"1234567890"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"IBAN"}),e.jsx("input",{type:"text",value:t.iban||"",onChange:a=>o({...t,iban:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"KW81CBKU0000000000001234560101"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SWIFT Code"}),e.jsx("input",{type:"text",value:t.swiftCode||"",onChange:a=>o({...t,swiftCode:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"CBKUKWKW"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:i,disabled:v,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:v?"Saving...":"Save Settings"})})]}),s==="terms"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Terms & Conditions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customize the text shown on your invoices"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Instructions"}),e.jsx("textarea",{value:t.paymentInstructions||"",onChange:a=>o({...t,paymentInstructions:a.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Please make payment within 10 days of invoice date..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Terms and Conditions"}),e.jsx("textarea",{value:t.termsAndConditions||"",onChange:a=>o({...t,termsAndConditions:a.target.value}),rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:`1. Payment is due within the specified period...
2. Late payments may incur additional charges...
3. All charges are in KWD unless otherwise stated...`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Footer Text"}),e.jsx("input",{type:"text",value:t.footerText||"",onChange:a=>o({...t,footerText:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Thank you for your business"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:i,disabled:v,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:v?"Saving...":"Save Settings"})})]}),s==="charges"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Charge Types"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage custom charges for storage and release"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Add Charge Type"]})]}),e.jsx("div",{className:"space-y-3",children:n.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:border-primary-300",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.name}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.category==="STORAGE"?"bg-blue-100 text-blue-700":a.category==="RELEASE"?"bg-green-100 text-green-700":a.category==="SERVICE"?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-700"}`,children:a.category}),a.isActive?e.jsx(ge,{className:"h-5 w-5 text-green-500"}):e.jsx(Pe,{className:"h-5 w-5 text-gray-400"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{className:"text-gray-700",children:[e.jsxs("strong",{children:[a.rate.toFixed(3)," ",t.currency]})," (",a.calculationType.replace("_"," ").toLowerCase(),")"]}),a.minCharge&&e.jsxs("span",{className:"text-gray-500",children:["Min: ",a.minCharge," ",t.currency]}),a.maxCharge&&e.jsxs("span",{className:"text-gray-500",children:["Max: ",a.maxCharge," ",t.currency]}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${a.isTaxable?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:a.isTaxable?"Taxable":"Non-taxable"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg",children:e.jsx(Ge,{className:"h-5 w-5"})}),e.jsx("button",{className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(qe,{className:"h-5 w-5"})})]})]},a.id))}),n.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(De,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No charge types configured yet"}),e.jsx("p",{className:"text-sm",children:"Add your first charge type to get started"})]})]})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-red-600",children:"Failed to load billing settings"})})},Za=()=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Integrations"}),e.jsx("p",{className:"text-gray-600",children:"Connect third-party services and APIs"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(xt,{className:"h-6 w-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"WhatsApp Business API"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Send job updates and notifications via WhatsApp"})]})]}),e.jsx("button",{className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Configure"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Key"}),e.jsx("input",{type:"password",placeholder:"Enter WhatsApp API key",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",placeholder:"+965 XXXX XXXX",className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(vs,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"SMTP configuration for email alerts"})]})]}),e.jsx("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:"Connected"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($t,{className:"h-6 w-6 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"SMS Gateway"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Send SMS notifications to customers"})]})]}),e.jsx("button",{className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Connect"})]})})]}),lt={STORAGE:"bg-blue-100 text-blue-800",MATERIALS:"bg-green-100 text-green-800",EQUIPMENT:"bg-purple-100 text-purple-800"},er={ACTIVE:"bg-green-100 text-green-800",MAINTENANCE:"bg-yellow-100 text-yellow-800",INACTIVE:"bg-red-100 text-red-800"},sr=()=>{const[s,b]=l.useState([]),[t,o]=l.useState([]),[n,N]=l.useState(!0),[r,T]=l.useState(!1),[v,h]=l.useState(!1),[k,j]=l.useState(null),[y,g]=l.useState({code:"",location:"",rackType:"STORAGE",capacityTotal:100}),[i,m]=l.useState({fieldName:"",fieldType:"TEXT",fieldOptions:[""],isRequired:!1,section:"SHIPMENT"});l.useEffect(()=>{a()},[]);const a=async()=>{try{N(!0);const[E,P]=await Promise.all([Re.getAll(),cs.getAll()]),J=E.racks.map(V=>({id:V.id,code:V.code,location:V.location||"",type:V.rackType,capacity:V.capacityTotal,currentLoad:V.capacityUsed,qrCode:V.qrCode,status:V.status})),F=P.customFields||P,K=(Array.isArray(F)?F:[]).map(V=>({id:V.id,name:V.fieldName,type:V.fieldType,options:V.fieldOptions||void 0,required:V.isRequired,section:V.section,order:1}));b(J),o(K)}catch(E){console.error("Failed to load data:",E),alert("Failed to load racks and custom fields")}finally{N(!1)}},x=E=>Math.round(E.currentLoad/E.capacity*100),d=E=>E>=90?"bg-red-500":E>=70?"bg-yellow-500":"bg-green-500",c=async()=>{try{if(!y.code||!y.location){alert("Please fill in all required fields");return}const E=await Re.create(y),P={id:E.rack.id,code:E.rack.code,location:E.rack.location||"",type:E.rack.rackType,capacity:E.rack.capacityTotal,currentLoad:E.rack.capacityUsed,qrCode:E.rack.qrCode,status:E.rack.status};b([...s,P]),g({code:"",location:"",rackType:"STORAGE",capacityTotal:100}),T(!1)}catch(E){console.error("Failed to create rack:",E),alert(E.message||"Failed to create rack")}},R=async()=>{try{if(!i.fieldName){alert("Please provide a field name");return}const E={...i,fieldOptions:i.fieldType==="DROPDOWN"?i.fieldOptions.filter(J=>J.trim()):null};console.log("Creating field with data:",E);const P=await cs.create(E);console.log("API Response:",P),await a(),m({fieldName:"",fieldType:"TEXT",fieldOptions:[""],isRequired:!1,section:"SHIPMENT"}),h(!1),alert("Custom field added successfully!")}catch(E){console.error("Failed to create custom field:",E),alert(E.message||"Failed to create custom field")}},u=async E=>{if(confirm("Are you sure you want to delete this rack?"))try{await Re.delete(E),b(s.filter(P=>P.id!==E))}catch(P){console.error("Failed to delete rack:",P),alert(P.message||"Failed to delete rack")}},C=async E=>{if(confirm("Are you sure you want to delete this custom field?"))try{await cs.delete(E),o(t.filter(P=>P.id!==E))}catch(P){console.error("Failed to delete custom field:",P),alert(P.message||"Failed to delete custom field")}},A=E=>{j(E),m({fieldName:E.name,fieldType:E.type,fieldOptions:E.options||[""],isRequired:E.required,section:E.section}),h(!0)},w=async()=>{if(k)try{if(!i.fieldName){alert("Please provide a field name");return}const E={fieldName:i.fieldName,fieldType:i.fieldType,fieldOptions:i.fieldType==="DROPDOWN"?i.fieldOptions.filter(J=>J.trim()):null,isRequired:i.isRequired,section:i.section},P=await cs.update(k.id,E);console.log("Update response:",P),await a(),m({fieldName:"",fieldType:"TEXT",fieldOptions:[""],isRequired:!1,section:"SHIPMENT"}),j(null),h(!1),alert("Custom field updated successfully!")}catch(E){console.error("Failed to update custom field:",E),alert(E.message||"Failed to update custom field")}},p=()=>{j(null),m({fieldName:"",fieldType:"TEXT",fieldOptions:[""],isRequired:!1,section:"SHIPMENT"}),h(!1)},f=E=>{const P={priority:{fieldName:"Priority Level",fieldType:"DROPDOWN",fieldOptions:["Low","Medium","High","Urgent"],isRequired:!1,section:"SHIPMENT"},insurance:{fieldName:"Insurance Value",fieldType:"NUMBER",fieldOptions:[""],isRequired:!0,section:"SHIPMENT"},customerType:{fieldName:"Customer Type",fieldType:"DROPDOWN",fieldOptions:["Individual","Corporate","Government"],isRequired:!1,section:"JOB"},deliveryInstructions:{fieldName:"Delivery Instructions",fieldType:"TEXT",fieldOptions:[""],isRequired:!1,section:"SHIPMENT"},fragile:{fieldName:"Fragile Item",fieldType:"CHECKBOX",fieldOptions:[""],isRequired:!1,section:"SHIPMENT"}};P[E]&&m(P[E])},D=()=>{m(E=>({...E,fieldOptions:[...E.fieldOptions,""]}))},L=(E,P)=>{m(J=>({...J,fieldOptions:J.fieldOptions.map((F,z)=>z===E?P:F)}))},q=E=>{m(P=>({...P,fieldOptions:P.fieldOptions.filter((J,F)=>F!==E)}))};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading system settings..."})]})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"System Configuration"}),e.jsx("p",{className:"text-gray-600",children:"Configure racks, custom fields, and operational settings"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Bt,{className:"h-6 w-6 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Warehouse Layout"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Total Capacity: ",s.reduce((E,P)=>E+P.capacity,0)," units"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6",children:[s.map(E=>{const P=x(E);return e.jsx("div",{className:`relative border-2 rounded-lg p-4 transition-all hover:shadow-md ${E.status==="ACTIVE"?"border-green-200 bg-green-50":E.status==="MAINTENANCE"?"border-yellow-200 bg-yellow-50":"border-red-200 bg-red-50"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:E.code}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:E.location}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:E.currentLoad}),e.jsx("span",{children:E.capacity})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${d(P)}`,style:{width:`${P}%`}})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[P,"%"]})]}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full mt-2 ${lt[E.type]}`,children:E.type})]})},E.id)}),e.jsx("div",{onClick:()=>T(!0),className:"border-2 border-dashed border-gray-300 rounded-lg p-4 flex items-center justify-center cursor-pointer hover:border-primary-400 hover:bg-primary-50 transition-all",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Oe,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Add Rack"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ie,{className:"h-6 w-6 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Rack Management"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{children:"Print QR Codes"})]}),e.jsxs("button",{onClick:()=>T(!0),className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors flex items-center space-x-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Rack"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rack"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Capacity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"QR Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(E=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-gray-900",children:E.code})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:E.location}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${lt[E.type]}`,children:E.type})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[E.currentLoad," / ",E.capacity]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${er[E.status]}`,children:E.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-500 font-mono",children:E.qrCode})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"text-green-600 hover:text-green-900",title:"Print QR Code",children:e.jsx(Be,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>u(E.id),className:"text-red-600 hover:text-red-900",title:"Delete Rack",children:e.jsx(qe,{className:"h-4 w-4"})})]})})]},E.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Es,{className:"h-6 w-6 text-primary-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Custom Fields"})]}),e.jsxs("button",{onClick:()=>{j(null),h(!0)},className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors flex items-center space-x-2",children:[e.jsx(Ot,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Field"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:t.filter(E=>E.section==="SHIPMENT").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Shipment Fields"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.filter(E=>E.section==="JOB").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Job Fields"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.filter(E=>E.section==="EXPENSE").length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Expense Fields"})]})]}),["SHIPMENT","JOB","EXPENSE"].map(E=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:[E," Fields"]}),e.jsx("div",{className:"space-y-2",children:t.filter(P=>P.section===E).sort((P,J)=>P.order-J.order).map(P=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"font-medium text-gray-900",children:P.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",P.type,")"]}),P.required&&e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded",children:"Required"})]}),P.options&&e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Options: ",P.options.join(", ")]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>A(P),className:"text-blue-600 hover:text-blue-900",title:"Edit Field",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:()=>C(P.id),className:"text-red-600 hover:text-red-900",title:"Delete Field",children:e.jsx(qe,{className:"h-4 w-4"})})]})]},P.id))})]},E))]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Rack"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rack Code"}),e.jsx("input",{type:"text",value:y.code,onChange:E=>g(P=>({...P,code:E.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"e.g., A1, B2, C3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),e.jsx("input",{type:"text",value:y.location,onChange:E=>g(P=>({...P,location:E.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"e.g., Section A - Row 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{value:y.rackType,onChange:E=>g(P=>({...P,rackType:E.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"STORAGE",children:"Storage"}),e.jsx("option",{value:"MATERIALS",children:"Materials"}),e.jsx("option",{value:"EQUIPMENT",children:"Equipment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Capacity"}),e.jsx("input",{type:"number",value:y.capacityTotal,onChange:E=>g(P=>({...P,capacityTotal:parseInt(E.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",min:"1"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:c,className:"flex-1 bg-primary-600 text-white py-2 px-4 rounded-lg hover:bg-primary-700 transition-colors",children:"Add Rack"}),e.jsx("button",{onClick:()=>T(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md max-h-96 overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:k?"Edit Custom Field":"Add Custom Field"}),!k&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Quick Templates:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>f("priority"),className:"text-xs bg-white px-2 py-1 rounded border border-blue-300 hover:bg-blue-100",children:"Priority Level"}),e.jsx("button",{onClick:()=>f("insurance"),className:"text-xs bg-white px-2 py-1 rounded border border-blue-300 hover:bg-blue-100",children:"Insurance Value"}),e.jsx("button",{onClick:()=>f("customerType"),className:"text-xs bg-white px-2 py-1 rounded border border-blue-300 hover:bg-blue-100",children:"Customer Type"}),e.jsx("button",{onClick:()=>f("deliveryInstructions"),className:"text-xs bg-white px-2 py-1 rounded border border-blue-300 hover:bg-blue-100",children:"Delivery Instructions"}),e.jsx("button",{onClick:()=>f("fragile"),className:"text-xs bg-white px-2 py-1 rounded border border-blue-300 hover:bg-blue-100",children:"Fragile Item"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Field Name"}),e.jsx("input",{type:"text",value:i.fieldName,onChange:E=>m(P=>({...P,fieldName:E.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:"e.g., Priority Level"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Field Type"}),e.jsxs("select",{value:i.fieldType,onChange:E=>m(P=>({...P,fieldType:E.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"TEXT",children:"Text"}),e.jsx("option",{value:"NUMBER",children:"Number"}),e.jsx("option",{value:"DATE",children:"Date"}),e.jsx("option",{value:"DROPDOWN",children:"Dropdown"}),e.jsx("option",{value:"CHECKBOX",children:"Checkbox"})]})]}),i.fieldType==="DROPDOWN"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Options"}),i.fieldOptions.map((E,P)=>e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"text",value:E,onChange:J=>L(P,J.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:`Option ${P+1}`}),i.fieldOptions.length>1&&e.jsx("button",{onClick:()=>q(P),className:"text-red-600 hover:text-red-800",children:e.jsx(Te,{className:"h-4 w-4"})})]},P)),e.jsx("button",{onClick:D,className:"text-primary-600 hover:text-primary-800 text-sm",children:"+ Add Option"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Section"}),e.jsxs("select",{value:i.section,onChange:E=>m(P=>({...P,section:E.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"SHIPMENT",children:"Shipment"}),e.jsx("option",{value:"JOB",children:"Moving Job"}),e.jsx("option",{value:"EXPENSE",children:"Expense"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"required",checked:i.isRequired,onChange:E=>m(P=>({...P,isRequired:E.target.checked})),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"required",className:"ml-2 text-sm text-gray-700",children:"Required field"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:k?w:R,className:"flex-1 bg-primary-600 text-white py-2 px-4 rounded-lg hover:bg-primary-700 transition-colors",children:k?"Update Field":"Add Field"}),e.jsx("button",{onClick:p,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"})]})]})})]})},tr=()=>e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Security & Access"}),e.jsx("p",{className:"text-gray-600",children:"Manage authentication and security settings"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Password Policy"}),e.jsx("div",{className:"space-y-3",children:["Minimum 8 characters","Require uppercase letters","Require numbers","Require special characters"].map((s,b)=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-4 w-4 text-primary-600 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s})]},b))})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add an extra layer of security"})]}),e.jsx("button",{className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700",children:"Enable"})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Session Management"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Timeout (minutes)"}),e.jsx("input",{type:"number",defaultValue:30,className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),ar=()=>{const[s,b]=l.useState({email:{},sms:{},push:{}}),[t,o]=l.useState(!0),[n,N]=l.useState(!1),[r,T]=l.useState(null);l.useEffect(()=>{v()},[]);const v=async()=>{try{const k=await at.get();b(k.preferences)}catch(k){console.error("Failed to load preferences:",k),T({type:"error",text:"Failed to load notification preferences"})}finally{o(!1)}},h=async()=>{N(!0),T(null);try{await at.update(s),T({type:"success",text:"Notification preferences saved successfully!"}),setTimeout(()=>T(null),3e3)}catch(k){T({type:"error",text:k.message||"Failed to save notification preferences"})}finally{N(!1)}};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading notification settings..."})]})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Notification Settings"}),e.jsx("p",{className:"text-gray-600",children:"Configure how and when you receive notifications"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[r&&e.jsxs("div",{className:`flex items-center ${r.type==="success"?"text-green-600":"text-red-600"}`,children:[r.type==="success"&&e.jsx(ge,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"text-sm",children:r.text})]}),e.jsx("button",{onClick:h,disabled:n,className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Saving...":"Save Preferences"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Notifications"}),e.jsx("div",{className:"space-y-3",children:[{label:"New shipment arrival",desc:"Get notified when new shipments arrive"},{label:"Job assignments",desc:"Notifications for new job assignments"},{label:"Expense approvals",desc:"Alerts for expense approval requests"},{label:"System updates",desc:"Important system updates and maintenance"}].map((k,j)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:k.label}),e.jsx("div",{className:"text-sm text-gray-500",children:k.desc})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"})]})]},j))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"WhatsApp Notifications"}),e.jsx("div",{className:"space-y-3",children:["Job updates","Schedule changes","Emergency alerts"].map((k,j)=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"h-4 w-4 text-primary-600 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:k})]},j))})]})]})},rr=()=>{const[s,b]=l.useState(null),[t,o]=l.useState(!0),[n,N]=l.useState(!1),[r,T]=l.useState(!1),[v,h]=l.useState(null);l.useEffect(()=>{k()},[]);const k=async()=>{o(!0);try{const i=await fetch("/api/shipment-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!i.ok)throw new Error("Failed to load settings");const m=await i.json();b(m.settings)}catch(i){h({type:"error",text:i.message})}finally{o(!1)}},j=async()=>{if(s){N(!0),h(null);try{const i=await fetch("/api/shipment-settings",{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(!i.ok)throw new Error("Failed to save settings");const m=await i.json();b(m.settings),h({type:"success",text:"Settings saved successfully!"}),setTimeout(()=>h(null),3e3)}catch(i){h({type:"error",text:i.message})}finally{N(!1)}}},y=async()=>{if(confirm("Are you sure you want to reset all shipment settings to defaults? This cannot be undone.")){T(!0),h(null);try{const i=await fetch("/api/shipment-settings/reset",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!i.ok)throw new Error("Failed to reset settings");const m=await i.json();b(m.settings),h({type:"success",text:"Settings reset to defaults successfully!"}),setTimeout(()=>h(null),3e3)}catch(i){h({type:"error",text:i.message})}finally{T(!1)}}},g=(i,m)=>{s&&b({...s,[i]:m})};return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Shipment Configuration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure shipment intake, storage, and release workflows"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:y,disabled:r||n,className:"px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),r?"Resetting...":"Reset to Defaults"]}),e.jsxs("button",{onClick:j,disabled:n||r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),n?"Saving...":"Save Changes"]})]})]}),v&&e.jsx("div",{className:`p-4 rounded-lg ${v.type==="success"?"bg-green-50 text-green-800":"bg-red-50 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[v.type==="success"?e.jsx(ge,{className:"h-5 w-5"}):e.jsx(Pe,{className:"h-5 w-5"}),e.jsx("span",{children:v.text})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Me,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Intake Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure required fields during shipment creation"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Client Email"}),e.jsx("input",{type:"checkbox",checked:s.requireClientEmail,onChange:i=>g("requireClientEmail",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Client Phone"}),e.jsx("input",{type:"checkbox",checked:s.requireClientPhone,onChange:i=>g("requireClientPhone",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Estimated Value"}),e.jsx("input",{type:"checkbox",checked:s.requireEstimatedValue,onChange:i=>g("requireEstimatedValue",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Photos"}),e.jsx("input",{type:"checkbox",checked:s.requirePhotos,onChange:i=>g("requirePhotos",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Auto-generate QR Code"}),e.jsx("input",{type:"checkbox",checked:s.autoGenerateQR,onChange:i=>g("autoGenerateQR",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"QR Code Prefix"}),e.jsx("input",{type:"text",value:s.qrCodePrefix,onChange:i=>g("qrCodePrefix",i.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",placeholder:"SHP"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Storage Type"}),e.jsxs("select",{value:s.defaultStorageType,onChange:i=>g("defaultStorageType",i.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"PERSONAL",children:"Personal"}),e.jsx("option",{value:"COMMERCIAL",children:"Commercial"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(we,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Intake Form Fields"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Customize which fields appear and are required in shipment intake form"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Basic Information Fields"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Client Address"}),e.jsx("input",{type:"checkbox",checked:s.showClientAddress!==!1,onChange:i=>g("showClientAddress",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]}),s.showClientAddress!==!1&&e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s.requireClientAddress===!0,onChange:i=>g("requireClientAddress",i.target.checked),className:"h-3 w-3 text-purple-600 rounded"}),"Make Required"]})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Reference ID"}),e.jsx("input",{type:"checkbox",checked:s.showReferenceId!==!1,onChange:i=>g("showReferenceId",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]}),s.showReferenceId!==!1&&e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s.requireReferenceId===!0,onChange:i=>g("requireReferenceId",i.target.checked),className:"h-3 w-3 text-purple-600 rounded"}),"Make Required"]})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Description"}),e.jsx("input",{type:"checkbox",checked:s.showDescription!==!1,onChange:i=>g("showDescription",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]}),s.showDescription!==!1&&e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s.requireDescription===!0,onChange:i=>g("requireDescription",i.target.checked),className:"h-3 w-3 text-purple-600 rounded"}),"Make Required"]})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Notes"}),e.jsx("input",{type:"checkbox",checked:s.showNotes!==!1,onChange:i=>g("showNotes",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]}),s.showNotes!==!1&&e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s.requireNotes===!0,onChange:i=>g("requireNotes",i.target.checked),className:"h-3 w-3 text-purple-600 rounded"}),"Make Required"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Warehouse Shipment Fields"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Warehouse Mode Toggle"}),e.jsx("input",{type:"checkbox",checked:s.showWarehouseMode!==!1,onChange:i=>g("showWarehouseMode",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]})}),e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Shipper Details"}),e.jsx("input",{type:"checkbox",checked:s.showShipperDetails!==!1,onChange:i=>g("showShipperDetails",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]})}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Weight"}),e.jsx("input",{type:"checkbox",checked:s.showWeight!==!1,onChange:i=>g("showWeight",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]}),s.showWeight!==!1&&e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s.requireWeight===!0,onChange:i=>g("requireWeight",i.target.checked),className:"h-3 w-3 text-purple-600 rounded"}),"Make Required"]})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Dimensions"}),e.jsx("input",{type:"checkbox",checked:s.showDimensions!==!1,onChange:i=>g("showDimensions",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]}),s.showDimensions!==!1&&e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s.requireDimensions===!0,onChange:i=>g("requireDimensions",i.target.checked),className:"h-3 w-3 text-purple-600 rounded"}),"Make Required"]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Storage Assignment Fields"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Estimated Storage Days"}),e.jsx("input",{type:"checkbox",checked:s.showEstimatedDays!==!1,onChange:i=>g("showEstimatedDays",i.target.checked),className:"h-4 w-4 text-purple-600 rounded"})]}),s.showEstimatedDays!==!1&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:s.requireEstimatedDays===!0,onChange:i=>g("requireEstimatedDays",i.target.checked),className:"h-3 w-3 text-purple-600 rounded"}),"Make Required"]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Default Value (days)"}),e.jsx("input",{type:"number",value:s.defaultEstimatedDays||30,onChange:i=>g("defaultEstimatedDays",parseInt(i.target.value)),className:"w-full mt-1 px-2 py-1 text-sm border border-gray-300 rounded",min:"1"})]})]})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:e.jsx(mt,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Storage Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure rack assignment and capacity alerts"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Allow Multiple Racks"}),e.jsx("input",{type:"checkbox",checked:s.allowMultipleRacks,onChange:i=>g("allowMultipleRacks",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Rack Assignment"}),e.jsx("input",{type:"checkbox",checked:s.requireRackAssignment,onChange:i=>g("requireRackAssignment",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Auto-assign Rack"}),e.jsx("input",{type:"checkbox",checked:s.autoAssignRack,onChange:i=>g("autoAssignRack",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Low Capacity Alerts"}),e.jsx("input",{type:"checkbox",checked:s.notifyOnLowCapacity,onChange:i=>g("notifyOnLowCapacity",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Low Capacity Threshold: ",s.lowCapacityThreshold,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:s.lowCapacityThreshold,onChange:i=>g("lowCapacityThreshold",parseInt(i.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Hs,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Release Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure release approval and documentation requirements"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Release Approval"}),e.jsx("input",{type:"checkbox",checked:s.requireReleaseApproval,onChange:i=>g("requireReleaseApproval",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Approver Role"}),e.jsxs("select",{value:s.releaseApproverRole,onChange:i=>g("releaseApproverRole",i.target.value),disabled:!s.requireReleaseApproval,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",children:[e.jsx("option",{value:"MANAGER",children:"Manager"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Release Photos"}),e.jsx("input",{type:"checkbox",checked:s.requireReleasePhotos,onChange:i=>g("requireReleasePhotos",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require ID Verification"}),e.jsx("input",{type:"checkbox",checked:s.requireIDVerification,onChange:i=>g("requireIDVerification",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Generate Release Invoice"}),e.jsx("input",{type:"checkbox",checked:s.generateReleaseInvoice,onChange:i=>g("generateReleaseInvoice",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Auto-send Invoice Email"}),e.jsx("input",{type:"checkbox",checked:s.autoSendInvoiceEmail,onChange:i=>g("autoSendInvoiceEmail",i.target.checked),disabled:!s.generateReleaseInvoice,className:"h-5 w-5 text-blue-600 rounded disabled:opacity-50"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Release Signature"}),e.jsx("input",{type:"checkbox",checked:s.requireReleaseSignature,onChange:i=>g("requireReleaseSignature",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Collector ID"}),e.jsx("input",{type:"checkbox",checked:s.requireCollectorID,onChange:i=>g("requireCollectorID",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Allow Proxy Collection"}),e.jsx("input",{type:"checkbox",checked:s.allowProxyCollection,onChange:i=>g("allowProxyCollection",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(ls,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Pricing Configuration"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure storage and release charges"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Storage Rate per Day (KWD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.storageRatePerDay,onChange:i=>g("storageRatePerDay",parseFloat(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Storage Rate per Box (KWD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.storageRatePerBox,onChange:i=>g("storageRatePerBox",parseFloat(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Charge Partial Day"}),e.jsx("input",{type:"checkbox",checked:s.chargePartialDay,onChange:i=>g("chargePartialDay",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Charge Days"}),e.jsx("input",{type:"number",min:"0",value:s.minimumChargeDays,onChange:i=>g("minimumChargeDays",parseInt(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Release Handling Fee (KWD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.releaseHandlingFee,onChange:i=>g("releaseHandlingFee",parseFloat(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Release Per-Box Fee (KWD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.releasePerBoxFee,onChange:i=>g("releasePerBoxFee",parseFloat(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Release Transport Fee (KWD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.releaseTransportFee,onChange:i=>g("releaseTransportFee",parseFloat(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Hs,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Partial Release Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure partial release workflow"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Allow Partial Release"}),e.jsx("input",{type:"checkbox",checked:s.allowPartialRelease,onChange:i=>g("allowPartialRelease",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Boxes per Release"}),e.jsx("input",{type:"number",min:"1",value:s.partialReleaseMinBoxes,onChange:i=>g("partialReleaseMinBoxes",parseInt(i.target.value)),disabled:!s.allowPartialRelease,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Require Partial Approval"}),e.jsx("input",{type:"checkbox",checked:s.requirePartialApproval,onChange:i=>g("requirePartialApproval",i.target.checked),disabled:!s.allowPartialRelease,className:"h-5 w-5 text-blue-600 rounded disabled:opacity-50"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(zs,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notification Settings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Configure client and staff notifications"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Notify Client on Intake"}),e.jsx("input",{type:"checkbox",checked:s.notifyClientOnIntake,onChange:i=>g("notifyClientOnIntake",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Notify Client on Release"}),e.jsx("input",{type:"checkbox",checked:s.notifyClientOnRelease,onChange:i=>g("notifyClientOnRelease",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Storage Alert Notifications"}),e.jsx("input",{type:"checkbox",checked:s.notifyOnStorageAlert,onChange:i=>g("notifyOnStorageAlert",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]}),e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Storage Alert After (Days)"}),e.jsx("input",{type:"number",min:"1",value:s.storageAlertDays,onChange:i=>g("storageAlertDays",parseInt(i.target.value)),disabled:!s.notifyOnStorageAlert,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{className:"text-gray-700",children:"Enable Custom Fields"}),e.jsx("input",{type:"checkbox",checked:s.enableCustomFields,onChange:i=>g("enableCustomFields",i.target.checked),className:"h-5 w-5 text-blue-600 rounded"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 sticky bottom-0 bg-white p-4 border-t border-gray-200 -mx-6 -mb-6",children:[e.jsxs("button",{onClick:y,disabled:r||n,className:"px-6 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),r?"Resetting...":"Reset to Defaults"]}),e.jsxs("button",{onClick:j,disabled:n||r,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),n?"Saving...":"Save Changes"]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Pe,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Failed to load settings"}),e.jsx("button",{onClick:k,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]})},lr=[{id:"company",name:"Company & Branding",icon:ze,path:"company",description:"Company details, logo, colors, and branding settings"},{id:"company-profiles",name:"Company Profiles",icon:ss,path:"company-profiles",description:"Manage customer/vendor profiles (DIOR, JAZEERA, etc.)"},{id:"users",name:"User Management",icon:ss,path:"users",description:"Manage team members, roles, and permissions"},{id:"invoice",name:"Invoice & Templates",icon:we,path:"invoice",description:"Customize invoice templates, branding, and layouts"},{id:"billing",name:"Billing & Rates",icon:De,path:"billing",description:"Storage rates, payment methods, and subscription"},{id:"integrations",name:"Integrations",icon:xt,path:"integrations",description:"WhatsApp, SMS, email, and third-party connections"},{id:"shipment",name:"Shipment Configuration",icon:Me,path:"shipment",description:"Configure shipment intake, storage, release workflows, and pricing"},{id:"system",name:"System Configuration",icon:rs,path:"system",description:"Racks setup, custom fields, and operational settings"},{id:"security",name:"Security & Access",icon:Fs,path:"security",description:"Authentication, permissions, and security policies"},{id:"notifications",name:"Notifications",icon:zs,path:"notifications",description:"Alert preferences, email notifications, and messaging"}],nr=()=>{const[s,b]=l.useState("company");return e.jsxs("div",{className:"flex h-full bg-gray-50",children:[e.jsxs("div",{className:"w-80 bg-white shadow-lg border-r border-gray-200 overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:e.jsx(mt,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure your warehouse system"})]})]})}),e.jsx("nav",{className:"p-4 space-y-2",children:lr.map(t=>{const o=t.icon,n=s===t.id;return e.jsx("button",{onClick:()=>b(t.id),className:`
                  w-full text-left p-4 rounded-lg transition-all duration-200
                  ${n?"bg-primary-50 border border-primary-200 text-primary-700":"hover:bg-gray-50 text-gray-700 border border-transparent"}
                `,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(o,{className:`h-5 w-5 mt-0.5 flex-shrink-0 ${n?"text-primary-600":"text-gray-400"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium ${n?"text-primary-900":"text-gray-900"}`,children:t.name}),e.jsx("p",{className:`text-sm mt-1 ${n?"text-primary-600":"text-gray-500"}`,children:t.description})]})]})},t.id)})}),e.jsxs("div",{className:"p-4 mt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Quick Stats"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Total Users"}),e.jsx("span",{className:"font-medium text-gray-900",children:"12"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Active Racks"}),e.jsx("span",{className:"font-medium text-gray-900",children:"48"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Monthly Revenue"}),e.jsx("span",{className:"font-medium text-gray-900",children:"2,450 KWD"})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-8",children:[s==="company"&&e.jsx(Ga,{}),s==="company-profiles"&&e.jsx(Ha,{}),s==="users"&&e.jsx(Qa,{}),s==="invoice"&&e.jsx(Xa,{}),s==="billing"&&e.jsx(Ya,{}),s==="integrations"&&e.jsx(Za,{}),s==="shipment"&&e.jsx(rr,{}),s==="system"&&e.jsx(sr,{}),s==="security"&&e.jsx(tr,{}),s==="notifications"&&e.jsx(ar,{})]})})]})},or=()=>{const[s,b]=l.useState(!1),[t,o]=l.useState(null),[n,N]=l.useState(""),[r,T]=l.useState(!1),[v,h]=l.useState([]),[k,j]=l.useState(null),[y,g]=l.useState(0),[i,m]=l.useState(0),a=l.useRef(null),x="qr-reader",[d,c]=l.useState("scanner"),[R,u]=l.useState([]),[C,A]=l.useState([]),[w,p]=l.useState([]),[f,D]=l.useState(null),[L,q]=l.useState(!1),[E,P]=l.useState(!1),[J,F]=l.useState(null),[z,K]=l.useState(0),[V,S]=l.useState(0),[O,M]=l.useState([]);l.useEffect(()=>()=>{a.current&&a.current.stop().catch(console.error)},[]);const H=async()=>{var G,$,Y,te,xe,pe,le,ye,fe,ke,Ke,Le,ts,Ss;try{N("");const Z=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",I=window.location.protocol==="https:",B=window.isSecureContext||I||Z,U=window.location.href;if(console.log("🔒 Camera Security Check:",{isSecureContext:B,isLocalhost:Z,isHttps:I,protocol:window.location.protocol,hostname:window.location.hostname,url:U,mediaDevices:!!navigator.mediaDevices,getUserMedia:!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}),!B&&window.location.protocol==="http:"&&!Z){const X=U.replace("http://","https://");throw new Error(`🔒 Camera requires HTTPS. Redirecting to: ${X}`)}if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera API not available. Your browser or connection does not support camera access. Please use HTTPS (https://qgocargo.cloud) and a modern browser like Chrome.");b(!0),console.log("⏳ Waiting for DOM to render qr-reader element..."),await new Promise(X=>setTimeout(X,300));let W=document.getElementById(x),ee=0;for(;!W&&ee<5;)console.log(`⏳ Retry ${ee+1}/5: Waiting for qr-reader element...`),await new Promise(X=>setTimeout(X,200)),W=document.getElementById(x),ee++;if(!W)throw console.error("❌ QR reader element not found in DOM after 5 retries"),console.error("DOM body:",document.body.innerHTML.substring(0,500)),new Error("Scanner container not ready after 5 retries. Please refresh and try again.");console.log("✅ QR reader element found:",W);const se=new ca(x);a.current=se,console.log("📹 Requesting camera access..."),console.log("📱 Available constraints:",navigator.mediaDevices.getSupportedConstraints());try{console.log("🔍 Trying camera access with environment facing mode...");const X=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});console.log("✅ Camera access granted:",X.getVideoTracks()),console.log("📹 Video track settings:",X.getVideoTracks()[0].getSettings()),X.getTracks().forEach(ne=>ne.stop())}catch(X){if(console.error("❌ getUserMedia failed:",X),console.error("Error details:",{name:X.name,message:X.message,constraint:X.constraint,stack:X.stack}),X.name==="OverconstrainedError"||X.constraint==="facingMode"){console.log("⚠️ facingMode not supported, trying without constraint...");try{const ne=await navigator.mediaDevices.getUserMedia({video:!0});console.log("✅ Camera access granted (fallback mode)"),ne.getTracks().forEach(oe=>oe.stop())}catch(ne){throw console.error("❌ Fallback also failed:",ne),X}}else throw X}console.log("🚀 Starting html5-qrcode scanner...");const re=[{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}},{facingMode:{ideal:"environment"}},{facingMode:"user"},"environment"];let me=!1,ue=null;for(let X=0;X<re.length;X++)try{console.log(`🔄 Trying camera config ${X+1}/${re.length}:`,re[X]),await se.start(re[X],{fps:10,qrbox:{width:250,height:250},aspectRatio:1},be,()=>{}),console.log(`✅ Scanner started successfully with config ${X+1}`),me=!0;break}catch(ne){console.warn(`⚠️ Config ${X+1} failed:`,ne.message),ue=ne;try{await se.stop()}catch{}}if(!me)throw console.error("❌ All camera configs failed"),ue||new Error("Failed to start scanner with any camera configuration")}catch(Z){console.error("❌ Camera error:",Z),console.error("Error details:",{name:Z.name,message:Z.message,stack:Z.stack,code:Z.code,type:typeof Z,stringified:JSON.stringify(Z,null,2)});let I="❌ Camera access failed",B="Try reloading the page";if((G=Z.message)!=null&&G.includes("HTTPS")||($=Z.message)!=null&&$.includes("https://")||(Y=Z.message)!=null&&Y.includes("Redirecting"))I="🔒 Camera requires HTTPS",B=`Current URL: ${window.location.href}

✅ Use HTTPS: https://qgocargo.cloud

Camera access only works on secure connections (HTTPS).`;else if(Z.name==="NotAllowedError"||(te=Z.message)!=null&&te.includes("Permission denied")||(xe=Z.message)!=null&&xe.includes("permission"))I="❌ Camera permission denied",B=`📱 MOBILE FIX (Android/iPhone):
1. Tap the 🔒 lock icon in the address bar
2. Tap "Permissions" or "Site settings"
3. Find "Camera" → Change to "Allow"
4. Refresh this page

💻 DESKTOP FIX:
Chrome: Click 🔒 → Site settings → Camera → Allow
Safari: Safari menu → Preferences → Websites → Camera → Allow
Firefox: Click 🔒 → Clear permissions → Reload (will ask again)

🔄 Then REFRESH the page!`;else if(Z.name==="NotFoundError"||(pe=Z.message)!=null&&pe.includes("not found")||(le=Z.message)!=null&&le.includes("No camera"))I="❌ No camera detected",B="Make sure your device has a working camera and it's not disabled in system settings.";else if(Z.name==="NotReadableError"||Z.name==="TrackStartError"||(ye=Z.message)!=null&&ye.includes("in use")||(fe=Z.message)!=null&&fe.includes("being used"))I="❌ Camera is busy",B="Close other apps using the camera (WhatsApp, Zoom, Skype, etc.) and try again.";else if(Z.name==="OverconstrainedError"||(ke=Z.message)!=null&&ke.includes("constraint"))I="❌ Camera settings not supported",B="Your camera doesn't support the required settings. Try using a different device or browser.";else if(Z.name==="NotSupportedError"||Z.name==="TypeError"||(Ke=Z.message)!=null&&Ke.includes("not available")||(Le=Z.message)!=null&&Le.includes("not supported"))I="❌ Camera API not supported",B=`Your browser doesn't support camera access.

✅ Recommended:
- Chrome (Desktop/Mobile)
- Safari (iPhone/iPad)
- Edge (Desktop)

🔒 Make sure you're using: https://qgocargo.cloud`;else if((ts=Z.message)!=null&&ts.includes("insecure context")||(Ss=Z.message)!=null&&Ss.includes("secure origin"))I="🔒 Insecure connection",B=`Camera requires HTTPS.

✅ Use: https://qgocargo.cloud
❌ Don't use: http://qgocargo.cloud`;else{const U=Z.message||Z.name||"Unknown error";I=`❌ Camera error: ${Z.name||"Unknown"}`,B=`Error: ${U}

Troubleshooting:
1. Make sure you're using HTTPS: https://qgocargo.cloud
2. Allow camera permissions when prompted
3. Try Chrome browser on mobile
4. Check if camera works in other apps
5. Reload the page and try again`}N(`${I}

💡 Solution:
${B}`),b(!1)}},de=async()=>{if(a.current)try{await a.current.stop(),a.current=null,b(!1)}catch(G){console.error("Scanner stop error:",G)}},be=async G=>{await de(),T(!0);try{const $=await he(G);o($),h(Y=>[$,...Y.slice(0,9)])}catch($){N($.message||"Failed to process scan")}finally{T(!1)}},he=async G=>{var te,xe,pe;if(G.toUpperCase().includes("RACK")||G.match(/^R-[A-Z]-\d+$/i)){const ye=(te=(await Re.getAll({search:G})).racks)==null?void 0:te.find(fe=>fe.code.toUpperCase()===G.toUpperCase());if(ye)return{type:"rack",data:ye,rawCode:G}}if(G.includes("-BOX-")){const le=G.split("-BOX-")[0],fe=(xe=(await $e.getAll({search:le})).shipments)==null?void 0:xe.find(ke=>ke.qrCode&&le.includes(ke.qrCode));if(fe){const Le=(await(await fetch(`/api/shipments/${fe.id}/boxes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json()).boxes.filter(ts=>!ts.rackId).length;return m(Le),{type:"shipment",data:{...fe,remainingBoxes:Le},rawCode:G}}}const Y=(pe=(await $e.getAll({search:G})).shipments)==null?void 0:pe.find(le=>le.referenceId.toUpperCase()===G.toUpperCase());if(Y){const fe=(await(await fetch(`/api/shipments/${Y.id}/boxes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json()).boxes.filter(ke=>!ke.rackId).length;return m(fe),{type:"shipment",data:{...Y,remainingBoxes:fe},rawCode:G}}return{type:"unknown",data:null,rawCode:G}},ve=async()=>{if(!(!k||!t||t.type!=="rack")){if(!y||y<=0){N("Please enter how many boxes to assign");return}if(y>i){N(`Only ${i} boxes remaining!`);return}try{T(!0);const te=(await(await fetch(`/api/shipments/${k.id}/boxes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json()).boxes.filter(xe=>!xe.rackId).slice(0,y).map(xe=>xe.boxNumber);await fetch(`/api/shipments/${k.id}/assign-boxes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({rackId:t.data.id,boxNumbers:te})}),y===i&&await fetch(`/api/shipments/${k.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({status:"IN_STORAGE"})}),alert(`✅ ${y} boxes assigned to ${t.data.code}!
📊 Rack capacity updated. Check Racks page for current status.`),j(null),o(null),g(0),m(0)}catch(G){N(G.message||"Failed to assign")}finally{T(!1)}}},Ne=()=>{o(null),N(""),j(null)},ae=async()=>{try{T(!0),console.log("Loading pending shipments...");const G=localStorage.getItem("authToken"),$=await fetch("/api/shipments",{headers:{Authorization:`Bearer ${G}`,"Content-Type":"application/json"}});if($.ok){const Y=await $.json();console.log("Loaded shipments:",Y);const te=Y.shipments||Y||[],pe=(await Promise.all(te.filter(le=>le.status==="PENDING"||le.status==="PARTIAL").map(async le=>{try{const fe=await(await fetch(`/api/shipments/${le.id}/boxes`,{headers:{Authorization:`Bearer ${G}`}})).json(),ke=fe.boxes.filter(Le=>!Le.rackId).length,Ke=fe.boxes.length;return ke>0?{...le,remainingBoxes:ke,totalBoxes:Ke}:null}catch{return le}}))).filter(le=>le!==null);console.log("Shipments with unassigned boxes (PENDING + PARTIAL):",pe),u(pe),A(pe)}else console.error("Failed to load shipments:",$.status),N(`Failed to load shipments: ${$.status}`)}catch(G){console.error("Error loading shipments:",G),N("Failed to load shipments")}finally{T(!1)}},He=async(G,$)=>{try{T(!0);const xe=(await(await fetch(`/api/shipments/${G.id}/boxes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json()).boxes.filter(fe=>!fe.rackId).length,pe=G.boxesPerPallet||0,le=pe>0?Math.floor(xe/pe):0,ye=pe>0?xe%pe:xe;D({...G,remainingBoxes:xe,totalPallets:le,looseBoxes:ye,boxesPerPallet:pe}),F($),K(le),S(ye),q(!1),P(!0)}catch{N("Failed to load rack/shipment details")}finally{T(!1)}},_e=async G=>{console.log("🎯 Choose Rack clicked for shipment:",G),console.log("📦 Current racks:",w),D(G),q(!0),console.log("✅ Rack selection enabled")},Fe=async()=>{try{console.log("Loading racks...");const G=localStorage.getItem("authToken"),$=await fetch("/api/racks",{headers:{Authorization:`Bearer ${G}`,"Content-Type":"application/json"}});if($.ok){const Y=await $.json();console.log("Loaded racks response:",Y);const te=Y.racks||Y||[];console.log("Racks array:",te),p(Array.isArray(te)?te:[])}else console.error("Failed to load racks:",$.status),p([])}catch(G){console.error("Error loading racks:",G),p([])}},Q=async()=>{if(!(!f||!J))try{T(!0);const G=localStorage.getItem("authToken"),$=f.boxesPerPallet||0,Y=z*$+V;console.log("🎯 Assigning:",{pallets:z,looseBoxes:V,totalBoxes:Y,rack:J.code,shipment:f.referenceId,photos:O.length});let te=[];if(O.length>0){for(const pe of O){const le=new FormData;le.append("photo",pe);const ye=await fetch("/api/shipments/upload/photo",{method:"POST",headers:{Authorization:`Bearer ${G}`},body:le});if(ye.ok){const fe=await ye.json();te.push(fe.photoUrl)}}console.log("📸 Uploaded photos:",te)}const xe=await fetch(`/api/shipments/${f.id}/assign-rack`,{method:"POST",headers:{Authorization:`Bearer ${G}`,"Content-Type":"application/json"},body:JSON.stringify({rackId:J.id,quantity:Y,pallets:z,looseBoxes:V,photos:te})});if(xe.ok)alert(`✅ Successfully assigned ${z} pallets + ${V} boxes to ${J.code}${te.length>0?` with ${te.length} photos`:""}`),P(!1),K(0),S(0),M([]),ae(),Fe();else{const pe=await xe.json();N(pe.message||"Failed to assign boxes to rack")}}catch(G){N(G.message||"Failed to assign boxes to rack")}finally{T(!1)}};return l.useEffect(()=>{d==="list"&&(ae(),Fe())},[d]),e.jsxs("div",{className:"p-6 space-y-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"📱 Warehouse Scanner"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"مسح المستودع | مسح أو بحث يدوي"})]}),e.jsxs("div",{className:"flex gap-2 bg-white rounded-xl p-2 shadow-md border-2 border-gray-200",children:[e.jsxs("button",{onClick:()=>c("scanner"),className:`flex-1 py-4 px-6 rounded-lg font-bold text-lg transition-all ${d==="scanner"?"bg-primary-600 text-white shadow-lg":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["📸 QR Scanner",e.jsx("br",{}),e.jsx("span",{className:"text-sm font-normal",children:"مسح QR | الكاميرا"})]}),e.jsxs("button",{onClick:()=>c("list"),className:`flex-1 py-4 px-6 rounded-lg font-bold text-lg transition-all ${d==="list"?"bg-primary-600 text-white shadow-lg":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:["📋 Pending List + Racks",e.jsx("br",{}),e.jsx("span",{className:"text-sm font-normal",children:"قائمة الانتظار | خريطة الرفوف"})]})]}),n&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 text-red-700 px-6 py-4 rounded-xl flex items-center gap-3",children:[e.jsx(Pe,{className:"h-6 w-6 flex-shrink-0"}),e.jsx("span",{className:"flex-1",children:n}),e.jsx("button",{onClick:()=>N(""),className:"text-red-500 hover:text-red-700 text-xl",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[d==="scanner"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border-2 border-gray-200 overflow-hidden",children:[s&&e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-primary-600 mb-2",children:"📸 Scanning..."}),e.jsx("p",{className:"text-gray-600",children:"ضع رمز الاستجابة السريعة في الإطار"})]}),e.jsx("div",{id:x,className:"mx-auto"}),e.jsx("button",{onClick:de,className:"w-full py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold",children:"Stop Camera / إيقاف الكاميرا"})]}),!s&&!t&&!r&&e.jsxs("div",{className:"p-12 text-center space-y-6",children:[window.location.protocol==="http:"&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border-2 border-red-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("p",{className:"text-red-900 font-bold text-lg",children:"🔒 Camera Requires HTTPS"})]}),e.jsx("p",{className:"text-red-700 mb-3",children:"Camera access only works on secure connections."}),e.jsx("button",{onClick:()=>{const G=window.location.href.replace("http://","https://");window.location.href=G},className:"px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors",children:"✅ Switch to HTTPS Now"})]}),e.jsx("div",{className:"mx-auto w-64 h-64 border-4 border-dashed border-primary-300 rounded-3xl flex items-center justify-center bg-gradient-to-br from-primary-50 to-blue-50",children:e.jsx(Ae,{className:"h-32 w-32 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Ready to Scan"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"جاهز للمسح"}),window.location.protocol==="https:"&&e.jsx("p",{className:"text-green-600 text-sm mt-2",children:"✅ Secure Connection (HTTPS)"})]}),e.jsxs("button",{onClick:H,className:"inline-flex items-center gap-3 px-10 py-5 bg-primary-600 text-white text-xl font-bold rounded-xl hover:bg-primary-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx(hs,{className:"h-7 w-7"}),"Start Camera"]})]}),r&&e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Processing scan..."})]}),t&&!r&&e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(ge,{className:"h-12 w-12 text-green-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-green-900 mb-1",children:"Scan Successful! ✅"}),e.jsx("p",{className:"text-gray-600 font-mono text-lg",children:t.rawCode})]}),t.type==="rack"&&e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ie,{className:"h-8 w-8 text-blue-600"}),e.jsx("h4",{className:"text-xl font-bold text-blue-900",children:"Rack Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Code:"}),e.jsx("p",{className:"font-bold",children:t.data.code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Location:"}),e.jsx("p",{className:"font-bold",children:t.data.location})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Section:"}),e.jsx("p",{className:"font-bold",children:t.data.section})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Capacity:"}),e.jsxs("p",{className:"font-bold",children:[t.data.capacityUsed||0," / ",t.data.capacityTotal||0]})]})]}),k&&e.jsxs("div",{className:"mt-6 pt-6 border-t-2 border-blue-300",children:[e.jsxs("p",{className:"text-blue-900 font-semibold mb-4",children:['📦 Assign "',k.referenceId,'" to this rack?']}),e.jsxs("div",{className:"mb-4 bg-white p-4 rounded-lg border-2 border-blue-300",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"How Many Boxes to Assign? 📦"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",min:"1",max:i,value:y||"",onChange:G=>g(parseInt(G.target.value)||0),placeholder:`Max: ${i} boxes`,className:"flex-1 px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("button",{onClick:()=>g(i),className:"px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold whitespace-nowrap",children:"📦 All"})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-2",children:["💡 Remaining: ",i,' boxes | Enter quantity or click "All" button']})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:ve,disabled:r||!y,className:"flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed font-bold text-lg",children:"✅ Confirm Assignment"}),e.jsx("button",{onClick:()=>{j(null),g(0),m(0)},className:"px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-bold",children:"Cancel"})]})]})]}),t.type==="shipment"&&e.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ye,{className:"h-8 w-8 text-purple-600"}),e.jsx("h4",{className:"text-xl font-bold text-purple-900",children:"Shipment Information"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Reference:"}),e.jsx("p",{className:"font-bold",children:t.data.referenceId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Client:"}),e.jsx("p",{className:"font-bold",children:t.data.clientName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Boxes:"}),e.jsx("p",{className:"font-bold",children:t.data.currentBoxCount})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Remaining:"}),e.jsxs("p",{className:"font-bold text-blue-600",children:[t.data.remainingBoxes||0," 📦"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("p",{className:"font-bold",children:t.data.status})]})]}),(t.data.status==="PENDING"||t.data.remainingBoxes>0)&&e.jsx("div",{className:"mt-6 pt-6 border-t-2 border-purple-300",children:e.jsxs("button",{onClick:()=>{j(t.data),g(t.data.remainingBoxes||0),o(null),H()},className:"w-full py-4 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-bold text-lg",children:["📍 Scan Rack to Assign (",t.data.remainingBoxes," boxes left)"]})})]}),t.type==="unknown"&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-xl p-6 text-center",children:[e.jsx(Pe,{className:"h-12 w-12 text-yellow-600 mx-auto mb-3"}),e.jsx("p",{className:"text-yellow-900 font-semibold text-lg",children:"QR code not found in system"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:Ne,className:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold",children:"Clear"}),e.jsxs("button",{onClick:()=>{o(null),H()},className:"flex-1 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 font-semibold flex items-center justify-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),"Scan Again"]})]})]})]}),!1,d==="list"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border-2 border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b-2 border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"📋 Pending Shipments"}),e.jsx("p",{className:"text-gray-600",children:"الشحنات في انتظار التخزين"})]}),r?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Loading shipments..."})]}):C.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(Ye,{className:"h-24 w-24 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-xl font-semibold",children:"No Pending Shipments"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"لا توجد شحنات في الانتظار"}),e.jsx("p",{className:"text-sm text-gray-400 mt-4",children:"Create a new shipment from Dashboard to see it here"})]}):e.jsx("div",{className:"divide-y-2 divide-gray-200",children:C.map(G=>e.jsxs("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-bold text-primary-600",children:G.referenceId}),e.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${G.status==="PARTIAL"?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800"}`,children:G.status==="PARTIAL"?"🔄 PARTIAL":"⏳ PENDING"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Client:"}),e.jsx("p",{className:"font-semibold text-gray-900",children:G.clientName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Boxes:"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[G.remainingBoxes||0," / ",G.totalBoxes||G.currentBoxCount||0," 📦",G.status==="PARTIAL"&&e.jsxs("span",{className:"text-sm text-orange-600 ml-2",children:["(",G.remainingBoxes," remaining)"]})]})]})]}),G.notes&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["📝 ",G.notes]})]}),e.jsxs("button",{onClick:()=>_e(G),className:"px-8 py-4 bg-primary-600 text-white font-bold rounded-xl hover:bg-primary-700 transition-all shadow-lg hover:shadow-xl text-lg whitespace-nowrap",children:["📍 Choose Rack",e.jsx("br",{}),e.jsx("span",{className:"text-sm font-normal",children:"اختر الرف"})]})]}),L&&(f==null?void 0:f.id)===G.id&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border-2 border-blue-300 rounded-xl",children:[e.jsx("h4",{className:"text-lg font-bold text-blue-900 mb-3",children:"🗺️ Select Rack | اختر الرف"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:w&&w.length>0?w.map($=>e.jsxs("button",{onClick:()=>He(G,$),disabled:$.status==="FULL",className:`
                                  p-3 rounded-lg font-bold text-xs transition-all text-left
                                  ${$.status==="AVAILABLE"?"bg-green-500 hover:bg-green-600 text-white":$.status==="FULL"?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-yellow-500 hover:bg-yellow-600 text-white"}
                                `,children:[e.jsx("div",{className:"font-bold text-sm",children:$.code}),e.jsxs("div",{className:"text-xs opacity-90 mt-1",children:["📦 ",$.capacityUsed||0,"/",$.capacityTotal||0]})]},$.id)):e.jsx("p",{className:"col-span-full text-gray-500 text-center py-4",children:"No racks available"})}),e.jsx("button",{onClick:()=>q(!1),className:"mt-3 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Cancel | إلغاء"})]})]},G.id))}),e.jsx("div",{className:"p-6 bg-gray-50 border-t-2 border-gray-200 text-center",children:e.jsx("button",{onClick:ae,disabled:r,className:"px-6 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 disabled:bg-gray-300 transition-colors",children:"🔄 Refresh List | تحديث القائمة"})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Recent Scans"]}),e.jsx("div",{className:"space-y-2",children:v.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No scans yet"}):v.map((G,$)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50",children:[G.type==="rack"?e.jsx(Ie,{className:"h-5 w-5 text-blue-500 flex-shrink-0"}):G.type==="shipment"?e.jsx(Ye,{className:"h-5 w-5 text-purple-500 flex-shrink-0"}):e.jsx(Ae,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"font-mono text-sm flex-1 truncate",children:G.rawCode})]},$))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-900 mb-3",children:"💡 Tips"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsx("li",{children:"• Scan shipment first"}),e.jsx("li",{children:"• Then scan rack to assign"}),e.jsx("li",{children:"• Keep QR code steady"}),e.jsx("li",{children:"• Good lighting helps"})]})]})]})]}),E&&f&&J&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ge,{className:"h-8 w-8"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Scan Successful! ✅"})]}),e.jsx("p",{className:"text-lg font-semibold",children:J.code})]}),e.jsxs("div",{className:"p-6 bg-blue-50 border-b-2 border-blue-200",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-900 mb-4 flex items-center gap-2",children:"📦 Rack Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Code:"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:J.code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Location:"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:J.location||"Section B, Row 2"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Section:"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:J.section||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Capacity:"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[J.capacityUsed||0," / ",J.capacityTotal||100]})]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-purple-900 mb-2 flex items-center gap-2",children:['📦 Assign "',f.referenceId,'" to this rack?']}),e.jsxs("p",{className:"text-gray-600",children:["Client: ",e.jsx("strong",{children:f.clientName})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 mb-6",children:[e.jsx("h4",{className:"text-lg font-bold text-purple-900 mb-4",children:"📦 How Many to Assign?"}),e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 border-2 border-purple-300",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Available for assignment:"}),e.jsxs("div",{className:"flex items-center gap-6 text-lg",children:[f.totalPallets>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold text-purple-700",children:[f.totalPallets," Pallets"]}),e.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["(",f.boxesPerPallet," boxes each)"]})]}),e.jsx("div",{children:e.jsxs("span",{className:"font-bold text-blue-700",children:[f.looseBoxes," Loose Boxes"]})})]})]}),f.totalPallets>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"🎁 Pallets to Assign:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>K(Math.max(0,z-1)),className:"w-12 h-12 bg-red-500 text-white rounded-lg font-bold text-xl hover:bg-red-600",children:"−"}),e.jsx("input",{type:"number",min:"0",max:f.totalPallets,value:z,onChange:G=>K(Math.min(f.totalPallets,Math.max(0,parseInt(G.target.value)||0))),className:"flex-1 text-center text-2xl font-bold border-2 border-purple-300 rounded-lg px-4 py-3"}),e.jsx("button",{onClick:()=>K(Math.min(f.totalPallets,z+1)),className:"w-12 h-12 bg-green-500 text-white rounded-lg font-bold text-xl hover:bg-green-600",children:"+"}),e.jsx("button",{onClick:()=>K(f.totalPallets),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700",children:"🎯 All"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["⚡ Max: ",f.totalPallets," pallets | Remaining: ",f.totalPallets-z," pallets"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-2",children:"📦 Loose Boxes to Assign:"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>S(Math.max(0,V-1)),className:"w-12 h-12 bg-red-500 text-white rounded-lg font-bold text-xl hover:bg-red-600",children:"−"}),e.jsx("input",{type:"number",min:"0",max:f.looseBoxes,value:V,onChange:G=>S(Math.min(f.looseBoxes,Math.max(0,parseInt(G.target.value)||0))),className:"flex-1 text-center text-2xl font-bold border-2 border-blue-300 rounded-lg px-4 py-3"}),e.jsx("button",{onClick:()=>S(Math.min(f.looseBoxes,V+1)),className:"w-12 h-12 bg-green-500 text-white rounded-lg font-bold text-xl hover:bg-green-600",children:"+"}),e.jsx("button",{onClick:()=>S(f.looseBoxes),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700",children:"🎯 All"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["⚡ Max: ",f.looseBoxes," boxes | Remaining: ",f.looseBoxes-V," boxes"]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-100 to-emerald-100 rounded-lg p-4 border-2 border-green-400",children:[e.jsx("p",{className:"text-gray-700 font-semibold mb-2",children:"Total to assign:"}),e.jsxs("div",{className:"flex items-center gap-4 text-xl font-bold",children:[z>0&&e.jsxs("span",{className:"text-purple-700",children:[z," Pallet",z>1?"s":"",e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",z*(f.boxesPerPallet||0)," boxes)"]})]}),V>0&&e.jsxs("span",{className:"text-blue-700",children:["+ ",V," Box",V>1?"es":""]})]}),e.jsxs("p",{className:"text-lg font-bold text-green-700 mt-2",children:["= ",z*(f.boxesPerPallet||0)+V," Total Boxes"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6 border-2 border-purple-300",children:[e.jsx("h4",{className:"text-lg font-bold text-purple-900 mb-3 flex items-center gap-2",children:"📸 Upload Photos (Optional - Max 10)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Take photos of pallets/boxes for reference"}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",multiple:!0,onChange:G=>{const $=Array.from(G.target.files||[]);if($.length+O.length>10){alert("Maximum 10 photos allowed");return}M([...O,...$])},className:"hidden",id:"photo-upload"}),e.jsxs("label",{htmlFor:"photo-upload",className:"block w-full px-6 py-4 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 cursor-pointer text-center transition-all",children:["📷 Take/Select Photos (",O.length,"/10)"]}),O.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:O.map((G,$)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:URL.createObjectURL(G),alt:`Photo ${$+1}`,className:"w-full h-24 object-cover rounded-lg border-2 border-purple-300"}),e.jsx("button",{onClick:()=>M(O.filter((Y,te)=>te!==$)),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold opacity-0 group-hover:opacity-100 transition-opacity",children:"✕"})]},$))})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>{P(!1),K(0),S(0)},className:"flex-1 px-6 py-4 bg-gray-500 text-white font-bold rounded-xl hover:bg-gray-600 transition-all text-lg",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:r||z===0&&V===0,className:"flex-1 px-6 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold rounded-xl hover:from-green-700 hover:to-emerald-700 disabled:from-gray-300 disabled:to-gray-400 transition-all text-lg shadow-lg",children:"✅ Confirm Assignment"})]})]})]})})]})},ir=()=>{const[s,b]=l.useState(""),[t,o]=l.useState(""),[n,N]=l.useState(!1),[r,T]=l.useState(!1),[v,h]=l.useState(""),[k,j]=l.useState(!1),[y,g]=l.useState({primaryColor:"#4F46E5",secondaryColor:"#7C3AED",showCompanyName:!0,logoSize:"medium"});l.useEffect(()=>{(async()=>{try{const a=await fetch("/api/company/branding");if(a.ok){const x=await a.json();console.log("✅ Loaded branding:",x.branding),g({name:x.branding.name,logo:x.branding.logoUrl||x.branding.logo,primaryColor:x.branding.primaryColor,secondaryColor:x.branding.secondaryColor,showCompanyName:x.branding.showCompanyName,logoSize:x.branding.logoSize||"medium"})}else console.log("⚠️ Failed to load branding, using defaults")}catch(a){console.log("⚠️ Error loading branding, using defaults:",a)}})()},[]);const i=async m=>{m.preventDefault(),T(!0),h("");try{const a=await ya.login(s,t);console.log("✅ Login successful:",a.user),console.log("✅ Token saved:",a.token?"Yes":"No"),console.log("✅ User saved:",localStorage.getItem("user")?"Yes":"No"),console.log("✅ Auth token:",localStorage.getItem("authToken")?"Yes":"No"),await new Promise(x=>setTimeout(x,100)),console.log("🔄 Navigating to dashboard..."),window.location.href="/dashboard"}catch(a){h(a.message||"Invalid email or password"),console.error("❌ Login error:",a),T(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative overflow-hidden transition-colors duration-500",style:{background:`linear-gradient(135deg, ${y.primaryColor}15 0%, ${y.secondaryColor}15 100%)`},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 -left-4 w-72 h-72 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob",style:{backgroundColor:`${y.primaryColor}30`}}),e.jsx("div",{className:"absolute top-0 -right-4 w-72 h-72 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000",style:{backgroundColor:`${y.secondaryColor}30`}}),e.jsx("div",{className:"absolute -bottom-8 left-20 w-72 h-72 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000",style:{backgroundColor:`${y.primaryColor}20`}})]}),e.jsxs("div",{className:"max-w-md w-full space-y-8 relative z-10",children:[e.jsxs("div",{className:"text-center animate-fade-in-down",children:[y.logo?e.jsx("div",{className:`mx-auto mb-4 flex items-center justify-center ${y.logoSize==="small"?"h-12":y.logoSize==="large"?"h-32":"h-20"}`,children:e.jsx("img",{src:y.logo,alt:"Company Logo",className:`object-contain ${y.logoSize==="small"?"max-h-12":y.logoSize==="large"?"max-h-32":"max-h-20"}`})}):e.jsx("div",{className:"mx-auto h-16 w-16 rounded-xl flex items-center justify-center mb-4 shadow-lg transition-all duration-300",style:{background:`linear-gradient(135deg, ${y.primaryColor} 0%, ${y.secondaryColor} 100%)`},children:e.jsx("svg",{className:"h-10 w-10 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900",children:y.showCompanyName&&y.name?y.name:"Warehouse Management"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Sign in to access your account"})]}),e.jsxs("form",{className:"mt-8 space-y-6 bg-white/80 backdrop-blur-xl p-8 rounded-2xl shadow-2xl border border-white/20 animate-fade-in-up",onSubmit:i,children:[v&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg animate-shake",children:v}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(vs,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:s,onChange:m=>b(m.target.value),className:"appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"admin@example.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(qt,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",name:"password",type:k?"text":"password",autoComplete:"current-password",required:!0,value:t,onChange:m=>o(m.target.value),className:"appearance-none block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"••••••••"}),e.jsx("button",{type:"button",onClick:()=>j(!k),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors",children:k?e.jsx(Ut,{className:"h-5 w-5"}):e.jsx(ds,{className:"h-5 w-5"})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",checked:n,onChange:m=>N(m.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-700",children:"Remember me"})]}),e.jsx("div",{className:"text-sm",children:e.jsx("a",{href:"#",className:"font-medium text-primary-600 hover:text-primary-500",children:"Forgot password?"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:r,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-xl hover:scale-[1.02] active:scale-[0.98]",style:{background:r?`linear-gradient(135deg, ${y.primaryColor} 0%, ${y.secondaryColor} 100%)`:`linear-gradient(135deg, ${y.primaryColor} 0%, ${y.secondaryColor} 100%)`,opacity:r?.7:1},children:r?"Signing in...":"Sign in"})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx("a",{href:"#",className:"font-medium text-primary-600 hover:text-primary-500",children:"Contact your administrator"})]})})]}),e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4 space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-sm font-bold text-blue-900",children:"🎯 Demo Login Credentials"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-white rounded-md p-3 border border-blue-100",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-800 mb-1",children:"👑 Admin Account"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Email:"})," admin@demo.com"]}),e.jsxs("p",{className:"text-xs text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Password:"})," demo123"]})]}),e.jsx("button",{type:"button",onClick:()=>{b("admin@demo.com"),o("demo123")},className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Use"})]})]}),e.jsxs("div",{className:"bg-white rounded-md p-3 border border-blue-100",children:[e.jsx("p",{className:"text-xs font-semibold text-blue-800 mb-1",children:"👔 Manager Account"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Email:"})," manager@demo.com"]}),e.jsxs("p",{className:"text-xs text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Password:"})," demo123"]})]}),e.jsx("button",{type:"button",onClick:()=>{b("manager@demo.com"),o("demo123")},className:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Use"})]})]})]}),e.jsx("p",{className:"text-xs text-blue-600 italic text-center",children:'Click "Use" to auto-fill credentials'})]})]})]})},dr=()=>{const s=Ws(),[b,t]=l.useState([]),[o,n]=l.useState(!0),[N,r]=l.useState(""),[T,v]=l.useState("all"),[h,k]=l.useState("all"),[j,y]=l.useState({total:0,totalAmount:0,paid:0,outstanding:0});l.useEffect(()=>{g()},[T,h,N]);const g=async()=>{try{n(!0);const a={};T!=="all"&&(a.status=T.toUpperCase()),h==="regular"?a.isWarehouseInvoice=!1:h==="warehouse"&&(a.isWarehouseInvoice=!0),N&&(a.search=N);const x=await Ee.getInvoices(a),d=Array.isArray(x)?x:x.invoices||[];t(d),i(d)}catch(a){console.error("Load invoices error:",a)}finally{n(!1)}},i=a=>{const x=a.length,d=a.reduce((u,C)=>u+parseFloat(C.totalAmount||0),0),c=a.filter(u=>(u.paymentStatus||u.status)==="PAID").length,R=a.filter(u=>(u.paymentStatus||u.status)!=="PAID").reduce((u,C)=>u+parseFloat(C.totalAmount||0)-parseFloat(C.paidAmount||0),0);y({total:x,totalAmount:d,paid:c,outstanding:R})},m=a=>{const x={PENDING:"bg-yellow-100 text-yellow-800 border-yellow-300",PAID:"bg-green-100 text-green-800 border-green-300",PARTIAL:"bg-blue-100 text-blue-800 border-blue-300",OVERDUE:"bg-red-100 text-red-800 border-red-300",CANCELLED:"bg-gray-100 text-gray-800 border-gray-300"},d={PENDING:e.jsx(Ve,{className:"h-4 w-4"}),PAID:e.jsx(ge,{className:"h-4 w-4"}),PARTIAL:e.jsx(De,{className:"h-4 w-4"}),OVERDUE:e.jsx(Pe,{className:"h-4 w-4"}),CANCELLED:e.jsx(Pe,{className:"h-4 w-4"})};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold border ${x[a]||x.PENDING}`,children:[d[a],a]})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Invoices"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage billing and payment tracking"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Invoices"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:j.total})]}),e.jsx(we,{className:"h-10 w-10 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Amount"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:j.totalAmount.toFixed(3)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"KWD"})]}),e.jsx(De,{className:"h-10 w-10 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Paid"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-2",children:j.paid}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Invoices"})]}),e.jsx(ge,{className:"h-10 w-10 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Outstanding"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-2",children:j.outstanding.toFixed(3)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"KWD"})]}),e.jsx(Ve,{className:"h-10 w-10 text-red-500"})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by invoice number, client name...",value:N,onChange:a=>r(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:T,onChange:a=>v(a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"overdue",children:"Overdue"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:h,onChange:a=>k(a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"regular",children:"Regular Invoices"}),e.jsx("option",{value:"warehouse",children:"Warehouse Invoices"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Shipment"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paid"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o?e.jsx("tr",{children:e.jsxs("td",{colSpan:9,className:"px-6 py-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading invoices..."})]})}):b.length>0?b.map(a=>{var d;const x=parseFloat(a.totalAmount)-parseFloat(a.paidAmount||0);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(we,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-primary-600",children:a.invoiceNumber})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(a.invoiceDate).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.clientName}),e.jsx("div",{className:"text-xs text-gray-500",children:a.clientPhone})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:((d=a.shipment)==null?void 0:d.referenceId)||"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900",children:[parseFloat(a.totalAmount).toFixed(3)," KWD"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium",children:[parseFloat(a.paidAmount||0).toFixed(3)," KWD"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold",children:e.jsxs("span",{className:x>0?"text-red-600":"text-green-600",children:[x.toFixed(3)," KWD"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m(a.paymentStatus||a.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>s(`/invoices/${a.id}`),className:"text-primary-600 hover:text-primary-900",children:"View Details →"})})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-12 text-center text-gray-500",children:"No invoices found"})})})]})})})]})},cr=({isOpen:s,onClose:b,invoice:t,onSuccess:o})=>{const n=parseFloat(t.totalAmount)-parseFloat(t.paidAmount||0),[N,r]=l.useState({amount:n.toFixed(3),paymentMethod:"CASH",transactionReference:"",receiptNumber:"",paymentDate:new Date().toISOString().split("T")[0],notes:""}),[T,v]=l.useState(!1),[h,k]=l.useState(""),j=async g=>{g.preventDefault();const i=parseFloat(N.amount);if(isNaN(i)||i<=0){k("Please enter a valid amount");return}if(i>n){k(`Amount cannot exceed balance due (${n.toFixed(3)} KWD)`);return}try{v(!0),k(""),await Ee.recordPayment(t.id,{...N,amount:parseFloat(N.amount)});const m=parseFloat(N.amount),a=n-m;alert(`✅ PAYMENT RECORDED!

💰 Amount: ${m.toFixed(3)} KWD
📄 Method: ${N.paymentMethod}
📋 Invoice: ${t.invoiceNumber}

${a<=0?"✅ Invoice FULLY PAID!":`⚠️ Remaining Balance: ${a.toFixed(3)} KWD`}`),o(),b()}catch(m){k(m.message||"Failed to record payment")}finally{v(!1)}},y=n-parseFloat(N.amount||"0");return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Record Payment"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Invoice: ",t.invoiceNumber]})]}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 bg-blue-50 border-b",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Balance Due"}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[n.toFixed(3)," KWD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"New Balance (After Payment)"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[y>=0?y.toFixed(3):"0.000"," KWD"]})]})]})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[h&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:h}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Payment Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.001",value:N.amount,onChange:g=>r({...N,amount:g.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"0.000",required:!0,max:n,min:"0.001"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"KWD"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Maximum: ",n.toFixed(3)," KWD"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Payment Method ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:N.paymentMethod,onChange:g=>r({...N,paymentMethod:g.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CARD",children:"Card"}),e.jsx("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),e.jsx("option",{value:"CHEQUE",children:"Cheque"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transaction Reference"}),e.jsx("input",{type:"text",value:N.transactionReference,onChange:g=>r({...N,transactionReference:g.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Bank ref, card last 4 digits, etc."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Receipt Number"}),e.jsx("input",{type:"text",value:N.receiptNumber,onChange:g=>r({...N,receiptNumber:g.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"RCP-001"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Payment Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:N.paymentDate,onChange:g=>r({...N,paymentDate:g.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:N.notes,onChange:g=>r({...N,notes:g.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Additional payment details..."})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Payment Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Invoice Total"}),e.jsxs("span",{className:"font-medium",children:[parseFloat(t.totalAmount).toFixed(3)," KWD"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Already Paid"}),e.jsxs("span",{className:"font-medium",children:[parseFloat(t.paidAmount||0).toFixed(3)," KWD"]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-gray-600",children:"Current Payment"}),e.jsxs("span",{className:"font-bold text-green-600",children:[parseFloat(N.amount||"0").toFixed(3)," KWD"]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[e.jsx("span",{className:"text-gray-900 font-semibold",children:"Remaining Balance"}),e.jsxs("span",{className:"font-bold text-red-600",children:[y>=0?y.toFixed(3):"0.000"," KWD"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors",disabled:T,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:T,className:"flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:T?"Recording...":"Record Payment"})]})]})]})}):null},xr=(s,b)=>{const t=new xa,o=b.primaryColor||"#2563eb",n=t.internal.pageSize.getWidth(),N=t.internal.pageSize.getHeight();let r=20;const v=(i=>{const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return m?{r:parseInt(m[1],16),g:parseInt(m[2],16),b:parseInt(m[3],16)}:{r:37,g:99,b:235}})(o);t.setFillColor(v.r,v.g,v.b),t.rect(0,0,n,40,"F"),b.logoUrl,t.setTextColor(255,255,255),t.setFontSize(28),t.setFont("helvetica","bold"),t.text("INVOICE",n-15,25,{align:"right"}),t.setFontSize(12),t.setFont("helvetica","normal"),t.text(s.invoiceNumber,n-15,33,{align:"right"}),t.setTextColor(0,0,0),r=50,t.setFontSize(10),t.setFont("helvetica","bold"),t.text("FROM:",15,r),t.setFont("helvetica","normal"),r+=6,t.text(b.companyName||"Company Name",15,r),r+=5,b.address&&(t.setFontSize(9),t.text(b.address,15,r),r+=5),b.phone&&(t.text(`Tel: ${b.phone}`,15,r),r+=5),b.email&&t.text(`Email: ${b.email}`,15,r),r=50,t.setFontSize(10),t.setFont("helvetica","bold"),t.text("BILL TO:",n-80,r),t.setFont("helvetica","normal"),r+=6,t.text(s.clientName,n-80,r),r+=5,t.setFontSize(9),t.text(`Tel: ${s.clientPhone}`,n-80,r),r+=5,s.clientEmail&&(t.text(`Email: ${s.clientEmail}`,n-80,r),r+=5),s.shipment&&t.text(`Shipment: ${s.shipment.referenceId}`,n-80,r),r=90,t.setFillColor(240,240,240),t.rect(15,r,n-30,20,"F"),t.setFontSize(9),t.setFont("helvetica","bold"),t.text("Invoice Date:",20,r+8),t.text("Due Date:",70,r+8),t.text("Status:",120,r+8),t.setFont("helvetica","normal"),t.text(new Date(s.invoiceDate).toLocaleDateString(),20,r+15),t.text(new Date(s.dueDate).toLocaleDateString(),70,r+15);const h=s.status==="PAID"?[34,197,94]:s.status==="PARTIAL"?[59,130,246]:s.status==="OVERDUE"?[239,68,68]:[234,179,8];t.setFillColor(h[0],h[1],h[2]),t.setTextColor(255,255,255),t.roundedRect(120,r+10,25,6,2,2,"F"),t.text(s.status,132.5,r+14,{align:"center"}),t.setTextColor(0,0,0),r=120;const k=s.lineItems.map(i=>[i.description+(i.notes?`
${i.notes}`:""),i.quantity.toString(),`${parseFloat(i.unitPrice).toFixed(3)} KWD`,`${parseFloat(i.taxAmount||"0").toFixed(3)} KWD`,`${parseFloat(i.amount).toFixed(3)} KWD`]);t.autoTable({startY:r,head:[["Description","Qty","Unit Price","Tax","Amount"]],body:k,theme:"striped",headStyles:{fillColor:[v.r,v.g,v.b],textColor:[255,255,255],fontStyle:"bold",fontSize:10},styles:{fontSize:9,cellPadding:5},columnStyles:{0:{cellWidth:80},1:{halign:"center",cellWidth:20},2:{halign:"right",cellWidth:30},3:{halign:"right",cellWidth:25},4:{halign:"right",cellWidth:30}}}),r=t.lastAutoTable.finalY+10;const j=n-70;t.setFontSize(10),t.text("Subtotal:",j,r,{align:"right"}),t.text(`${parseFloat(s.subtotal).toFixed(3)} KWD`,n-15,r,{align:"right"}),r+=7,t.text("Tax:",j,r,{align:"right"}),t.text(`${parseFloat(s.taxAmount||"0").toFixed(3)} KWD`,n-15,r,{align:"right"}),r+=10,t.setDrawColor(v.r,v.g,v.b),t.setLineWidth(.5),t.line(j-10,r-3,n-15,r-3),t.setFont("helvetica","bold"),t.setFontSize(12),t.text("Total:",j,r,{align:"right"}),t.text(`${parseFloat(s.totalAmount).toFixed(3)} KWD`,n-15,r,{align:"right"});const y=parseFloat(s.totalAmount)-parseFloat(s.paidAmount||"0");if(r+=7,t.setFontSize(10),t.setFont("helvetica","normal"),t.text("Paid:",j,r,{align:"right"}),t.setTextColor(34,197,94),t.text(`${parseFloat(s.paidAmount||"0").toFixed(3)} KWD`,n-15,r,{align:"right"}),r+=7,t.setTextColor(0,0,0),t.text("Balance Due:",j,r,{align:"right"}),t.setTextColor(y>0?239:34,y>0?68:197,y>0?68:94),t.text(`${y.toFixed(3)} KWD`,n-15,r,{align:"right"}),t.setTextColor(0,0,0),s.payments&&s.payments.length>0){r+=15,t.setFont("helvetica","bold"),t.setFontSize(11),t.text("Payment History",15,r),r+=5;const i=s.payments.map(m=>[new Date(m.paymentDate).toLocaleDateString(),m.paymentMethod,m.transactionReference||"N/A",`${parseFloat(m.amount).toFixed(3)} KWD`]);t.autoTable({startY:r,head:[["Date","Method","Reference","Amount"]],body:i,theme:"plain",headStyles:{fillColor:[240,240,240],textColor:[0,0,0],fontStyle:"bold",fontSize:9},styles:{fontSize:9,cellPadding:4}}),r=t.lastAutoTable.finalY+10}b.bankDetails&&r<N-60&&(r+=10,t.setFillColor(240,248,255),t.rect(15,r,n-30,30,"F"),r+=7,t.setFontSize(10),t.setFont("helvetica","bold"),t.text("Bank Details",20,r),r+=6,t.setFont("helvetica","normal"),t.setFontSize(8),b.bankDetails.split(`
`).forEach(m=>{t.text(m,20,r),r+=4})),b.termsAndConditions&&r<N-40&&(r+=10,t.setFontSize(9),t.setFont("helvetica","bold"),t.text("Terms & Conditions",15,r),r+=5,t.setFont("helvetica","normal"),t.setFontSize(7),b.termsAndConditions.split(`
`).slice(0,3).forEach(m=>{t.text(m,15,r),r+=4})),t.setFontSize(8),t.setTextColor(128,128,128),t.text("Thank you for your business!",n/2,N-15,{align:"center"}),t.text(`Generated on ${new Date().toLocaleDateString()}`,n/2,N-10,{align:"center"});const g=`Invoice-${s.invoiceNumber}-${new Date().toISOString().split("T")[0]}.pdf`;t.save(g)},mr=()=>{var u,C;const{id:s}=Wt(),b=Ws(),[t,o]=l.useState(null),[n,N]=l.useState(null),[r,T]=l.useState(null),[v,h]=l.useState(!0),[k,j]=l.useState(!1),[y,g]=l.useState(!1);l.useEffect(()=>{i()},[s]);const i=async()=>{try{h(!0);const[A,w,p]=await Promise.all([Ee.getInvoice(s),Ee.getSettings(),fetch("/api/template-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}).then(f=>f.json()).catch(()=>({settings:null}))]);o(A.invoice||A),N(w.settings||w),T(p.settings)}catch(A){console.error("Load invoice error:",A)}finally{h(!1)}},m=A=>{const w={PENDING:"bg-yellow-100 text-yellow-800 border-yellow-300",PAID:"bg-green-100 text-green-800 border-green-300",PARTIAL:"bg-blue-100 text-blue-800 border-blue-300",OVERDUE:"bg-red-100 text-red-800 border-red-300",CANCELLED:"bg-gray-100 text-gray-800 border-gray-300"},p={PENDING:e.jsx(Ve,{className:"h-5 w-5"}),PAID:e.jsx(ge,{className:"h-5 w-5"}),PARTIAL:e.jsx(De,{className:"h-5 w-5"}),OVERDUE:e.jsx(Ve,{className:"h-5 w-5"}),CANCELLED:e.jsx(Ve,{className:"h-5 w-5"})};return e.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold border ${w[A]||w.PENDING}`,children:[p[A],A]})},a=()=>{window.print()},x=async()=>{if(!(!t||!n))try{g(!0),await new Promise(A=>setTimeout(A,500)),xr(t,n)}catch(A){console.error("PDF generation error:",A),alert("Failed to generate PDF. Please try again.")}finally{g(!1)}},d=()=>{const A=(r==null?void 0:r.qrCodePosition)||"TOP_RIGHT",w={TOP_RIGHT:"top-4 right-4",TOP_LEFT:"top-4 left-4",BOTTOM_RIGHT:"bottom-4 right-4",BOTTOM_LEFT:"bottom-4 left-4"};return w[A]||w.TOP_RIGHT};if(v)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(!t)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("p",{className:"text-gray-600",children:"Invoice not found"})});const c=parseFloat(t.totalAmount)-parseFloat(t.paidAmount||0),R=parseFloat(t.paidAmount||0)/parseFloat(t.totalAmount)*100;return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[e.jsx("div",{className:"max-w-5xl mx-auto mb-6 print:hidden",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>b("/invoices"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(zt,{className:"h-5 w-5"}),"Back to Invoices"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c>0&&e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(De,{className:"h-5 w-5"}),"Record Payment"]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(Be,{className:"h-5 w-5"}),"Print"]}),e.jsx("button",{onClick:x,disabled:y,className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-700"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Vt,{className:"h-5 w-5"}),"Download PDF"]})}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:[e.jsx(vs,{className:"h-5 w-5"}),"Send Email"]})]})]})}),e.jsxs("div",{className:"max-w-5xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden relative",children:[(r==null?void 0:r.showQRCode)&&t&&e.jsx("div",{className:`absolute ${d()} z-10 bg-white p-2 rounded-lg shadow-md print:block`,children:e.jsx(nt,{value:`INV-${t.invoiceNumber||t.id}`,size:(r==null?void 0:r.qrCodeSize)||100,level:"M",includeMargin:!0})}),e.jsxs("div",{className:"p-8 border-b-4",style:{borderColor:(r==null?void 0:r.invoicePrimaryColor)||(n==null?void 0:n.primaryColor)||"#2563eb",backgroundColor:`${(r==null?void 0:r.invoicePrimaryColor)||(n==null?void 0:n.primaryColor)||"#2563eb"}08`},children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[(r==null?void 0:r.invoiceShowLogo)!==!1&&((r==null?void 0:r.companyLogo)||(n==null?void 0:n.logoUrl))&&e.jsx("img",{src:(r==null?void 0:r.companyLogo)||n.logoUrl,alt:"Company Logo",className:"h-16 mb-4"}),e.jsx("h1",{className:"text-3xl font-bold",style:{color:(r==null?void 0:r.invoicePrimaryColor)||(n==null?void 0:n.primaryColor)||"#2563eb"},children:(r==null?void 0:r.invoiceTitle)||"INVOICE"}),e.jsx("p",{className:"text-gray-600 mt-1",children:t.invoiceNumber}),(r==null?void 0:r.companyName)&&e.jsx("p",{className:"text-gray-700 font-semibold mt-2",children:r.companyName}),(r==null?void 0:r.invoiceShowAddress)!==!1&&(r==null?void 0:r.companyAddress)&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.companyAddress}),(r==null?void 0:r.invoiceShowPhone)!==!1&&(r==null?void 0:r.companyPhone)&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Phone: ",r.companyPhone]}),(r==null?void 0:r.invoiceShowEmail)!==!1&&(r==null?void 0:r.companyEmail)&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Email: ",r.companyEmail]})]}),e.jsx("div",{children:m(t.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-8 mt-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Invoice Date"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:new Date(t.invoiceDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Due Date"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:new Date(t.dueDate).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"p-8 grid grid-cols-2 gap-8 border-b",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase mb-2",children:"From"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:(n==null?void 0:n.companyName)||"Company Name"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:(n==null?void 0:n.address)||""}),e.jsx("p",{className:"text-gray-600 text-sm",children:(n==null?void 0:n.phone)||""}),e.jsx("p",{className:"text-gray-600 text-sm",children:(n==null?void 0:n.email)||""})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase mb-2",children:"Bill To"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:t.clientName}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:t.clientPhone}),t.clientEmail&&e.jsx("p",{className:"text-gray-600 text-sm",children:t.clientEmail}),t.shipment&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 rounded border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Shipment Reference"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.shipment.referenceId}),t.shipment.rackLocations&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Rack Locations"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.shipment.rackLocations})]})]})]})]}),t.shipment&&e.jsxs("div",{className:"p-8 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",style:{color:(r==null?void 0:r.invoicePrimaryColor)||(n==null?void 0:n.primaryColor)||"#2563eb"},children:[e.jsx("span",{children:"📦"})," Shipment Details & Box Distribution"]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Shipment ID"}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:t.shipment.qrCode||t.shipment.id})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Total Boxes"}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:t.shipment.originalBoxCount||((u=t.shipment.boxes)==null?void 0:u.length)||0})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Arrival Date"}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:t.shipment.arrivalDate?new Date(t.shipment.arrivalDate).toLocaleDateString():t.shipment.receivedDate?new Date(t.shipment.receivedDate).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Days Stored"}),e.jsxs("p",{className:"text-sm font-bold text-indigo-600",children:[t.shipment.arrivalDate||t.shipment.receivedDate?Math.ceil((new Date().getTime()-new Date(t.shipment.arrivalDate||t.shipment.receivedDate).getTime())/(1e3*3600*24)):0," days"]})]})]}),t.shipment.boxes&&t.shipment.boxes.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-3",children:"📍 Box Distribution by Rack Location:"}),(()=>{const A={};return t.shipment.boxes.forEach(w=>{if(w.rackId&&w.rack){const p=w.rack.code;A[p]||(A[p]=[]),A[p].push(w)}else A.Unassigned||(A.Unassigned=[]),A.Unassigned.push(w)}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(A).map(([w,p])=>{var L;const f=w==="Unassigned",D=(L=p[0])==null?void 0:L.rack;return e.jsxs("div",{className:`border-2 rounded-lg p-3 bg-white ${f?"border-yellow-300":"border-green-300"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-gray-800",children:[f?"⏳":"🗄️"," ",f?"Unassigned":`Rack ${w}`]}),e.jsxs("span",{className:`px-2 py-0.5 rounded-full text-xs font-semibold ${f?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:[p.length," box",p.length!==1?"es":""]})]})}),!f&&(D==null?void 0:D.location)&&e.jsxs("p",{className:"text-xs text-gray-600 mb-2",children:["📍 ",D.location]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:p.map(q=>e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs font-mono font-semibold text-gray-700",title:`Box #${q.boxNumber} - ${q.status}`,children:["#",q.boxNumber]},q.id))})]},w)})})})(),e.jsxs("div",{className:"mt-3 grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"bg-white border border-gray-300 rounded p-2 text-center",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Total Racks"}),e.jsx("p",{className:"text-base font-bold text-gray-800",children:Object.keys(t.shipment.boxes.reduce((A,w)=>(w.rackId&&(A[w.rackId]=!0),A),{})).length})]}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded p-2 text-center",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Assigned"}),e.jsx("p",{className:"text-base font-bold text-green-600",children:t.shipment.boxes.filter(A=>A.rackId).length})]}),e.jsxs("div",{className:"bg-white border border-gray-300 rounded p-2 text-center",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Unassigned"}),e.jsx("p",{className:"text-base font-bold text-yellow-600",children:t.shipment.boxes.filter(A=>!A.rackId).length})]})]})]})]}),e.jsxs("div",{className:"p-8 border-b",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200",children:[e.jsx("th",{className:"text-left py-3 text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"text-right py-3 text-sm font-semibold text-gray-700",children:"Qty"}),e.jsx("th",{className:"text-right py-3 text-sm font-semibold text-gray-700",children:"Unit Price"}),e.jsx("th",{className:"text-right py-3 text-sm font-semibold text-gray-700",children:"Tax"}),e.jsx("th",{className:"text-right py-3 text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:(C=t.lineItems)==null?void 0:C.map((A,w)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsxs("td",{className:"py-4 text-gray-900",children:[e.jsx("div",{className:"font-medium",children:A.description}),A.notes&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:A.notes})]}),e.jsx("td",{className:"py-4 text-right text-gray-900",children:A.quantity}),e.jsx("td",{className:"py-4 text-right text-gray-900",children:parseFloat(A.unitPrice).toFixed(3)}),e.jsx("td",{className:"py-4 text-right text-gray-900",children:parseFloat(A.taxAmount||0).toFixed(3)}),e.jsx("td",{className:"py-4 text-right text-gray-900 font-semibold",children:parseFloat(A.amount).toFixed(3)})]},w))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("div",{className:"w-80",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"text-gray-900 font-semibold",children:[parseFloat(t.subtotal).toFixed(3)," ",(r==null?void 0:r.currencySymbol)||"KWD"]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Tax"}),e.jsxs("span",{className:"text-gray-900 font-semibold",children:[parseFloat(t.taxAmount||0).toFixed(3)," ",(r==null?void 0:r.currencySymbol)||"KWD"]})]}),e.jsxs("div",{className:"flex justify-between py-3 border-b-2 border-gray-300",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[parseFloat(t.totalAmount).toFixed(3)," ",(r==null?void 0:r.currencySymbol)||"KWD"]})]})]})})]}),e.jsxs("div",{className:"p-8 bg-gray-50 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payment Status"}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Amount"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[parseFloat(t.totalAmount).toFixed(3)," ",(r==null?void 0:r.currencySymbol)||"KWD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Paid Amount"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:[parseFloat(t.paidAmount||0).toFixed(3)," ",(r==null?void 0:r.currencySymbol)||"KWD"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Balance Due"}),e.jsxs("p",{className:"text-xl font-bold text-red-600",children:[c.toFixed(3)," ",(r==null?void 0:r.currencySymbol)||"KWD"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${R}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[R.toFixed(1),"% Paid"]})]}),t.payments&&t.payments.length>0&&e.jsxs("div",{className:"p-8 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payment History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:"Method"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-gray-700",children:"Reference"}),e.jsx("th",{className:"text-right px-4 py-3 text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.payments.map(A=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:new Date(A.paymentDate).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-gray-900",children:A.paymentMethod}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:A.transactionReference||"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-right text-green-600 font-semibold",children:[parseFloat(A.amount).toFixed(3)," ",(r==null?void 0:r.currencySymbol)||"KWD"]})]},A.id))})]})})]}),(n==null?void 0:n.bankDetails)&&e.jsxs("div",{className:"p-8 border-b bg-blue-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Bank Details"}),e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:n.bankDetails})]}),((r==null?void 0:r.invoiceTerms)||(n==null?void 0:n.termsAndConditions))&&e.jsxs("div",{className:"p-8 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",style:{color:(r==null?void 0:r.invoicePrimaryColor)||(n==null?void 0:n.primaryColor)||"#2563eb"},children:"Terms & Conditions"}),e.jsx("div",{className:"text-sm text-gray-600 whitespace-pre-line",children:(r==null?void 0:r.invoiceTerms)||n.termsAndConditions})]}),(r==null?void 0:r.invoiceShowFooter)!==!1&&e.jsxs("div",{className:"p-8 text-center border-t",children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold mb-2",children:(r==null?void 0:r.invoiceFooterText)||"Thank you for your business!"}),(r==null?void 0:r.companyWebsite)&&e.jsx("p",{className:"text-xs text-gray-500",children:r.companyWebsite})]})]}),e.jsx(cr,{isOpen:k,onClose:()=>j(!1),invoice:t,onSuccess:i})]})},ur=({isOpen:s,onClose:b,onSuccess:t})=>{const[o,n]=l.useState({title:"",category:"MAINTENANCE",amount:"",currency:"KWD",description:"",expenseDate:new Date().toISOString().split("T")[0]}),[N,r]=l.useState([]),[T,v]=l.useState({}),[h,k]=l.useState(!1),[j,y]=l.useState("");l.useEffect(()=>{s&&g()},[s]);const g=async()=>{try{const a=await fetch("/api/custom-fields?section=EXPENSE",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(a.ok){const x=await a.json(),d=x.customFields||x,c=Array.isArray(d)?d.filter(u=>u.isActive):[];r(c);const R={};c.forEach(u=>{R[u.id]=""}),v(R)}}catch(a){console.error("Failed to load custom fields:",a)}},i=async a=>{var x;if(a.preventDefault(),y(""),!o.title.trim()){y("Title is required");return}if(!o.amount||parseFloat(o.amount)<=0){y("Valid amount is required");return}try{k(!0);const d=await Xe.create({...o,amount:parseFloat(o.amount)}),c=((x=d.expense)==null?void 0:x.id)||d.id;if(N.length>0){const R=Object.entries(T).filter(([u,C])=>C!=="").map(([u,C])=>({customFieldId:u,fieldValue:C}));if(R.length>0)try{await fetch(`/api/custom-field-values/EXPENSE/${c}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({values:R})})}catch(u){console.error("Failed to save custom field values:",u)}}t(),m()}catch(d){y(d.message||"Failed to create expense")}finally{k(!1)}},m=()=>{n({title:"",category:"MAINTENANCE",amount:"",currency:"KWD",description:"",expenseDate:new Date().toISOString().split("T")[0]}),y(""),b()};return s?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:m}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:[e.jsxs("div",{className:"bg-primary-600 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Add New Expense"}),e.jsx("button",{onClick:m,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:i,className:"px-6 py-4",children:[j&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:j}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:o.title,onChange:a=>n({...o,title:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"e.g., Warehouse Rent - October",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:o.category,onChange:a=>n({...o,category:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0,children:[e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"}),e.jsx("option",{value:"FUEL",children:"Fuel"}),e.jsx("option",{value:"MATERIALS",children:"Materials"}),e.jsx("option",{value:"SALARIES",children:"Salaries"}),e.jsx("option",{value:"RENT",children:"Rent"}),e.jsx("option",{value:"UTILITIES",children:"Utilities"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",value:o.amount,onChange:a=>n({...o,amount:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter amount",required:!0}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"KWD"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Expense Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:o.expenseDate,onChange:a=>n({...o,expenseDate:a.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:a=>n({...o,description:a.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Additional details about this expense..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Receipt / Attachment"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Photo upload coming soon"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PDF, JPG, PNG up to 10MB"})]})]})]}),N.length>0&&e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"✨ Custom Fields"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:N.map(a=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[a.fieldName,a.isRequired&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),a.fieldType==="TEXT"&&e.jsx("input",{type:"text",value:T[a.id]||"",onChange:x=>v(d=>({...d,[a.id]:x.target.value})),required:a.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:`Enter ${a.fieldName.toLowerCase()}`}),a.fieldType==="NUMBER"&&e.jsx("input",{type:"number",value:T[a.id]||"",onChange:x=>v(d=>({...d,[a.id]:x.target.value})),required:a.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:`Enter ${a.fieldName.toLowerCase()}`}),a.fieldType==="DATE"&&e.jsx("input",{type:"date",value:T[a.id]||"",onChange:x=>v(d=>({...d,[a.id]:x.target.value})),required:a.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"}),a.fieldType==="DROPDOWN"&&a.fieldOptions&&e.jsxs("select",{value:T[a.id]||"",onChange:x=>v(d=>({...d,[a.id]:x.target.value})),required:a.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"-- Select --"}),(()=>{if(!a.fieldOptions)return[];try{const x=JSON.parse(a.fieldOptions);return Array.isArray(x)?x.map(d=>e.jsx("option",{value:d,children:d},d)):[]}catch{return typeof a.fieldOptions=="string"?a.fieldOptions.split(",").map(x=>e.jsx("option",{value:x.trim(),children:x.trim()},x.trim())):[]}})()]}),a.fieldType==="CHECKBOX"&&e.jsxs("div",{className:"flex items-center h-10",children:[e.jsx("input",{type:"checkbox",checked:T[a.id]==="true",onChange:x=>v(d=>({...d,[a.id]:x.target.checked?"true":"false"})),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Yes"})]})]},a.id))})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",disabled:h,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:h,children:h?"Creating...":"Create Expense"})]})]})]})]})}):null},hr=({isOpen:s,onClose:b,onSuccess:t,expense:o})=>{const[n,N]=l.useState({title:"",category:"MAINTENANCE",amount:"",currency:"KWD",description:"",expenseDate:"",status:"PENDING"}),[r,T]=l.useState([]),[v,h]=l.useState({}),[k,j]=l.useState(!1),[y,g]=l.useState("");l.useEffect(()=>{var x;o&&(N({title:o.title||"",category:o.category||"MAINTENANCE",amount:((x=o.amount)==null?void 0:x.toString())||"",currency:o.currency||"KWD",description:o.description||"",expenseDate:o.expenseDate?new Date(o.expenseDate).toISOString().split("T")[0]:"",status:o.status||"PENDING"}),i())},[o]);const i=async()=>{if(o!=null&&o.id)try{const x=await fetch("/api/custom-fields?section=EXPENSE",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(x.ok){const d=await x.json(),c=d.customFields||d,R=Array.isArray(c)?c.filter(C=>C.isActive):[];T(R);const u=await fetch(`/api/custom-field-values/EXPENSE/${o.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(u.ok){const C=await u.json(),A=C.customFieldValues||C,w={};Array.isArray(A)&&A.forEach(p=>{w[p.customFieldId]=p.fieldValue}),h(w)}}}catch(x){console.error("Failed to load custom fields:",x)}},m=async x=>{if(x.preventDefault(),g(""),!n.title.trim()){g("Title is required");return}if(!n.amount||parseFloat(n.amount)<=0){g("Valid amount is required");return}try{if(j(!0),await Xe.update(o.id,{...n,amount:parseFloat(n.amount)}),r.length>0){const d=Object.entries(v).filter(([c,R])=>R!=="").map(([c,R])=>({customFieldId:c,fieldValue:R}));if(d.length>0)try{await fetch(`/api/custom-field-values/EXPENSE/${o.id}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({values:d})})}catch(c){console.error("Failed to save custom field values:",c)}}t(),a()}catch(d){g(d.message||"Failed to update expense")}finally{j(!1)}},a=()=>{g(""),b()};return!s||!o?null:e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75",onClick:a}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",children:[e.jsxs("div",{className:"bg-primary-600 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Edit Expense"}),e.jsx("button",{onClick:a,className:"text-white hover:text-gray-200 transition-colors",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:m,className:"px-6 py-4",children:[y&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:y}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:n.title,onChange:x=>N({...n,title:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"e.g., Warehouse Rent - October",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:n.category,onChange:x=>N({...n,category:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0,children:[e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"}),e.jsx("option",{value:"FUEL",children:"Fuel"}),e.jsx("option",{value:"MATERIALS",children:"Materials"}),e.jsx("option",{value:"SALARIES",children:"Salaries"}),e.jsx("option",{value:"RENT",children:"Rent"}),e.jsx("option",{value:"UTILITIES",children:"Utilities"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:n.amount,onChange:x=>N({...n,amount:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"0.00",required:!0}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"KWD"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Expense Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:n.expenseDate,onChange:x=>N({...n,expenseDate:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:n.status,onChange:x=>N({...n,status:x.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:x=>N({...n,description:x.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Additional details about this expense..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Receipt / Attachment"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Photo upload coming soon"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PDF, JPG, PNG up to 10MB"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["Created on ",new Date(o.createdAt).toLocaleDateString(),o.approvedBy&&e.jsxs(e.Fragment,{children:[" • Approved by user ",o.approvedBy]})]})})]})})]}),r.length>0&&e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700",children:"✨ Custom Fields"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(x=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[x.fieldName,x.isRequired&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),x.fieldType==="TEXT"&&e.jsx("input",{type:"text",value:v[x.id]||"",onChange:d=>h(c=>({...c,[x.id]:d.target.value})),required:x.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:`Enter ${x.fieldName.toLowerCase()}`}),x.fieldType==="NUMBER"&&e.jsx("input",{type:"number",value:v[x.id]||"",onChange:d=>h(c=>({...c,[x.id]:d.target.value})),required:x.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",placeholder:`Enter ${x.fieldName.toLowerCase()}`}),x.fieldType==="DATE"&&e.jsx("input",{type:"date",value:v[x.id]||"",onChange:d=>h(c=>({...c,[x.id]:d.target.value})),required:x.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"}),x.fieldType==="DROPDOWN"&&x.fieldOptions&&e.jsxs("select",{value:v[x.id]||"",onChange:d=>h(c=>({...c,[x.id]:d.target.value})),required:x.isRequired,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"-- Select --"}),(()=>{try{const d=JSON.parse(x.fieldOptions);return Array.isArray(d)?d.map(c=>e.jsx("option",{value:c,children:c},c)):[]}catch{return typeof x.fieldOptions=="string"?x.fieldOptions.split(",").map(d=>e.jsx("option",{value:d.trim(),children:d.trim()},d.trim())):[]}})()]}),x.fieldType==="CHECKBOX"&&e.jsxs("div",{className:"flex items-center h-10",children:[e.jsx("input",{type:"checkbox",checked:v[x.id]==="true",onChange:d=>h(c=>({...c,[x.id]:d.target.checked?"true":"false"})),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-2 focus:ring-primary-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Yes"})]})]},x.id))})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",disabled:k,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:k,children:k?"Updating...":"Update Expense"})]})]})]})]})})},pr=()=>{const[s,b]=l.useState([]),[t,o]=l.useState(null),[n,N]=l.useState(!0),[r,T]=l.useState(""),[v,h]=l.useState(""),[k,j]=l.useState(""),[y,g]=l.useState(""),[i,m]=l.useState(!1),[a,x]=l.useState(null);l.useEffect(()=>{d()},[k,y,v]);const d=async()=>{try{N(!0);const w={};k&&(w.category=k),y&&(w.status=y),v&&(w.search=v);const p=await Xe.getAll(w);b(p.expenses),o(p.summary)}catch(w){T(w.message)}finally{N(!1)}},c=async w=>{if(window.confirm("Are you sure you want to delete this expense?"))try{await Xe.delete(w),d()}catch(p){alert("Failed to delete expense: "+p.message)}},R=async w=>{try{await Xe.updateStatus(w,"APPROVED"),d()}catch(p){alert("Failed to approve expense: "+p.message)}},u=async w=>{try{await Xe.updateStatus(w,"REJECTED"),d()}catch(p){alert("Failed to reject expense: "+p.message)}},C=w=>{const p={PENDING:{bg:"bg-yellow-100",text:"text-yellow-800",icon:Ve},APPROVED:{bg:"bg-green-100",text:"text-green-800",icon:ge},REJECTED:{bg:"bg-red-100",text:"text-red-800",icon:Pe}},f=p[w]||p.PENDING,D=f.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f.bg} ${f.text}`,children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),w]})},A=w=>{const p={MAINTENANCE:"bg-blue-100 text-blue-800",FUEL:"bg-green-100 text-green-800",MATERIALS:"bg-purple-100 text-purple-800",SALARIES:"bg-yellow-100 text-yellow-800",RENT:"bg-red-100 text-red-800",UTILITIES:"bg-indigo-100 text-indigo-800",OTHER:"bg-gray-100 text-gray-800"};return p[w]||p.OTHER};return n?e.jsx("div",{className:"p-6 flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading expenses..."})]})}):r?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:["Error loading expenses: ",r]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Expenses"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Track and manage company expenses"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2"}),"Add Expense"]})]}),t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Total Expenses"}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:[t.total.toFixed(2)," ",t.currency]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t.count," expenses"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Pending"}),e.jsxs("div",{className:"text-2xl font-bold text-yellow-600 mt-1",children:[t.pending.toFixed(2)," ",t.currency]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Awaiting approval"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Approved"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600 mt-1",children:[t.approved.toFixed(2)," ",t.currency]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Verified expenses"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"This Month"}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600 mt-1",children:[t.total.toFixed(2)," ",t.currency]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Current period"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search expenses...",value:v,onChange:w=>h(w.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsxs("select",{value:k,onChange:w=>j(w.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"MAINTENANCE",children:"Maintenance"}),e.jsx("option",{value:"FUEL",children:"Fuel"}),e.jsx("option",{value:"MATERIALS",children:"Materials"}),e.jsx("option",{value:"SALARIES",children:"Salaries"}),e.jsx("option",{value:"RENT",children:"Rent"}),e.jsx("option",{value:"UTILITIES",children:"Utilities"}),e.jsx("option",{value:"OTHER",children:"Other"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsxs("select",{value:y,onChange:w=>g(w.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expense"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-medium",children:"No expenses found"}),e.jsx("p",{className:"text-sm mt-1",children:"Create your first expense to get started"})]})})}):s.map(w=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:w.title}),w.description&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:w.description})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${A(w.category)}`,children:w.category})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:[w.amount.toFixed(2)," ",w.currency]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(w.expenseDate).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:C(w.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[w.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>R(w.id),className:"text-green-600 hover:text-green-900",title:"Approve",children:e.jsx(ge,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>u(w.id),className:"text-red-600 hover:text-red-900",title:"Reject",children:e.jsx(Pe,{className:"h-5 w-5"})})]}),e.jsx("button",{onClick:()=>x(w),className:"text-blue-600 hover:text-blue-900",title:"Edit",children:e.jsx(Ge,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>c(w.id),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(qe,{className:"h-5 w-5"})})]})})]},w.id))})]})}),e.jsx(ur,{isOpen:i,onClose:()=>m(!1),onSuccess:()=>{m(!1),d()}}),e.jsx(hr,{isOpen:!!a,onClose:()=>x(null),onSuccess:()=>{x(null),d()},expense:a})]})},gr=()=>{const[s,b]=l.useState(null),[t,o]=l.useState(!0),[n,N]=l.useState(!1),[r,T]=l.useState("company"),[v,h]=l.useState(null),[k,j]=l.useState(!1);l.useEffect(()=>{y()},[]);const y=async()=>{try{const c=await(await fetch("/api/template-settings",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json();b(c.settings||g())}catch(d){console.error("Failed to load settings:",d),b(g())}finally{o(!1)}},g=()=>({companyName:"QGO Cargo",companyAddress:"Kuwait",companyPhone:"+965 XXXX XXXX",companyEmail:"info@qgocargo.com",companyWebsite:"www.qgocargo.com",invoiceTitle:"TAX INVOICE",releaseNoteTitle:"SHIPMENT RELEASE NOTE",invoicePrimaryColor:"#2563eb",releasePrimaryColor:"#1e40af",currencySymbol:"KD"}),i=async()=>{N(!0);try{await fetch("/api/template-settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(s)}),alert("Settings saved successfully!")}catch(d){console.error("Failed to save settings:",d),alert("Failed to save settings")}finally{N(!1)}},m=(d,c)=>{b(R=>({...R,[d]:c}))},a=async()=>{if(v){j(!0);try{const d=new FormData;d.append("logo",v);const R=await(await fetch("/api/upload/logo",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:d})).json();R.success&&R.fullUrl?(m("companyLogo",R.fullUrl),h(null),alert("Logo uploaded successfully!")):alert("Failed to upload logo: "+(R.error||"Unknown error"))}catch(d){console.error("Upload error:",d),alert("Failed to upload logo")}finally{j(!1)}}};if(t)return e.jsx("div",{className:"p-8",children:"Loading..."});const x=[{id:"company",name:"Company Info",icon:Ts},{id:"invoice",name:"Invoice Template",icon:we},{id:"release",name:"Release Note",icon:we},{id:"colors",name:"Colors & Styling",icon:ws},{id:"advanced",name:"Advanced",icon:Ts}];return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Template Settings"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Customize invoice and release note templates"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:x.map(d=>e.jsxs("button",{onClick:()=>T(d.id),className:`
                flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm
                ${r===d.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
              `,children:[e.jsx(d.icon,{className:"h-5 w-5"}),d.name]},d.id))})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[r==="company"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Company Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Logo"}),s.companyLogo&&e.jsx("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx("img",{src:s.companyLogo,alt:"Logo",className:"h-20 w-auto",onError:d=>{d.currentTarget.src="https://via.placeholder.com/150x60?text=Invalid+Image"}})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:d=>{var c;return h(((c=d.target.files)==null?void 0:c[0])||null)},className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsx("button",{onClick:a,disabled:!v||k,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:k?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block animate-spin mr-2",children:"⏳"}),"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"h-5 w-5 inline mr-2"}),"Upload"]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"OR"})})]}),e.jsx("input",{type:"url",value:s.companyLogo||"",onChange:d=>m("companyLogo",d.target.value),placeholder:"Paste logo URL (e.g., https://example.com/logo.png)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Accepted formats: JPG, PNG, GIF, SVG, WebP • Max size: 5MB"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),e.jsx("input",{type:"text",value:s.companyName||"",onChange:d=>m("companyName",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("textarea",{value:s.companyAddress||"",onChange:d=>m("companyAddress",d.target.value),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"text",value:s.companyPhone||"",onChange:d=>m("companyPhone",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsx("input",{type:"email",value:s.companyEmail||"",onChange:d=>m("companyEmail",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website"}),e.jsx("input",{type:"text",value:s.companyWebsite||"",onChange:d=>m("companyWebsite",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License/Registration No."}),e.jsx("input",{type:"text",value:s.companyLicense||"",onChange:d=>m("companyLicense",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]})]}),r==="invoice"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Invoice Template"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Title"}),e.jsx("input",{type:"text",value:s.invoiceTitle||"TAX INVOICE",onChange:d=>m("invoiceTitle",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Style"}),e.jsxs("select",{value:s.invoiceTemplateType||"STANDARD",onChange:d=>m("invoiceTemplateType",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"STANDARD",children:"Standard"}),e.jsx("option",{value:"MODERN",children:"Modern"}),e.jsx("option",{value:"MINIMAL",children:"Minimal"}),e.jsx("option",{value:"CLASSIC",children:"Classic"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Display Elements"}),e.jsx("div",{className:"space-y-2",children:[{key:"invoiceShowLogo",label:"Show Company Logo"},{key:"invoiceShowAddress",label:"Show Address"},{key:"invoiceShowPhone",label:"Show Phone"},{key:"invoiceShowEmail",label:"Show Email"},{key:"invoiceShowWebsite",label:"Show Website"},{key:"invoiceShowLicense",label:"Show License Number"},{key:"invoiceShowFooter",label:"Show Footer"}].map(d=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s[d.key]!==!1,onChange:c=>m(d.key,c.target.checked),className:"rounded border-gray-300 text-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:d.label})]},d.key))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Terms & Conditions"}),e.jsx("textarea",{value:s.invoiceTerms||"",onChange:d=>m("invoiceTerms",d.target.value),rows:6,placeholder:"Enter default terms and conditions for invoices...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Footer Text"}),e.jsx("input",{type:"text",value:s.invoiceFooterText||"",onChange:d=>m("invoiceFooterText",d.target.value),placeholder:"Thank you for your business!",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]}),r==="release"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Release Note Template"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Release Note Title"}),e.jsx("input",{type:"text",value:s.releaseNoteTitle||"SHIPMENT RELEASE NOTE",onChange:d=>m("releaseNoteTitle",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Style"}),e.jsxs("select",{value:s.releaseNoteTemplate||"PROFESSIONAL",onChange:d=>m("releaseNoteTemplate",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"PROFESSIONAL",children:"Professional"}),e.jsx("option",{value:"COMPACT",children:"Compact"}),e.jsx("option",{value:"DETAILED",children:"Detailed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Display Sections"}),e.jsx("div",{className:"space-y-2",children:[{key:"releaseNoteShowLogo",label:"Show Company Logo"},{key:"releaseShowShipment",label:"Show Shipment Details"},{key:"releaseShowStorage",label:"Show Storage Information"},{key:"releaseShowItems",label:"Show Items Released"},{key:"releaseShowCollector",label:"Show Collector Information"},{key:"releaseShowCharges",label:"Show Charges & Payment"},{key:"releaseShowPhotos",label:"Show Release Photos"},{key:"releaseShowTerms",label:"Show Terms & Conditions"},{key:"releaseShowSignatures",label:"Show Signature Spaces"}].map(d=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s[d.key]!==!1,onChange:c=>m(d.key,c.target.checked),className:"rounded border-gray-300 text-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:d.label})]},d.key))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Terms & Conditions"}),e.jsx("textarea",{value:s.releaseTerms||"",onChange:d=>m("releaseTerms",d.target.value),rows:6,placeholder:"Enter terms and conditions for release notes...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Footer Text"}),e.jsx("input",{type:"text",value:s.releaseFooterText||"",onChange:d=>m("releaseFooterText",d.target.value),placeholder:"Thank you for choosing our services!",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]}),r==="colors"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Colors & Styling"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Invoice Colors"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.invoicePrimaryColor||"#2563eb",onChange:d=>m("invoicePrimaryColor",d.target.value),className:"h-10 w-20"}),e.jsx("input",{type:"text",value:s.invoicePrimaryColor||"#2563eb",onChange:d=>m("invoicePrimaryColor",d.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Header Background"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.invoiceHeaderBg||"#2563eb",onChange:d=>m("invoiceHeaderBg",d.target.value),className:"h-10 w-20"}),e.jsx("input",{type:"text",value:s.invoiceHeaderBg||"#2563eb",onChange:d=>m("invoiceHeaderBg",d.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Release Note Colors"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.releasePrimaryColor||"#1e40af",onChange:d=>m("releasePrimaryColor",d.target.value),className:"h-10 w-20"}),e.jsx("input",{type:"text",value:s.releasePrimaryColor||"#1e40af",onChange:d=>m("releasePrimaryColor",d.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Header Background"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",value:s.releaseNoteHeaderBg||"#1e40af",onChange:d=>m("releaseNoteHeaderBg",d.target.value),className:"h-10 w-20"}),e.jsx("input",{type:"text",value:s.releaseNoteHeaderBg||"#1e40af",onChange:d=>m("releaseNoteHeaderBg",d.target.value),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Font Size"}),e.jsxs("select",{value:s.invoiceFontSize||"MEDIUM",onChange:d=>m("invoiceFontSize",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"SMALL",children:"Small"}),e.jsx("option",{value:"MEDIUM",children:"Medium"}),e.jsx("option",{value:"LARGE",children:"Large"})]})]})]}),r==="advanced"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Advanced Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Currency Symbol"}),e.jsx("input",{type:"text",value:s.currencySymbol||"KD",onChange:d=>m("currencySymbol",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Currency Position"}),e.jsxs("select",{value:s.currencyPosition||"AFTER",onChange:d=>m("currencyPosition",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"BEFORE",children:"Before ($ 100)"}),e.jsx("option",{value:"AFTER",children:"After (100 KD)"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Format"}),e.jsxs("select",{value:s.dateFormat||"MMM dd, yyyy",onChange:d=>m("dateFormat",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"MMM dd, yyyy",children:"Oct 13, 2025"}),e.jsx("option",{value:"dd/MM/yyyy",children:"13/10/2025"}),e.jsx("option",{value:"yyyy-MM-dd",children:"2025-10-13"}),e.jsx("option",{value:"dd MMMM yyyy",children:"13 October 2025"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time Format"}),e.jsxs("select",{value:s.timeFormat||"hh:mm a",onChange:d=>m("timeFormat",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"hh:mm a",children:"03:30 PM"}),e.jsx("option",{value:"HH:mm",children:"15:30"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paper Size"}),e.jsxs("select",{value:s.invoicePaperSize||"A4",onChange:d=>m("invoicePaperSize",d.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"A4",children:"A4 (210 × 297 mm)"}),e.jsx("option",{value:"LETTER",children:"Letter (8.5 × 11 in)"}),e.jsx("option",{value:"A5",children:"A5 (148 × 210 mm)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Print Margins (mm)"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:["Top","Bottom","Left","Right"].map(d=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:d}),e.jsx("input",{type:"number",value:s[`printMargin${d}`]||10,onChange:c=>m(`printMargin${d}`,parseInt(c.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Signature Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.requireStaffSignature!==!1,onChange:d=>m("requireStaffSignature",d.target.checked),className:"rounded border-gray-300 text-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Require Staff Signature"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.requireClientSignature!==!1,onChange:d=>m("requireClientSignature",d.target.checked),className:"rounded border-gray-300 text-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Require Client Signature"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center mb-3",children:[e.jsx("input",{type:"checkbox",checked:s.showQRCode===!0,onChange:d=>m("showQRCode",d.target.checked),className:"rounded border-gray-300 text-primary-600"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"Show QR Code on Documents"})]}),s.showQRCode&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 ml-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Position"}),e.jsxs("select",{value:s.qrCodePosition||"TOP_RIGHT",onChange:d=>m("qrCodePosition",d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"TOP_RIGHT",children:"Top Right"}),e.jsx("option",{value:"TOP_LEFT",children:"Top Left"}),e.jsx("option",{value:"BOTTOM_RIGHT",children:"Bottom Right"}),e.jsx("option",{value:"BOTTOM_LEFT",children:"Bottom Left"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Size (px)"}),e.jsx("input",{type:"number",value:s.qrCodeSize||100,onChange:d=>m("qrCodeSize",parseInt(d.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"})]})]})]})]}),e.jsxs("div",{className:"mt-8 flex items-center justify-between pt-6 border-t",children:[e.jsxs("button",{className:"flex items-center gap-2 text-primary-600 hover:text-primary-700",children:[e.jsx(ds,{className:"h-5 w-5"}),"Preview Templates"]}),e.jsx("button",{onClick:i,disabled:n,className:"flex items-center gap-2 px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-5 w-5"}),"Save Settings"]})})]})]})]})},br=()=>{const[s,b]=l.useState("personal"),[t,o]=l.useState(null),[n,N]=l.useState(null),[r,T]=l.useState(!0),[v,h]=l.useState(!1),[k,j]=l.useState(null),[y,g]=l.useState({name:"",phone:"",skills:"",position:"",department:""}),[i,m]=l.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[a,x]=l.useState("");l.useEffect(()=>{d(),c()},[]);const d=async()=>{try{const p=localStorage.getItem("authToken"),f=await Qe.get("/api/users/profile/me",{headers:{Authorization:`Bearer ${p}`}});if(f.data.success){const D=f.data.data;o(D),g({name:D.name||"",phone:D.phone||"",skills:D.skills||"",position:D.position||"",department:D.department||""}),x(D.avatar||"")}}catch(p){console.error("Failed to fetch profile:",p),R("error","Failed to load profile")}finally{T(!1)}},c=async()=>{try{const p=localStorage.getItem("authToken"),f=await Qe.get("/api/users/profile/stats",{headers:{Authorization:`Bearer ${p}`}});f.data.success&&N(f.data.data.stats)}catch(p){console.error("Failed to fetch stats:",p)}},R=(p,f)=>{j({type:p,text:f}),setTimeout(()=>j(null),5e3)},u=async p=>{var f,D;p.preventDefault(),h(!0);try{const L=localStorage.getItem("authToken"),q=await Qe.put("/api/users/profile/me",y,{headers:{Authorization:`Bearer ${L}`}});q.data.success&&(o(q.data.data),R("success","Profile updated successfully!"))}catch(L){console.error("Failed to update profile:",L),R("error",((D=(f=L.response)==null?void 0:f.data)==null?void 0:D.error)||"Failed to update profile")}finally{h(!1)}},C=async p=>{var f,D;if(p.preventDefault(),i.newPassword!==i.confirmPassword){R("error","New passwords do not match");return}if(i.newPassword.length<6){R("error","Password must be at least 6 characters long");return}h(!0);try{const L=localStorage.getItem("authToken");(await Qe.put("/api/users/profile/password",{currentPassword:i.currentPassword,newPassword:i.newPassword},{headers:{Authorization:`Bearer ${L}`}})).data.success&&(m({currentPassword:"",newPassword:"",confirmPassword:""}),R("success","Password changed successfully!"))}catch(L){console.error("Failed to change password:",L),R("error",((D=(f=L.response)==null?void 0:f.data)==null?void 0:D.error)||"Failed to change password")}finally{h(!1)}},A=async()=>{var p,f;if(!a.trim()){R("error","Please enter an avatar URL");return}h(!0);try{const D=localStorage.getItem("authToken");(await Qe.put("/api/users/profile/avatar",{avatar:a},{headers:{Authorization:`Bearer ${D}`}})).data.success&&(t&&o({...t,avatar:a}),R("success","Avatar updated successfully!"))}catch(D){console.error("Failed to update avatar:",D),R("error",((f=(p=D.response)==null?void 0:p.data)==null?void 0:f.error)||"Failed to update avatar")}finally{h(!1)}},w=p=>{switch(p){case"ADMIN":return"bg-red-100 text-red-800";case"MANAGER":return"bg-green-100 text-green-800";case"WORKER":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 h-32"}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsxs("div",{className:"flex items-end -mt-16 mb-4",children:[e.jsxs("div",{className:"relative",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-32 h-32 rounded-full border-4 border-white shadow-lg object-cover"}):e.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-white shadow-lg bg-gray-200 flex items-center justify-center",children:e.jsx(ks,{className:"w-16 h-16 text-gray-400"})}),e.jsx("button",{onClick:()=>b("personal"),className:"absolute bottom-0 right-0 bg-blue-600 text-white p-2 rounded-full shadow-lg hover:bg-blue-700 transition-colors",children:e.jsx(fs,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"ml-6 flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.name}),e.jsx("p",{className:"text-gray-600",children:t.email}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${w(t.role)}`,children:t.role}),t.position&&e.jsxs("span",{className:"text-gray-600 text-sm",children:["• ",t.position]}),t.department&&e.jsxs("span",{className:"text-gray-600 text-sm",children:["• ",t.department]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 flex items-center gap-4",children:[t.company.logo?e.jsx("img",{src:t.company.logo,alt:t.company.name,className:"w-12 h-12 object-contain"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded flex items-center justify-center",children:e.jsx(_s,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.company.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Plan: ",t.company.plan]})]})]})]})]}),k&&e.jsx("div",{className:`px-4 py-3 rounded-lg border ${k.type==="success"?"bg-green-50 border-green-200 text-green-700":"bg-red-50 border-red-200 text-red-700"}`,children:k.text}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsxs("button",{onClick:()=>b("personal"),className:`px-6 py-3 border-b-2 font-medium text-sm ${s==="personal"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(ks,{className:"w-4 h-4 inline mr-2"}),"Personal Info"]}),e.jsxs("button",{onClick:()=>b("security"),className:`px-6 py-3 border-b-2 font-medium text-sm ${s==="security"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(Ks,{className:"w-4 h-4 inline mr-2"}),"Security"]}),e.jsxs("button",{onClick:()=>b("activity"),className:`px-6 py-3 border-b-2 font-medium text-sm ${s==="activity"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(Ls,{className:"w-4 h-4 inline mr-2"}),"Activity"]})]})}),e.jsxs("div",{className:"p-6",children:[s==="personal"&&e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ks,{className:"w-4 h-4 inline mr-1"}),"Full Name"]}),e.jsx("input",{type:"text",value:y.name,onChange:p=>g({...y,name:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Jt,{className:"w-4 h-4 inline mr-1"}),"Email"]}),e.jsx("input",{type:"email",value:t.email,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Email cannot be changed"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Gt,{className:"w-4 h-4 inline mr-1"}),"Phone"]}),e.jsx("input",{type:"tel",value:y.phone,onChange:p=>g({...y,phone:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Qs,{className:"w-4 h-4 inline mr-1"}),"Position"]}),e.jsx("input",{type:"text",value:y.position,onChange:p=>g({...y,position:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Warehouse Manager"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(_s,{className:"w-4 h-4 inline mr-1"}),"Department"]}),e.jsx("input",{type:"text",value:y.department,onChange:p=>g({...y,department:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Operations"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ht,{className:"w-4 h-4 inline mr-1"}),"Role"]}),e.jsx("input",{type:"text",value:t.role,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Role can only be changed by admins"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Skills"}),e.jsx("textarea",{value:y.skills,onChange:p=>g({...y,skills:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"e.g., Forklift, Inventory Management, Safety Certified"})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Avatar"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"url",value:a,onChange:p=>x(p.target.value),placeholder:"Enter avatar URL",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{type:"button",onClick:A,disabled:v,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors disabled:opacity-50",children:"Update Avatar"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-6",children:[e.jsxs("button",{type:"button",onClick:()=>d(),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Se,{className:"w-4 h-4 inline mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:v,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(Ze,{className:"w-4 h-4 inline mr-2"}),v?"Saving...":"Save Changes"]})]})]}),s==="security"&&e.jsxs("form",{onSubmit:C,className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Change Password"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),e.jsx("input",{type:"password",value:i.currentPassword,onChange:p=>m({...i,currentPassword:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),e.jsx("input",{type:"password",value:i.newPassword,onChange:p=>m({...i,newPassword:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,minLength:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:i.confirmPassword,onChange:p=>m({...i,confirmPassword:p.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,minLength:6})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-800 font-semibold mb-2",children:"Password Requirements:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"At least 6 characters long"}),e.jsx("li",{children:"Use a mix of letters and numbers"}),e.jsx("li",{children:"Avoid common passwords"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-6",children:[e.jsxs("button",{type:"button",onClick:()=>m({currentPassword:"",newPassword:"",confirmPassword:""}),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Se,{className:"w-4 h-4 inline mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",disabled:v,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:[e.jsx(Ks,{className:"w-4 h-4 inline mr-2"}),v?"Changing...":"Change Password"]})]})]}),s==="activity"&&n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Rack Activities"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900 mt-2",children:n.rackActivities})]}),e.jsx(Ls,{className:"w-12 h-12 text-blue-400"})]})}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Job Assignments"}),e.jsx("p",{className:"text-3xl font-bold text-green-900 mt-2",children:n.jobAssignments})]}),e.jsx(Qs,{className:"w-12 h-12 text-green-400"})]})}),e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Days Active"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900 mt-2",children:n.daysSinceJoined})]}),e.jsx(Vs,{className:"w-12 h-12 text-purple-400"})]})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Account Information"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Account Created:"}),e.jsx("span",{className:"font-medium",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Last Updated:"}),e.jsx("span",{className:"font-medium",children:new Date(t.updatedAt).toLocaleDateString()})]}),n.lastLoginAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Last Login:"}),e.jsx("span",{className:"font-medium",children:new Date(n.lastLoginAt).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Account Status:"}),e.jsx("span",{className:`font-medium ${t.isActive?"text-green-600":"text-red-600"}`,children:t.isActive?"Active":"Inactive"})]})]})]})]})]})]})]}):e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:"Failed to load profile"})},yr=()=>{const[s,b]=l.useState([]),[t,o]=l.useState([]),[n,N]=l.useState("materials"),[r,T]=l.useState(!1),[v,h]=l.useState({sku:"",name:"",category:"",unit:"PCS",minStockLevel:0});l.useEffect(()=>{k(),j()},[]);const k=async()=>{try{const g=await fetch("/api/materials",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(g.ok){const i=await g.json();b(i)}}catch(g){console.error("Failed to fetch materials:",g)}},j=async()=>{try{const g=await fetch("/api/materials/issues",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(g.ok){const i=await g.json();o(i)}}catch(g){console.error("Failed to fetch issues:",g)}},y=async g=>{g.preventDefault();try{(await fetch("/api/materials",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(v)})).ok&&(T(!1),h({sku:"",name:"",category:"",unit:"PCS",minStockLevel:0}),k())}catch(i){console.error("Failed to add material:",i)}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"mb-4",children:"Materials Management"}),e.jsxs("div",{className:"mb-4",style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("button",{onClick:()=>N("materials"),style:{padding:"10px 20px",backgroundColor:n==="materials"?"#007bff":"transparent",color:n==="materials"?"white":"black",border:"none",cursor:"pointer",marginRight:"10px"},children:"Materials Catalog"}),e.jsx("button",{onClick:()=>N("issues"),style:{padding:"10px 20px",backgroundColor:n==="issues"?"#007bff":"transparent",color:n==="issues"?"white":"black",border:"none",cursor:"pointer",marginRight:"10px"},children:"Material Issues"}),e.jsx("button",{onClick:()=>N("returns"),style:{padding:"10px 20px",backgroundColor:n==="returns"?"#007bff":"transparent",color:n==="returns"?"white":"black",border:"none",cursor:"pointer"},children:"Material Returns & Damage"})]}),n==="materials"&&e.jsxs("div",{children:[e.jsx("button",{onClick:()=>T(!r),style:{padding:"8px 16px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"20px"},children:r?"Cancel":"Add Material"}),r&&e.jsx("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"4px",marginBottom:"20px"},children:e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"SKU"}),e.jsx("input",{type:"text",required:!0,value:v.sku,onChange:g=>h({...v,sku:g.target.value}),style:{width:"100%",padding:"8px",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Name"}),e.jsx("input",{type:"text",required:!0,value:v.name,onChange:g=>h({...v,name:g.target.value}),style:{width:"100%",padding:"8px",boxSizing:"border-box"}})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px"},children:"Category"}),e.jsx("input",{type:"text",required:!0,value:v.category,onChange:g=>h({...v,category:g.target.value}),style:{width:"100%",padding:"8px",boxSizing:"border-box"}})]}),e.jsx("button",{type:"submit",style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Create Material"})]})}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"SKU"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Name"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Category"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Unit"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Min Stock"})]})}),e.jsx("tbody",{children:s.map(g=>e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:g.sku}),e.jsx("td",{style:{padding:"12px"},children:g.name}),e.jsx("td",{style:{padding:"12px"},children:g.category}),e.jsx("td",{style:{padding:"12px"},children:g.unit}),e.jsx("td",{style:{padding:"12px"},children:g.minStockLevel})]},g.id))})]}),s.length===0&&e.jsx("p",{style:{textAlign:"center",color:"#6c757d",marginTop:"20px"},children:"No materials found. Create one to get started!"})]}),n==="issues"&&e.jsxs("div",{children:[e.jsx("h5",{style:{marginBottom:"20px"},children:"Material Issues (Allocations to Jobs)"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Material"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Quantity"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Total Cost"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Job ID"})]})}),e.jsx("tbody",{children:t.map(g=>{var i;return e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:(i=g.material)==null?void 0:i.name}),e.jsx("td",{style:{padding:"12px"},children:g.quantity}),e.jsxs("td",{style:{padding:"12px"},children:[g.totalCost.toFixed(2)," KWD"]}),e.jsx("td",{style:{padding:"12px"},children:g.jobId})]},g.id)})})]}),t.length===0&&e.jsx("p",{style:{textAlign:"center",color:"#6c757d",marginTop:"20px"},children:"No material issues recorded yet."})]}),n==="returns"&&e.jsxs("div",{children:[e.jsx("h5",{style:{marginBottom:"20px"},children:"Material Returns & Damage Tracking"}),e.jsx("p",{style:{color:"#6c757d"},children:"Track material returns after job completion and record damage."}),e.jsx("div",{style:{padding:"20px",backgroundColor:"#e7f3ff",borderRadius:"4px",marginTop:"20px"},children:e.jsx("p",{children:"📋 Coming soon: Return request form and damage photo upload"})})]})]})},fr=()=>{const[s,b]=l.useState(null),[t,o]=l.useState([]),[n,N]=l.useState("summary"),[r,T]=l.useState(!1);l.useEffect(()=>{v()},[]);const v=async()=>{T(!0);try{const[k,j]=await Promise.all([fetch("/api/reports/profitability",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),fetch("/api/reports/material-costs",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})]);if(k.ok){const y=await k.json();b(y)}if(j.ok){const y=await j.json();o(y)}}catch(k){console.error("Failed to fetch reports:",k)}finally{T(!1)}},h=k=>`${k.toFixed(2)} KWD`;return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"mb-4",children:"Job Reports & Financial Analytics"}),e.jsxs("div",{className:"mb-4",style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("button",{onClick:()=>N("summary"),style:{padding:"10px 20px",backgroundColor:n==="summary"?"#007bff":"transparent",color:n==="summary"?"white":"black",border:"none",cursor:"pointer",marginRight:"10px"},children:"Profitability Summary"}),e.jsx("button",{onClick:()=>N("details"),style:{padding:"10px 20px",backgroundColor:n==="details"?"#007bff":"transparent",color:n==="details"?"white":"black",border:"none",cursor:"pointer",marginRight:"10px"},children:"Cost Breakdown"}),e.jsx("button",{onClick:()=>N("costs"),style:{padding:"10px 20px",backgroundColor:n==="costs"?"#007bff":"transparent",color:n==="costs"?"white":"black",border:"none",cursor:"pointer"},children:"Material Costs"})]}),r?e.jsx("p",{children:"Loading reports..."}):e.jsxs(e.Fragment,{children:[n==="summary"&&s&&e.jsx("div",{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"30px"},children:[e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",borderLeft:"4px solid #28a745"},children:[e.jsx("h6",{style:{color:"#6c757d",marginBottom:"10px"},children:"Total Revenue"}),e.jsx("h3",{style:{fontSize:"24px",fontWeight:"bold",color:"#28a745"},children:h(s.totalRevenue)})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",borderLeft:"4px solid #dc3545"},children:[e.jsx("h6",{style:{color:"#6c757d",marginBottom:"10px"},children:"Total Costs"}),e.jsx("h3",{style:{fontSize:"24px",fontWeight:"bold",color:"#dc3545"},children:h(s.totalCosts)})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",borderLeft:`4px solid ${s.totalProfit>=0?"#28a745":"#dc3545"}`},children:[e.jsx("h6",{style:{color:"#6c757d",marginBottom:"10px"},children:"Total Profit"}),e.jsx("h3",{style:{fontSize:"24px",fontWeight:"bold",color:s.totalProfit>=0?"#28a745":"#dc3545"},children:h(s.totalProfit)})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",borderLeft:"4px solid #007bff"},children:[e.jsx("h6",{style:{color:"#6c757d",marginBottom:"10px"},children:"Avg Profit Margin"}),e.jsxs("h3",{style:{fontSize:"24px",fontWeight:"bold",color:"#007bff"},children:[s.avgProfitMargin.toFixed(1),"%"]})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"20px",borderRadius:"8px",borderLeft:"4px solid #17a2b8"},children:[e.jsx("h6",{style:{color:"#6c757d",marginBottom:"10px"},children:"Jobs Tracked"}),e.jsx("h3",{style:{fontSize:"24px",fontWeight:"bold",color:"#17a2b8"},children:s.jobCount})]})]})}),n==="details"&&s&&e.jsxs("div",{children:[e.jsx("h5",{style:{marginBottom:"20px"},children:"Cost Breakdown"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Cost Category"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Amount"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"% of Total"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:"Materials"}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:h(s.breakdown.materials)}),e.jsxs("td",{style:{padding:"12px",textAlign:"right"},children:[s.totalCosts>0?(s.breakdown.materials/s.totalCosts*100).toFixed(1):0,"%"]})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:"Labor"}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:h(s.breakdown.labor)}),e.jsxs("td",{style:{padding:"12px",textAlign:"right"},children:[s.totalCosts>0?(s.breakdown.labor/s.totalCosts*100).toFixed(1):0,"%"]})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:"Damage Loss"}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:h(s.breakdown.damage)}),e.jsxs("td",{style:{padding:"12px",textAlign:"right"},children:[s.totalCosts>0?(s.breakdown.damage/s.totalCosts*100).toFixed(1):0,"%"]})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:"Other"}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:h(s.breakdown.other)}),e.jsxs("td",{style:{padding:"12px",textAlign:"right"},children:[s.totalCosts>0?(s.breakdown.other/s.totalCosts*100).toFixed(1):0,"%"]})]}),e.jsxs("tr",{style:{backgroundColor:"#f8f9fa",fontWeight:"bold"},children:[e.jsx("td",{style:{padding:"12px"},children:"Total Costs"}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:h(s.totalCosts)}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:"100%"})]})]})]})]}),n==="costs"&&e.jsxs("div",{children:[e.jsx("h5",{style:{marginBottom:"20px"},children:"Material Cost Details"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Material"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"SKU"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Quantity"}),e.jsx("th",{style:{padding:"12px",textAlign:"right"},children:"Total Cost"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Job"})]})}),e.jsx("tbody",{children:t.map((k,j)=>e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:k.materialName}),e.jsx("td",{style:{padding:"12px"},children:k.materialSku}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:k.quantity}),e.jsx("td",{style:{padding:"12px",textAlign:"right"},children:h(k.totalCost)}),e.jsx("td",{style:{padding:"12px"},children:k.jobCode})]},j))})]}),t.length===0&&e.jsx("p",{style:{textAlign:"center",color:"#6c757d",marginTop:"20px"},children:"No material costs recorded yet."})]})]})]})},jr=()=>{var d;const[s,b]=l.useState([]),[t,o]=l.useState([]),[n,N]=l.useState("plugins"),[r,T]=l.useState(!1),[v,h]=l.useState(null),[k,j]=l.useState({name:"",version:"1.0.0",description:""});l.useEffect(()=>{y()},[]);const y=async()=>{T(!0);try{const c=await fetch("/api/plugins",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(c.ok){const R=await c.json();b(R)}}catch(c){console.error("Failed to fetch plugins:",c)}finally{T(!1)}},g=async c=>{try{const R=await fetch(`/api/plugins/${c}/logs`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(R.ok){const u=await R.json();o(u)}}catch(R){console.error("Failed to fetch plugin logs:",R)}},i=async c=>{c.preventDefault(),T(!0);try{(await fetch("/api/plugins",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(k)})).ok?(alert("Plugin installed successfully"),j({name:"",version:"1.0.0",description:""}),N("plugins"),y()):alert("Failed to install plugin")}catch(R){console.error("Installation error:",R),alert("Error installing plugin")}finally{T(!1)}},m=async(c,R)=>{try{(await fetch(`/api/plugins/${c}/${R?"activate":"deactivate"}`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok?y():alert("Failed to update plugin")}catch(u){console.error("Error:",u)}},a=async c=>{if(window.confirm("Are you sure you want to uninstall this plugin?"))try{(await fetch(`/api/plugins/${c}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok?(alert("Plugin uninstalled successfully"),y()):alert("Failed to uninstall plugin")}catch(R){console.error("Error:",R)}},x=c=>{switch(c){case"ACTIVE":return"#28a745";case"DISABLED":return"#ffc107";case"ERROR":return"#dc3545";default:return"#6c757d"}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"mb-4",children:"Plugin System Management"}),e.jsxs("div",{className:"mb-4",style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("button",{onClick:()=>N("plugins"),style:{padding:"10px 20px",backgroundColor:n==="plugins"?"#007bff":"transparent",color:n==="plugins"?"white":"black",border:"none",cursor:"pointer",marginRight:"10px"},children:"Installed Plugins"}),e.jsx("button",{onClick:()=>N("install"),style:{padding:"10px 20px",backgroundColor:n==="install"?"#007bff":"transparent",color:n==="install"?"white":"black",border:"none",cursor:"pointer",marginRight:"10px"},children:"Install Plugin"}),e.jsx("button",{onClick:()=>{N("logs"),v&&g(v)},style:{padding:"10px 20px",backgroundColor:n==="logs"?"#007bff":"transparent",color:n==="logs"?"white":"black",border:"none",cursor:"pointer"},children:"Audit Logs"})]}),r&&e.jsx("p",{children:"Loading..."}),n==="plugins"&&!r&&e.jsx("div",{children:s.length===0?e.jsx("p",{style:{color:"#6c757d"},children:"No plugins installed yet."}):e.jsx("div",{style:{display:"grid",gap:"15px"},children:s.map(c=>e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"8px",borderLeft:`4px solid ${x(c.status)}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"10px"},children:[e.jsxs("div",{children:[e.jsx("h5",{style:{marginBottom:"5px"},children:c.name}),e.jsxs("small",{style:{color:"#6c757d"},children:["Version ",c.version," • Installed: ",new Date(c.installDate).toLocaleDateString()]})]}),e.jsx("span",{style:{backgroundColor:x(c.status),color:"white",padding:"5px 10px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold"},children:c.status})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:()=>m(c.id,c.status!=="ACTIVE"),style:{padding:"8px 12px",backgroundColor:c.status==="ACTIVE"?"#ffc107":"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:c.status==="ACTIVE"?"Disable":"Enable"}),e.jsx("button",{onClick:()=>{h(c.id),N("logs"),g(c.id)},style:{padding:"8px 12px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"View Logs"}),e.jsx("button",{onClick:()=>a(c.id),style:{padding:"8px 12px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Uninstall"})]})]},c.id))})}),n==="install"&&e.jsxs("form",{onSubmit:i,style:{maxWidth:"500px"},children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Plugin Name *"}),e.jsx("input",{type:"text",required:!0,value:k.name,onChange:c=>j({...k,name:c.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"},placeholder:"e.g., Advanced Reporting"})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Version"}),e.jsx("input",{type:"text",value:k.version,onChange:c=>j({...k,version:c.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box"},placeholder:"1.0.0"})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Description"}),e.jsx("textarea",{value:k.description,onChange:c=>j({...k,description:c.target.value}),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box",minHeight:"100px"},placeholder:"Plugin description and features..."})]}),e.jsx("button",{type:"submit",disabled:r,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:r?"not-allowed":"pointer",fontWeight:"bold",opacity:r?.6:1},children:r?"Installing...":"Install Plugin"})]}),n==="logs"&&e.jsx("div",{children:v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:"20px"},children:e.jsxs("h5",{children:["Plugin: ",(d=s.find(c=>c.id===v))==null?void 0:d.name]})}),t.length===0?e.jsx("p",{style:{color:"#6c757d"},children:"No logs available for this plugin."}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f9fa",borderBottom:"2px solid #dee2e6"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Timestamp"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Action"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Performed By"}),e.jsx("th",{style:{padding:"12px",textAlign:"left"},children:"Details"})]})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{style:{borderBottom:"1px solid #dee2e6"},children:[e.jsx("td",{style:{padding:"12px"},children:new Date(c.timestamp).toLocaleString()}),e.jsx("td",{style:{padding:"12px"},children:e.jsx("span",{style:{backgroundColor:c.action==="INSTALLED"?"#28a745":c.action==="ACTIVATED"?"#17a2b8":c.action==="DEACTIVATED"?"#ffc107":c.action==="UNINSTALLED"?"#dc3545":"#6c757d",color:"white",padding:"4px 8px",borderRadius:"3px",fontSize:"12px",fontWeight:"bold"},children:c.action})}),e.jsx("td",{style:{padding:"12px"},children:c.performedBy}),e.jsx("td",{style:{padding:"12px",color:"#6c757d"},children:c.details||"-"})]},c.id))})]})]})})]})},Nr=()=>{const[s,b]=l.useState([]),[t,o]=l.useState([]),[n,N]=l.useState("PENDING"),[r,T]=l.useState("ALL"),[v,h]=l.useState(null),[k,j]=l.useState(""),[y,g]=l.useState(!1);l.useEffect(()=>{i()},[]),l.useEffect(()=>{m()},[s,n,r]);const i=async()=>{g(!0);try{const R=await fetch("/api/materials/approvals",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(R.ok){const u=await R.json();b(u)}}catch(R){console.error("Failed to fetch approvals:",R)}finally{g(!1)}},m=()=>{let R=s;n!=="ALL"&&(R=R.filter(u=>u.status===n)),r!=="ALL"&&(R=R.filter(u=>u.approvalType===r)),o(R)},a=async R=>{try{(await fetch(`/api/materials/approvals/${R}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({decision:"APPROVED",notes:k})})).ok?(alert("Approval recorded successfully"),h(null),j(""),i()):alert("Failed to record approval")}catch(u){console.error("Error:",u)}},x=async R=>{try{(await fetch(`/api/materials/approvals/${R}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({decision:"REJECTED",notes:k})})).ok?(alert("Rejection recorded successfully"),h(null),j(""),i()):alert("Failed to record rejection")}catch(u){console.error("Error:",u)}},d=R=>({DAMAGE:"#dc3545",PREMIUM_MATERIAL:"#007bff",QUANTITY_VARIATION:"#ffc107"})[R]||"#6c757d",c=R=>({PENDING:"#ffc107",APPROVED:"#28a745",REJECTED:"#dc3545"})[R]||"#6c757d";return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"mb-4",children:"Approval Workflow Management"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Status"}),e.jsxs("select",{value:n,onChange:R=>N(R.target.value),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px"},children:[e.jsx("option",{value:"ALL",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Type"}),e.jsxs("select",{value:r,onChange:R=>T(R.target.value),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px"},children:[e.jsx("option",{value:"ALL",children:"All Types"}),e.jsx("option",{value:"DAMAGE",children:"Damage Claims"}),e.jsx("option",{value:"PREMIUM_MATERIAL",children:"Premium Materials"}),e.jsx("option",{value:"QUANTITY_VARIATION",children:"Quantity Variations"})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsx("button",{onClick:i,style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Refresh"})})]}),y?e.jsx("p",{children:"Loading approvals..."}):t.length===0?e.jsx("p",{style:{color:"#6c757d"},children:"No approvals found."}):e.jsx("div",{style:{display:"grid",gap:"15px"},children:t.map(R=>e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"8px",borderLeft:`4px solid ${c(R.status)}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"10px"},children:[e.jsxs("div",{children:[e.jsx("h5",{style:{marginBottom:"5px"},children:R.materialName}),e.jsxs("small",{style:{color:"#6c757d"},children:["SKU: ",R.materialSku," • Category: ",R.category,R.jobCode&&` • Job: ${R.jobCode}`]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("span",{style:{backgroundColor:d(R.approvalType),color:"white",padding:"4px 8px",borderRadius:"3px",fontSize:"12px",fontWeight:"bold"},children:R.approvalType.replace(/_/g," ")}),e.jsx("span",{style:{backgroundColor:c(R.status),color:"white",padding:"4px 8px",borderRadius:"3px",fontSize:"12px",fontWeight:"bold"},children:R.status})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"15px",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("small",{style:{color:"#6c757d"},children:"Quantity"}),e.jsxs("p",{style:{fontWeight:"bold",margin:"3px 0"},children:[R.quantity," units"]})]}),e.jsxs("div",{children:[e.jsx("small",{style:{color:"#6c757d"},children:"Estimated Cost"}),e.jsxs("p",{style:{fontWeight:"bold",margin:"3px 0"},children:[R.estimatedCost.toFixed(2)," KWD"]})]}),e.jsxs("div",{children:[e.jsx("small",{style:{color:"#6c757d"},children:"Requested By"}),e.jsx("p",{style:{fontWeight:"bold",margin:"3px 0"},children:R.requestedBy})]}),e.jsxs("div",{children:[e.jsx("small",{style:{color:"#6c757d"},children:"Requested At"}),e.jsx("p",{style:{fontWeight:"bold",margin:"3px 0"},children:new Date(R.requestedAt).toLocaleDateString()})]})]}),R.status==="PENDING"&&e.jsx("button",{onClick:()=>h(R),style:{padding:"8px 12px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"Review & Decide"}),R.status!=="PENDING"&&e.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#e9ecef",borderRadius:"4px"},children:[e.jsxs("small",{style:{color:"#6c757d"},children:[e.jsx("strong",{children:"Decision:"})," ",R.status," by ",R.approvedBy," on"," ",R.approvedAt?new Date(R.approvedAt).toLocaleString():"N/A"]}),R.decisionNotes&&e.jsxs("p",{style:{margin:"5px 0",color:"#495057"},children:[e.jsx("strong",{children:"Notes:"})," ",R.decisionNotes]})]})]},R.id))}),v&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>h(null),children:e.jsxs("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"8px",maxWidth:"500px",width:"90%",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)"},onClick:R=>R.stopPropagation(),children:[e.jsx("h4",{style:{marginBottom:"15px"},children:"Review Approval Request"}),e.jsxs("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"4px"},children:[e.jsxs("small",{style:{color:"#6c757d"},children:[e.jsx("strong",{children:v.materialName})," (",v.materialSku,")"]}),e.jsxs("p",{style:{margin:"5px 0",fontWeight:"bold"},children:[v.quantity," units • ",v.estimatedCost.toFixed(2)," KWD"]})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Decision Notes"}),e.jsx("textarea",{value:k,onChange:R=>j(R.target.value),style:{width:"100%",padding:"8px",border:"1px solid #dee2e6",borderRadius:"4px",boxSizing:"border-box",minHeight:"80px"},placeholder:"Enter approval or rejection notes..."})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>h(null),style:{padding:"8px 16px",backgroundColor:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Cancel"}),e.jsx("button",{onClick:()=>x(v.id),style:{padding:"8px 16px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Reject"}),e.jsx("button",{onClick:()=>a(v.id),style:{padding:"8px 16px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:"Approve"})]})]})})]})},vr=({isOpen:s,onClose:b,materialId:t,materialName:o})=>{const[n,N]=l.useState([]),[r,T]=l.useState(!1),[v,h]=l.useState({currentStock:0,totalPurchased:0,totalIssued:0,totalReturned:0,totalDamaged:0});l.useEffect(()=>{s&&t&&k()},[s,t]);const k=async()=>{T(!0);try{const y=await(await fetch(`/api/materials/${t}/history`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json();N(y.transactions),h(y.summary)}catch(j){console.error("Failed to load transaction history:",j)}finally{T(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Je,{className:"w-6 h-6"}),"Transaction History"]}),e.jsx("p",{className:"text-blue-100 mt-1",children:o})]}),e.jsx("button",{onClick:b,className:"text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2",children:e.jsx(Se,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4 p-6 bg-gray-50 border-b",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Current Stock"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:v.currentStock})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Purchased"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["+",v.totalPurchased]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Issued"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["-",v.totalIssued]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Returned"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["+",v.totalReturned]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Damaged"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:v.totalDamaged})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading transactions..."})]}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Je,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No transactions found"})]}):e.jsx("div",{className:"space-y-4",children:n.map(j=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[j.type==="PURCHASE"&&e.jsx("div",{className:"bg-green-100 p-2 rounded-full",children:e.jsx(Xs,{className:"w-5 h-5 text-green-600"})}),j.type==="ISSUE"&&e.jsx("div",{className:"bg-orange-100 p-2 rounded-full",children:e.jsx(Ms,{className:"w-5 h-5 text-orange-600"})}),j.type==="RETURN"&&e.jsx("div",{className:"bg-blue-100 p-2 rounded-full",children:e.jsx(Xs,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[j.type==="PURCHASE"&&"Stock Purchase",j.type==="ISSUE"&&"Material Issued",j.type==="RETURN"&&"Material Returned",j.type==="ADJUSTMENT"&&"Stock Adjustment"]}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(Vs,{className:"w-4 h-4"}),new Date(j.date).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"ml-14 space-y-1",children:[j.details.jobCode&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Job:"})," ",e.jsx("span",{className:"text-blue-600",children:j.details.jobCode}),j.details.jobTitle&&` - ${j.details.jobTitle}`]}),j.details.purchaseOrderNo&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"PO:"})," ",j.details.purchaseOrderNo]}),j.details.supplier&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Supplier:"})," ",j.details.supplier]}),j.details.rack&&e.jsxs("p",{className:"text-sm flex items-center gap-1",children:[e.jsx(ut,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:"Rack:"})," ",j.details.rack]}),j.details.unitCost&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Unit Cost:"})," ₹",j.details.unitCost.toFixed(2)]}),j.details.notes&&e.jsx("p",{className:"text-sm text-gray-600 italic",children:j.details.notes})]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("p",{className:`text-2xl font-bold ${j.type==="PURCHASE"||j.type==="RETURN"?"text-green-600":"text-orange-600"}`,children:[j.type==="PURCHASE"||j.type==="RETURN"?"+":"-",j.quantity]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Balance: ",e.jsx("span",{className:"font-semibold text-gray-700",children:j.balanceAfter})]})]})]})},j.id))})}),e.jsx("div",{className:"border-t p-4 bg-gray-50 flex justify-end",children:e.jsx("button",{onClick:b,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Close"})})]})}):null},wr=()=>{const[s,b]=l.useState("materials"),[t,o]=l.useState([]),[n,N]=l.useState([]),[r,T]=l.useState([]),[v,h]=l.useState(!1),[k,j]=l.useState(""),[y,g]=l.useState(!1),[i,m]=l.useState(null),[a,x]=l.useState(!1),[d,c]=l.useState({name:"",parentId:"",description:""}),[R,u]=l.useState(!1),[C,A]=l.useState({sku:"",name:"",description:"",categoryId:"",unit:"PCS",minStockLevel:5,unitCost:0,sellingPrice:0}),[w,p]=l.useState(!1),[f,D]=l.useState({materialId:"",batchNumber:"",quantityReceived:0,unitCost:0,sellingPrice:0});l.useEffect(()=>{if(!localStorage.getItem("authToken")){console.warn("No token found, redirecting to login"),window.location.href="/login";return}q(),E()},[]);const L=()=>{const S=localStorage.getItem("authToken");return S?{Authorization:`Bearer ${S}`,"Content-Type":"application/json"}:null},q=async()=>{try{const S=L();if(!S){window.location.href="/login";return}const O=await fetch("/api/materials/categories",{headers:S});if(O.status===401||O.status===403){console.error("Authentication failed - invalid or expired token"),alert("Your session has expired. Please login again."),localStorage.removeItem("authToken"),window.location.href="/login";return}if(O.ok){const M=await O.json();o(M)}else console.error("Failed to fetch categories:",O.status)}catch(S){console.error("Failed to fetch categories:",S)}},E=async()=>{try{h(!0);const S=L();if(!S){window.location.href="/login";return}const O=await fetch("/api/materials",{headers:S});if(O.status===401||O.status===403){console.error("Authentication failed - invalid or expired token"),alert("Your session has expired. Please login again."),localStorage.removeItem("authToken"),window.location.href="/login";return}if(O.ok){const M=await O.json();N(M)}else console.error("Failed to fetch materials:",O.status)}catch(S){console.error("Failed to fetch materials:",S)}finally{h(!1)}},P=async S=>{try{const O=S?`/api/materials/${S}/stock`:"/api/materials/stock/all",M=await fetch(O,{headers:L()});if(M.ok){const H=await M.json();T(H)}}catch(O){console.error("Failed to fetch stock:",O)}},J=async S=>{S.preventDefault();try{const O=await fetch("/api/materials/categories",{method:"POST",headers:L(),body:JSON.stringify(d)});if(O.status===401||O.status===403){alert("Session expired. Please login again."),localStorage.removeItem("authToken"),window.location.href="/login";return}if(O.ok)alert("Category added successfully!"),x(!1),c({name:"",parentId:"",description:""}),q();else{const M=await O.json();alert(M.error||"Failed to add category")}}catch{alert("Failed to add category")}},F=async S=>{S.preventDefault();try{const O=await fetch("/api/materials",{method:"POST",headers:L(),body:JSON.stringify(C)});if(O.status===401||O.status===403){alert("Session expired. Please login again."),localStorage.removeItem("authToken"),window.location.href="/login";return}if(O.ok)alert("Material added successfully!"),u(!1),A({sku:"",name:"",description:"",categoryId:"",unit:"PCS",minStockLevel:5,unitCost:0,sellingPrice:0}),E();else{const M=await O.json();alert(M.error||"Failed to add material")}}catch{alert("Failed to add material")}},z=async S=>{S.preventDefault();try{const O=await fetch("/api/materials/stock",{method:"POST",headers:L(),body:JSON.stringify(f)});if(O.ok)alert("Stock added successfully!"),p(!1),D({materialId:"",batchNumber:"",quantityReceived:0,unitCost:0,sellingPrice:0}),E(),P();else{const M=await O.json();alert(M.error||"Failed to add stock")}}catch{alert("Failed to add stock")}},K=(S,O=0)=>S.map(M=>e.jsxs("div",{style:{marginLeft:`${O*20}px`},className:"border-l-2 border-gray-200 pl-4 my-2",children:[e.jsx("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(As,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:M.name}),e.jsx("p",{className:"text-sm text-gray-500",children:M.description}),M._count&&e.jsxs("span",{className:"text-xs text-gray-400",children:[M._count.materials," materials"]})]})]})}),M.children&&M.children.length>0&&K(M.children,O+1)]},M.id)),V=n.filter(S=>S.name.toLowerCase().includes(k.toLowerCase())||S.sku.toLowerCase().includes(k.toLowerCase()));return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Material Management"})}),e.jsxs("div",{className:"flex gap-4 mb-6 border-b",children:[e.jsxs("button",{onClick:()=>b("categories"),className:`px-6 py-3 font-semibold transition ${s==="categories"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(As,{className:"w-5 h-5 inline mr-2"}),"Categories"]}),e.jsxs("button",{onClick:()=>b("materials"),className:`px-6 py-3 font-semibold transition ${s==="materials"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(Je,{className:"w-5 h-5 inline mr-2"}),"Materials"]}),e.jsxs("button",{onClick:()=>{b("stock"),P()},className:`px-6 py-3 font-semibold transition ${s==="stock"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(_t,{className:"w-5 h-5 inline mr-2"}),"Stock Batches"]})]}),s==="categories"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Material Categories"}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(ms,{className:"w-5 h-5"}),"Add Category"]})]}),a&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"New Category"}),e.jsx("button",{onClick:()=>x(!1),children:e.jsx(Se,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category Name *"}),e.jsx("input",{type:"text",required:!0,value:d.name,onChange:S=>c({...d,name:S.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"e.g., Boxes, Tape, Bubble Wrap"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Parent Category"}),e.jsxs("select",{value:d.parentId,onChange:S=>c({...d,parentId:S.target.value}),className:"w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"-- Root Category --"}),t.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:S=>c({...d,description:S.target.value}),className:"w-full border rounded-lg px-3 py-2",rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(Ze,{className:"w-4 h-4 inline mr-2"}),"Save Category"]}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(As,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No categories yet. Add your first category to organize materials."})]}):K(t)})]}),s==="materials"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"flex-1 mr-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(Kt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search materials...",value:k,onChange:S=>j(S.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg"})]})}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(ms,{className:"w-5 h-5"}),"Add Material"]})]}),R&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"New Material"}),e.jsx("button",{onClick:()=>u(!1),children:e.jsx(Se,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:F,className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"SKU *"}),e.jsx("input",{type:"text",required:!0,value:C.sku,onChange:S=>A({...C,sku:S.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"MAT-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Material Name *"}),e.jsx("input",{type:"text",required:!0,value:C.name,onChange:S=>A({...C,name:S.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"Large Moving Box"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{value:C.description,onChange:S=>A({...C,description:S.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"Optional description...",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Category *"}),e.jsxs("select",{required:!0,value:C.categoryId,onChange:S=>A({...C,categoryId:S.target.value}),className:"w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"-- Select Category --"}),t.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Unit"}),e.jsxs("select",{value:C.unit,onChange:S=>A({...C,unit:S.target.value}),className:"w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"PCS",children:"Pieces"}),e.jsx("option",{value:"ROLL",children:"Roll"}),e.jsx("option",{value:"BOX",children:"Box"}),e.jsx("option",{value:"KG",children:"Kilogram"}),e.jsx("option",{value:"METER",children:"Meter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Min Stock Level *"}),e.jsx("input",{type:"number",required:!0,value:C.minStockLevel===0?"":C.minStockLevel,onChange:S=>A({...C,minStockLevel:S.target.value===""?0:parseInt(S.target.value)}),className:"w-full border rounded-lg px-3 py-2",placeholder:"Enter minimum stock"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Unit Cost (KWD)"}),e.jsx("input",{type:"number",step:"0.01",value:C.unitCost===0?"":C.unitCost,onChange:S=>A({...C,unitCost:S.target.value===""?0:parseFloat(S.target.value)}),className:"w-full border rounded-lg px-3 py-2",placeholder:"Enter unit cost"})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 w-full",children:[e.jsx(Ze,{className:"w-4 h-4 inline mr-2"}),"Save Material"]})})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Material Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Unit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"Loading..."})}):V.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"No materials found. Add your first material to get started."})}):V.map(S=>{var O;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:S.sku}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:S.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:((O=S.materialCategory)==null?void 0:O.name)||"Uncategorized"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[e.jsx("span",{className:`font-bold ${S.totalQuantity<S.minStockLevel?"text-red-600":"text-green-600"}`,children:S.totalQuantity}),S.totalQuantity<S.minStockLevel&&e.jsx(Qt,{className:"w-4 h-4 inline ml-2 text-red-600"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:S.unit}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${S.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:S.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("button",{onClick:()=>{m(S),g(!0)},className:"px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center gap-1",children:[e.jsx(Xt,{className:"w-4 h-4"}),"History"]})})]},S.id)})})]})})]}),s==="stock"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Stock Management"}),e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:[e.jsx(ms,{className:"w-5 h-5"}),"Add Stock"]})]}),w&&e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Add Stock Batch"}),e.jsx("button",{onClick:()=>p(!1),children:e.jsx(Se,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:z,className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Material *"}),e.jsxs("select",{required:!0,value:f.materialId,onChange:S=>D({...f,materialId:S.target.value}),className:"w-full border rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",children:"-- Select Material --"}),n.map(S=>e.jsxs("option",{value:S.id,children:[S.sku," - ",S.name]},S.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Batch Number *"}),e.jsx("input",{type:"text",required:!0,value:f.batchNumber,onChange:S=>D({...f,batchNumber:S.target.value}),className:"w-full border rounded-lg px-3 py-2",placeholder:"BATCH-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Quantity *"}),e.jsx("input",{type:"number",required:!0,min:"1",value:f.quantityReceived,onChange:S=>D({...f,quantityReceived:S.target.value===""?0:parseInt(S.target.value)||0}),className:"w-full border rounded-lg px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Unit Cost (KWD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:f.unitCost,onChange:S=>D({...f,unitCost:S.target.value===""?0:parseFloat(S.target.value)||0}),className:"w-full border rounded-lg px-3 py-2"})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 w-full",children:[e.jsx(Ze,{className:"w-4 h-4 inline mr-2"}),"Add Stock"]})})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Batch #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Material"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Received"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Remaining"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Unit Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"No stock batches found."})}):r.map(S=>{var O,M;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:S.batchNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:((O=S.material)==null?void 0:O.name)||((M=n.find(H=>H.id===S.materialId))==null?void 0:M.name)||"Unknown"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:S.quantityPurchased||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:S.quantityRemaining===0?"text-red-600":"text-green-600",children:S.quantityRemaining})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[S.unitCost.toFixed(2)," KWD"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:new Date(S.purchaseDate).toLocaleDateString()})]},S.id)})})]})})]}),e.jsx(vr,{isOpen:y,onClose:()=>g(!1),materialId:(i==null?void 0:i.id)||"",materialName:(i==null?void 0:i.name)||""})]})},Cr=()=>{const[s,b]=l.useState("overview"),[t,o]=l.useState(!1),[n,N]=l.useState({start:"",end:""}),[r,T]=l.useState(null),[v,h]=l.useState([]),[k,j]=l.useState(null),[y,g]=l.useState(null),[i,m]=l.useState([]),[a,x]=l.useState(null);l.useEffect(()=>{d()},[s,n]);const d=async()=>{o(!0);const C={Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"};try{switch(s){case"overview":case"stock":const w=await(await fetch("/api/materials/reports/stock-summary",{headers:C})).json();T(w);break;case"low-stock":const f=await(await fetch("/api/materials/reports/low-stock",{headers:C})).json();h(f.lowStockAlerts||[]);break;case"consumption":const D=`/api/materials/reports/consumption?startDate=${n.start}&endDate=${n.end}`,q=await(await fetch(D,{headers:C})).json();j(q);break;case"purchases":const E=`/api/materials/reports/purchase-history?startDate=${n.start}&endDate=${n.end}`,J=await(await fetch(E,{headers:C})).json();g(J);break;case"vendors":const z=await(await fetch("/api/materials/reports/vendor-performance",{headers:C})).json();m(z.vendors||[]);break;case"valuation":const V=await(await fetch("/api/materials/reports/valuation",{headers:C})).json();x(V);break}}catch(A){console.error("Failed to load report:",A)}finally{o(!1)}},c=(u,C)=>{const A=[Object.keys(u[0]).join(","),...u.map(D=>Object.values(D).join(","))].join(`
`),w=new Blob([A],{type:"text/csv"}),p=window.URL.createObjectURL(w),f=document.createElement("a");f.href=p,f.download=`${C}-${new Date().toISOString().split("T")[0]}.csv`,f.click()},R=["#4F46E5","#10B981","#F59E0B","#EF4444","#8B5CF6"];return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Material Reports & Analytics"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:n.start,onChange:u=>N({...n,start:u.target.value}),className:"border rounded px-3 py-2"}),e.jsx("input",{type:"date",value:n.end,onChange:u=>N({...n,end:u.target.value}),className:"border rounded px-3 py-2"}),e.jsxs("button",{onClick:d,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Apply Filter"]})]})]}),e.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto",children:[{id:"overview",label:"Overview",icon:Ls},{id:"stock",label:"Stock Summary",icon:Je},{id:"low-stock",label:"Low Stock Alerts",icon:gs},{id:"consumption",label:"Consumption",icon:Ms},{id:"purchases",label:"Purchase History",icon:Zt},{id:"vendors",label:"Vendor Performance",icon:Is},{id:"valuation",label:"Stock Valuation",icon:Ys}].map(u=>e.jsxs("button",{onClick:()=>b(u.id),className:`flex items-center gap-2 px-4 py-2 rounded whitespace-nowrap ${s===u.id?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:[e.jsx(u.icon,{className:"w-4 h-4"}),u.label]},u.id))}),t?e.jsx("div",{className:"text-center py-12",children:"Loading report data..."}):e.jsxs(e.Fragment,{children:[s==="overview"&&r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Materials"}),e.jsx("p",{className:"text-2xl font-bold",children:r.totals.totalMaterials})]}),e.jsx(Je,{className:"w-10 h-10 text-blue-600"})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Low Stock Items"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r.totals.lowStockItems})]}),e.jsx(gs,{className:"w-10 h-10 text-orange-600"})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Out of Stock"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:r.totals.outOfStockItems})]}),e.jsx(Ms,{className:"w-10 h-10 text-red-600"})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold",children:[r.totals.totalValue.toFixed(2)," KWD"]})]}),e.jsx(Ys,{className:"w-10 h-10 text-green-600"})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Stock by Category"}),e.jsx($s,{width:"100%",height:300,children:e.jsxs(ht,{children:[e.jsx(pt,{data:r.summary.reduce((u,C)=>{const A=u.find(w=>w.category===C.category);return A?A.value+=C.totalQuantity:u.push({category:C.category,value:C.totalQuantity}),u},[]),dataKey:"value",nameKey:"category",cx:"50%",cy:"50%",outerRadius:100,label:!0,children:r.summary.map((u,C)=>e.jsx(gt,{fill:R[C%R.length]},`cell-${C}`))}),e.jsx(Bs,{}),e.jsx(Os,{})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Stock Value by Material"}),e.jsx($s,{width:"100%",height:300,children:e.jsxs(la,{data:r.summary.slice(0,10),children:[e.jsx(na,{strokeDasharray:"3 3"}),e.jsx(oa,{dataKey:"sku"}),e.jsx(ia,{}),e.jsx(Bs,{}),e.jsx(Os,{}),e.jsx(da,{dataKey:"totalValue",fill:"#4F46E5"})]})})]})]})]}),s==="stock"&&r&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Stock Summary Report"}),e.jsxs("button",{onClick:()=>c(r.summary,"stock-summary"),className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Export CSV"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Material"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Min Level"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Value (KWD)"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.summary.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:u.sku}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:u.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:u.category}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[u.totalQuantity," ",u.unit]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:u.minStockLevel}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${u.stockStatus==="ADEQUATE"?"bg-green-100 text-green-800":u.stockStatus==="LOW"?"bg-orange-100 text-orange-800":"bg-red-100 text-red-800"}`,children:u.stockStatus})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[u.totalValue.toFixed(2)," KWD"]})]},u.id))})]})})]}),s==="low-stock"&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h2",{className:"text-xl font-bold text-red-600",children:["Low Stock Alerts (",v.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Material"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Current Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Min Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Shortfall"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Suggested Reorder"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map(u=>e.jsxs("tr",{className:"bg-red-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:u.sku}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:u.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-bold",children:[u.currentStock," ",u.unit]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:u.minStock}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600",children:u.shortfall}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:[u.suggestedReorderQty," ",u.unit]})]},u.id))})]})})]}),s==="consumption"&&k&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Material Consumption Report"}),e.jsxs("p",{className:"text-gray-600",children:["Total Usage Records: ",k.totalRecords]})]}),s==="purchases"&&y&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Purchase History"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"border p-4 rounded",children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Purchases"}),e.jsx("p",{className:"text-2xl font-bold",children:y.summary.totalPurchases})]}),e.jsxs("div",{className:"border p-4 rounded",children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Quantity"}),e.jsx("p",{className:"text-2xl font-bold",children:y.summary.totalQuantity})]}),e.jsxs("div",{className:"border p-4 rounded",children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold",children:[y.summary.totalAmount.toFixed(2)," KWD"]})]})]})]}),s==="vendors"&&i.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h2",{className:"text-xl font-bold",children:"Vendor Performance Report"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Vendor"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rating"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Purchases"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Avg Cost"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:u.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:["⭐ ",u.rating.toFixed(1)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:u.totalPurchases}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[u.totalAmount.toFixed(2)," KWD"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[u.avgUnitCost.toFixed(2)," KWD"]})]},u.id))})]})})]}),s==="valuation"&&a&&e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Stock Valuation Report (",a.valuationMethod,")"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Inventory Value"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600",children:[a.totalValue.toFixed(2)," KWD"]})]})]})})]})]})},Sr=()=>{const[s,b]=l.useState([]),[t,o]=l.useState(null),[n,N]=l.useState(!1),[r,T]=l.useState(null),[v,h]=l.useState({startDate:"",endDate:"",materialId:""});l.useEffect(()=>{k()},[]);const k=async()=>{N(!0);try{const g=new URLSearchParams;v.startDate&&g.append("startDate",v.startDate),v.endDate&&g.append("endDate",v.endDate),v.materialId&&g.append("materialId",v.materialId);const m=await(await fetch(`/api/reports/damages?${g}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}})).json();b(m.damages),o(m.summary)}catch(g){console.error("Failed to load damage report:",g)}finally{N(!1)}},j=()=>{window.print()},y=()=>{const g=["Date","Job Code","Material","SKU","Quantity","Reason","Value","Recorded By"],i=s.map(c=>[new Date(c.recordedAt).toLocaleDateString(),c.job.jobCode,c.material.name,c.material.sku,c.quantity,c.reason,c.estimatedValue.toFixed(2),c.recordedBy.name]),m=[g,...i].map(c=>c.join(",")).join(`
`),a=new Blob([m],{type:"text/csv"}),x=window.URL.createObjectURL(a),d=document.createElement("a");d.href=x,d.download=`damage-report-${new Date().toISOString().split("T")[0]}.csv`,d.click()};return e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 print:mb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(gs,{className:"w-8 h-8 text-red-600"}),"Damage Report"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Complete record of damaged materials with photos and job details"})]}),e.jsxs("div",{className:"flex gap-2 print:hidden",children:[e.jsxs("button",{onClick:j,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4"}),"Print"]}),e.jsxs("button",{onClick:y,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Export CSV"]})]})]})}),t&&e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6 print:mb-4",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-700 font-medium mb-1",children:"Total Damaged Items"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:t.totalItems})]}),e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-orange-700 font-medium mb-1",children:"Estimated Value Loss"}),e.jsxs("p",{className:"text-3xl font-bold text-orange-600",children:[t.totalValue.toFixed(2)," KWD"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-yellow-700 font-medium mb-1",children:"Most Damaged"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:t.mostDamagedMaterial})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium mb-1",children:"Recent Damage"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:new Date(t.recentDamageDate).toLocaleDateString()})]})]}),e.jsx("div",{className:"bg-white border rounded-lg p-4 mb-6 print:hidden",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:v.startDate,onChange:g=>h({...v,startDate:g.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:v.endDate,onChange:g=>h({...v,endDate:g.target.value}),className:"w-full border rounded px-3 py-2"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:k,className:"w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Apply Filters"})})]})}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden",children:n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading damage records..."})]}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(gs,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No damage records found"})]}):e.jsx("div",{className:"divide-y",children:s.map(g=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-red-600"}),g.material.name]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SKU: ",g.material.sku]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[g.quantity," ",g.material.unit]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[g.estimatedValue.toFixed(2)," KWD"]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 mb-3",children:[e.jsx("p",{className:"font-semibold text-blue-900 mb-1",children:"Job Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Job Code:"}),e.jsx("span",{className:"ml-2 font-medium text-blue-700",children:g.job.jobCode})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Title:"}),e.jsx("span",{className:"ml-2 font-medium",children:g.job.jobTitle})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(ut,{className:"w-3 h-3 inline mr-1"}),e.jsx("span",{className:"text-gray-700",children:g.job.jobAddress})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"font-semibold text-gray-700 mb-1",children:"Damage Reason:"}),e.jsx("p",{className:"text-gray-800 bg-yellow-50 border border-yellow-200 rounded p-2",children:g.reason})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Vs,{className:"w-4 h-4"}),new Date(g.recordedAt).toLocaleString()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ea,{className:"w-4 h-4"}),"Recorded by: ",g.recordedBy.name]})]})]}),e.jsxs("div",{className:"w-64",children:[e.jsxs("p",{className:"font-semibold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(fs,{className:"w-4 h-4"}),"Damage Photos (",g.photoUrls.length,")"]}),g.photoUrls.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:g.photoUrls.map((i,m)=>e.jsx("div",{className:"aspect-square border rounded overflow-hidden cursor-pointer hover:opacity-75 transition-opacity",onClick:()=>T(i),children:e.jsx("img",{src:i,alt:`Damage ${m+1}`,className:"w-full h-full object-cover"})},m))}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No photos available"})]})]})},g.id))})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 print:hidden",onClick:()=>T(null),children:e.jsx("div",{className:"max-w-4xl max-h-[90vh] p-4",children:e.jsx("img",{src:r,alt:"Damage",className:"max-w-full max-h-full object-contain"})})}),e.jsx("style",{children:`
        @media print {
          .print\\:hidden {
            display: none !important;
          }
          .print\\:mb-4 {
            margin-bottom: 1rem !important;
          }
        }
      `})]})},kr=()=>{const[s,b]=l.useState([]),[t,o]=l.useState("test@example.com"),[n,N]=l.useState("Test123!"),[r,T]=l.useState({hasToken:!1,hasUser:!1,userData:null}),v=(y,g="info")=>{const i={time:new Date().toLocaleTimeString(),message:y,type:g};b(m=>[i,...m])},h=()=>{const y=localStorage.getItem("authToken"),g=localStorage.getItem("user");let i=null;if(g)try{i=JSON.parse(g)}catch{v("Invalid user data in localStorage","error")}T({hasToken:!!y,hasUser:!!g,userData:i}),y?v(`Token found: ${y.substring(0,20)}...`,"success"):v("No token in localStorage","warning"),i&&v(`User data: ${i.email||i.id}`,"success")},k=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),v("🗑️ Cleared all auth data","warning"),h()},j=async()=>{v(`Attempting login with: ${t}`,"info");try{const y=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}),g=await y.json();y.ok&&g.success?(localStorage.setItem("authToken",g.token),localStorage.setItem("user",JSON.stringify(g.user)),v(`✅ Login successful for ${g.user.email}`,"success"),v(`Token saved: ${g.token.substring(0,20)}...`,"success"),h()):v(`❌ Login failed: ${g.message||"Unknown error"}`,"error")}catch(y){v(`❌ Error during login: ${y.message}`,"error")}};return l.useEffect(()=>{h(),v("🚀 Debug tool loaded","info")},[]),e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-indigo-600 mb-2",children:"🔍 Login Debug Tool"}),e.jsx("p",{className:"text-gray-600",children:"Test Parse authentication without redirects"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center",children:["📊 Current Auth Status",e.jsx("button",{onClick:h,className:"ml-auto px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:"🔄 Refresh"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-4 border-l-4 rounded ${r.hasToken?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"}`,children:r.hasToken?"✅ Token exists in localStorage":"❌ No token found"}),e.jsx("div",{className:`p-4 border-l-4 rounded ${r.hasUser?"bg-green-50 border-green-500 text-green-800":"bg-red-50 border-red-500 text-red-800"}`,children:r.hasUser?"✅ User data exists":"❌ No user data found"}),r.userData&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[e.jsx("strong",{children:"User Data:"}),e.jsx("pre",{className:"mt-2 text-sm overflow-auto",children:JSON.stringify(r.userData,null,2)})]}),e.jsx("button",{onClick:k,className:"w-full px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"🗑️ Clear Auth Data"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"🔐 Test Login"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:t,onChange:y=>o(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:n,onChange:y=>N(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsx("button",{onClick:j,className:"w-full px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"🚀 Test Login"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"📋 Response Logs"}),e.jsx("div",{className:"bg-gray-900 text-green-400 p-4 rounded h-96 overflow-auto font-mono text-sm",children:s.length===0?e.jsx("div",{children:"Waiting for actions..."}):s.map((y,g)=>e.jsxs("div",{className:"mb-1",children:["[",y.time,"] ",y.message]},g))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"⚡ Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>window.location.href="/login",className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"🔙 Go to Login Page"}),e.jsx("button",{onClick:()=>window.location.href="/dashboard",className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"📊 Go to Dashboard"})]})]})]})})},Ar=l.createContext(void 0),Rr=({children:s})=>{const[b,t]=l.useState([]),[o,n]=l.useState(!0),N=async()=>{try{const m=localStorage.getItem("authToken");if(!m){t([]),n(!1);return}const a=await Qe.get("/api/permissions/my-permissions",{headers:{Authorization:`Bearer ${m}`}});a.data.success&&t(a.data.data.permissions)}catch(m){console.error("Failed to fetch permissions:",m),t([])}finally{n(!1)}};l.useEffect(()=>{N()},[]);const r=(m,a)=>b.some(x=>x.resource===m&&x.action===a),T=m=>r(m,"VIEW"),v=m=>r(m,"CREATE"),h=m=>r(m,"EDIT"),k=m=>r(m,"DELETE"),j=m=>r(m,"APPROVE"),y=m=>r(m,"EXPORT"),g=m=>r(m,"MANAGE"),i=async()=>{n(!0),await N()};return e.jsx(Ar.Provider,{value:{permissions:b,loading:o,hasPermission:r,canView:T,canCreate:v,canEdit:h,canDelete:k,canApprove:j,canExport:y,canManage:g,refreshPermissions:i},children:s})},je=({children:s,allowedRoles:b=[],redirectTo:t="/scanner"})=>{const o=localStorage.getItem("user");if(!o)return e.jsx(es,{to:"/login",replace:!0});try{const N=JSON.parse(o).role;return b.length===0?e.jsx(e.Fragment,{children:s}):b.includes(N)?e.jsx(e.Fragment,{children:s}):e.jsx(es,{to:t,replace:!0})}catch{return localStorage.removeItem("authToken"),localStorage.removeItem("user"),e.jsx(es,{to:"/login",replace:!0})}};function Tr(){const[s,b]=l.useState(!1),[t,o]=l.useState(!0);return l.useEffect(()=>{(()=>{const N=bs(),r=localStorage.getItem("user");if(N&&r)try{JSON.parse(r),b(!0)}catch{localStorage.removeItem("authToken"),localStorage.removeItem("user"),b(!1)}else b(!1);o(!1)})()},[]),t?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e.jsx(Rr,{children:e.jsxs(sa,{children:[e.jsxs(ta,{children:[e.jsx(ie,{path:"/login",element:e.jsx(ir,{})}),e.jsx(ie,{path:"/debug-login",element:e.jsx(kr,{})}),e.jsxs(ie,{path:"/",element:s?e.jsx(pa,{}):e.jsx(es,{to:"/login",replace:!0}),children:[e.jsx(ie,{index:!0,element:e.jsx(es,{to:"/dashboard",replace:!0})}),e.jsx(ie,{path:"dashboard",element:e.jsx(va,{})}),e.jsx(ie,{path:"shipments",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(Ea,{})})}),e.jsx(ie,{path:"racks",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(Ma,{})})}),e.jsx(ie,{path:"materials",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(wr,{})})}),e.jsx(ie,{path:"material-reports",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(Cr,{})})}),e.jsx(ie,{path:"damage-report",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(Sr,{})})}),e.jsx(ie,{path:"moving-jobs",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(Va,{})})}),e.jsx(ie,{path:"jobs-management",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(bt,{})})}),e.jsx(ie,{path:"materials-management",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(yr,{})})}),e.jsx(ie,{path:"job-reports",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(fr,{})})}),e.jsx(ie,{path:"plugin-system",element:e.jsx(je,{allowedRoles:["ADMIN"],children:e.jsx(jr,{})})}),e.jsx(ie,{path:"approvals",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(Nr,{})})}),e.jsx(ie,{path:"invoices",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(dr,{})})}),e.jsx(ie,{path:"invoices/:id",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(mr,{})})}),e.jsx(ie,{path:"expenses",element:e.jsx(je,{allowedRoles:["ADMIN","MANAGER"],children:e.jsx(pr,{})})}),e.jsx(ie,{path:"settings",element:e.jsx(je,{allowedRoles:["ADMIN"],children:e.jsx(nr,{})})}),e.jsx(ie,{path:"settings/templates",element:e.jsx(je,{allowedRoles:["ADMIN"],children:e.jsx(gr,{})})}),e.jsx(ie,{path:"scanner",element:e.jsx(or,{})}),e.jsx(ie,{path:"profile",element:e.jsx(br,{})}),e.jsx(ie,{path:"my-jobs",element:e.jsx(je,{allowedRoles:["WORKER"],children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"My Jobs"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Your assigned moving jobs will appear here"})]})})}),e.jsx(ie,{path:"my-tasks",element:e.jsx(je,{allowedRoles:["WORKER"],children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"My Tasks"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Your current tasks and assignments"})]})})})]}),e.jsx(ie,{path:"*",element:e.jsx(es,{to:"/scanner",replace:!0})})]}),e.jsx(ma,{})]})})}const Pr=aa.createRoot(document.getElementById("root"));Pr.render(e.jsx(ra.StrictMode,{children:e.jsx(Tr,{})}));
